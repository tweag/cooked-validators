<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE NumericUnderscores #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE TypeSynonymInstances #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-orphans #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cooked.MockChain.Wallet</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Api</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Crypto.Wallet</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CWCrypto</span></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Default</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Function</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">on</span></span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Ledger</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Pl</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Ada</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Pl</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.CardanoWallet</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CW</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Credential</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Pl</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Crypto</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Crypto</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Validation</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Validation</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Value</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Pl</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unsafe.Coerce</span></span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-comment">-- * MockChain Wallets</span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-comment">-- $mockchainwallets</span><span>
</span><span id="line-25"></span><span class="hs-comment">--</span><span>
</span><span id="line-26"></span><span class="hs-comment">-- Because the mock wallets from the plutus-apps changes somewhat often, we will</span><span>
</span><span id="line-27"></span><span class="hs-comment">-- provide our own wrapper on top of them to make sure that we can easily deal</span><span>
</span><span id="line-28"></span><span class="hs-comment">-- changes from Plutus.</span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-keyword">type</span><span> </span><span id="Wallet"><span class="annot"><a href="Cooked.MockChain.Wallet.html#Wallet"><span class="hs-identifier hs-var">Wallet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CW.MockWallet</span></span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">type</span><span> </span><span id="PrivateKey"><span class="annot"><a href="Cooked.MockChain.Wallet.html#PrivateKey"><span class="hs-identifier hs-var">PrivateKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CWCrypto.XPrv</span></span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679558739"><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="Cooked.MockChain.Wallet.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-35"></span><span>  </span><span id="local-6989586621679558737"><span class="annot"><span class="annottext">== :: Wallet -&gt; Wallet -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var hs-var">(==)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Digest Blake2b_160 -&gt; Digest Blake2b_160 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span> </span><span class="annot"><span class="annottext">(Digest Blake2b_160 -&gt; Digest Blake2b_160 -&gt; Bool)
-&gt; (Wallet -&gt; Digest Blake2b_160) -&gt; Wallet -&gt; Wallet -&gt; Bool
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">Wallet -&gt; Digest Blake2b_160
</span><span class="hs-identifier hs-var hs-var">CW.mwWalletId</span></span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679558722"><span id="local-6989586621679558724"><span id="local-6989586621679558726"><span id="local-6989586621679558728"><span id="local-6989586621679558730"><span id="local-6989586621679558732"><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="Cooked.MockChain.Wallet.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-38"></span><span>  </span><span id="local-6989586621679558720"><span class="annot"><span class="annottext">compare :: Wallet -&gt; Wallet -&gt; Ordering
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">compare</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Digest Blake2b_160 -&gt; Digest Blake2b_160 -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">(Digest Blake2b_160 -&gt; Digest Blake2b_160 -&gt; Ordering)
-&gt; (Wallet -&gt; Digest Blake2b_160) -&gt; Wallet -&gt; Wallet -&gt; Ordering
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">Wallet -&gt; Digest Blake2b_160
</span><span class="hs-identifier hs-var hs-var">CW.mwWalletId</span></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="annot"><a href="Cooked.MockChain.Wallet.html#knownWallets"><span class="hs-identifier hs-type">knownWallets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cooked.MockChain.Wallet.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-41"></span><span id="knownWallets"><span class="annot"><span class="annottext">knownWallets :: [Wallet]
</span><a href="Cooked.MockChain.Wallet.html#knownWallets"><span class="hs-identifier hs-var hs-var">knownWallets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Wallet]
</span><span class="hs-identifier hs-var">CW.knownMockWallets</span></span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="annot"><a href="Cooked.MockChain.Wallet.html#wallet"><span class="hs-identifier hs-type">wallet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.Wallet.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span>
</span><span id="line-44"></span><span id="wallet"><span class="annot"><span class="annottext">wallet :: Int -&gt; Wallet
</span><a href="Cooked.MockChain.Wallet.html#wallet"><span class="hs-identifier hs-var hs-var">wallet</span></a></span></span><span> </span><span id="local-6989586621679558715"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679558715"><span class="hs-identifier hs-var">j</span></a></span></span><span>
</span><span id="line-45"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679558715"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679558715"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679558711"><span class="annot"><span class="annottext">i :: Int
</span><a href="#local-6989586621679558711"><span class="hs-identifier hs-var hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679558715"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[Wallet]
</span><a href="Cooked.MockChain.Wallet.html#knownWallets"><span class="hs-identifier hs-var">knownWallets</span></a></span><span> </span><span class="annot"><span class="annottext">[Wallet] -&gt; Int -&gt; Wallet
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679558711"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WalletNumber -&gt; Wallet
</span><span class="hs-identifier hs-var">CW.fromWalletNumber</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; WalletNumber
</span><span class="hs-identifier hs-var">CW.WalletNumber</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; WalletNumber) -&gt; Integer -&gt; WalletNumber
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679558715"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="annot"><a href="Cooked.MockChain.Wallet.html#walletPKHashToId"><span class="hs-identifier hs-type">walletPKHashToId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pl.PubKeyHash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-49"></span><span id="walletPKHashToId"><span class="annot"><span class="annottext">walletPKHashToId :: PubKeyHash -&gt; Maybe Int
</span><a href="Cooked.MockChain.Wallet.html#walletPKHashToId"><span class="hs-identifier hs-var hs-var">walletPKHashToId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PubKeyHash -&gt; Map PubKeyHash Int -&gt; Maybe Int)
-&gt; Map PubKeyHash Int -&gt; PubKeyHash -&gt; Maybe Int
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">PubKeyHash -&gt; Map PubKeyHash Int -&gt; Maybe Int
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">Map PubKeyHash Int
</span><a href="#local-6989586621679558704"><span class="hs-identifier hs-var">walletPKHashToIdMap</span></a></span><span>
</span><span id="line-50"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-51"></span><span>    </span><span id="local-6989586621679558704"><span class="annot"><span class="annottext">walletPKHashToIdMap :: Map PubKeyHash Int
</span><a href="#local-6989586621679558704"><span class="hs-identifier hs-var hs-var">walletPKHashToIdMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(PubKeyHash, Int)] -&gt; Map PubKeyHash Int
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(PubKeyHash, Int)] -&gt; Map PubKeyHash Int)
-&gt; ([Wallet] -&gt; [(PubKeyHash, Int)])
-&gt; [Wallet]
-&gt; Map PubKeyHash Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">([PubKeyHash] -&gt; [Int] -&gt; [(PubKeyHash, Int)])
-&gt; [Int] -&gt; [PubKeyHash] -&gt; [(PubKeyHash, Int)]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">[PubKeyHash] -&gt; [Int] -&gt; [(PubKeyHash, Int)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">([PubKeyHash] -&gt; [(PubKeyHash, Int)])
-&gt; ([Wallet] -&gt; [PubKeyHash]) -&gt; [Wallet] -&gt; [(PubKeyHash, Int)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Wallet -&gt; PubKeyHash) -&gt; [Wallet] -&gt; [PubKeyHash]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Wallet -&gt; PubKeyHash
</span><a href="Cooked.MockChain.Wallet.html#walletPKHash"><span class="hs-identifier hs-var">walletPKHash</span></a></span><span> </span><span class="annot"><span class="annottext">([Wallet] -&gt; Map PubKeyHash Int) -&gt; [Wallet] -&gt; Map PubKeyHash Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Wallet]
</span><a href="Cooked.MockChain.Wallet.html#knownWallets"><span class="hs-identifier hs-var">knownWallets</span></a></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="annot"><a href="Cooked.MockChain.Wallet.html#walletPK"><span class="hs-identifier hs-type">walletPK</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cooked.MockChain.Wallet.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pl.PubKey</span></span><span>
</span><span id="line-54"></span><span id="walletPK"><span class="annot"><span class="annottext">walletPK :: Wallet -&gt; PubKey
</span><a href="Cooked.MockChain.Wallet.html#walletPK"><span class="hs-identifier hs-var hs-var">walletPK</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PaymentPubKey -&gt; PubKey
</span><span class="hs-identifier hs-var hs-var">Pl.unPaymentPubKey</span></span><span> </span><span class="annot"><span class="annottext">(PaymentPubKey -&gt; PubKey)
-&gt; (Wallet -&gt; PaymentPubKey) -&gt; Wallet -&gt; PubKey
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Wallet -&gt; PaymentPubKey
</span><span class="hs-identifier hs-var">CW.paymentPubKey</span></span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="annot"><a href="Cooked.MockChain.Wallet.html#walletStakingPK"><span class="hs-identifier hs-type">walletStakingPK</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cooked.MockChain.Wallet.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pl.PubKey</span></span><span>
</span><span id="line-57"></span><span id="walletStakingPK"><span class="annot"><span class="annottext">walletStakingPK :: Wallet -&gt; Maybe PubKey
</span><a href="Cooked.MockChain.Wallet.html#walletStakingPK"><span class="hs-identifier hs-var hs-var">walletStakingPK</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(XPrv -&gt; PubKey) -&gt; Maybe XPrv -&gt; Maybe PubKey
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">XPrv -&gt; PubKey
</span><span class="hs-identifier hs-var">Crypto.toPublicKey</span></span><span> </span><span class="annot"><span class="annottext">(Maybe XPrv -&gt; Maybe PubKey)
-&gt; (Wallet -&gt; Maybe XPrv) -&gt; Wallet -&gt; Maybe PubKey
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Wallet -&gt; Maybe XPrv
</span><a href="Cooked.MockChain.Wallet.html#walletStakingSK"><span class="hs-identifier hs-var">walletStakingSK</span></a></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="annot"><a href="Cooked.MockChain.Wallet.html#walletPKHash"><span class="hs-identifier hs-type">walletPKHash</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cooked.MockChain.Wallet.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pl.PubKeyHash</span></span><span>
</span><span id="line-60"></span><span id="walletPKHash"><span class="annot"><span class="annottext">walletPKHash :: Wallet -&gt; PubKeyHash
</span><a href="Cooked.MockChain.Wallet.html#walletPKHash"><span class="hs-identifier hs-var hs-var">walletPKHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PubKey -&gt; PubKeyHash
</span><span class="hs-identifier hs-var">Pl.pubKeyHash</span></span><span> </span><span class="annot"><span class="annottext">(PubKey -&gt; PubKeyHash)
-&gt; (Wallet -&gt; PubKey) -&gt; Wallet -&gt; PubKeyHash
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Wallet -&gt; PubKey
</span><a href="Cooked.MockChain.Wallet.html#walletPK"><span class="hs-identifier hs-var">walletPK</span></a></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="annot"><a href="Cooked.MockChain.Wallet.html#walletStakingPKHash"><span class="hs-identifier hs-type">walletStakingPKHash</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cooked.MockChain.Wallet.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pl.PubKeyHash</span></span><span>
</span><span id="line-63"></span><span id="walletStakingPKHash"><span class="annot"><span class="annottext">walletStakingPKHash :: Wallet -&gt; Maybe PubKeyHash
</span><a href="Cooked.MockChain.Wallet.html#walletStakingPKHash"><span class="hs-identifier hs-var hs-var">walletStakingPKHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PubKey -&gt; PubKeyHash) -&gt; Maybe PubKey -&gt; Maybe PubKeyHash
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">PubKey -&gt; PubKeyHash
</span><span class="hs-identifier hs-var">Crypto.pubKeyHash</span></span><span> </span><span class="annot"><span class="annottext">(Maybe PubKey -&gt; Maybe PubKeyHash)
-&gt; (Wallet -&gt; Maybe PubKey) -&gt; Wallet -&gt; Maybe PubKeyHash
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Wallet -&gt; Maybe PubKey
</span><a href="Cooked.MockChain.Wallet.html#walletStakingPK"><span class="hs-identifier hs-var">walletStakingPK</span></a></span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="annot"><a href="Cooked.MockChain.Wallet.html#walletAddress"><span class="hs-identifier hs-type">walletAddress</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cooked.MockChain.Wallet.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pl.Address</span></span><span>
</span><span id="line-66"></span><span id="walletAddress"><span class="annot"><span class="annottext">walletAddress :: Wallet -&gt; Address
</span><a href="Cooked.MockChain.Wallet.html#walletAddress"><span class="hs-identifier hs-var hs-var">walletAddress</span></a></span></span><span> </span><span id="local-6989586621679558691"><span class="annot"><span class="annottext">Wallet
</span><a href="#local-6989586621679558691"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-67"></span><span>  </span><span class="annot"><span class="annottext">Credential -&gt; Maybe StakingCredential -&gt; Address
</span><span class="hs-identifier hs-var">Pl.Address</span></span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PubKeyHash -&gt; Credential
</span><span class="hs-identifier hs-var">Pl.PubKeyCredential</span></span><span> </span><span class="annot"><span class="annottext">(PubKeyHash -&gt; Credential) -&gt; PubKeyHash -&gt; Credential
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Wallet -&gt; PubKeyHash
</span><a href="Cooked.MockChain.Wallet.html#walletPKHash"><span class="hs-identifier hs-var">walletPKHash</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet
</span><a href="#local-6989586621679558691"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Credential -&gt; StakingCredential
</span><span class="hs-identifier hs-var">Pl.StakingHash</span></span><span> </span><span class="annot"><span class="annottext">(Credential -&gt; StakingCredential)
-&gt; (PubKeyHash -&gt; Credential) -&gt; PubKeyHash -&gt; StakingCredential
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PubKeyHash -&gt; Credential
</span><span class="hs-identifier hs-var">Pl.PubKeyCredential</span></span><span> </span><span class="annot"><span class="annottext">(PubKeyHash -&gt; StakingCredential)
-&gt; Maybe PubKeyHash -&gt; Maybe StakingCredential
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Wallet -&gt; Maybe PubKeyHash
</span><a href="Cooked.MockChain.Wallet.html#walletStakingPKHash"><span class="hs-identifier hs-var">walletStakingPKHash</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet
</span><a href="#local-6989586621679558691"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="annot"><a href="Cooked.MockChain.Wallet.html#walletSK"><span class="hs-identifier hs-type">walletSK</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CW.MockWallet</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.Wallet.html#PrivateKey"><span class="hs-identifier hs-type">PrivateKey</span></a></span><span>
</span><span id="line-72"></span><span id="walletSK"><span class="annot"><span class="annottext">walletSK :: Wallet -&gt; XPrv
</span><a href="Cooked.MockChain.Wallet.html#walletSK"><span class="hs-identifier hs-var hs-var">walletSK</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PaymentPrivateKey -&gt; XPrv
</span><span class="hs-identifier hs-var hs-var">Pl.unPaymentPrivateKey</span></span><span> </span><span class="annot"><span class="annottext">(PaymentPrivateKey -&gt; XPrv)
-&gt; (Wallet -&gt; PaymentPrivateKey) -&gt; Wallet -&gt; XPrv
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Wallet -&gt; PaymentPrivateKey
</span><span class="hs-identifier hs-var">CW.paymentPrivateKey</span></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-comment">-- Massive hack to be able to open a MockPrivateKey; this is needed because</span><span>
</span><span id="line-75"></span><span class="hs-comment">-- the constructor and accessor to MockPrivateKey are not exported. Hence,</span><span>
</span><span id="line-76"></span><span class="hs-comment">-- we make an isomorphic datatype, unsafeCoerce to this datatype then extract</span><span>
</span><span id="line-77"></span><span class="hs-comment">-- whatever we need from it.</span><span>
</span><span id="line-78"></span><span class="hs-keyword">newtype</span><span> </span><span id="HACK"><span class="annot"><a href="Cooked.MockChain.Wallet.html#HACK"><span class="hs-identifier hs-var">HACK</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="HACK"><span class="annot"><a href="Cooked.MockChain.Wallet.html#HACK"><span class="hs-identifier hs-var">HACK</span></a></span></span><span> </span><span class="hs-special">{</span><span id="please"><span class="annot"><span class="annottext">HACK -&gt; XPrv
</span><a href="Cooked.MockChain.Wallet.html#please"><span class="hs-identifier hs-var hs-var">please</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CWCrypto.XPrv</span></span><span class="hs-special">}</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-comment">-- | Don't use this; its a hack and will be deprecated once we have time</span><span>
</span><span id="line-81"></span><span class="hs-comment">--  to make a PR into plutus exporting the things we need. If you use this anyway,</span><span>
</span><span id="line-82"></span><span class="hs-comment">--  make sure that you only apply it to @MockPrivateKey@; the function is polymorphic</span><span>
</span><span id="line-83"></span><span class="hs-comment">--  because @MockPrivateKey@ is not exported either; having a dedicated function makes</span><span>
</span><span id="line-84"></span><span class="hs-comment">--  it easy to test that this works: check the @Cooked.MockChain.WalletSpec@ test module.</span><span>
</span><span id="line-85"></span><span id="local-6989586621679558782"><span class="annot"><a href="Cooked.MockChain.Wallet.html#hackUnMockPrivateKey"><span class="hs-identifier hs-type">hackUnMockPrivateKey</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679558782"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CWCrypto.XPrv</span></span></span><span>
</span><span id="line-86"></span><span id="hackUnMockPrivateKey"><span class="annot"><span class="annottext">hackUnMockPrivateKey :: a -&gt; XPrv
</span><a href="Cooked.MockChain.Wallet.html#hackUnMockPrivateKey"><span class="hs-identifier hs-var hs-var">hackUnMockPrivateKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HACK -&gt; XPrv
</span><a href="Cooked.MockChain.Wallet.html#please"><span class="hs-identifier hs-var hs-var">please</span></a></span><span> </span><span class="annot"><span class="annottext">(HACK -&gt; XPrv) -&gt; (a -&gt; HACK) -&gt; a -&gt; XPrv
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; HACK
forall a b. a -&gt; b
</span><span class="hs-identifier hs-var">unsafeCoerce</span></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="annot"><a href="Cooked.MockChain.Wallet.html#walletStakingSK"><span class="hs-identifier hs-type">walletStakingSK</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cooked.MockChain.Wallet.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Cooked.MockChain.Wallet.html#PrivateKey"><span class="hs-identifier hs-type">PrivateKey</span></a></span><span>
</span><span id="line-89"></span><span id="walletStakingSK"><span class="annot"><span class="annottext">walletStakingSK :: Wallet -&gt; Maybe XPrv
</span><a href="Cooked.MockChain.Wallet.html#walletStakingSK"><span class="hs-identifier hs-var hs-var">walletStakingSK</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(MockPrivateKey -&gt; XPrv) -&gt; Maybe MockPrivateKey -&gt; Maybe XPrv
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">MockPrivateKey -&gt; XPrv
forall a. a -&gt; XPrv
</span><a href="Cooked.MockChain.Wallet.html#hackUnMockPrivateKey"><span class="hs-identifier hs-var">hackUnMockPrivateKey</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe MockPrivateKey -&gt; Maybe XPrv)
-&gt; (Wallet -&gt; Maybe MockPrivateKey) -&gt; Wallet -&gt; Maybe XPrv
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Wallet -&gt; Maybe MockPrivateKey
</span><span class="hs-identifier hs-var hs-var">CW.mwStakeKey</span></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="annot"><a href="Cooked.MockChain.Wallet.html#toPKHMap"><span class="hs-identifier hs-type">toPKHMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cooked.MockChain.Wallet.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pl.PubKeyHash</span></span><span> </span><span class="annot"><a href="Cooked.MockChain.Wallet.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span>
</span><span id="line-92"></span><span id="toPKHMap"><span class="annot"><span class="annottext">toPKHMap :: [Wallet] -&gt; Map PubKeyHash Wallet
</span><a href="Cooked.MockChain.Wallet.html#toPKHMap"><span class="hs-identifier hs-var hs-var">toPKHMap</span></a></span></span><span> </span><span id="local-6989586621679558677"><span class="annot"><span class="annottext">[Wallet]
</span><a href="#local-6989586621679558677"><span class="hs-identifier hs-var">ws</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(PubKeyHash, Wallet)] -&gt; Map PubKeyHash Wallet
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Wallet -&gt; PubKeyHash
</span><a href="Cooked.MockChain.Wallet.html#walletPKHash"><span class="hs-identifier hs-var">walletPKHash</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet
</span><a href="#local-6989586621679558676"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Wallet
</span><a href="#local-6989586621679558676"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679558676"><span class="annot"><span class="annottext">Wallet
</span><a href="#local-6989586621679558676"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Wallet]
</span><a href="#local-6989586621679558677"><span class="hs-identifier hs-var">ws</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-comment">-- * Signs a transaction</span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="annot"><a href="Cooked.MockChain.Wallet.html#txAddSignature"><span class="hs-identifier hs-type">txAddSignature</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cooked.MockChain.Wallet.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pl.Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pl.Tx</span></span><span>
</span><span id="line-97"></span><span id="txAddSignature"><span class="annot"><span class="annottext">txAddSignature :: Wallet -&gt; Tx -&gt; Tx
</span><a href="Cooked.MockChain.Wallet.html#txAddSignature"><span class="hs-identifier hs-var hs-var">txAddSignature</span></a></span></span><span> </span><span id="local-6989586621679558674"><span class="annot"><span class="annottext">Wallet
</span><a href="#local-6989586621679558674"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XPrv -&gt; Tx -&gt; Tx
</span><span class="hs-identifier hs-var">Pl.addSignature'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Wallet -&gt; XPrv
</span><a href="Cooked.MockChain.Wallet.html#walletSK"><span class="hs-identifier hs-var">walletSK</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet
</span><a href="#local-6989586621679558674"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="annot"><a href="Cooked.MockChain.Wallet.html#txAddSignatureAPI"><span class="hs-identifier hs-type">txAddSignatureAPI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cooked.MockChain.Wallet.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Tx</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.AlonzoEra</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Tx</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.AlonzoEra</span></span><span>
</span><span id="line-100"></span><span id="txAddSignatureAPI"><span class="annot"><span class="annottext">txAddSignatureAPI :: Wallet -&gt; Tx AlonzoEra -&gt; Tx AlonzoEra
</span><a href="Cooked.MockChain.Wallet.html#txAddSignatureAPI"><span class="hs-identifier hs-var hs-var">txAddSignatureAPI</span></a></span></span><span> </span><span id="local-6989586621679558671"><span class="annot"><span class="annottext">Wallet
</span><a href="#local-6989586621679558671"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XPrv -&gt; Tx AlonzoEra -&gt; Tx AlonzoEra
</span><span class="hs-identifier hs-var">Validation.addSignature</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Wallet -&gt; XPrv
</span><a href="Cooked.MockChain.Wallet.html#walletSK"><span class="hs-identifier hs-var">walletSK</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet
</span><a href="#local-6989586621679558671"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="hs-comment">-- * Initial distribution of funds</span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="hs-comment">-- $initfundsdistr</span><span>
</span><span id="line-105"></span><span class="hs-comment">--</span><span>
</span><span id="line-106"></span><span class="hs-comment">-- Are nothing but is a map from Wallet to Value; we'll just proxy</span><span>
</span><span id="line-107"></span><span class="hs-comment">-- the underlying plutus definitions to make it easer when we have</span><span>
</span><span id="line-108"></span><span class="hs-comment">-- to plug our own, if we ever have the need</span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-comment">-- | Describes the initial distribution of /UTxOs/ per wallet. This is important since</span><span>
</span><span id="line-111"></span><span class="hs-comment">--  transaction validation must specify a /collateral/, hence, wallets must posses more</span><span>
</span><span id="line-112"></span><span class="hs-comment">--  than one UTxO to begin with in order to execute a transaction and have some collateral</span><span>
</span><span id="line-113"></span><span class="hs-comment">--  option. The @txCollateral@ is transfered to the node operator in case the transaction</span><span>
</span><span id="line-114"></span><span class="hs-comment">--  fails to validate.</span><span>
</span><span id="line-115"></span><span class="hs-comment">--</span><span>
</span><span id="line-116"></span><span class="hs-comment">--  An initial distribution defined by:</span><span>
</span><span id="line-117"></span><span class="hs-comment">--</span><span>
</span><span id="line-118"></span><span class="hs-comment">--  &gt; i0 = InitialDistribution $ M.fromList</span><span>
</span><span id="line-119"></span><span class="hs-comment">--  &gt;        [ (wallet 1 , [ Pl.lovelaveValueOf 42000000</span><span>
</span><span id="line-120"></span><span class="hs-comment">--  &gt;                      , Pl.lovelaceValueOf 2000000 &lt;&gt; quickValue &quot;TOK&quot; 1</span><span>
</span><span id="line-121"></span><span class="hs-comment">--  &gt;                      ]</span><span>
</span><span id="line-122"></span><span class="hs-comment">--  &gt;        , (wallet 2 , [Pl.lovelaveValueOf 10000000])</span><span>
</span><span id="line-123"></span><span class="hs-comment">--  &gt;        , (wallet 3 , [Pl.lovelaceValueOf 10000000 &lt;&gt; permanentValue &quot;XYZ&quot; 10])</span><span>
</span><span id="line-124"></span><span class="hs-comment">--  &gt;        ]</span><span>
</span><span id="line-125"></span><span class="hs-comment">--</span><span>
</span><span id="line-126"></span><span class="hs-comment">--  Specifies a starting state where @wallet 1@ contains two /UTxOs/, one with 42 Ada</span><span>
</span><span id="line-127"></span><span class="hs-comment">--  and one with 2 Ada and one &quot;TOK&quot; token; @wallet 2@ contains a single /UTxO/ with 10 Ada and</span><span>
</span><span id="line-128"></span><span class="hs-comment">--  @wallet 3@ has 10 Ada and a permanent value. Check #quickvalues for more on quick</span><span>
</span><span id="line-129"></span><span class="hs-comment">--  and permanent values. (Remember: 1 Ada = 1000000 Lovelace)</span><span>
</span><span id="line-130"></span><span class="hs-comment">--</span><span>
</span><span id="line-131"></span><span class="hs-comment">--  Check the corresponding @Default InitialDistribution@ instance for the default value.</span><span>
</span><span id="line-132"></span><span class="hs-keyword">newtype</span><span> </span><span id="InitialDistribution"><span class="annot"><a href="Cooked.MockChain.Wallet.html#InitialDistribution"><span class="hs-identifier hs-var">InitialDistribution</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="InitialDistribution"><span class="annot"><a href="Cooked.MockChain.Wallet.html#InitialDistribution"><span class="hs-identifier hs-var">InitialDistribution</span></a></span></span><span> </span><span class="hs-special">{</span><span id="distribution"><span class="annot"><span class="annottext">InitialDistribution -&gt; Map Wallet [Value]
</span><a href="Cooked.MockChain.Wallet.html#distribution"><span class="hs-identifier hs-var hs-var">distribution</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Cooked.MockChain.Wallet.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Pl.Value</span></span><span class="hs-special">]</span><span class="hs-special">}</span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679558664"><span id="local-6989586621679558666"><span class="annot"><span class="annottext">InitialDistribution -&gt; InitialDistribution -&gt; Bool
(InitialDistribution -&gt; InitialDistribution -&gt; Bool)
-&gt; (InitialDistribution -&gt; InitialDistribution -&gt; Bool)
-&gt; Eq InitialDistribution
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: InitialDistribution -&gt; InitialDistribution -&gt; Bool
$c/= :: InitialDistribution -&gt; InitialDistribution -&gt; Bool
== :: InitialDistribution -&gt; InitialDistribution -&gt; Bool
$c== :: InitialDistribution -&gt; InitialDistribution -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679558658"><span id="local-6989586621679558660"><span id="local-6989586621679558662"><span class="annot"><span class="annottext">Int -&gt; InitialDistribution -&gt; ShowS
[InitialDistribution] -&gt; ShowS
InitialDistribution -&gt; String
(Int -&gt; InitialDistribution -&gt; ShowS)
-&gt; (InitialDistribution -&gt; String)
-&gt; ([InitialDistribution] -&gt; ShowS)
-&gt; Show InitialDistribution
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [InitialDistribution] -&gt; ShowS
$cshowList :: [InitialDistribution] -&gt; ShowS
show :: InitialDistribution -&gt; String
$cshow :: InitialDistribution -&gt; String
showsPrec :: Int -&gt; InitialDistribution -&gt; ShowS
$cshowsPrec :: Int -&gt; InitialDistribution -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="hs-comment">-- | An initial distribution is valid if all utxos being created contain at least</span><span>
</span><span id="line-136"></span><span class="hs-comment">--  a minimum amount of Ada: 'minAda'.</span><span>
</span><span id="line-137"></span><span class="annot"><a href="Cooked.MockChain.Wallet.html#validInitialDistribution"><span class="hs-identifier hs-type">validInitialDistribution</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cooked.MockChain.Wallet.html#InitialDistribution"><span class="hs-identifier hs-type">InitialDistribution</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-138"></span><span id="validInitialDistribution"><span class="annot"><span class="annottext">validInitialDistribution :: InitialDistribution -&gt; Bool
</span><a href="Cooked.MockChain.Wallet.html#validInitialDistribution"><span class="hs-identifier hs-var hs-var">validInitialDistribution</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Wallet, [Value]) -&gt; Bool) -&gt; [(Wallet, [Value])] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Value -&gt; Bool) -&gt; [Value] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Bool
</span><a href="#local-6989586621679558654"><span class="hs-identifier hs-var">hasMinAda</span></a></span><span> </span><span class="annot"><span class="annottext">([Value] -&gt; Bool)
-&gt; ((Wallet, [Value]) -&gt; [Value]) -&gt; (Wallet, [Value]) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Wallet, [Value]) -&gt; [Value]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Wallet, [Value])] -&gt; Bool)
-&gt; (InitialDistribution -&gt; [(Wallet, [Value])])
-&gt; InitialDistribution
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map Wallet [Value] -&gt; [(Wallet, [Value])]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.toList</span></span><span> </span><span class="annot"><span class="annottext">(Map Wallet [Value] -&gt; [(Wallet, [Value])])
-&gt; (InitialDistribution -&gt; Map Wallet [Value])
-&gt; InitialDistribution
-&gt; [(Wallet, [Value])]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">InitialDistribution -&gt; Map Wallet [Value]
</span><a href="Cooked.MockChain.Wallet.html#distribution"><span class="hs-identifier hs-var hs-var">distribution</span></a></span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-140"></span><span>    </span><span id="local-6989586621679558654"><span class="annot"><span class="annottext">hasMinAda :: Value -&gt; Bool
</span><a href="#local-6989586621679558654"><span class="hs-identifier hs-var hs-var">hasMinAda</span></a></span></span><span> </span><span id="local-6989586621679558652"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679558652"><span class="hs-identifier hs-var">vl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="Cooked.MockChain.Wallet.html#minAda"><span class="hs-identifier hs-var">minAda</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Bool
</span><span class="hs-operator hs-var">`Pl.leq`</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679558652"><span class="hs-identifier hs-var">vl</span></a></span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span class="hs-comment">-- | Proxy to 'Pl.minAdaTxOut' as a 'Pl.Value'</span><span>
</span><span id="line-143"></span><span class="annot"><a href="Cooked.MockChain.Wallet.html#minAda"><span class="hs-identifier hs-type">minAda</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pl.Value</span></span><span>
</span><span id="line-144"></span><span id="minAda"><span class="annot"><span class="annottext">minAda :: Value
</span><a href="Cooked.MockChain.Wallet.html#minAda"><span class="hs-identifier hs-var hs-var">minAda</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ada -&gt; Value
</span><span class="hs-identifier hs-var">Pl.toValue</span></span><span> </span><span class="annot"><span class="annottext">Ada
</span><span class="hs-identifier hs-var">Pl.minAdaTxOut</span></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679558643"><span id="local-6989586621679558645"><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="Cooked.MockChain.Wallet.html#InitialDistribution"><span class="hs-identifier hs-type">InitialDistribution</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-147"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.Wallet.html#InitialDistribution"><span class="hs-identifier hs-type">InitialDistribution</span></a></span><span> </span><span id="local-6989586621679558641"><span class="annot"><span class="annottext">Map Wallet [Value]
</span><a href="#local-6989586621679558641"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679558640"><span class="annot"><span class="annottext">&lt;&gt; :: InitialDistribution -&gt; InitialDistribution -&gt; InitialDistribution
</span><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.Wallet.html#InitialDistribution"><span class="hs-identifier hs-type">InitialDistribution</span></a></span><span> </span><span id="local-6989586621679558639"><span class="annot"><span class="annottext">Map Wallet [Value]
</span><a href="#local-6989586621679558639"><span class="hs-identifier hs-var">j</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Wallet [Value] -&gt; InitialDistribution
</span><a href="Cooked.MockChain.Wallet.html#InitialDistribution"><span class="hs-identifier hs-var">InitialDistribution</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Wallet [Value] -&gt; InitialDistribution)
-&gt; Map Wallet [Value] -&gt; InitialDistribution
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([Value] -&gt; [Value] -&gt; [Value])
-&gt; Map Wallet [Value] -&gt; Map Wallet [Value] -&gt; Map Wallet [Value]
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.unionWith</span></span><span> </span><span class="annot"><span class="annottext">[Value] -&gt; [Value] -&gt; [Value]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="annot"><span class="annottext">Map Wallet [Value]
</span><a href="#local-6989586621679558641"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Map Wallet [Value]
</span><a href="#local-6989586621679558639"><span class="hs-identifier hs-var">j</span></a></span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679558632"><span id="local-6989586621679558634"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="Cooked.MockChain.Wallet.html#InitialDistribution"><span class="hs-identifier hs-type">InitialDistribution</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-150"></span><span>  </span><span id="local-6989586621679558630"><span class="annot"><span class="annottext">mempty :: InitialDistribution
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Wallet [Value] -&gt; InitialDistribution
</span><a href="Cooked.MockChain.Wallet.html#InitialDistribution"><span class="hs-identifier hs-var">InitialDistribution</span></a></span><span> </span><span class="annot"><span class="annottext">Map Wallet [Value]
forall k a. Map k a
</span><span class="hs-identifier hs-var">M.empty</span></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Default</span></span><span> </span><span class="annot"><a href="Cooked.MockChain.Wallet.html#InitialDistribution"><span class="hs-identifier hs-type">InitialDistribution</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-153"></span><span>  </span><span id="local-6989586621679558626"><span class="annot"><span class="annottext">def :: InitialDistribution
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">def</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Wallet [Value] -&gt; InitialDistribution
</span><a href="Cooked.MockChain.Wallet.html#InitialDistribution"><span class="hs-identifier hs-var">InitialDistribution</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Wallet [Value] -&gt; InitialDistribution)
-&gt; Map Wallet [Value] -&gt; InitialDistribution
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Wallet, [Value])] -&gt; Map Wallet [Value]
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(Wallet, [Value])] -&gt; Map Wallet [Value])
-&gt; [(Wallet, [Value])] -&gt; Map Wallet [Value]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Wallet] -&gt; [[Value]] -&gt; [(Wallet, [Value])]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Wallet]
</span><a href="Cooked.MockChain.Wallet.html#knownWallets"><span class="hs-identifier hs-var">knownWallets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Value] -&gt; [[Value]]
forall a. a -&gt; [a]
</span><span class="hs-identifier hs-var">repeat</span></span><span> </span><span class="annot"><span class="annottext">([Value] -&gt; [[Value]]) -&gt; [Value] -&gt; [[Value]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Value -&gt; [Value]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679558622"><span class="hs-identifier hs-var">defLovelace</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-155"></span><span>      </span><span id="local-6989586621679558622"><span class="annot"><span class="annottext">defLovelace :: Value
</span><a href="#local-6989586621679558622"><span class="hs-identifier hs-var hs-var">defLovelace</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Value
</span><span class="hs-identifier hs-var">Pl.lovelaceValueOf</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">100_000_000</span></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="annot"><a href="Cooked.MockChain.Wallet.html#distributionFromList"><span class="hs-identifier hs-type">distributionFromList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.Wallet.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Pl.Value</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.Wallet.html#InitialDistribution"><span class="hs-identifier hs-type">InitialDistribution</span></a></span><span>
</span><span id="line-158"></span><span id="distributionFromList"><span class="annot"><span class="annottext">distributionFromList :: [(Wallet, [Value])] -&gt; InitialDistribution
</span><a href="Cooked.MockChain.Wallet.html#distributionFromList"><span class="hs-identifier hs-var hs-var">distributionFromList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Wallet [Value] -&gt; InitialDistribution
</span><a href="Cooked.MockChain.Wallet.html#InitialDistribution"><span class="hs-identifier hs-var">InitialDistribution</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Wallet [Value] -&gt; InitialDistribution)
-&gt; ([(Wallet, [Value])] -&gt; Map Wallet [Value])
-&gt; [(Wallet, [Value])]
-&gt; InitialDistribution
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(Wallet, [Value])] -&gt; Map Wallet [Value]
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="hs-comment">-- | Extension of the default initial distribution with additional value in</span><span>
</span><span id="line-161"></span><span class="hs-comment">-- some wallets.</span><span>
</span><span id="line-162"></span><span class="annot"><a href="Cooked.MockChain.Wallet.html#initialDistribution%27"><span class="hs-identifier hs-type">initialDistribution'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.Wallet.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Pl.Value</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.Wallet.html#InitialDistribution"><span class="hs-identifier hs-type">InitialDistribution</span></a></span><span>
</span><span id="line-163"></span><span id="initialDistribution%27"><span class="annot"><span class="annottext">initialDistribution' :: [(Wallet, [Value])] -&gt; InitialDistribution
</span><a href="Cooked.MockChain.Wallet.html#initialDistribution%27"><span class="hs-identifier hs-var hs-var">initialDistribution'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InitialDistribution
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span> </span><span class="annot"><span class="annottext">InitialDistribution -&gt; InitialDistribution -&gt; InitialDistribution
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(InitialDistribution -&gt; InitialDistribution)
-&gt; ([(Wallet, [Value])] -&gt; InitialDistribution)
-&gt; [(Wallet, [Value])]
-&gt; InitialDistribution
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(Wallet, [Value])] -&gt; InitialDistribution
</span><a href="Cooked.MockChain.Wallet.html#distributionFromList"><span class="hs-identifier hs-var">distributionFromList</span></a></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span class="annot"><a href="Cooked.MockChain.Wallet.html#initialTxFor"><span class="hs-identifier hs-type">initialTxFor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cooked.MockChain.Wallet.html#InitialDistribution"><span class="hs-identifier hs-type">InitialDistribution</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pl.Tx</span></span><span>
</span><span id="line-166"></span><span id="initialTxFor"><span class="annot"><span class="annottext">initialTxFor :: InitialDistribution -&gt; Tx
</span><a href="Cooked.MockChain.Wallet.html#initialTxFor"><span class="hs-identifier hs-var hs-var">initialTxFor</span></a></span></span><span> </span><span id="local-6989586621679558617"><span class="annot"><span class="annottext">InitialDistribution
</span><a href="#local-6989586621679558617"><span class="hs-identifier hs-var">initDist</span></a></span></span><span>
</span><span id="line-167"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InitialDistribution -&gt; Bool
</span><a href="Cooked.MockChain.Wallet.html#validInitialDistribution"><span class="hs-identifier hs-var">validInitialDistribution</span></a></span><span> </span><span class="annot"><span class="annottext">InitialDistribution
</span><a href="#local-6989586621679558617"><span class="hs-identifier hs-var">initDist</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-168"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Tx
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Not all UTxOs have at least minAda; this initial distribution is unusable&quot;</span></span><span>
</span><span id="line-169"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-170"></span><span>    </span><span class="annot"><span class="annottext">Tx
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-171"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">txMint :: Value
</span><span class="hs-identifier hs-var">Pl.txMint</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Value] -&gt; Value
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Wallet, [Value]) -&gt; Value) -&gt; [(Wallet, [Value])] -&gt; [Value]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Value] -&gt; Value
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([Value] -&gt; Value)
-&gt; ((Wallet, [Value]) -&gt; [Value]) -&gt; (Wallet, [Value]) -&gt; Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Wallet, [Value]) -&gt; [Value]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Wallet, [Value])]
</span><a href="#local-6989586621679558613"><span class="hs-identifier hs-var">initDist'</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-172"></span><span>        </span><span class="annot"><span class="annottext">txOutputs :: [TxOut]
</span><span class="hs-identifier hs-var">Pl.txOutputs</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Wallet, [Value]) -&gt; [TxOut]) -&gt; [(Wallet, [Value])] -&gt; [TxOut]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679558610"><span class="annot"><span class="annottext">Wallet
</span><a href="#local-6989586621679558610"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679558609"><span class="annot"><span class="annottext">[Value]
</span><a href="#local-6989586621679558609"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Value -&gt; TxOut) -&gt; [Value] -&gt; [TxOut]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Wallet -&gt; Value -&gt; TxOut
</span><a href="#local-6989586621679558608"><span class="hs-identifier hs-var">initUtxosFor</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet
</span><a href="#local-6989586621679558610"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Value]
</span><a href="#local-6989586621679558609"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Wallet, [Value])]
</span><a href="#local-6989586621679558613"><span class="hs-identifier hs-var">initDist'</span></a></span><span>
</span><span id="line-173"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-174"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-175"></span><span>    </span><span id="local-6989586621679558608"><span class="annot"><span class="annottext">initUtxosFor :: Wallet -&gt; Value -&gt; TxOut
</span><a href="#local-6989586621679558608"><span class="hs-identifier hs-var hs-var">initUtxosFor</span></a></span></span><span> </span><span id="local-6989586621679558607"><span class="annot"><span class="annottext">Wallet
</span><a href="#local-6989586621679558607"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621679558606"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679558606"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Address -&gt; Value -&gt; Maybe DatumHash -&gt; TxOut
</span><span class="hs-identifier hs-var">Pl.TxOut</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Wallet -&gt; Address
</span><a href="Cooked.MockChain.Wallet.html#walletAddress"><span class="hs-identifier hs-var">walletAddress</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet
</span><a href="#local-6989586621679558607"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679558606"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe DatumHash
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span>    </span><span id="local-6989586621679558613"><span class="annot"><span class="annottext">initDist' :: [(Wallet, [Value])]
</span><a href="#local-6989586621679558613"><span class="hs-identifier hs-var hs-var">initDist'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Wallet [Value] -&gt; [(Wallet, [Value])]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.toList</span></span><span> </span><span class="annot"><span class="annottext">(Map Wallet [Value] -&gt; [(Wallet, [Value])])
-&gt; Map Wallet [Value] -&gt; [(Wallet, [Value])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InitialDistribution -&gt; Map Wallet [Value]
</span><a href="Cooked.MockChain.Wallet.html#distribution"><span class="hs-identifier hs-var hs-var">distribution</span></a></span><span> </span><span class="annot"><span class="annottext">InitialDistribution
</span><a href="#local-6989586621679558617"><span class="hs-identifier hs-var">initDist</span></a></span><span>
</span><span id="line-178"></span></pre></body></html>