<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | This module defines 'Tweaks' revolving around the validity range of a transaction</span><span>
</span><span id="line-2"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cooked.Tweak.ValidityRange</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../Control.Monad.html#guard"><span class="hs-identifier">guard</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../Data.Functor.html#void"><span class="hs-identifier">void</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.MockChain.html"><span class="hs-identifier">Cooked.MockChain</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#awaitSlot"><span class="hs-identifier">awaitSlot</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#currentSlot"><span class="hs-identifier">currentSlot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.Skeleton.html"><span class="hs-identifier">Cooked.Skeleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Skeleton.html#txSkelValidityRangeL"><span class="hs-identifier">txSkelValidityRangeL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.Tweak.Common.html"><span class="hs-identifier">Cooked.Tweak.Common</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tweak.Common.html#MonadTweak"><span class="hs-identifier">MonadTweak</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cooked.Tweak.Common.html#setTweak"><span class="hs-identifier">setTweak</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cooked.Tweak.Common.html#viewTweak"><span class="hs-identifier">viewTweak</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../Ledger.html"><span class="hs-identifier">Ledger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../Plutus.V1.Ledger.Interval.html#before"><span class="hs-identifier">before</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../Plutus.V1.Ledger.Interval.html#contains"><span class="hs-identifier">contains</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../Plutus.V1.Ledger.Interval.html#intersection"><span class="hs-identifier">intersection</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../Plutus.V1.Ledger.Interval.html#interval"><span class="hs-identifier">interval</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../Plutus.V1.Ledger.Interval.html#isEmpty"><span class="hs-identifier">isEmpty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../Plutus.V1.Ledger.Interval.html#member"><span class="hs-identifier">member</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../Plutus.V1.Ledger.Interval.html#never"><span class="hs-identifier">never</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../Plutus.V1.Ledger.Interval.html#singleton"><span class="hs-identifier">singleton</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../Ledger.Slot.html"><span class="hs-identifier">Ledger.Slot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../Ledger.Slot.html#Slot"><span class="hs-identifier">Slot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../Ledger.Slot.html#Slot"><span class="hs-identifier">Slot</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../Ledger.Slot.html#SlotRange"><span class="hs-identifier">SlotRange</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../Plutus.V2.Ledger.Api.html"><span class="hs-identifier">Plutus.V2.Ledger.Api</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../Plutus.V1.Ledger.Interval.html#Extended"><span class="hs-identifier">Extended</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../Plutus.V1.Ledger.Interval.html#Finite"><span class="hs-identifier">Finite</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../Plutus.V1.Ledger.Interval.html#Interval"><span class="hs-identifier">Interval</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../Plutus.V1.Ledger.Interval.html#LowerBound"><span class="hs-identifier">LowerBound</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../Plutus.V1.Ledger.Interval.html#UpperBound"><span class="hs-identifier">UpperBound</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../Plutus.V1.Ledger.Interval.html#always"><span class="hs-identifier">always</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span id="local-6989586621679642130"><span class="annot"><a href="Cooked.Tweak.ValidityRange.html#getValidityRangeTweak"><span class="hs-identifier hs-type">getValidityRangeTweak</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tweak.Common.html#MonadTweak"><span class="hs-identifier hs-type">MonadTweak</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679642130"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679642130"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="../Ledger.Slot.html#SlotRange"><span class="hs-identifier hs-type">SlotRange</span></a></span></span><span>
</span><span id="line-13"></span><span id="getValidityRangeTweak"><span class="annot"><span class="annottext">getValidityRangeTweak :: m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#getValidityRangeTweak"><span class="hs-identifier hs-var hs-var">getValidityRangeTweak</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx TxSkel SlotRange -&gt; m SlotRange
forall (m :: * -&gt; *) k (is :: IxList) a.
(MonadTweak m, Is k A_Getter) =&gt;
Optic' k is TxSkel a -&gt; m a
</span><a href="Cooked.Tweak.Common.html#viewTweak"><span class="hs-identifier hs-var">viewTweak</span></a></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx TxSkel SlotRange
</span><a href="Cooked.Skeleton.html#txSkelValidityRangeL"><span class="hs-identifier hs-var">txSkelValidityRangeL</span></a></span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-comment">-- | Changes the current validity range, returning the old one</span><span>
</span><span id="line-16"></span><span id="local-6989586621679642121"><span class="annot"><a href="Cooked.Tweak.ValidityRange.html#setValidityRangeTweak"><span class="hs-identifier hs-type">setValidityRangeTweak</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tweak.Common.html#MonadTweak"><span class="hs-identifier hs-type">MonadTweak</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679642121"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../Ledger.Slot.html#SlotRange"><span class="hs-identifier hs-type">SlotRange</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679642121"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="../Ledger.Slot.html#SlotRange"><span class="hs-identifier hs-type">SlotRange</span></a></span></span><span>
</span><span id="line-17"></span><span id="setValidityRangeTweak"><span class="annot"><span class="annottext">setValidityRangeTweak :: SlotRange -&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#setValidityRangeTweak"><span class="hs-identifier hs-var hs-var">setValidityRangeTweak</span></a></span></span><span> </span><span id="local-6989586621679642037"><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679642037"><span class="hs-identifier hs-var">newRange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-18"></span><span>  </span><span id="local-6989586621679642036"><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679642036"><span class="hs-identifier hs-var">oldRange</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m SlotRange
forall (m :: * -&gt; *). MonadTweak m =&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#getValidityRangeTweak"><span class="hs-identifier hs-var">getValidityRangeTweak</span></a></span><span>
</span><span id="line-19"></span><span>  </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx TxSkel SlotRange -&gt; SlotRange -&gt; m ()
forall (m :: * -&gt; *) k (is :: IxList) a.
(MonadTweak m, Is k A_Setter) =&gt;
Optic' k is TxSkel a -&gt; a -&gt; m ()
</span><a href="Cooked.Tweak.Common.html#setTweak"><span class="hs-identifier hs-var">setTweak</span></a></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx TxSkel SlotRange
</span><a href="Cooked.Skeleton.html#txSkelValidityRangeL"><span class="hs-identifier hs-var">txSkelValidityRangeL</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679642037"><span class="hs-identifier hs-var">newRange</span></a></span><span>
</span><span id="line-20"></span><span>  </span><span class="annot"><span class="annottext">SlotRange -&gt; m SlotRange
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679642036"><span class="hs-identifier hs-var">oldRange</span></a></span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-comment">-- | Ensures the skeleton makes for an unconstrained validity range</span><span>
</span><span id="line-23"></span><span id="local-6989586621679642035"><span class="annot"><a href="Cooked.Tweak.ValidityRange.html#setAlwaysValidRangeTweak"><span class="hs-identifier hs-type">setAlwaysValidRangeTweak</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tweak.Common.html#MonadTweak"><span class="hs-identifier hs-type">MonadTweak</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679642035"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679642035"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="../Ledger.Slot.html#SlotRange"><span class="hs-identifier hs-type">SlotRange</span></a></span></span><span>
</span><span id="line-24"></span><span id="setAlwaysValidRangeTweak"><span class="annot"><span class="annottext">setAlwaysValidRangeTweak :: m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#setAlwaysValidRangeTweak"><span class="hs-identifier hs-var hs-var">setAlwaysValidRangeTweak</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotRange -&gt; m SlotRange
forall (m :: * -&gt; *). MonadTweak m =&gt; SlotRange -&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#setValidityRangeTweak"><span class="hs-identifier hs-var">setValidityRangeTweak</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange
forall a. Interval a
</span><a href="../Plutus.V1.Ledger.Interval.html#always"><span class="hs-identifier hs-var">always</span></a></span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-comment">-- | Sets the left bound of the validity range. Leaves the right bound unchanged</span><span>
</span><span id="line-27"></span><span id="local-6989586621679642033"><span class="annot"><a href="Cooked.Tweak.ValidityRange.html#setValidityStartTweak"><span class="hs-identifier hs-type">setValidityStartTweak</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tweak.Common.html#MonadTweak"><span class="hs-identifier hs-type">MonadTweak</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679642033"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../Ledger.Slot.html#Slot"><span class="hs-identifier hs-type">Slot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679642033"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="../Ledger.Slot.html#SlotRange"><span class="hs-identifier hs-type">SlotRange</span></a></span></span><span>
</span><span id="line-28"></span><span id="setValidityStartTweak"><span class="annot"><span class="annottext">setValidityStartTweak :: Slot -&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#setValidityStartTweak"><span class="hs-identifier hs-var hs-var">setValidityStartTweak</span></a></span></span><span> </span><span id="local-6989586621679642031"><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679642031"><span class="hs-identifier hs-var">left</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m SlotRange
forall (m :: * -&gt; *). MonadTweak m =&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#getValidityRangeTweak"><span class="hs-identifier hs-var">getValidityRangeTweak</span></a></span><span> </span><span class="annot"><span class="annottext">m SlotRange -&gt; (SlotRange -&gt; m SlotRange) -&gt; m SlotRange
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange -&gt; m SlotRange
forall (m :: * -&gt; *). MonadTweak m =&gt; SlotRange -&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#setValidityRangeTweak"><span class="hs-identifier hs-var">setValidityRangeTweak</span></a></span><span> </span><span class="annot"><span class="annottext">(SlotRange -&gt; m SlotRange)
-&gt; (SlotRange -&gt; SlotRange) -&gt; SlotRange -&gt; m SlotRange
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">LowerBound Slot -&gt; UpperBound Slot -&gt; SlotRange
forall a. LowerBound a -&gt; UpperBound a -&gt; Interval a
</span><a href="../Plutus.V1.Ledger.Interval.html#Interval"><span class="hs-identifier hs-var">Interval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Extended Slot -&gt; Closure -&gt; LowerBound Slot
forall a. Extended a -&gt; Closure -&gt; LowerBound a
</span><a href="../Plutus.V1.Ledger.Interval.html#LowerBound"><span class="hs-identifier hs-var">LowerBound</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slot -&gt; Extended Slot
forall a. a -&gt; Extended a
</span><a href="../Plutus.V1.Ledger.Interval.html#Finite"><span class="hs-identifier hs-var">Finite</span></a></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679642031"><span class="hs-identifier hs-var">left</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Closure
</span><a href="../GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(UpperBound Slot -&gt; SlotRange)
-&gt; (SlotRange -&gt; UpperBound Slot) -&gt; SlotRange -&gt; SlotRange
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange -&gt; UpperBound Slot
forall a. Interval a -&gt; UpperBound a
</span><a href="../Plutus.V1.Ledger.Interval.html#ivTo"><span class="hs-identifier hs-var hs-var">ivTo</span></a></span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-comment">-- | Sets the right bound of the validity range. Leaves the left bound unchanged</span><span>
</span><span id="line-31"></span><span id="local-6989586621679642026"><span class="annot"><a href="Cooked.Tweak.ValidityRange.html#setValidityEndTweak"><span class="hs-identifier hs-type">setValidityEndTweak</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tweak.Common.html#MonadTweak"><span class="hs-identifier hs-type">MonadTweak</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679642026"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../Ledger.Slot.html#Slot"><span class="hs-identifier hs-type">Slot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679642026"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="../Ledger.Slot.html#SlotRange"><span class="hs-identifier hs-type">SlotRange</span></a></span></span><span>
</span><span id="line-32"></span><span id="setValidityEndTweak"><span class="annot"><span class="annottext">setValidityEndTweak :: Slot -&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#setValidityEndTweak"><span class="hs-identifier hs-var hs-var">setValidityEndTweak</span></a></span></span><span> </span><span id="local-6989586621679642024"><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679642024"><span class="hs-identifier hs-var">right</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m SlotRange
forall (m :: * -&gt; *). MonadTweak m =&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#getValidityRangeTweak"><span class="hs-identifier hs-var">getValidityRangeTweak</span></a></span><span> </span><span class="annot"><span class="annottext">m SlotRange -&gt; (SlotRange -&gt; m SlotRange) -&gt; m SlotRange
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange -&gt; m SlotRange
forall (m :: * -&gt; *). MonadTweak m =&gt; SlotRange -&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#setValidityRangeTweak"><span class="hs-identifier hs-var">setValidityRangeTweak</span></a></span><span> </span><span class="annot"><span class="annottext">(SlotRange -&gt; m SlotRange)
-&gt; (SlotRange -&gt; SlotRange) -&gt; SlotRange -&gt; m SlotRange
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(LowerBound Slot -&gt; UpperBound Slot -&gt; SlotRange)
-&gt; UpperBound Slot -&gt; LowerBound Slot -&gt; SlotRange
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">LowerBound Slot -&gt; UpperBound Slot -&gt; SlotRange
forall a. LowerBound a -&gt; UpperBound a -&gt; Interval a
</span><a href="../Plutus.V1.Ledger.Interval.html#Interval"><span class="hs-identifier hs-var">Interval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Extended Slot -&gt; Closure -&gt; UpperBound Slot
forall a. Extended a -&gt; Closure -&gt; UpperBound a
</span><a href="../Plutus.V1.Ledger.Interval.html#UpperBound"><span class="hs-identifier hs-var">UpperBound</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slot -&gt; Extended Slot
forall a. a -&gt; Extended a
</span><a href="../Plutus.V1.Ledger.Interval.html#Finite"><span class="hs-identifier hs-var">Finite</span></a></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679642024"><span class="hs-identifier hs-var">right</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Closure
</span><a href="../GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LowerBound Slot -&gt; SlotRange)
-&gt; (SlotRange -&gt; LowerBound Slot) -&gt; SlotRange -&gt; SlotRange
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange -&gt; LowerBound Slot
forall a. Interval a -&gt; LowerBound a
</span><a href="../Plutus.V1.Ledger.Interval.html#ivFrom"><span class="hs-identifier hs-var hs-var">ivFrom</span></a></span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-comment">-- | Checks if the validity range satisfies a certain predicate</span><span>
</span><span id="line-35"></span><span id="local-6989586621679642092"><span class="annot"><a href="Cooked.Tweak.ValidityRange.html#validityRangeSatisfiesTweak"><span class="hs-identifier hs-type">validityRangeSatisfiesTweak</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tweak.Common.html#MonadTweak"><span class="hs-identifier hs-type">MonadTweak</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679642092"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../Ledger.Slot.html#SlotRange"><span class="hs-identifier hs-type">SlotRange</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679642092"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="../GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span></span><span>
</span><span id="line-36"></span><span id="validityRangeSatisfiesTweak"><span class="annot"><span class="annottext">validityRangeSatisfiesTweak :: (SlotRange -&gt; Closure) -&gt; m Closure
</span><a href="Cooked.Tweak.ValidityRange.html#validityRangeSatisfiesTweak"><span class="hs-identifier hs-var hs-var">validityRangeSatisfiesTweak</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SlotRange -&gt; Closure) -&gt; m SlotRange -&gt; m Closure
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">m SlotRange
forall (m :: * -&gt; *). MonadTweak m =&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#getValidityRangeTweak"><span class="hs-identifier hs-var">getValidityRangeTweak</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="hs-comment">-- | Checks if a given time belongs to the validity range of a transaction</span><span>
</span><span id="line-39"></span><span id="local-6989586621679642086"><span class="annot"><a href="Cooked.Tweak.ValidityRange.html#isValidAtTweak"><span class="hs-identifier hs-type">isValidAtTweak</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tweak.Common.html#MonadTweak"><span class="hs-identifier hs-type">MonadTweak</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679642086"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../Ledger.Slot.html#Slot"><span class="hs-identifier hs-type">Slot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679642086"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="../GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span></span><span>
</span><span id="line-40"></span><span id="isValidAtTweak"><span class="annot"><span class="annottext">isValidAtTweak :: Slot -&gt; m Closure
</span><a href="Cooked.Tweak.ValidityRange.html#isValidAtTweak"><span class="hs-identifier hs-var hs-var">isValidAtTweak</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SlotRange -&gt; Closure) -&gt; m Closure
forall (m :: * -&gt; *).
MonadTweak m =&gt;
(SlotRange -&gt; Closure) -&gt; m Closure
</span><a href="Cooked.Tweak.ValidityRange.html#validityRangeSatisfiesTweak"><span class="hs-identifier hs-var">validityRangeSatisfiesTweak</span></a></span><span> </span><span class="annot"><span class="annottext">((SlotRange -&gt; Closure) -&gt; m Closure)
-&gt; (Slot -&gt; SlotRange -&gt; Closure) -&gt; Slot -&gt; m Closure
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Slot -&gt; SlotRange -&gt; Closure
forall a. Ord a =&gt; a -&gt; Interval a -&gt; Closure
</span><a href="../Plutus.V1.Ledger.Interval.html#member"><span class="hs-identifier hs-var">member</span></a></span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-comment">-- | Checks if the current validity range includes the current time</span><span>
</span><span id="line-43"></span><span id="local-6989586621679642017"><span class="annot"><a href="Cooked.Tweak.ValidityRange.html#isValidNowTweak"><span class="hs-identifier hs-type">isValidNowTweak</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tweak.Common.html#MonadTweak"><span class="hs-identifier hs-type">MonadTweak</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679642017"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679642017"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="../GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span></span><span>
</span><span id="line-44"></span><span id="isValidNowTweak"><span class="annot"><span class="annottext">isValidNowTweak :: m Closure
</span><a href="Cooked.Tweak.ValidityRange.html#isValidNowTweak"><span class="hs-identifier hs-var hs-var">isValidNowTweak</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m Slot
forall (m :: * -&gt; *). MonadBlockChainWithoutValidation m =&gt; m Slot
</span><a href="Cooked.MockChain.BlockChain.html#currentSlot"><span class="hs-identifier hs-var">currentSlot</span></a></span><span> </span><span class="annot"><span class="annottext">m Slot -&gt; (Slot -&gt; m Closure) -&gt; m Closure
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Slot -&gt; m Closure
forall (m :: * -&gt; *). MonadTweak m =&gt; Slot -&gt; m Closure
</span><a href="Cooked.Tweak.ValidityRange.html#isValidAtTweak"><span class="hs-identifier hs-var">isValidAtTweak</span></a></span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-comment">-- | Checks if a given range is included in the validity range of a transaction</span><span>
</span><span id="line-47"></span><span id="local-6989586621679642015"><span class="annot"><a href="Cooked.Tweak.ValidityRange.html#isValidDuringTweak"><span class="hs-identifier hs-type">isValidDuringTweak</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tweak.Common.html#MonadTweak"><span class="hs-identifier hs-type">MonadTweak</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679642015"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../Ledger.Slot.html#SlotRange"><span class="hs-identifier hs-type">SlotRange</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679642015"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="../GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span></span><span>
</span><span id="line-48"></span><span id="isValidDuringTweak"><span class="annot"><span class="annottext">isValidDuringTweak :: SlotRange -&gt; m Closure
</span><a href="Cooked.Tweak.ValidityRange.html#isValidDuringTweak"><span class="hs-identifier hs-var hs-var">isValidDuringTweak</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SlotRange -&gt; Closure) -&gt; m Closure
forall (m :: * -&gt; *).
MonadTweak m =&gt;
(SlotRange -&gt; Closure) -&gt; m Closure
</span><a href="Cooked.Tweak.ValidityRange.html#validityRangeSatisfiesTweak"><span class="hs-identifier hs-var">validityRangeSatisfiesTweak</span></a></span><span> </span><span class="annot"><span class="annottext">((SlotRange -&gt; Closure) -&gt; m Closure)
-&gt; (SlotRange -&gt; SlotRange -&gt; Closure) -&gt; SlotRange -&gt; m Closure
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(SlotRange -&gt; SlotRange -&gt; Closure)
-&gt; SlotRange -&gt; SlotRange -&gt; Closure
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange -&gt; SlotRange -&gt; Closure
forall a. Ord a =&gt; Interval a -&gt; Interval a -&gt; Closure
</span><a href="../Plutus.V1.Ledger.Interval.html#contains"><span class="hs-identifier hs-var">contains</span></a></span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-comment">-- | Checks if the validity range is empty</span><span>
</span><span id="line-51"></span><span id="local-6989586621679642013"><span class="annot"><a href="Cooked.Tweak.ValidityRange.html#hasEmptyTimeRangeTweak"><span class="hs-identifier hs-type">hasEmptyTimeRangeTweak</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tweak.Common.html#MonadTweak"><span class="hs-identifier hs-type">MonadTweak</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679642013"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679642013"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="../GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span></span><span>
</span><span id="line-52"></span><span id="hasEmptyTimeRangeTweak"><span class="annot"><span class="annottext">hasEmptyTimeRangeTweak :: m Closure
</span><a href="Cooked.Tweak.ValidityRange.html#hasEmptyTimeRangeTweak"><span class="hs-identifier hs-var hs-var">hasEmptyTimeRangeTweak</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SlotRange -&gt; Closure) -&gt; m Closure
forall (m :: * -&gt; *).
MonadTweak m =&gt;
(SlotRange -&gt; Closure) -&gt; m Closure
</span><a href="Cooked.Tweak.ValidityRange.html#validityRangeSatisfiesTweak"><span class="hs-identifier hs-var">validityRangeSatisfiesTweak</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange -&gt; Closure
forall a. (Enum a, Ord a) =&gt; Interval a -&gt; Closure
</span><a href="../Plutus.V1.Ledger.Interval.html#isEmpty"><span class="hs-identifier hs-var">isEmpty</span></a></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-comment">-- | Checks if the validity range is unconstrained</span><span>
</span><span id="line-55"></span><span id="local-6989586621679642011"><span class="annot"><a href="Cooked.Tweak.ValidityRange.html#hasFullTimeRangeTweak"><span class="hs-identifier hs-type">hasFullTimeRangeTweak</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tweak.Common.html#MonadTweak"><span class="hs-identifier hs-type">MonadTweak</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679642011"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679642011"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="../GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span></span><span>
</span><span id="line-56"></span><span id="hasFullTimeRangeTweak"><span class="annot"><span class="annottext">hasFullTimeRangeTweak :: m Closure
</span><a href="Cooked.Tweak.ValidityRange.html#hasFullTimeRangeTweak"><span class="hs-identifier hs-var hs-var">hasFullTimeRangeTweak</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SlotRange -&gt; Closure) -&gt; m Closure
forall (m :: * -&gt; *).
MonadTweak m =&gt;
(SlotRange -&gt; Closure) -&gt; m Closure
</span><a href="Cooked.Tweak.ValidityRange.html#validityRangeSatisfiesTweak"><span class="hs-identifier hs-var">validityRangeSatisfiesTweak</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotRange
forall a. Interval a
</span><a href="../Plutus.V1.Ledger.Interval.html#always"><span class="hs-identifier hs-var">always</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange -&gt; SlotRange -&gt; Closure
forall a. Eq a =&gt; a -&gt; a -&gt; Closure
</span><a href="../GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="hs-comment">-- | Adds a constraint to the current validity range</span><span>
</span><span id="line-59"></span><span class="hs-comment">-- Returns the old range, and fails is the resulting interval is empty</span><span>
</span><span id="line-60"></span><span id="local-6989586621679642009"><span class="annot"><a href="Cooked.Tweak.ValidityRange.html#intersectValidityRangeTweak"><span class="hs-identifier hs-type">intersectValidityRangeTweak</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tweak.Common.html#MonadTweak"><span class="hs-identifier hs-type">MonadTweak</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679642009"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../Ledger.Slot.html#SlotRange"><span class="hs-identifier hs-type">SlotRange</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679642009"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="../Ledger.Slot.html#SlotRange"><span class="hs-identifier hs-type">SlotRange</span></a></span></span><span>
</span><span id="line-61"></span><span id="intersectValidityRangeTweak"><span class="annot"><span class="annottext">intersectValidityRangeTweak :: SlotRange -&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#intersectValidityRangeTweak"><span class="hs-identifier hs-var hs-var">intersectValidityRangeTweak</span></a></span></span><span> </span><span id="local-6989586621679642007"><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679642007"><span class="hs-identifier hs-var">newRange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-62"></span><span>  </span><span id="local-6989586621679642006"><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679642006"><span class="hs-identifier hs-var">oldRange</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx TxSkel SlotRange -&gt; m SlotRange
forall (m :: * -&gt; *) k (is :: IxList) a.
(MonadTweak m, Is k A_Getter) =&gt;
Optic' k is TxSkel a -&gt; m a
</span><a href="Cooked.Tweak.Common.html#viewTweak"><span class="hs-identifier hs-var">viewTweak</span></a></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx TxSkel SlotRange
</span><a href="Cooked.Skeleton.html#txSkelValidityRangeL"><span class="hs-identifier hs-var">txSkelValidityRangeL</span></a></span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679642005"><span class="annot"><span class="annottext">combinedRange :: SlotRange
</span><a href="#local-6989586621679642005"><span class="hs-identifier hs-var hs-var">combinedRange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotRange -&gt; SlotRange -&gt; SlotRange
forall a. Ord a =&gt; Interval a -&gt; Interval a -&gt; Interval a
</span><a href="../Plutus.V1.Ledger.Interval.html#intersection"><span class="hs-identifier hs-var">intersection</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679642007"><span class="hs-identifier hs-var">newRange</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679642006"><span class="hs-identifier hs-var">oldRange</span></a></span><span>
</span><span id="line-64"></span><span>  </span><span class="annot"><span class="annottext">Closure -&gt; m ()
forall (f :: * -&gt; *). Alternative f =&gt; Closure -&gt; f ()
</span><a href="../Control.Monad.html#guard"><span class="hs-identifier hs-var">guard</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679642005"><span class="hs-identifier hs-var">combinedRange</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange -&gt; SlotRange -&gt; Closure
forall a. Eq a =&gt; a -&gt; a -&gt; Closure
</span><a href="../GHC.Classes.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange
forall a. Interval a
</span><a href="../Plutus.V1.Ledger.Interval.html#never"><span class="hs-identifier hs-var">never</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>  </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx TxSkel SlotRange -&gt; SlotRange -&gt; m ()
forall (m :: * -&gt; *) k (is :: IxList) a.
(MonadTweak m, Is k A_Setter) =&gt;
Optic' k is TxSkel a -&gt; a -&gt; m ()
</span><a href="Cooked.Tweak.Common.html#setTweak"><span class="hs-identifier hs-var">setTweak</span></a></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx TxSkel SlotRange
</span><a href="Cooked.Skeleton.html#txSkelValidityRangeL"><span class="hs-identifier hs-var">txSkelValidityRangeL</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679642005"><span class="hs-identifier hs-var">combinedRange</span></a></span><span>
</span><span id="line-66"></span><span>  </span><span class="annot"><span class="annottext">SlotRange -&gt; m SlotRange
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679642006"><span class="hs-identifier hs-var">oldRange</span></a></span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-comment">-- | Centers the validity range around a value with a certain radius</span><span>
</span><span id="line-69"></span><span id="local-6989586621679642003"><span class="annot"><a href="Cooked.Tweak.ValidityRange.html#centerAroundValidityRangeTweak"><span class="hs-identifier hs-type">centerAroundValidityRangeTweak</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tweak.Common.html#MonadTweak"><span class="hs-identifier hs-type">MonadTweak</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679642003"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../Ledger.Slot.html#Slot"><span class="hs-identifier hs-type">Slot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../GHC.Integer.Type.html#Integer"><span class="hs-identifier hs-type">Integer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679642003"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="../Ledger.Slot.html#SlotRange"><span class="hs-identifier hs-type">SlotRange</span></a></span></span><span>
</span><span id="line-70"></span><span id="centerAroundValidityRangeTweak"><span class="annot"><span class="annottext">centerAroundValidityRangeTweak :: Slot -&gt; Integer -&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#centerAroundValidityRangeTweak"><span class="hs-identifier hs-var hs-var">centerAroundValidityRangeTweak</span></a></span></span><span> </span><span id="local-6989586621679642001"><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679642001"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679642000"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679642000"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679641999"><span class="annot"><span class="annottext">radius :: Slot
</span><a href="#local-6989586621679641999"><span class="hs-identifier hs-var hs-var">radius</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Slot
</span><a href="../Ledger.Slot.html#Slot"><span class="hs-identifier hs-var">Slot</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679642000"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-72"></span><span>      </span><span id="local-6989586621679641998"><span class="annot"><span class="annottext">left :: Slot
</span><a href="#local-6989586621679641998"><span class="hs-identifier hs-var hs-var">left</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679642001"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Slot -&gt; Slot -&gt; Slot
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679641999"><span class="hs-identifier hs-var">radius</span></a></span><span>
</span><span id="line-73"></span><span>      </span><span id="local-6989586621679641997"><span class="annot"><span class="annottext">right :: Slot
</span><a href="#local-6989586621679641997"><span class="hs-identifier hs-var hs-var">right</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679642001"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Slot -&gt; Slot -&gt; Slot
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679641999"><span class="hs-identifier hs-var">radius</span></a></span><span>
</span><span id="line-74"></span><span>      </span><span id="local-6989586621679641995"><span class="annot"><span class="annottext">newRange :: SlotRange
</span><a href="#local-6989586621679641995"><span class="hs-identifier hs-var hs-var">newRange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Slot -&gt; Slot -&gt; SlotRange
forall a. a -&gt; a -&gt; Interval a
</span><a href="../Plutus.V1.Ledger.Interval.html#interval"><span class="hs-identifier hs-var">interval</span></a></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679641998"><span class="hs-identifier hs-var">left</span></a></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679641997"><span class="hs-identifier hs-var">right</span></a></span><span>
</span><span id="line-75"></span><span>  </span><span class="annot"><span class="annottext">SlotRange -&gt; m SlotRange
forall (m :: * -&gt; *). MonadTweak m =&gt; SlotRange -&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#setValidityRangeTweak"><span class="hs-identifier hs-var">setValidityRangeTweak</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679641995"><span class="hs-identifier hs-var">newRange</span></a></span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="hs-comment">-- | Makes a transaction range equal to a singleton</span><span>
</span><span id="line-78"></span><span id="local-6989586621679642068"><span class="annot"><a href="Cooked.Tweak.ValidityRange.html#makeValidityRangeSingletonTweak"><span class="hs-identifier hs-type">makeValidityRangeSingletonTweak</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tweak.Common.html#MonadTweak"><span class="hs-identifier hs-type">MonadTweak</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679642068"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../Ledger.Slot.html#Slot"><span class="hs-identifier hs-type">Slot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679642068"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="../Ledger.Slot.html#SlotRange"><span class="hs-identifier hs-type">SlotRange</span></a></span></span><span>
</span><span id="line-79"></span><span id="makeValidityRangeSingletonTweak"><span class="annot"><span class="annottext">makeValidityRangeSingletonTweak :: Slot -&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#makeValidityRangeSingletonTweak"><span class="hs-identifier hs-var hs-var">makeValidityRangeSingletonTweak</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotRange -&gt; m SlotRange
forall (m :: * -&gt; *). MonadTweak m =&gt; SlotRange -&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#setValidityRangeTweak"><span class="hs-identifier hs-var">setValidityRangeTweak</span></a></span><span> </span><span class="annot"><span class="annottext">(SlotRange -&gt; m SlotRange)
-&gt; (Slot -&gt; SlotRange) -&gt; Slot -&gt; m SlotRange
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Slot -&gt; SlotRange
forall a. a -&gt; Interval a
</span><a href="../Plutus.V1.Ledger.Interval.html#singleton"><span class="hs-identifier hs-var">singleton</span></a></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-comment">-- | Makes the transaction validity range comply with the current time</span><span>
</span><span id="line-82"></span><span id="local-6989586621679641993"><span class="annot"><a href="Cooked.Tweak.ValidityRange.html#makeValidityRangeNowTweak"><span class="hs-identifier hs-type">makeValidityRangeNowTweak</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tweak.Common.html#MonadTweak"><span class="hs-identifier hs-type">MonadTweak</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679641993"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679641993"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="../Ledger.Slot.html#SlotRange"><span class="hs-identifier hs-type">SlotRange</span></a></span></span><span>
</span><span id="line-83"></span><span id="makeValidityRangeNowTweak"><span class="annot"><span class="annottext">makeValidityRangeNowTweak :: m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#makeValidityRangeNowTweak"><span class="hs-identifier hs-var hs-var">makeValidityRangeNowTweak</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m Slot
forall (m :: * -&gt; *). MonadBlockChainWithoutValidation m =&gt; m Slot
</span><a href="Cooked.MockChain.BlockChain.html#currentSlot"><span class="hs-identifier hs-var">currentSlot</span></a></span><span> </span><span class="annot"><span class="annottext">m Slot -&gt; (Slot -&gt; m SlotRange) -&gt; m SlotRange
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Slot -&gt; m SlotRange
forall (m :: * -&gt; *). MonadTweak m =&gt; Slot -&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#makeValidityRangeSingletonTweak"><span class="hs-identifier hs-var">makeValidityRangeSingletonTweak</span></a></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-comment">-- | Makes current time comply with the validity range of the transaction under</span><span>
</span><span id="line-86"></span><span class="hs-comment">-- modification. Returns the new current time after the modification; fails if</span><span>
</span><span id="line-87"></span><span class="hs-comment">-- current time is already after the validity range.</span><span>
</span><span id="line-88"></span><span id="local-6989586621679641991"><span class="annot"><a href="Cooked.Tweak.ValidityRange.html#waitUntilValidTweak"><span class="hs-identifier hs-type">waitUntilValidTweak</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tweak.Common.html#MonadTweak"><span class="hs-identifier hs-type">MonadTweak</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679641991"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679641991"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="../Ledger.Slot.html#Slot"><span class="hs-identifier hs-type">Slot</span></a></span></span><span>
</span><span id="line-89"></span><span id="waitUntilValidTweak"><span class="annot"><span class="annottext">waitUntilValidTweak :: m Slot
</span><a href="Cooked.Tweak.ValidityRange.html#waitUntilValidTweak"><span class="hs-identifier hs-var hs-var">waitUntilValidTweak</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-90"></span><span>  </span><span id="local-6989586621679641989"><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679641989"><span class="hs-identifier hs-var">now</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Slot
forall (m :: * -&gt; *). MonadBlockChainWithoutValidation m =&gt; m Slot
</span><a href="Cooked.MockChain.BlockChain.html#currentSlot"><span class="hs-identifier hs-var">currentSlot</span></a></span><span>
</span><span id="line-91"></span><span>  </span><span id="local-6989586621679641988"><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679641988"><span class="hs-identifier hs-var">vRange</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m SlotRange
forall (m :: * -&gt; *). MonadTweak m =&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#getValidityRangeTweak"><span class="hs-identifier hs-var">getValidityRangeTweak</span></a></span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Slot -&gt; SlotRange -&gt; Closure
forall a. Ord a =&gt; a -&gt; Interval a -&gt; Closure
</span><a href="../Plutus.V1.Ledger.Interval.html#member"><span class="hs-identifier hs-var">member</span></a></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679641989"><span class="hs-identifier hs-var">now</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679641988"><span class="hs-identifier hs-var">vRange</span></a></span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Slot -&gt; m Slot
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679641989"><span class="hs-identifier hs-var">now</span></a></span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-95"></span><span>      </span><span class="annot"><span class="annottext">Closure -&gt; m ()
forall (f :: * -&gt; *). Alternative f =&gt; Closure -&gt; f ()
</span><a href="../Control.Monad.html#guard"><span class="hs-identifier hs-var">guard</span></a></span><span> </span><span class="annot"><span class="annottext">(Closure -&gt; m ()) -&gt; Closure -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Slot -&gt; SlotRange -&gt; Closure
forall a. Ord a =&gt; a -&gt; Interval a -&gt; Closure
</span><a href="../Plutus.V1.Ledger.Interval.html#before"><span class="hs-identifier hs-var">before</span></a></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679641989"><span class="hs-identifier hs-var">now</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679641988"><span class="hs-identifier hs-var">vRange</span></a></span><span>
</span><span id="line-96"></span><span>      </span><span class="annot"><span class="annottext">Closure -&gt; m ()
forall (f :: * -&gt; *). Alternative f =&gt; Closure -&gt; f ()
</span><a href="../Control.Monad.html#guard"><span class="hs-identifier hs-var">guard</span></a></span><span> </span><span class="annot"><span class="annottext">(Closure -&gt; m ()) -&gt; Closure -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Closure -&gt; Closure
</span><a href="../GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Closure -&gt; Closure) -&gt; Closure -&gt; Closure
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange -&gt; Closure
forall a. (Enum a, Ord a) =&gt; Interval a -&gt; Closure
</span><a href="../Plutus.V1.Ledger.Interval.html#isEmpty"><span class="hs-identifier hs-var">isEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679641988"><span class="hs-identifier hs-var">vRange</span></a></span><span>
</span><span id="line-97"></span><span>      </span><span id="local-6989586621679641986"><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679641986"><span class="hs-identifier hs-var">later</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SlotRange -&gt; LowerBound Slot
forall a. Interval a -&gt; LowerBound a
</span><a href="../Plutus.V1.Ledger.Interval.html#ivFrom"><span class="hs-identifier hs-var hs-var">ivFrom</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679641988"><span class="hs-identifier hs-var">vRange</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-98"></span><span>        </span><span class="annot"><a href="../Plutus.V1.Ledger.Interval.html#LowerBound"><span class="hs-identifier hs-type">LowerBound</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../Plutus.V1.Ledger.Interval.html#Finite"><span class="hs-identifier hs-type">Finite</span></a></span><span> </span><span id="local-6989586621679641985"><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679641985"><span class="hs-identifier hs-var">left</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679641984"><span class="annot"><span class="annottext">Closure
</span><a href="#local-6989586621679641984"><span class="hs-identifier hs-var">isClosed</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-99"></span><span>          </span><span class="annot"><span class="annottext">Slot -&gt; m Slot
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Slot -&gt; m Slot) -&gt; Slot -&gt; m Slot
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679641985"><span class="hs-identifier hs-var">left</span></a></span><span> </span><span class="annot"><span class="annottext">Slot -&gt; Slot -&gt; Slot
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Slot
</span><a href="../Ledger.Slot.html#Slot"><span class="hs-identifier hs-var">Slot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><a href="../GHC.Real.html#toInteger"><span class="hs-identifier hs-var">toInteger</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Integer) -&gt; Int -&gt; Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Closure -&gt; Int
forall a. Enum a =&gt; a -&gt; Int
</span><a href="../GHC.Enum.html#fromEnum"><span class="hs-identifier hs-var">fromEnum</span></a></span><span> </span><span class="annot"><span class="annottext">(Closure -&gt; Int) -&gt; Closure -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Closure -&gt; Closure
</span><a href="../GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">Closure
</span><a href="#local-6989586621679641984"><span class="hs-identifier hs-var">isClosed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>        </span><span class="annot"><span class="annottext">LowerBound Slot
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; m Slot
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="../GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;this should never happen: left-finite interval without left border&quot;</span></span><span>
</span><span id="line-101"></span><span>      </span><span class="annot"><span class="annottext">m Slot -&gt; m ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../Data.Functor.html#void"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(m Slot -&gt; m ()) -&gt; m Slot -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Slot -&gt; m Slot
forall (m :: * -&gt; *).
MonadBlockChainWithoutValidation m =&gt;
Slot -&gt; m Slot
</span><a href="Cooked.MockChain.BlockChain.html#awaitSlot"><span class="hs-identifier hs-var">awaitSlot</span></a></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679641986"><span class="hs-identifier hs-var">later</span></a></span><span>
</span><span id="line-102"></span><span>      </span><span class="annot"><span class="annottext">Slot -&gt; m Slot
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679641986"><span class="hs-identifier hs-var">later</span></a></span><span>
</span><span id="line-103"></span></pre></body></html>