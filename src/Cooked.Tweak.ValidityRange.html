<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | This module defines 'Tweaks' revolving around the validity range of a</span><span>
</span><span id="line-2"></span><span class="hs-comment">-- transaction</span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cooked.Tweak.ValidityRange</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.MockChain.html"><span class="hs-identifier">Cooked.MockChain</span></a></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.Skeleton.html"><span class="hs-identifier">Cooked.Skeleton</span></a></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.Tweak.Common.html"><span class="hs-identifier">Cooked.Tweak.Common</span></a></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Slot</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ledger</span></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusLedgerApi.V1.Interval</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Api</span></span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span id="local-6989586621679775887"><span class="annot"><a href="Cooked.Tweak.ValidityRange.html#getValidityRangeTweak"><span class="hs-identifier hs-type">getValidityRangeTweak</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tweak.Common.html#MonadTweak"><span class="hs-identifier hs-type">MonadTweak</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679775887"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679775887"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.SlotRange</span></span></span><span>
</span><span id="line-13"></span><span id="getValidityRangeTweak"><span class="annot"><span class="annottext">getValidityRangeTweak :: forall (m :: * -&gt; *). MonadTweak m =&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#getValidityRangeTweak"><span class="hs-identifier hs-var hs-var">getValidityRangeTweak</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx TxSkel SlotRange -&gt; m SlotRange
forall (m :: * -&gt; *) k (is :: IxList) a.
(MonadTweak m, Is k A_Getter) =&gt;
Optic' k is TxSkel a -&gt; m a
</span><a href="Cooked.Tweak.Common.html#viewTweak"><span class="hs-identifier hs-var">viewTweak</span></a></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx TxSkel SlotRange
</span><a href="Cooked.Skeleton.html#txSkelValidityRangeL"><span class="hs-identifier hs-var">txSkelValidityRangeL</span></a></span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="annot"><span class="hs-comment">-- | Changes the current validity range, returning the old one</span></span><span>
</span><span id="line-16"></span><span id="local-6989586621679775902"><span class="annot"><a href="Cooked.Tweak.ValidityRange.html#setValidityRangeTweak"><span class="hs-identifier hs-type">setValidityRangeTweak</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tweak.Common.html#MonadTweak"><span class="hs-identifier hs-type">MonadTweak</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679775902"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.SlotRange</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679775902"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.SlotRange</span></span></span><span>
</span><span id="line-17"></span><span id="setValidityRangeTweak"><span class="annot"><span class="annottext">setValidityRangeTweak :: forall (m :: * -&gt; *). MonadTweak m =&gt; SlotRange -&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#setValidityRangeTweak"><span class="hs-identifier hs-var hs-var">setValidityRangeTweak</span></a></span></span><span> </span><span id="local-6989586621679776006"><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679776006"><span class="hs-identifier hs-var">newRange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-18"></span><span>  </span><span id="local-6989586621679776007"><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679776007"><span class="hs-identifier hs-var">oldRange</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m SlotRange
forall (m :: * -&gt; *). MonadTweak m =&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#getValidityRangeTweak"><span class="hs-identifier hs-var">getValidityRangeTweak</span></a></span><span>
</span><span id="line-19"></span><span>  </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx TxSkel SlotRange -&gt; SlotRange -&gt; m ()
forall (m :: * -&gt; *) k (is :: IxList) a.
(MonadTweak m, Is k A_Setter) =&gt;
Optic' k is TxSkel a -&gt; a -&gt; m ()
</span><a href="Cooked.Tweak.Common.html#setTweak"><span class="hs-identifier hs-var">setTweak</span></a></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx TxSkel SlotRange
</span><a href="Cooked.Skeleton.html#txSkelValidityRangeL"><span class="hs-identifier hs-var">txSkelValidityRangeL</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679776006"><span class="hs-identifier hs-var">newRange</span></a></span><span>
</span><span id="line-20"></span><span>  </span><span class="annot"><span class="annottext">SlotRange -&gt; m SlotRange
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679776007"><span class="hs-identifier hs-var">oldRange</span></a></span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="annot"><span class="hs-comment">-- | Ensures the skeleton makes for an unconstrained validity range</span></span><span>
</span><span id="line-23"></span><span id="local-6989586621679776009"><span class="annot"><a href="Cooked.Tweak.ValidityRange.html#setAlwaysValidRangeTweak"><span class="hs-identifier hs-type">setAlwaysValidRangeTweak</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tweak.Common.html#MonadTweak"><span class="hs-identifier hs-type">MonadTweak</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679776009"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679776009"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.SlotRange</span></span></span><span>
</span><span id="line-24"></span><span id="setAlwaysValidRangeTweak"><span class="annot"><span class="annottext">setAlwaysValidRangeTweak :: forall (m :: * -&gt; *). MonadTweak m =&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#setAlwaysValidRangeTweak"><span class="hs-identifier hs-var hs-var">setAlwaysValidRangeTweak</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotRange -&gt; m SlotRange
forall (m :: * -&gt; *). MonadTweak m =&gt; SlotRange -&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#setValidityRangeTweak"><span class="hs-identifier hs-var">setValidityRangeTweak</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange
forall a. Interval a
</span><span class="hs-identifier hs-var">Api.always</span></span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="annot"><span class="hs-comment">-- | Sets the left bound of the validity range. Leaves the right bound unchanged</span></span><span>
</span><span id="line-27"></span><span id="local-6989586621679775917"><span class="annot"><a href="Cooked.Tweak.ValidityRange.html#setValidityStartTweak"><span class="hs-identifier hs-type">setValidityStartTweak</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tweak.Common.html#MonadTweak"><span class="hs-identifier hs-type">MonadTweak</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679775917"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.Slot</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679775917"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.SlotRange</span></span></span><span>
</span><span id="line-28"></span><span id="setValidityStartTweak"><span class="annot"><span class="annottext">setValidityStartTweak :: forall (m :: * -&gt; *). MonadTweak m =&gt; Slot -&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#setValidityStartTweak"><span class="hs-identifier hs-var hs-var">setValidityStartTweak</span></a></span></span><span> </span><span id="local-6989586621679776021"><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679776021"><span class="hs-identifier hs-var">left</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m SlotRange
forall (m :: * -&gt; *). MonadTweak m =&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#getValidityRangeTweak"><span class="hs-identifier hs-var">getValidityRangeTweak</span></a></span><span> </span><span class="annot"><span class="annottext">m SlotRange -&gt; (SlotRange -&gt; m SlotRange) -&gt; m SlotRange
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">SlotRange -&gt; m SlotRange
forall (m :: * -&gt; *). MonadTweak m =&gt; SlotRange -&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#setValidityRangeTweak"><span class="hs-identifier hs-var">setValidityRangeTweak</span></a></span><span> </span><span class="annot"><span class="annottext">(SlotRange -&gt; m SlotRange)
-&gt; (SlotRange -&gt; SlotRange) -&gt; SlotRange -&gt; m SlotRange
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LowerBound Slot -&gt; UpperBound Slot -&gt; SlotRange
forall a. LowerBound a -&gt; UpperBound a -&gt; Interval a
</span><span class="hs-identifier hs-var">Api.Interval</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Extended Slot -&gt; Closure -&gt; LowerBound Slot
forall a. Extended a -&gt; Closure -&gt; LowerBound a
</span><span class="hs-identifier hs-var">Api.LowerBound</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slot -&gt; Extended Slot
forall a. a -&gt; Extended a
</span><span class="hs-identifier hs-var">Api.Finite</span></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679776021"><span class="hs-identifier hs-var">left</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Closure
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(UpperBound Slot -&gt; SlotRange)
-&gt; (SlotRange -&gt; UpperBound Slot) -&gt; SlotRange -&gt; SlotRange
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SlotRange -&gt; UpperBound Slot
forall a. Interval a -&gt; UpperBound a
</span><span class="hs-identifier hs-var">Api.ivTo</span></span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="annot"><span class="hs-comment">-- | Sets the right bound of the validity range. Leaves the left bound unchanged</span></span><span>
</span><span id="line-31"></span><span id="local-6989586621679776027"><span class="annot"><a href="Cooked.Tweak.ValidityRange.html#setValidityEndTweak"><span class="hs-identifier hs-type">setValidityEndTweak</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tweak.Common.html#MonadTweak"><span class="hs-identifier hs-type">MonadTweak</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679776027"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.Slot</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679776027"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.SlotRange</span></span></span><span>
</span><span id="line-32"></span><span id="setValidityEndTweak"><span class="annot"><span class="annottext">setValidityEndTweak :: forall (m :: * -&gt; *). MonadTweak m =&gt; Slot -&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#setValidityEndTweak"><span class="hs-identifier hs-var hs-var">setValidityEndTweak</span></a></span></span><span> </span><span id="local-6989586621679776035"><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679776035"><span class="hs-identifier hs-var">right</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m SlotRange
forall (m :: * -&gt; *). MonadTweak m =&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#getValidityRangeTweak"><span class="hs-identifier hs-var">getValidityRangeTweak</span></a></span><span> </span><span class="annot"><span class="annottext">m SlotRange -&gt; (SlotRange -&gt; m SlotRange) -&gt; m SlotRange
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">SlotRange -&gt; m SlotRange
forall (m :: * -&gt; *). MonadTweak m =&gt; SlotRange -&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#setValidityRangeTweak"><span class="hs-identifier hs-var">setValidityRangeTweak</span></a></span><span> </span><span class="annot"><span class="annottext">(SlotRange -&gt; m SlotRange)
-&gt; (SlotRange -&gt; SlotRange) -&gt; SlotRange -&gt; m SlotRange
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(LowerBound Slot -&gt; UpperBound Slot -&gt; SlotRange)
-&gt; UpperBound Slot -&gt; LowerBound Slot -&gt; SlotRange
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">LowerBound Slot -&gt; UpperBound Slot -&gt; SlotRange
forall a. LowerBound a -&gt; UpperBound a -&gt; Interval a
</span><span class="hs-identifier hs-var">Api.Interval</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Extended Slot -&gt; Closure -&gt; UpperBound Slot
forall a. Extended a -&gt; Closure -&gt; UpperBound a
</span><span class="hs-identifier hs-var">Api.UpperBound</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slot -&gt; Extended Slot
forall a. a -&gt; Extended a
</span><span class="hs-identifier hs-var">Api.Finite</span></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679776035"><span class="hs-identifier hs-var">right</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Closure
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LowerBound Slot -&gt; SlotRange)
-&gt; (SlotRange -&gt; LowerBound Slot) -&gt; SlotRange -&gt; SlotRange
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SlotRange -&gt; LowerBound Slot
forall a. Interval a -&gt; LowerBound a
</span><span class="hs-identifier hs-var">Api.ivFrom</span></span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="annot"><span class="hs-comment">-- | Checks if the validity range satisfies a certain predicate</span></span><span>
</span><span id="line-35"></span><span id="local-6989586621679775939"><span class="annot"><a href="Cooked.Tweak.ValidityRange.html#validityRangeSatisfiesTweak"><span class="hs-identifier hs-type">validityRangeSatisfiesTweak</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tweak.Common.html#MonadTweak"><span class="hs-identifier hs-type">MonadTweak</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679775939"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ledger.SlotRange</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679775939"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-36"></span><span id="validityRangeSatisfiesTweak"><span class="annot"><span class="annottext">validityRangeSatisfiesTweak :: forall (m :: * -&gt; *).
MonadTweak m =&gt;
(SlotRange -&gt; Closure) -&gt; m Closure
</span><a href="Cooked.Tweak.ValidityRange.html#validityRangeSatisfiesTweak"><span class="hs-identifier hs-var hs-var">validityRangeSatisfiesTweak</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SlotRange -&gt; Closure) -&gt; m SlotRange -&gt; m Closure
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m SlotRange
forall (m :: * -&gt; *). MonadTweak m =&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#getValidityRangeTweak"><span class="hs-identifier hs-var">getValidityRangeTweak</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="annot"><span class="hs-comment">-- | Checks if a given time belongs to the validity range of a transaction</span></span><span>
</span><span id="line-39"></span><span id="local-6989586621679775947"><span class="annot"><a href="Cooked.Tweak.ValidityRange.html#isValidAtTweak"><span class="hs-identifier hs-type">isValidAtTweak</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tweak.Common.html#MonadTweak"><span class="hs-identifier hs-type">MonadTweak</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679775947"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.Slot</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679775947"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-40"></span><span id="isValidAtTweak"><span class="annot"><span class="annottext">isValidAtTweak :: forall (m :: * -&gt; *). MonadTweak m =&gt; Slot -&gt; m Closure
</span><a href="Cooked.Tweak.ValidityRange.html#isValidAtTweak"><span class="hs-identifier hs-var hs-var">isValidAtTweak</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SlotRange -&gt; Closure) -&gt; m Closure
forall (m :: * -&gt; *).
MonadTweak m =&gt;
(SlotRange -&gt; Closure) -&gt; m Closure
</span><a href="Cooked.Tweak.ValidityRange.html#validityRangeSatisfiesTweak"><span class="hs-identifier hs-var">validityRangeSatisfiesTweak</span></a></span><span> </span><span class="annot"><span class="annottext">((SlotRange -&gt; Closure) -&gt; m Closure)
-&gt; (Slot -&gt; SlotRange -&gt; Closure) -&gt; Slot -&gt; m Closure
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Slot -&gt; SlotRange -&gt; Closure
forall a. (Enum a, Ord a) =&gt; a -&gt; Interval a -&gt; Closure
</span><span class="hs-identifier hs-var">Api.member</span></span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="annot"><span class="hs-comment">-- | Checks if the current validity range includes the current time</span></span><span>
</span><span id="line-43"></span><span id="local-6989586621679775952"><span class="annot"><a href="Cooked.Tweak.ValidityRange.html#isValidNowTweak"><span class="hs-identifier hs-type">isValidNowTweak</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tweak.Common.html#MonadTweak"><span class="hs-identifier hs-type">MonadTweak</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679775952"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679775952"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-44"></span><span id="isValidNowTweak"><span class="annot"><span class="annottext">isValidNowTweak :: forall (m :: * -&gt; *). MonadTweak m =&gt; m Closure
</span><a href="Cooked.Tweak.ValidityRange.html#isValidNowTweak"><span class="hs-identifier hs-var hs-var">isValidNowTweak</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m Slot
forall (m :: * -&gt; *). MonadBlockChainWithoutValidation m =&gt; m Slot
</span><a href="Cooked.MockChain.BlockChain.html#currentSlot"><span class="hs-identifier hs-var">currentSlot</span></a></span><span> </span><span class="annot"><span class="annottext">m Slot -&gt; (Slot -&gt; m Closure) -&gt; m Closure
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Slot -&gt; m Closure
forall (m :: * -&gt; *). MonadTweak m =&gt; Slot -&gt; m Closure
</span><a href="Cooked.Tweak.ValidityRange.html#isValidAtTweak"><span class="hs-identifier hs-var">isValidAtTweak</span></a></span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="annot"><span class="hs-comment">-- | Checks if a given range is included in the validity range of a transaction</span></span><span>
</span><span id="line-47"></span><span id="local-6989586621679775956"><span class="annot"><a href="Cooked.Tweak.ValidityRange.html#isValidDuringTweak"><span class="hs-identifier hs-type">isValidDuringTweak</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tweak.Common.html#MonadTweak"><span class="hs-identifier hs-type">MonadTweak</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679775956"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.SlotRange</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679775956"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-48"></span><span id="isValidDuringTweak"><span class="annot"><span class="annottext">isValidDuringTweak :: forall (m :: * -&gt; *). MonadTweak m =&gt; SlotRange -&gt; m Closure
</span><a href="Cooked.Tweak.ValidityRange.html#isValidDuringTweak"><span class="hs-identifier hs-var hs-var">isValidDuringTweak</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SlotRange -&gt; Closure) -&gt; m Closure
forall (m :: * -&gt; *).
MonadTweak m =&gt;
(SlotRange -&gt; Closure) -&gt; m Closure
</span><a href="Cooked.Tweak.ValidityRange.html#validityRangeSatisfiesTweak"><span class="hs-identifier hs-var">validityRangeSatisfiesTweak</span></a></span><span> </span><span class="annot"><span class="annottext">((SlotRange -&gt; Closure) -&gt; m Closure)
-&gt; (SlotRange -&gt; SlotRange -&gt; Closure) -&gt; SlotRange -&gt; m Closure
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(SlotRange -&gt; SlotRange -&gt; Closure)
-&gt; SlotRange -&gt; SlotRange -&gt; Closure
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">SlotRange -&gt; SlotRange -&gt; Closure
forall a. (Enum a, Ord a) =&gt; Interval a -&gt; Interval a -&gt; Closure
</span><span class="hs-identifier hs-var">Api.contains</span></span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="annot"><span class="hs-comment">-- | Checks if the validity range is empty</span></span><span>
</span><span id="line-51"></span><span id="local-6989586621679776075"><span class="annot"><a href="Cooked.Tweak.ValidityRange.html#hasEmptyTimeRangeTweak"><span class="hs-identifier hs-type">hasEmptyTimeRangeTweak</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tweak.Common.html#MonadTweak"><span class="hs-identifier hs-type">MonadTweak</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679776075"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679776075"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-52"></span><span id="hasEmptyTimeRangeTweak"><span class="annot"><span class="annottext">hasEmptyTimeRangeTweak :: forall (m :: * -&gt; *). MonadTweak m =&gt; m Closure
</span><a href="Cooked.Tweak.ValidityRange.html#hasEmptyTimeRangeTweak"><span class="hs-identifier hs-var hs-var">hasEmptyTimeRangeTweak</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SlotRange -&gt; Closure) -&gt; m Closure
forall (m :: * -&gt; *).
MonadTweak m =&gt;
(SlotRange -&gt; Closure) -&gt; m Closure
</span><a href="Cooked.Tweak.ValidityRange.html#validityRangeSatisfiesTweak"><span class="hs-identifier hs-var">validityRangeSatisfiesTweak</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange -&gt; Closure
forall a. (Enum a, Ord a) =&gt; Interval a -&gt; Closure
</span><span class="hs-identifier hs-var">Api.isEmpty</span></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="annot"><span class="hs-comment">-- | Checks if the validity range is unconstrained</span></span><span>
</span><span id="line-55"></span><span id="local-6989586621679776082"><span class="annot"><a href="Cooked.Tweak.ValidityRange.html#hasFullTimeRangeTweak"><span class="hs-identifier hs-type">hasFullTimeRangeTweak</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tweak.Common.html#MonadTweak"><span class="hs-identifier hs-type">MonadTweak</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679776082"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679776082"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-56"></span><span id="hasFullTimeRangeTweak"><span class="annot"><span class="annottext">hasFullTimeRangeTweak :: forall (m :: * -&gt; *). MonadTweak m =&gt; m Closure
</span><a href="Cooked.Tweak.ValidityRange.html#hasFullTimeRangeTweak"><span class="hs-identifier hs-var hs-var">hasFullTimeRangeTweak</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SlotRange -&gt; Closure) -&gt; m Closure
forall (m :: * -&gt; *).
MonadTweak m =&gt;
(SlotRange -&gt; Closure) -&gt; m Closure
</span><a href="Cooked.Tweak.ValidityRange.html#validityRangeSatisfiesTweak"><span class="hs-identifier hs-var">validityRangeSatisfiesTweak</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotRange
forall a. Interval a
</span><span class="hs-identifier hs-var">Api.always</span></span><span> </span><span class="annot"><span class="annottext">SlotRange -&gt; SlotRange -&gt; Closure
forall a. Eq a =&gt; a -&gt; a -&gt; Closure
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="hs-comment">-- | Adds a constraint to the current validity range. Returns the old range, and</span><span>
</span><span id="line-59"></span><span class="hs-comment">-- fails is the resulting interval is empty</span><span>
</span><span id="line-60"></span><span id="local-6989586621679776090"><span class="annot"><a href="Cooked.Tweak.ValidityRange.html#intersectValidityRangeTweak"><span class="hs-identifier hs-type">intersectValidityRangeTweak</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tweak.Common.html#MonadTweak"><span class="hs-identifier hs-type">MonadTweak</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679776090"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.SlotRange</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679776090"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.SlotRange</span></span></span><span>
</span><span id="line-61"></span><span id="intersectValidityRangeTweak"><span class="annot"><span class="annottext">intersectValidityRangeTweak :: forall (m :: * -&gt; *). MonadTweak m =&gt; SlotRange -&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#intersectValidityRangeTweak"><span class="hs-identifier hs-var hs-var">intersectValidityRangeTweak</span></a></span></span><span> </span><span id="local-6989586621679776108"><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679776108"><span class="hs-identifier hs-var">newRange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-62"></span><span>  </span><span id="local-6989586621679776109"><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679776109"><span class="hs-identifier hs-var">oldRange</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx TxSkel SlotRange -&gt; m SlotRange
forall (m :: * -&gt; *) k (is :: IxList) a.
(MonadTweak m, Is k A_Getter) =&gt;
Optic' k is TxSkel a -&gt; m a
</span><a href="Cooked.Tweak.Common.html#viewTweak"><span class="hs-identifier hs-var">viewTweak</span></a></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx TxSkel SlotRange
</span><a href="Cooked.Skeleton.html#txSkelValidityRangeL"><span class="hs-identifier hs-var">txSkelValidityRangeL</span></a></span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679776110"><span class="annot"><span class="annottext">combinedRange :: SlotRange
</span><a href="#local-6989586621679776110"><span class="hs-identifier hs-var hs-var">combinedRange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotRange -&gt; SlotRange -&gt; SlotRange
forall a. (Enum a, Ord a) =&gt; Interval a -&gt; Interval a -&gt; Interval a
</span><span class="hs-identifier hs-var">Api.intersection</span></span><span> </span><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679776108"><span class="hs-identifier hs-var">newRange</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679776109"><span class="hs-identifier hs-var">oldRange</span></a></span><span>
</span><span id="line-64"></span><span>  </span><span class="annot"><span class="annottext">Closure -&gt; m ()
forall (f :: * -&gt; *). Alternative f =&gt; Closure -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679776110"><span class="hs-identifier hs-var">combinedRange</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange -&gt; SlotRange -&gt; Closure
forall a. Eq a =&gt; a -&gt; a -&gt; Closure
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">SlotRange
forall a. Interval a
</span><span class="hs-identifier hs-var">Api.never</span></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>  </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx TxSkel SlotRange -&gt; SlotRange -&gt; m ()
forall (m :: * -&gt; *) k (is :: IxList) a.
(MonadTweak m, Is k A_Setter) =&gt;
Optic' k is TxSkel a -&gt; a -&gt; m ()
</span><a href="Cooked.Tweak.Common.html#setTweak"><span class="hs-identifier hs-var">setTweak</span></a></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx TxSkel SlotRange
</span><a href="Cooked.Skeleton.html#txSkelValidityRangeL"><span class="hs-identifier hs-var">txSkelValidityRangeL</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679776110"><span class="hs-identifier hs-var">combinedRange</span></a></span><span>
</span><span id="line-66"></span><span>  </span><span class="annot"><span class="annottext">SlotRange -&gt; m SlotRange
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679776109"><span class="hs-identifier hs-var">oldRange</span></a></span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="annot"><span class="hs-comment">-- | Centers the validity range around a value with a certain radius</span></span><span>
</span><span id="line-69"></span><span id="local-6989586621679775967"><span class="annot"><a href="Cooked.Tweak.ValidityRange.html#centerAroundValidityRangeTweak"><span class="hs-identifier hs-type">centerAroundValidityRangeTweak</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tweak.Common.html#MonadTweak"><span class="hs-identifier hs-type">MonadTweak</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679775967"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.Slot</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679775967"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.SlotRange</span></span></span><span>
</span><span id="line-70"></span><span id="centerAroundValidityRangeTweak"><span class="annot"><span class="annottext">centerAroundValidityRangeTweak :: forall (m :: * -&gt; *).
MonadTweak m =&gt;
Slot -&gt; Integer -&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#centerAroundValidityRangeTweak"><span class="hs-identifier hs-var hs-var">centerAroundValidityRangeTweak</span></a></span></span><span> </span><span id="local-6989586621679776120"><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679776120"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679776121"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679776121"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679776122"><span class="annot"><span class="annottext">radius :: Slot
</span><a href="#local-6989586621679776122"><span class="hs-identifier hs-var hs-var">radius</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Slot
</span><span class="hs-identifier hs-var">Ledger.Slot</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679776121"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-72"></span><span>      </span><span id="local-6989586621679776124"><span class="annot"><span class="annottext">left :: Slot
</span><a href="#local-6989586621679776124"><span class="hs-identifier hs-var hs-var">left</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679776120"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Slot -&gt; Slot -&gt; Slot
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679776122"><span class="hs-identifier hs-var">radius</span></a></span><span>
</span><span id="line-73"></span><span>      </span><span id="local-6989586621679776125"><span class="annot"><span class="annottext">right :: Slot
</span><a href="#local-6989586621679776125"><span class="hs-identifier hs-var hs-var">right</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679776120"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Slot -&gt; Slot -&gt; Slot
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679776122"><span class="hs-identifier hs-var">radius</span></a></span><span>
</span><span id="line-74"></span><span>      </span><span id="local-6989586621679776127"><span class="annot"><span class="annottext">newRange :: SlotRange
</span><a href="#local-6989586621679776127"><span class="hs-identifier hs-var hs-var">newRange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Slot -&gt; Slot -&gt; SlotRange
forall a. a -&gt; a -&gt; Interval a
</span><span class="hs-identifier hs-var">Api.interval</span></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679776124"><span class="hs-identifier hs-var">left</span></a></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679776125"><span class="hs-identifier hs-var">right</span></a></span><span>
</span><span id="line-75"></span><span>  </span><span class="annot"><span class="annottext">SlotRange -&gt; m SlotRange
forall (m :: * -&gt; *). MonadTweak m =&gt; SlotRange -&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#setValidityRangeTweak"><span class="hs-identifier hs-var">setValidityRangeTweak</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679776127"><span class="hs-identifier hs-var">newRange</span></a></span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="annot"><span class="hs-comment">-- | Makes a transaction range equal to a singleton</span></span><span>
</span><span id="line-78"></span><span id="local-6989586621679776129"><span class="annot"><a href="Cooked.Tweak.ValidityRange.html#makeValidityRangeSingletonTweak"><span class="hs-identifier hs-type">makeValidityRangeSingletonTweak</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tweak.Common.html#MonadTweak"><span class="hs-identifier hs-type">MonadTweak</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679776129"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.Slot</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679776129"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.SlotRange</span></span></span><span>
</span><span id="line-79"></span><span id="makeValidityRangeSingletonTweak"><span class="annot"><span class="annottext">makeValidityRangeSingletonTweak :: forall (m :: * -&gt; *). MonadTweak m =&gt; Slot -&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#makeValidityRangeSingletonTweak"><span class="hs-identifier hs-var hs-var">makeValidityRangeSingletonTweak</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotRange -&gt; m SlotRange
forall (m :: * -&gt; *). MonadTweak m =&gt; SlotRange -&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#setValidityRangeTweak"><span class="hs-identifier hs-var">setValidityRangeTweak</span></a></span><span> </span><span class="annot"><span class="annottext">(SlotRange -&gt; m SlotRange)
-&gt; (Slot -&gt; SlotRange) -&gt; Slot -&gt; m SlotRange
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Slot -&gt; SlotRange
forall a. a -&gt; Interval a
</span><span class="hs-identifier hs-var">Api.singleton</span></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="annot"><span class="hs-comment">-- | Makes the transaction validity range comply with the current time</span></span><span>
</span><span id="line-82"></span><span id="local-6989586621679776134"><span class="annot"><a href="Cooked.Tweak.ValidityRange.html#makeValidityRangeNowTweak"><span class="hs-identifier hs-type">makeValidityRangeNowTweak</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tweak.Common.html#MonadTweak"><span class="hs-identifier hs-type">MonadTweak</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679776134"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679776134"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.SlotRange</span></span></span><span>
</span><span id="line-83"></span><span id="makeValidityRangeNowTweak"><span class="annot"><span class="annottext">makeValidityRangeNowTweak :: forall (m :: * -&gt; *). MonadTweak m =&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#makeValidityRangeNowTweak"><span class="hs-identifier hs-var hs-var">makeValidityRangeNowTweak</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m Slot
forall (m :: * -&gt; *). MonadBlockChainWithoutValidation m =&gt; m Slot
</span><a href="Cooked.MockChain.BlockChain.html#currentSlot"><span class="hs-identifier hs-var">currentSlot</span></a></span><span> </span><span class="annot"><span class="annottext">m Slot -&gt; (Slot -&gt; m SlotRange) -&gt; m SlotRange
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Slot -&gt; m SlotRange
forall (m :: * -&gt; *). MonadTweak m =&gt; Slot -&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#makeValidityRangeSingletonTweak"><span class="hs-identifier hs-var">makeValidityRangeSingletonTweak</span></a></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-comment">-- | Makes current time comply with the validity range of the transaction under</span><span>
</span><span id="line-86"></span><span class="hs-comment">-- modification. Returns the new current time after the modification; fails if</span><span>
</span><span id="line-87"></span><span class="hs-comment">-- current time is already after the validity range.</span><span>
</span><span id="line-88"></span><span id="local-6989586621679775974"><span class="annot"><a href="Cooked.Tweak.ValidityRange.html#waitUntilValidTweak"><span class="hs-identifier hs-type">waitUntilValidTweak</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Tweak.Common.html#MonadTweak"><span class="hs-identifier hs-type">MonadTweak</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679775974"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679775974"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.Slot</span></span></span><span>
</span><span id="line-89"></span><span id="waitUntilValidTweak"><span class="annot"><span class="annottext">waitUntilValidTweak :: forall (m :: * -&gt; *). MonadTweak m =&gt; m Slot
</span><a href="Cooked.Tweak.ValidityRange.html#waitUntilValidTweak"><span class="hs-identifier hs-var hs-var">waitUntilValidTweak</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-90"></span><span>  </span><span id="local-6989586621679776179"><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679776179"><span class="hs-identifier hs-var">now</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Slot
forall (m :: * -&gt; *). MonadBlockChainWithoutValidation m =&gt; m Slot
</span><a href="Cooked.MockChain.BlockChain.html#currentSlot"><span class="hs-identifier hs-var">currentSlot</span></a></span><span>
</span><span id="line-91"></span><span>  </span><span id="local-6989586621679776180"><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679776180"><span class="hs-identifier hs-var">vRange</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m SlotRange
forall (m :: * -&gt; *). MonadTweak m =&gt; m SlotRange
</span><a href="Cooked.Tweak.ValidityRange.html#getValidityRangeTweak"><span class="hs-identifier hs-var">getValidityRangeTweak</span></a></span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Slot -&gt; SlotRange -&gt; Closure
forall a. (Enum a, Ord a) =&gt; a -&gt; Interval a -&gt; Closure
</span><span class="hs-identifier hs-var">Api.member</span></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679776179"><span class="hs-identifier hs-var">now</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679776180"><span class="hs-identifier hs-var">vRange</span></a></span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Slot -&gt; m Slot
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679776179"><span class="hs-identifier hs-var">now</span></a></span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-95"></span><span>      </span><span class="annot"><span class="annottext">Closure -&gt; m ()
forall (f :: * -&gt; *). Alternative f =&gt; Closure -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Closure -&gt; m ()) -&gt; Closure -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Slot -&gt; SlotRange -&gt; Closure
forall a. (Enum a, Ord a) =&gt; a -&gt; Interval a -&gt; Closure
</span><span class="hs-identifier hs-var">Api.before</span></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679776179"><span class="hs-identifier hs-var">now</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679776180"><span class="hs-identifier hs-var">vRange</span></a></span><span>
</span><span id="line-96"></span><span>      </span><span class="annot"><span class="annottext">Closure -&gt; m ()
forall (f :: * -&gt; *). Alternative f =&gt; Closure -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Closure -&gt; m ()) -&gt; Closure -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Closure -&gt; Closure
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Closure -&gt; Closure) -&gt; Closure -&gt; Closure
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SlotRange -&gt; Closure
forall a. (Enum a, Ord a) =&gt; Interval a -&gt; Closure
</span><span class="hs-identifier hs-var">Api.isEmpty</span></span><span> </span><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679776180"><span class="hs-identifier hs-var">vRange</span></a></span><span>
</span><span id="line-97"></span><span>      </span><span id="local-6989586621679776183"><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679776183"><span class="hs-identifier hs-var">later</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SlotRange -&gt; LowerBound Slot
forall a. Interval a -&gt; LowerBound a
</span><span class="hs-identifier hs-var">Api.ivFrom</span></span><span> </span><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679776180"><span class="hs-identifier hs-var">vRange</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-98"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Api.LowerBound</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Api.Finite</span></span><span> </span><span id="local-6989586621679776184"><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679776184"><span class="hs-identifier hs-var">left</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679776185"><span class="annot"><span class="annottext">Closure
</span><a href="#local-6989586621679776185"><span class="hs-identifier hs-var">isClosed</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-99"></span><span>          </span><span class="annot"><span class="annottext">Slot -&gt; m Slot
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Slot -&gt; m Slot) -&gt; Slot -&gt; m Slot
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679776184"><span class="hs-identifier hs-var">left</span></a></span><span> </span><span class="annot"><span class="annottext">Slot -&gt; Slot -&gt; Slot
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Slot
</span><span class="hs-identifier hs-var">Ledger.Slot</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><span class="hs-identifier hs-var">toInteger</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Integer) -&gt; Int -&gt; Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Closure -&gt; Int
forall a. Enum a =&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">fromEnum</span></span><span> </span><span class="annot"><span class="annottext">(Closure -&gt; Int) -&gt; Closure -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Closure -&gt; Closure
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Closure
</span><a href="#local-6989586621679776185"><span class="hs-identifier hs-var">isClosed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>        </span><span class="annot"><span class="annottext">LowerBound Slot
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; m Slot
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;this should never happen: left-finite interval without left border&quot;</span></span><span>
</span><span id="line-101"></span><span>      </span><span class="annot"><span class="annottext">m Slot -&gt; m ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(m Slot -&gt; m ()) -&gt; m Slot -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Slot -&gt; m Slot
forall (m :: * -&gt; *).
MonadBlockChainWithoutValidation m =&gt;
Slot -&gt; m Slot
</span><a href="Cooked.MockChain.BlockChain.html#awaitSlot"><span class="hs-identifier hs-var">awaitSlot</span></a></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679776183"><span class="hs-identifier hs-var">later</span></a></span><span>
</span><span id="line-102"></span><span>      </span><span class="annot"><span class="annottext">Slot -&gt; m Slot
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679776183"><span class="hs-identifier hs-var">later</span></a></span><span>
</span><span id="line-103"></span></pre></body></html>