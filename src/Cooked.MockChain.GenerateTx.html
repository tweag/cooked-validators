<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | This module provides primitives to translate elements from our skeleton to</span><span>
</span><span id="line-2"></span><span class="hs-comment">-- actual transaction elements, including the transaction itself. Ideally, this</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- module should only export `generateTx` but we need to make visible a few</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- other primitives that will be used in balancing.</span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cooked.MockChain.GenerateTx</span><span>
</span><span id="line-6"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#GenerateTxError"><span class="hs-identifier">GenerateTxError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#generateBodyContent"><span class="hs-identifier">generateBodyContent</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#generateTxOut"><span class="hs-identifier">generateTxOut</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#generateTx"><span class="hs-identifier">generateTx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">where</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Api</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Cardano</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Api.Shelley</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Cardano</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Node.Emulator.Internal.Node</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Emulator</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.Conversion.html"><span class="hs-identifier">Cooked.Conversion</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.Output.html"><span class="hs-identifier">Cooked.Output</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.Skeleton.html"><span class="hs-identifier">Cooked.Skeleton</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.Wallet.html"><span class="hs-identifier">Cooked.Wallet</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bifunctor</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Default</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Address</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ledger</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Tx</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ledger</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Tx.CardanoAPI</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ledger</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Optics.Core</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.Script.Utils.Scripts</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Script</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusLedgerApi.V1.Value</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Api</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusLedgerApi.V3</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Api</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusTx.Numeric</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PlutusTx</span></span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="annot"><span class="hs-comment">-- * Domain for transaction generation and associated types</span></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-keyword">data</span><span> </span><span id="GenerateTxError"><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#GenerateTxError"><span class="hs-identifier hs-var">GenerateTxError</span></a></span></span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="ToCardanoError"><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#ToCardanoError"><span class="hs-identifier hs-var">ToCardanoError</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.ToCardanoError</span></span><span>
</span><span id="line-42"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="TxBodyError"><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#TxBodyError"><span class="hs-identifier hs-var">TxBodyError</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.TxBodyError</span></span><span>
</span><span id="line-43"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="GenerateTxErrorGeneral"><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#GenerateTxErrorGeneral"><span class="hs-identifier hs-var">GenerateTxErrorGeneral</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-44"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679701853"><span id="local-6989586621679701868"><span id="local-6989586621679701872"><span class="annot"><span class="annottext">Int -&gt; GenerateTxError -&gt; ShowS
[GenerateTxError] -&gt; ShowS
GenerateTxError -&gt; String
(Int -&gt; GenerateTxError -&gt; ShowS)
-&gt; (GenerateTxError -&gt; String)
-&gt; ([GenerateTxError] -&gt; ShowS)
-&gt; Show GenerateTxError
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; GenerateTxError -&gt; ShowS
showsPrec :: Int -&gt; GenerateTxError -&gt; ShowS
$cshow :: GenerateTxError -&gt; String
show :: GenerateTxError -&gt; String
$cshowList :: [GenerateTxError] -&gt; ShowS
showList :: [GenerateTxError] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679701877"><span id="local-6989586621679701888"><span class="annot"><span class="annottext">GenerateTxError -&gt; GenerateTxError -&gt; Bool
(GenerateTxError -&gt; GenerateTxError -&gt; Bool)
-&gt; (GenerateTxError -&gt; GenerateTxError -&gt; Bool)
-&gt; Eq GenerateTxError
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: GenerateTxError -&gt; GenerateTxError -&gt; Bool
== :: GenerateTxError -&gt; GenerateTxError -&gt; Bool
$c/= :: GenerateTxError -&gt; GenerateTxError -&gt; Bool
/= :: GenerateTxError -&gt; GenerateTxError -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="annot"><span class="hs-comment">-- | Context in which various parts of transactions will be built</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">data</span><span> </span><span id="Context"><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#Context"><span class="hs-identifier hs-var">Context</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-48"></span><span>  </span><span id="Context"><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#Context"><span class="hs-identifier hs-var">Context</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-comment">-- | fee to apply to body generation</span></span><span>
</span><span id="line-50"></span><span>      </span><span id="fee"><span class="annot"><span class="annottext">Context -&gt; Integer
</span><a href="Cooked.MockChain.GenerateTx.html#fee"><span class="hs-identifier hs-var hs-var">fee</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>      </span><span class="annot"><span class="hs-comment">-- | collaterals to add to body generation</span></span><span>
</span><span id="line-52"></span><span>      </span><span id="collateralIns"><span class="annot"><span class="annottext">Context -&gt; Set TxOutRef
</span><a href="Cooked.MockChain.GenerateTx.html#collateralIns"><span class="hs-identifier hs-var hs-var">collateralIns</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOutRef</span></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>      </span><span class="annot"><span class="hs-comment">-- | wallet to return collaterals to</span></span><span>
</span><span id="line-54"></span><span>      </span><span id="returnCollateralWallet"><span class="annot"><span class="annottext">Context -&gt; Maybe Wallet
</span><a href="Cooked.MockChain.GenerateTx.html#returnCollateralWallet"><span class="hs-identifier hs-var hs-var">returnCollateralWallet</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Cooked.Wallet.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>      </span><span class="annot"><span class="hs-comment">-- | parameters of the emulator</span></span><span>
</span><span id="line-56"></span><span>      </span><span id="params"><span class="annot"><span class="annottext">Context -&gt; Params
</span><a href="Cooked.MockChain.GenerateTx.html#params"><span class="hs-identifier hs-var hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Emulator.Params</span></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>      </span><span class="annot"><span class="hs-comment">-- | datums present in our environment</span></span><span>
</span><span id="line-58"></span><span>      </span><span id="managedData"><span class="annot"><span class="annottext">Context -&gt; Map DatumHash Datum
</span><a href="Cooked.MockChain.GenerateTx.html#managedData"><span class="hs-identifier hs-var hs-var">managedData</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.DatumHash</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.Datum</span></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>      </span><span class="annot"><span class="hs-comment">-- | txouts present in our environment</span></span><span>
</span><span id="line-60"></span><span>      </span><span id="managedTxOuts"><span class="annot"><span class="annottext">Context -&gt; Map TxOutRef TxOut
</span><a href="Cooked.MockChain.GenerateTx.html#managedTxOuts"><span class="hs-identifier hs-var hs-var">managedTxOuts</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOutRef</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOut</span></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>      </span><span class="annot"><span class="hs-comment">-- | validators present in our environment</span></span><span>
</span><span id="line-62"></span><span>      </span><span id="managedValidators"><span class="annot"><span class="annottext">Context -&gt; Map ValidatorHash (Versioned Validator)
</span><a href="Cooked.MockChain.GenerateTx.html#managedValidators"><span class="hs-identifier hs-var hs-var">managedValidators</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script.ValidatorHash</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Script.Versioned</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script.Validator</span></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-64"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Default</span></span><span> </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-67"></span><span>  </span><span id="local-6989586621679701906"><span class="annot"><span class="annottext">def :: Context
</span><a href="#local-6989586621679701906"><span class="hs-identifier hs-var hs-var hs-var hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer
-&gt; Set TxOutRef
-&gt; Maybe Wallet
-&gt; Params
-&gt; Map DatumHash Datum
-&gt; Map TxOutRef TxOut
-&gt; Map ValidatorHash (Versioned Validator)
-&gt; Context
</span><a href="Cooked.MockChain.GenerateTx.html#Context"><span class="hs-identifier hs-var">Context</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Set TxOutRef
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Maybe Wallet
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Params
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span> </span><span class="annot"><span class="annottext">Map DatumHash Datum
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span> </span><span class="annot"><span class="annottext">Map TxOutRef TxOut
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span> </span><span class="annot"><span class="annottext">Map ValidatorHash (Versioned Validator)
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-comment">-- The domain in which transactions are generated.</span><span>
</span><span id="line-70"></span><span class="hs-keyword">type</span><span> </span><span id="TxGen"><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#TxGen"><span class="hs-identifier hs-var">TxGen</span></a></span></span><span> </span><span id="local-6989586621679701909"><span class="annot"><a href="#local-6989586621679701909"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#GenerateTxError"><span class="hs-identifier hs-type">GenerateTxError</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679701909"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="annot"><span class="hs-comment">-- * Helpers to throw errors in 'TxGen'</span></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-comment">-- Looks up a key in a map. Throws a 'GenerateTxErrorGeneral' error with a given</span><span>
</span><span id="line-75"></span><span class="hs-comment">-- message when the key is absent, returns the associated value otherwise.</span><span>
</span><span id="line-76"></span><span id="local-6989586621679701416"><span id="local-6989586621679701417"><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#throwOnLookup"><span class="hs-identifier hs-type">throwOnLookup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679701416"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679701416"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679701416"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679701417"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#TxGen"><span class="hs-identifier hs-type">TxGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679701417"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-77"></span><span id="throwOnLookup"><span class="annot"><span class="annottext">throwOnLookup :: forall k a. Ord k =&gt; String -&gt; k -&gt; Map k a -&gt; TxGen a
</span><a href="Cooked.MockChain.GenerateTx.html#throwOnLookup"><span class="hs-identifier hs-var hs-var">throwOnLookup</span></a></span></span><span> </span><span id="local-6989586621679701914"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679701914"><span class="hs-identifier hs-var">errorMsg</span></a></span></span><span> </span><span id="local-6989586621679701915"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679701915"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxGen a -&gt; (a -&gt; TxGen a) -&gt; Maybe a -&gt; TxGen a
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; TxGen a
forall a. String -&gt; TxGen a
</span><a href="Cooked.MockChain.GenerateTx.html#throwOnString"><span class="hs-identifier hs-var">throwOnString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679701914"><span class="hs-identifier hs-var">errorMsg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; TxGen a
forall a. a -&gt; ReaderT Context (Either GenerateTxError) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe a -&gt; TxGen a) -&gt; (Map k a -&gt; Maybe a) -&gt; Map k a -&gt; TxGen a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">k -&gt; Map k a -&gt; Maybe a
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679701915"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-comment">-- Throws a general error from a String</span><span>
</span><span id="line-80"></span><span id="local-6989586621679701423"><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#throwOnString"><span class="hs-identifier hs-type">throwOnString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#TxGen"><span class="hs-identifier hs-type">TxGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679701423"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-81"></span><span id="throwOnString"><span class="annot"><span class="annottext">throwOnString :: forall a. String -&gt; TxGen a
</span><a href="Cooked.MockChain.GenerateTx.html#throwOnString"><span class="hs-identifier hs-var hs-var">throwOnString</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either GenerateTxError a
-&gt; ReaderT Context (Either GenerateTxError) a
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ReaderT Context m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(Either GenerateTxError a
 -&gt; ReaderT Context (Either GenerateTxError) a)
-&gt; (String -&gt; Either GenerateTxError a)
-&gt; String
-&gt; ReaderT Context (Either GenerateTxError) a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenerateTxError -&gt; Either GenerateTxError a
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(GenerateTxError -&gt; Either GenerateTxError a)
-&gt; (String -&gt; GenerateTxError)
-&gt; String
-&gt; Either GenerateTxError a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; GenerateTxError
</span><a href="Cooked.MockChain.GenerateTx.html#GenerateTxErrorGeneral"><span class="hs-identifier hs-var">GenerateTxErrorGeneral</span></a></span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="hs-comment">-- Lifts a 'ToCardanoError' with an associated error message, or apply a</span><span>
</span><span id="line-84"></span><span class="hs-comment">-- function if a value exists</span><span>
</span><span id="line-85"></span><span id="local-6989586621679701437"><span id="local-6989586621679701438"><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#throwOnToCardanoErrorOrApply"><span class="hs-identifier hs-type">throwOnToCardanoErrorOrApply</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679701437"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679701438"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.ToCardanoError</span></span><span> </span><span class="annot"><a href="#local-6989586621679701437"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#TxGen"><span class="hs-identifier hs-type">TxGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679701438"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-86"></span><span id="throwOnToCardanoErrorOrApply"><span class="annot"><span class="annottext">throwOnToCardanoErrorOrApply :: forall a b.
String -&gt; (a -&gt; b) -&gt; Either ToCardanoError a -&gt; TxGen b
</span><a href="Cooked.MockChain.GenerateTx.html#throwOnToCardanoErrorOrApply"><span class="hs-identifier hs-var hs-var">throwOnToCardanoErrorOrApply</span></a></span></span><span> </span><span id="local-6989586621679701927"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679701927"><span class="hs-identifier hs-var">errorMsg</span></a></span></span><span> </span><span id="local-6989586621679701928"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679701928"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either GenerateTxError b
-&gt; ReaderT Context (Either GenerateTxError) b
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ReaderT Context m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(Either GenerateTxError b
 -&gt; ReaderT Context (Either GenerateTxError) b)
-&gt; (Either ToCardanoError a -&gt; Either GenerateTxError b)
-&gt; Either ToCardanoError a
-&gt; ReaderT Context (Either GenerateTxError) b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ToCardanoError -&gt; GenerateTxError)
-&gt; (a -&gt; b) -&gt; Either ToCardanoError a -&gt; Either GenerateTxError b
forall a b c d. (a -&gt; b) -&gt; (c -&gt; d) -&gt; Either a c -&gt; Either b d
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ToCardanoError -&gt; GenerateTxError
</span><a href="Cooked.MockChain.GenerateTx.html#ToCardanoError"><span class="hs-identifier hs-var">ToCardanoError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679701927"><span class="hs-identifier hs-var">errorMsg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679701928"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-comment">-- Lifts a 'ToCardanoError' with an associated error message, or leaves the</span><span>
</span><span id="line-89"></span><span class="hs-comment">-- value unchanged if it exists</span><span>
</span><span id="line-90"></span><span id="local-6989586621679701446"><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#throwOnToCardanoError"><span class="hs-identifier hs-type">throwOnToCardanoError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.ToCardanoError</span></span><span> </span><span class="annot"><a href="#local-6989586621679701446"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#TxGen"><span class="hs-identifier hs-type">TxGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679701446"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-91"></span><span id="throwOnToCardanoError"><span class="annot"><span class="annottext">throwOnToCardanoError :: forall a. String -&gt; Either ToCardanoError a -&gt; TxGen a
</span><a href="Cooked.MockChain.GenerateTx.html#throwOnToCardanoError"><span class="hs-identifier hs-var hs-var">throwOnToCardanoError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String -&gt; (a -&gt; a) -&gt; Either ToCardanoError a -&gt; TxGen a)
-&gt; (a -&gt; a) -&gt; String -&gt; Either ToCardanoError a -&gt; TxGen a
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; (a -&gt; a) -&gt; Either ToCardanoError a -&gt; TxGen a
forall a b.
String -&gt; (a -&gt; b) -&gt; Either ToCardanoError a -&gt; TxGen b
</span><a href="Cooked.MockChain.GenerateTx.html#throwOnToCardanoErrorOrApply"><span class="hs-identifier hs-var">throwOnToCardanoErrorOrApply</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="annot"><span class="hs-comment">-- * Generation functions</span></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#txSkelToBodyContent"><span class="hs-identifier hs-type">txSkelToBodyContent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cooked.Skeleton.html#TxSkel"><span class="hs-identifier hs-type">TxSkel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#TxGen"><span class="hs-identifier hs-type">TxGen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Cardano.TxBodyContent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.BuildTx</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.ConwayEra</span></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span id="txSkelToBodyContent"><span class="annot"><span class="annottext">txSkelToBodyContent :: TxSkel -&gt; TxGen (TxBodyContent BuildTx ConwayEra)
</span><a href="Cooked.MockChain.GenerateTx.html#txSkelToBodyContent"><span class="hs-identifier hs-var hs-var">txSkelToBodyContent</span></a></span></span><span> </span><span class="annot"><a href="Cooked.Skeleton.html#TxSkel"><span class="hs-identifier hs-type">TxSkel</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679701935"><span id="local-6989586621679701936"><span id="local-6989586621679701937"><span id="local-6989586621679701938"><span id="local-6989586621679701939"><span id="local-6989586621679701940"><span id="local-6989586621679701941"><span id="local-6989586621679701942"><span class="annot"><span class="annottext">[Wallet]
[TxSkelOut]
Set TxOutRef
Set TxLabel
Map TxOutRef TxSkelRedeemer
TxSkelMints
SlotRange
TxOpts
txSkelLabel :: Set TxLabel
txSkelOpts :: TxOpts
txSkelMints :: TxSkelMints
txSkelSigners :: [Wallet]
txSkelValidityRange :: SlotRange
txSkelIns :: Map TxOutRef TxSkelRedeemer
txSkelInsReference :: Set TxOutRef
txSkelOuts :: [TxSkelOut]
txSkelLabel :: TxSkel -&gt; Set TxLabel
txSkelOpts :: TxSkel -&gt; TxOpts
txSkelMints :: TxSkel -&gt; TxSkelMints
txSkelSigners :: TxSkel -&gt; [Wallet]
txSkelValidityRange :: TxSkel -&gt; SlotRange
txSkelIns :: TxSkel -&gt; Map TxOutRef TxSkelRedeemer
txSkelInsReference :: TxSkel -&gt; Set TxOutRef
txSkelOuts :: TxSkel -&gt; [TxSkelOut]
</span><a href="#local-6989586621679701935"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-97"></span><span>  </span><span id="local-6989586621679701951"><span class="annot"><span class="annottext">[(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn ConwayEra))]
</span><a href="#local-6989586621679701951"><span class="hs-identifier hs-var">txIns</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((TxOutRef, TxSkelRedeemer)
 -&gt; ReaderT
      Context
      (Either GenerateTxError)
      (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn ConwayEra)))
-&gt; [(TxOutRef, TxSkelRedeemer)]
-&gt; ReaderT
     Context
     (Either GenerateTxError)
     [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn ConwayEra))]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">(TxOutRef, TxSkelRedeemer)
-&gt; ReaderT
     Context
     (Either GenerateTxError)
     (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn ConwayEra))
</span><a href="Cooked.MockChain.GenerateTx.html#txSkelInToTxIn"><span class="hs-identifier hs-var">txSkelInToTxIn</span></a></span><span> </span><span class="annot"><span class="annottext">([(TxOutRef, TxSkelRedeemer)]
 -&gt; ReaderT
      Context
      (Either GenerateTxError)
      [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn ConwayEra))])
-&gt; [(TxOutRef, TxSkelRedeemer)]
-&gt; ReaderT
     Context
     (Either GenerateTxError)
     [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn ConwayEra))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map TxOutRef TxSkelRedeemer -&gt; [(TxOutRef, TxSkelRedeemer)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map TxOutRef TxSkelRedeemer
</span><a href="#local-6989586621679701940"><span class="hs-identifier hs-var">txSkelIns</span></a></span><span>
</span><span id="line-98"></span><span>  </span><span id="local-6989586621679701955"><span class="annot"><span class="annottext">TxInsReference BuildTx ConwayEra
</span><a href="#local-6989586621679701955"><span class="hs-identifier hs-var">txInsReference</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TxOutRef] -&gt; TxGen (TxInsReference BuildTx ConwayEra)
</span><a href="Cooked.MockChain.GenerateTx.html#txOutRefsToTxInsReference"><span class="hs-identifier hs-var">txOutRefsToTxInsReference</span></a></span><span> </span><span class="annot"><span class="annottext">([TxOutRef] -&gt; TxGen (TxInsReference BuildTx ConwayEra))
-&gt; [TxOutRef] -&gt; TxGen (TxInsReference BuildTx ConwayEra)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TxSkelRedeemer -&gt; Maybe TxOutRef)
-&gt; [TxSkelRedeemer] -&gt; [TxOutRef]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">TxSkelRedeemer -&gt; Maybe TxOutRef
</span><a href="Cooked.Skeleton.html#txSkelReferenceScript"><span class="hs-identifier hs-var">txSkelReferenceScript</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map TxOutRef TxSkelRedeemer -&gt; [TxSkelRedeemer]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">Map.elems</span></span><span> </span><span class="annot"><span class="annottext">Map TxOutRef TxSkelRedeemer
</span><a href="#local-6989586621679701940"><span class="hs-identifier hs-var">txSkelIns</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TxOutRef] -&gt; [TxOutRef] -&gt; [TxOutRef]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Set TxOutRef -&gt; [TxOutRef]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set TxOutRef
</span><a href="#local-6989586621679701941"><span class="hs-identifier hs-var">txSkelInsReference</span></a></span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679701961"><span class="annot"><span class="annottext">TxInsCollateral ConwayEra
</span><a href="#local-6989586621679701961"><span class="hs-identifier hs-var">txInsCollateral</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679701962"><span class="annot"><span class="annottext">TxTotalCollateral ConwayEra
</span><a href="#local-6989586621679701962"><span class="hs-identifier hs-var">txTotalCollateral</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679701963"><span class="annot"><span class="annottext">TxReturnCollateral CtxTx ConwayEra
</span><a href="#local-6989586621679701963"><span class="hs-identifier hs-var">txReturnCollateral</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxGen
  (TxInsCollateral ConwayEra, TxTotalCollateral ConwayEra,
   TxReturnCollateral CtxTx ConwayEra)
</span><a href="Cooked.MockChain.GenerateTx.html#toCollateralTriplet"><span class="hs-identifier hs-var">toCollateralTriplet</span></a></span><span>
</span><span id="line-100"></span><span>  </span><span id="local-6989586621679701965"><span class="annot"><span class="annottext">[TxOut CtxTx ConwayEra]
</span><a href="#local-6989586621679701965"><span class="hs-identifier hs-var">txOuts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TxSkelOut
 -&gt; ReaderT
      Context (Either GenerateTxError) (TxOut CtxTx ConwayEra))
-&gt; [TxSkelOut]
-&gt; ReaderT Context (Either GenerateTxError) [TxOut CtxTx ConwayEra]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">TxSkelOut
-&gt; ReaderT Context (Either GenerateTxError) (TxOut CtxTx ConwayEra)
</span><a href="Cooked.MockChain.GenerateTx.html#txSkelOutToCardanoTxOut"><span class="hs-identifier hs-var">txSkelOutToCardanoTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">[TxSkelOut]
</span><a href="#local-6989586621679701942"><span class="hs-identifier hs-var">txSkelOuts</span></a></span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679701967"><span class="annot"><span class="annottext">TxValidityLowerBound ConwayEra
</span><a href="#local-6989586621679701967"><span class="hs-identifier hs-var">txValidityLowerBound</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679701968"><span class="annot"><span class="annottext">TxValidityUpperBound ConwayEra
</span><a href="#local-6989586621679701968"><span class="hs-identifier hs-var">txValidityUpperBound</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-102"></span><span>    </span><span class="annot"><span class="annottext">String
-&gt; Either
     ToCardanoError
     (TxValidityLowerBound ConwayEra, TxValidityUpperBound ConwayEra)
-&gt; TxGen
     (TxValidityLowerBound ConwayEra, TxValidityUpperBound ConwayEra)
forall a. String -&gt; Either ToCardanoError a -&gt; TxGen a
</span><a href="Cooked.MockChain.GenerateTx.html#throwOnToCardanoError"><span class="hs-identifier hs-var">throwOnToCardanoError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;translating the transaction validity range&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Either
   ToCardanoError
   (TxValidityLowerBound ConwayEra, TxValidityUpperBound ConwayEra)
 -&gt; TxGen
      (TxValidityLowerBound ConwayEra, TxValidityUpperBound ConwayEra))
-&gt; Either
     ToCardanoError
     (TxValidityLowerBound ConwayEra, TxValidityUpperBound ConwayEra)
-&gt; TxGen
     (TxValidityLowerBound ConwayEra, TxValidityUpperBound ConwayEra)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SlotRange
-&gt; Either
     ToCardanoError
     (TxValidityLowerBound ConwayEra, TxValidityUpperBound ConwayEra)
</span><span class="hs-identifier hs-var">Ledger.toCardanoValidityRange</span></span><span> </span><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679701939"><span class="hs-identifier hs-var">txSkelValidityRange</span></a></span><span>
</span><span id="line-103"></span><span>  </span><span id="local-6989586621679701970"><span class="annot"><span class="annottext">TxMintValue BuildTx ConwayEra
</span><a href="#local-6989586621679701970"><span class="hs-identifier hs-var">txMintValue</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxSkelMints -&gt; TxGen (TxMintValue BuildTx ConwayEra)
</span><a href="Cooked.MockChain.GenerateTx.html#txSkelMintsToTxMintValue"><span class="hs-identifier hs-var">txSkelMintsToTxMintValue</span></a></span><span> </span><span class="annot"><span class="annottext">TxSkelMints
</span><a href="#local-6989586621679701937"><span class="hs-identifier hs-var">txSkelMints</span></a></span><span>
</span><span id="line-104"></span><span>  </span><span id="local-6989586621679701972"><span class="annot"><span class="annottext">TxExtraKeyWitnesses ConwayEra
</span><a href="#local-6989586621679701972"><span class="hs-identifier hs-var">txExtraKeyWits</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[Wallet] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Wallet]
</span><a href="#local-6989586621679701938"><span class="hs-identifier hs-var">txSkelSigners</span></a></span><span>
</span><span id="line-106"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TxExtraKeyWitnesses ConwayEra
-&gt; ReaderT
     Context (Either GenerateTxError) (TxExtraKeyWitnesses ConwayEra)
forall a. a -&gt; ReaderT Context (Either GenerateTxError) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TxExtraKeyWitnesses ConwayEra
forall era. TxExtraKeyWitnesses era
</span><span class="hs-identifier hs-var">Cardano.TxExtraKeyWitnessesNone</span></span><span>
</span><span id="line-107"></span><span>      </span><span class="hs-keyword">else</span><span>
</span><span id="line-108"></span><span>        </span><span class="annot"><span class="annottext">String
-&gt; ([Hash PaymentKey] -&gt; TxExtraKeyWitnesses ConwayEra)
-&gt; Either ToCardanoError [Hash PaymentKey]
-&gt; ReaderT
     Context (Either GenerateTxError) (TxExtraKeyWitnesses ConwayEra)
forall a b.
String -&gt; (a -&gt; b) -&gt; Either ToCardanoError a -&gt; TxGen b
</span><a href="Cooked.MockChain.GenerateTx.html#throwOnToCardanoErrorOrApply"><span class="hs-identifier hs-var">throwOnToCardanoErrorOrApply</span></a></span><span>
</span><span id="line-109"></span><span>          </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;translating the required signers&quot;</span></span><span>
</span><span id="line-110"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AlonzoEraOnwards ConwayEra
-&gt; [Hash PaymentKey] -&gt; TxExtraKeyWitnesses ConwayEra
forall era.
AlonzoEraOnwards era
-&gt; [Hash PaymentKey] -&gt; TxExtraKeyWitnesses era
</span><span class="hs-identifier hs-var">Cardano.TxExtraKeyWitnesses</span></span><span> </span><span class="annot"><span class="annottext">AlonzoEraOnwards ConwayEra
</span><span class="hs-identifier hs-var">Cardano.AlonzoEraOnwardsConway</span></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>          </span><span class="annot"><span class="annottext">(Either ToCardanoError [Hash PaymentKey]
 -&gt; ReaderT
      Context (Either GenerateTxError) (TxExtraKeyWitnesses ConwayEra))
-&gt; Either ToCardanoError [Hash PaymentKey]
-&gt; ReaderT
     Context (Either GenerateTxError) (TxExtraKeyWitnesses ConwayEra)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Wallet -&gt; Either ToCardanoError (Hash PaymentKey))
-&gt; [Wallet] -&gt; Either ToCardanoError [Hash PaymentKey]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PaymentPubKeyHash -&gt; Either ToCardanoError (Hash PaymentKey)
</span><span class="hs-identifier hs-var">Ledger.toCardanoPaymentKeyHash</span></span><span> </span><span class="annot"><span class="annottext">(PaymentPubKeyHash -&gt; Either ToCardanoError (Hash PaymentKey))
-&gt; (Wallet -&gt; PaymentPubKeyHash)
-&gt; Wallet
-&gt; Either ToCardanoError (Hash PaymentKey)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PubKeyHash -&gt; PaymentPubKeyHash
</span><span class="hs-identifier hs-var">Ledger.PaymentPubKeyHash</span></span><span> </span><span class="annot"><span class="annottext">(PubKeyHash -&gt; PaymentPubKeyHash)
-&gt; (Wallet -&gt; PubKeyHash) -&gt; Wallet -&gt; PaymentPubKeyHash
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Wallet -&gt; PubKeyHash
</span><a href="Cooked.Wallet.html#walletPKHash"><span class="hs-identifier hs-var">walletPKHash</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Wallet]
</span><a href="#local-6989586621679701938"><span class="hs-identifier hs-var">txSkelSigners</span></a></span><span>
</span><span id="line-112"></span><span>  </span><span id="local-6989586621679701980"><span class="annot"><span class="annottext">BuildTxWith BuildTx (Maybe (LedgerProtocolParameters ConwayEra))
</span><a href="#local-6989586621679701980"><span class="hs-identifier hs-var">txProtocolParams</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Context
 -&gt; BuildTxWith
      BuildTx (Maybe (LedgerProtocolParameters ConwayEra)))
-&gt; ReaderT
     Context
     (Either GenerateTxError)
     (BuildTxWith BuildTx (Maybe (LedgerProtocolParameters ConwayEra)))
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (LedgerProtocolParameters ConwayEra)
-&gt; BuildTxWith BuildTx (Maybe (LedgerProtocolParameters ConwayEra))
forall a. a -&gt; BuildTxWith BuildTx a
</span><span class="hs-identifier hs-var">Cardano.BuildTxWith</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (LedgerProtocolParameters ConwayEra)
 -&gt; BuildTxWith
      BuildTx (Maybe (LedgerProtocolParameters ConwayEra)))
-&gt; (Context -&gt; Maybe (LedgerProtocolParameters ConwayEra))
-&gt; Context
-&gt; BuildTxWith BuildTx (Maybe (LedgerProtocolParameters ConwayEra))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LedgerProtocolParameters ConwayEra
-&gt; Maybe (LedgerProtocolParameters ConwayEra)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(LedgerProtocolParameters ConwayEra
 -&gt; Maybe (LedgerProtocolParameters ConwayEra))
-&gt; (Context -&gt; LedgerProtocolParameters ConwayEra)
-&gt; Context
-&gt; Maybe (LedgerProtocolParameters ConwayEra)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Params -&gt; LedgerProtocolParameters ConwayEra
</span><span class="hs-identifier hs-var">Emulator.ledgerProtocolParameters</span></span><span> </span><span class="annot"><span class="annottext">(Params -&gt; LedgerProtocolParameters ConwayEra)
-&gt; (Context -&gt; Params)
-&gt; Context
-&gt; LedgerProtocolParameters ConwayEra
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; Params
</span><a href="Cooked.MockChain.GenerateTx.html#params"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>  </span><span id="local-6989586621679701984"><span class="annot"><span class="annottext">TxFee ConwayEra
</span><a href="#local-6989586621679701984"><span class="hs-identifier hs-var">txFee</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Context -&gt; TxFee ConwayEra)
-&gt; ReaderT Context (Either GenerateTxError) (TxFee ConwayEra)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyBasedEra ConwayEra -&gt; Coin -&gt; TxFee ConwayEra
forall era. ShelleyBasedEra era -&gt; Coin -&gt; TxFee era
</span><span class="hs-identifier hs-var">Cardano.TxFeeExplicit</span></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra ConwayEra
</span><span class="hs-identifier hs-var">Cardano.ShelleyBasedEraConway</span></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; TxFee ConwayEra)
-&gt; (Context -&gt; Coin) -&gt; Context -&gt; TxFee ConwayEra
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><span class="hs-identifier hs-var">Emulator.Coin</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Coin) -&gt; (Context -&gt; Integer) -&gt; Context -&gt; Coin
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; Integer
</span><a href="Cooked.MockChain.GenerateTx.html#fee"><span class="hs-identifier hs-var">fee</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679701988"><span class="annot"><span class="annottext">txMetadata :: TxMetadataInEra era
</span><a href="#local-6989586621679701988"><span class="hs-identifier hs-var hs-var">txMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxMetadataInEra era
forall era. TxMetadataInEra era
</span><span class="hs-identifier hs-var">Cardano.TxMetadataNone</span></span><span> </span><span class="hs-comment">-- That's what plutus-apps does as well</span><span>
</span><span id="line-115"></span><span>      </span><span id="local-6989586621679701990"><span class="annot"><span class="annottext">txAuxScripts :: TxAuxScripts era
</span><a href="#local-6989586621679701990"><span class="hs-identifier hs-var hs-var">txAuxScripts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxAuxScripts era
forall era. TxAuxScripts era
</span><span class="hs-identifier hs-var">Cardano.TxAuxScriptsNone</span></span><span> </span><span class="hs-comment">-- That's what plutus-apps does as well</span><span>
</span><span id="line-116"></span><span>      </span><span id="local-6989586621679701992"><span class="annot"><span class="annottext">txWithdrawals :: TxWithdrawals build era
</span><a href="#local-6989586621679701992"><span class="hs-identifier hs-var hs-var">txWithdrawals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxWithdrawals build era
forall build era. TxWithdrawals build era
</span><span class="hs-identifier hs-var">Cardano.TxWithdrawalsNone</span></span><span> </span><span class="hs-comment">-- That's what plutus-apps does as well</span><span>
</span><span id="line-117"></span><span>      </span><span id="local-6989586621679701994"><span class="annot"><span class="annottext">txCertificates :: TxCertificates build era
</span><a href="#local-6989586621679701994"><span class="hs-identifier hs-var hs-var">txCertificates</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxCertificates build era
forall build era. TxCertificates build era
</span><span class="hs-identifier hs-var">Cardano.TxCertificatesNone</span></span><span> </span><span class="hs-comment">-- That's what plutus-apps does as well</span><span>
</span><span id="line-118"></span><span>      </span><span id="local-6989586621679701996"><span class="annot"><span class="annottext">txUpdateProposal :: TxUpdateProposal era
</span><a href="#local-6989586621679701996"><span class="hs-identifier hs-var hs-var">txUpdateProposal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxUpdateProposal era
forall era. TxUpdateProposal era
</span><span class="hs-identifier hs-var">Cardano.TxUpdateProposalNone</span></span><span> </span><span class="hs-comment">-- That's what plutus-apps does as well</span><span>
</span><span id="line-119"></span><span>      </span><span id="local-6989586621679701998"><span class="annot"><span class="annottext">txScriptValidity :: TxScriptValidity era
</span><a href="#local-6989586621679701998"><span class="hs-identifier hs-var hs-var">txScriptValidity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxScriptValidity era
forall era. TxScriptValidity era
</span><span class="hs-identifier hs-var">Cardano.TxScriptValidityNone</span></span><span> </span><span class="hs-comment">-- That's what plutus-apps does as well</span><span>
</span><span id="line-120"></span><span>      </span><span id="local-6989586621679702000"><span class="annot"><span class="annottext">txProposalProcedures :: Maybe a
</span><a href="#local-6989586621679702000"><span class="hs-identifier hs-var hs-var">txProposalProcedures</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-comment">-- TODO, should appear in our skeleton?</span><span>
</span><span id="line-121"></span><span>      </span><span id="local-6989586621679702001"><span class="annot"><span class="annottext">txVotingProcedures :: Maybe a
</span><a href="#local-6989586621679702001"><span class="hs-identifier hs-var hs-var">txVotingProcedures</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-comment">-- TODO, same as above</span><span>
</span><span id="line-122"></span><span>  </span><span class="annot"><span class="annottext">TxBodyContent BuildTx ConwayEra
-&gt; TxGen (TxBodyContent BuildTx ConwayEra)
forall a. a -&gt; ReaderT Context (Either GenerateTxError) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.TxBodyContent</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">[(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn ConwayEra))]
[TxOut CtxTx ConwayEra]
Maybe
  (Featured
     ConwayEraOnwards
     ConwayEra
     (TxProposalProcedures BuildTx ConwayEra))
Maybe
  (Featured
     ConwayEraOnwards ConwayEra (TxVotingProcedures BuildTx ConwayEra))
BuildTxWith BuildTx (Maybe (LedgerProtocolParameters ConwayEra))
TxAuxScripts ConwayEra
TxCertificates BuildTx ConwayEra
TxExtraKeyWitnesses ConwayEra
TxFee ConwayEra
TxInsCollateral ConwayEra
TxInsReference BuildTx ConwayEra
TxMetadataInEra ConwayEra
TxMintValue BuildTx ConwayEra
TxReturnCollateral CtxTx ConwayEra
TxTotalCollateral ConwayEra
TxUpdateProposal ConwayEra
TxValidityLowerBound ConwayEra
TxValidityUpperBound ConwayEra
TxWithdrawals BuildTx ConwayEra
TxScriptValidity ConwayEra
forall a. Maybe a
forall era. TxAuxScripts era
forall era. TxMetadataInEra era
forall era. TxUpdateProposal era
forall era. TxScriptValidity era
forall build era. TxCertificates build era
forall build era. TxWithdrawals build era
txIns :: [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn ConwayEra))]
txInsReference :: TxInsReference BuildTx ConwayEra
txInsCollateral :: TxInsCollateral ConwayEra
txTotalCollateral :: TxTotalCollateral ConwayEra
txReturnCollateral :: TxReturnCollateral CtxTx ConwayEra
txOuts :: [TxOut CtxTx ConwayEra]
txValidityLowerBound :: TxValidityLowerBound ConwayEra
txValidityUpperBound :: TxValidityUpperBound ConwayEra
txMintValue :: TxMintValue BuildTx ConwayEra
txExtraKeyWits :: TxExtraKeyWitnesses ConwayEra
txProtocolParams :: BuildTxWith BuildTx (Maybe (LedgerProtocolParameters ConwayEra))
txFee :: TxFee ConwayEra
txMetadata :: forall era. TxMetadataInEra era
txAuxScripts :: forall era. TxAuxScripts era
txWithdrawals :: forall build era. TxWithdrawals build era
txCertificates :: forall build era. TxCertificates build era
txUpdateProposal :: forall era. TxUpdateProposal era
txScriptValidity :: forall era. TxScriptValidity era
txProposalProcedures :: forall a. Maybe a
txVotingProcedures :: forall a. Maybe a
txAuxScripts :: TxAuxScripts ConwayEra
txCertificates :: TxCertificates BuildTx ConwayEra
txExtraKeyWits :: TxExtraKeyWitnesses ConwayEra
txFee :: TxFee ConwayEra
txIns :: [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn ConwayEra))]
txInsCollateral :: TxInsCollateral ConwayEra
txInsReference :: TxInsReference BuildTx ConwayEra
txMetadata :: TxMetadataInEra ConwayEra
txMintValue :: TxMintValue BuildTx ConwayEra
txOuts :: [TxOut CtxTx ConwayEra]
txProposalProcedures :: Maybe
  (Featured
     ConwayEraOnwards
     ConwayEra
     (TxProposalProcedures BuildTx ConwayEra))
txProtocolParams :: BuildTxWith BuildTx (Maybe (LedgerProtocolParameters ConwayEra))
txReturnCollateral :: TxReturnCollateral CtxTx ConwayEra
txScriptValidity :: TxScriptValidity ConwayEra
txTotalCollateral :: TxTotalCollateral ConwayEra
txUpdateProposal :: TxUpdateProposal ConwayEra
txValidityLowerBound :: TxValidityLowerBound ConwayEra
txValidityUpperBound :: TxValidityUpperBound ConwayEra
txVotingProcedures :: Maybe
  (Featured
     ConwayEraOnwards ConwayEra (TxVotingProcedures BuildTx ConwayEra))
txWithdrawals :: TxWithdrawals BuildTx ConwayEra
</span><a href="#local-6989586621679701951"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#generateBodyContent"><span class="hs-identifier hs-type">generateBodyContent</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-125"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-126"></span><span>  </span><span class="annot"><a href="Cooked.Wallet.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-127"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOutRef</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-128"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Emulator.Params</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-129"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.DatumHash</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.Datum</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-130"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOutRef</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOut</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-131"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script.ValidatorHash</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Script.Versioned</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script.Validator</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-132"></span><span>  </span><span class="annot"><a href="Cooked.Skeleton.html#TxSkel"><span class="hs-identifier hs-type">TxSkel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-133"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#GenerateTxError"><span class="hs-identifier hs-type">GenerateTxError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Cardano.TxBodyContent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.BuildTx</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.ConwayEra</span></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span id="generateBodyContent"><span class="annot"><span class="annottext">generateBodyContent :: Integer
-&gt; Wallet
-&gt; Set TxOutRef
-&gt; Params
-&gt; Map DatumHash Datum
-&gt; Map TxOutRef TxOut
-&gt; Map ValidatorHash (Versioned Validator)
-&gt; TxSkel
-&gt; Either GenerateTxError (TxBodyContent BuildTx ConwayEra)
</span><a href="Cooked.MockChain.GenerateTx.html#generateBodyContent"><span class="hs-identifier hs-var hs-var">generateBodyContent</span></a></span></span><span> </span><span id="local-6989586621679702023"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679702023"><span class="hs-identifier hs-var">fee</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Wallet -&gt; Maybe Wallet
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679702024"><span class="annot"><span class="annottext">Maybe Wallet
</span><a href="#local-6989586621679702024"><span class="hs-identifier hs-var">returnCollateralWallet</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679702025"><span class="annot"><span class="annottext">Set TxOutRef
</span><a href="#local-6989586621679702025"><span class="hs-identifier hs-var">collateralIns</span></a></span></span><span> </span><span id="local-6989586621679702026"><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679702026"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621679702027"><span class="annot"><span class="annottext">Map DatumHash Datum
</span><a href="#local-6989586621679702027"><span class="hs-identifier hs-var">managedData</span></a></span></span><span> </span><span id="local-6989586621679702028"><span class="annot"><span class="annottext">Map TxOutRef TxOut
</span><a href="#local-6989586621679702028"><span class="hs-identifier hs-var">managedTxOuts</span></a></span></span><span> </span><span id="local-6989586621679702029"><span class="annot"><span class="annottext">Map ValidatorHash (Versioned Validator)
</span><a href="#local-6989586621679702029"><span class="hs-identifier hs-var">managedValidators</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-135"></span><span>  </span><span class="annot"><span class="annottext">(TxGen (TxBodyContent BuildTx ConwayEra)
 -&gt; Context
 -&gt; Either GenerateTxError (TxBodyContent BuildTx ConwayEra))
-&gt; Context
-&gt; TxGen (TxBodyContent BuildTx ConwayEra)
-&gt; Either GenerateTxError (TxBodyContent BuildTx ConwayEra)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">TxGen (TxBodyContent BuildTx ConwayEra)
-&gt; Context
-&gt; Either GenerateTxError (TxBodyContent BuildTx ConwayEra)
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var">runReaderT</span></span><span> </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">Integer
Maybe Wallet
Set TxOutRef
Map DatumHash Datum
Map TxOutRef TxOut
Map ValidatorHash (Versioned Validator)
Params
fee :: Integer
collateralIns :: Set TxOutRef
returnCollateralWallet :: Maybe Wallet
params :: Params
managedData :: Map DatumHash Datum
managedTxOuts :: Map TxOutRef TxOut
managedValidators :: Map ValidatorHash (Versioned Validator)
fee :: Integer
returnCollateralWallet :: Maybe Wallet
collateralIns :: Set TxOutRef
params :: Params
managedData :: Map DatumHash Datum
managedTxOuts :: Map TxOutRef TxOut
managedValidators :: Map ValidatorHash (Versioned Validator)
</span><a href="Cooked.MockChain.GenerateTx.html#fee"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">(TxGen (TxBodyContent BuildTx ConwayEra)
 -&gt; Either GenerateTxError (TxBodyContent BuildTx ConwayEra))
-&gt; (TxSkel -&gt; TxGen (TxBodyContent BuildTx ConwayEra))
-&gt; TxSkel
-&gt; Either GenerateTxError (TxBodyContent BuildTx ConwayEra)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TxSkel -&gt; TxGen (TxBodyContent BuildTx ConwayEra)
</span><a href="Cooked.MockChain.GenerateTx.html#txSkelToBodyContent"><span class="hs-identifier hs-var">txSkelToBodyContent</span></a></span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="hs-comment">-- Convert a 'TxSkel' input, which consists of a 'Api.TxOutRef' and a</span><span>
</span><span id="line-138"></span><span class="hs-comment">-- 'TxSkelIn', into a 'Cardano.TxIn', together with the appropriate witness. If</span><span>
</span><span id="line-139"></span><span class="hs-comment">-- you add reference inputs, don't forget to also update the 'txInsReference'!</span><span>
</span><span id="line-140"></span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#txSkelInToTxIn"><span class="hs-identifier hs-type">txSkelInToTxIn</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Api.TxOutRef</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cooked.Skeleton.html#TxSkelRedeemer"><span class="hs-identifier hs-type">TxSkelRedeemer</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-142"></span><span>  </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#TxGen"><span class="hs-identifier hs-type">TxGen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Cardano.TxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.BuildTxWith</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.BuildTx</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Cardano.Witness</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.WitCtxTxIn</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.ConwayEra</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span id="txSkelInToTxIn"><span class="annot"><span class="annottext">txSkelInToTxIn :: (TxOutRef, TxSkelRedeemer)
-&gt; ReaderT
     Context
     (Either GenerateTxError)
     (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn ConwayEra))
</span><a href="Cooked.MockChain.GenerateTx.html#txSkelInToTxIn"><span class="hs-identifier hs-var hs-var">txSkelInToTxIn</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679702031"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679702031"><span class="hs-identifier hs-var">txOutRef</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679702032"><span class="annot"><span class="annottext">TxSkelRedeemer
</span><a href="#local-6989586621679702032"><span class="hs-identifier hs-var">txSkelRedeemer</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-144"></span><span>  </span><span id="local-6989586621679702033"><span class="annot"><span class="annottext">Witness WitCtxTxIn ConwayEra
</span><a href="#local-6989586621679702033"><span class="hs-identifier hs-var">witness</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; TxSkelRedeemer -&gt; TxGen (Witness WitCtxTxIn ConwayEra)
</span><a href="Cooked.MockChain.GenerateTx.html#txSkelRedeemerToWitness"><span class="hs-identifier hs-var">txSkelRedeemerToWitness</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679702031"><span class="hs-identifier hs-var">txOutRef</span></a></span><span> </span><span class="annot"><span class="annottext">TxSkelRedeemer
</span><a href="#local-6989586621679702032"><span class="hs-identifier hs-var">txSkelRedeemer</span></a></span><span>
</span><span id="line-145"></span><span>  </span><span class="annot"><span class="annottext">String
-&gt; (TxIn
    -&gt; (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn ConwayEra)))
-&gt; Either ToCardanoError TxIn
-&gt; ReaderT
     Context
     (Either GenerateTxError)
     (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn ConwayEra))
forall a b.
String -&gt; (a -&gt; b) -&gt; Either ToCardanoError a -&gt; TxGen b
</span><a href="Cooked.MockChain.GenerateTx.html#throwOnToCardanoErrorOrApply"><span class="hs-identifier hs-var">throwOnToCardanoErrorOrApply</span></a></span><span>
</span><span id="line-146"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;txSkelIntoTxIn, translating TxOutRef&quot;</span></span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Witness WitCtxTxIn ConwayEra
-&gt; BuildTxWith BuildTx (Witness WitCtxTxIn ConwayEra)
forall a. a -&gt; BuildTxWith BuildTx a
</span><span class="hs-identifier hs-var">Cardano.BuildTxWith</span></span><span> </span><span class="annot"><span class="annottext">Witness WitCtxTxIn ConwayEra
</span><a href="#local-6989586621679702033"><span class="hs-identifier hs-var">witness</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>    </span><span class="annot"><span class="annottext">(Either ToCardanoError TxIn
 -&gt; ReaderT
      Context
      (Either GenerateTxError)
      (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn ConwayEra)))
-&gt; Either ToCardanoError TxIn
-&gt; ReaderT
     Context
     (Either GenerateTxError)
     (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn ConwayEra))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; Either ToCardanoError TxIn
</span><span class="hs-identifier hs-var">Ledger.toCardanoTxIn</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679702031"><span class="hs-identifier hs-var">txOutRef</span></a></span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#resolveScriptOutputOwnerAndDatum"><span class="hs-identifier hs-type">resolveScriptOutputOwnerAndDatum</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-151"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOutRef</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-152"></span><span>  </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#TxGen"><span class="hs-identifier hs-type">TxGen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Script.ValidatorHash</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script.Versioned</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script.Validator</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.ScriptDatum</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.WitCtxTxIn</span></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span id="resolveScriptOutputOwnerAndDatum"><span class="annot"><span class="annottext">resolveScriptOutputOwnerAndDatum :: TxOutRef
-&gt; TxGen
     (ValidatorHash, Versioned Validator, ScriptDatum WitCtxTxIn)
</span><a href="Cooked.MockChain.GenerateTx.html#resolveScriptOutputOwnerAndDatum"><span class="hs-identifier hs-var hs-var">resolveScriptOutputOwnerAndDatum</span></a></span></span><span> </span><span id="local-6989586621679702037"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679702037"><span class="hs-identifier hs-var">txOutRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-154"></span><span>  </span><span id="local-6989586621679702038"><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621679702038"><span class="hs-identifier hs-var">txOut</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; TxOutRef -&gt; Map TxOutRef TxOut -&gt; TxGen TxOut
forall k a. Ord k =&gt; String -&gt; k -&gt; Map k a -&gt; TxGen a
</span><a href="Cooked.MockChain.GenerateTx.html#throwOnLookup"><span class="hs-identifier hs-var">throwOnLookup</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;txSkelInToTxIn: Unknown txOutRef&quot;</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679702037"><span class="hs-identifier hs-var">txOutRef</span></a></span><span> </span><span class="annot"><span class="annottext">(Map TxOutRef TxOut -&gt; TxGen TxOut)
-&gt; ReaderT Context (Either GenerateTxError) (Map TxOutRef TxOut)
-&gt; TxGen TxOut
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">(Context -&gt; Map TxOutRef TxOut)
-&gt; ReaderT Context (Either GenerateTxError) (Map TxOutRef TxOut)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; Map TxOutRef TxOut
</span><a href="Cooked.MockChain.GenerateTx.html#managedTxOuts"><span class="hs-identifier hs-var">managedTxOuts</span></a></span><span>
</span><span id="line-155"></span><span>  </span><span id="local-6989586621679702040"><span class="annot"><span class="annottext">ValidatorHash
</span><a href="#local-6989586621679702040"><span class="hs-identifier hs-var">validatorHash</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TxOut -&gt; Address
forall o.
(IsAbstractOutput o, ToCredential (OwnerType o)) =&gt;
o -&gt; Address
</span><a href="Cooked.Output.html#outputAddress"><span class="hs-identifier hs-var">outputAddress</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621679702038"><span class="hs-identifier hs-var">txOut</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-157"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Api.Address</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Api.ScriptCredential</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Api.ScriptHash</span></span><span> </span><span id="local-6989586621679702045"><span class="annot"><span class="annottext">BuiltinByteString
</span><a href="#local-6989586621679702045"><span class="hs-identifier hs-var">validatorHash</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe StakingCredential
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ValidatorHash
-&gt; ReaderT Context (Either GenerateTxError) ValidatorHash
forall a. a -&gt; ReaderT Context (Either GenerateTxError) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ValidatorHash
 -&gt; ReaderT Context (Either GenerateTxError) ValidatorHash)
-&gt; ValidatorHash
-&gt; ReaderT Context (Either GenerateTxError) ValidatorHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BuiltinByteString -&gt; ValidatorHash
</span><span class="hs-identifier hs-var">Script.ValidatorHash</span></span><span> </span><span class="annot"><span class="annottext">BuiltinByteString
</span><a href="#local-6989586621679702045"><span class="hs-identifier hs-var">validatorHash</span></a></span><span>
</span><span id="line-158"></span><span>      </span><span class="annot"><span class="annottext">Address
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ReaderT Context (Either GenerateTxError) ValidatorHash
forall a. String -&gt; TxGen a
</span><a href="Cooked.MockChain.GenerateTx.html#throwOnString"><span class="hs-identifier hs-var">throwOnString</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ReaderT Context (Either GenerateTxError) ValidatorHash)
-&gt; String -&gt; ReaderT Context (Either GenerateTxError) ValidatorHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;txSkelInToTxIn: Output is not a script output&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TxOut -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621679702038"><span class="hs-identifier hs-var">txOut</span></a></span><span>
</span><span id="line-159"></span><span>  </span><span id="local-6989586621679702048"><span class="annot"><span class="annottext">Versioned Validator
</span><a href="#local-6989586621679702048"><span class="hs-identifier hs-var">validator</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String
-&gt; ValidatorHash
-&gt; Map ValidatorHash (Versioned Validator)
-&gt; TxGen (Versioned Validator)
forall k a. Ord k =&gt; String -&gt; k -&gt; Map k a -&gt; TxGen a
</span><a href="Cooked.MockChain.GenerateTx.html#throwOnLookup"><span class="hs-identifier hs-var">throwOnLookup</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;txSkelInToTxIn: Unknown validator&quot;</span></span><span> </span><span class="annot"><span class="annottext">ValidatorHash
</span><a href="#local-6989586621679702040"><span class="hs-identifier hs-var">validatorHash</span></a></span><span> </span><span class="annot"><span class="annottext">(Map ValidatorHash (Versioned Validator)
 -&gt; TxGen (Versioned Validator))
-&gt; ReaderT
     Context
     (Either GenerateTxError)
     (Map ValidatorHash (Versioned Validator))
-&gt; TxGen (Versioned Validator)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">(Context -&gt; Map ValidatorHash (Versioned Validator))
-&gt; ReaderT
     Context
     (Either GenerateTxError)
     (Map ValidatorHash (Versioned Validator))
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; Map ValidatorHash (Versioned Validator)
</span><a href="Cooked.MockChain.GenerateTx.html#managedValidators"><span class="hs-identifier hs-var">managedValidators</span></a></span><span>
</span><span id="line-160"></span><span>  </span><span id="local-6989586621679702049"><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><a href="#local-6989586621679702049"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TxOut -&gt; OutputDatum
forall o.
(IsAbstractOutput o, ToOutputDatum (DatumType o)) =&gt;
o -&gt; OutputDatum
</span><a href="Cooked.Output.html#outputOutputDatum"><span class="hs-identifier hs-var">outputOutputDatum</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621679702038"><span class="hs-identifier hs-var">txOut</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-162"></span><span>      </span><span class="annot"><span class="annottext">OutputDatum
</span><span class="hs-identifier hs-var">Api.NoOutputDatum</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
-&gt; ReaderT
     Context (Either GenerateTxError) (ScriptDatum WitCtxTxIn)
forall a. String -&gt; TxGen a
</span><a href="Cooked.MockChain.GenerateTx.html#throwOnString"><span class="hs-identifier hs-var">throwOnString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;txSkelInToTxIn: No datum found on script output&quot;</span></span><span>
</span><span id="line-163"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Api.OutputDatum</span></span><span> </span><span class="annot"><span class="annottext">Datum
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
-&gt; ReaderT
     Context (Either GenerateTxError) (ScriptDatum WitCtxTxIn)
forall a. a -&gt; ReaderT Context (Either GenerateTxError) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><span class="hs-identifier hs-var">Cardano.InlineScriptDatum</span></span><span>
</span><span id="line-164"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Api.OutputDatumHash</span></span><span> </span><span id="local-6989586621679702055"><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679702055"><span class="hs-identifier hs-var">datumHash</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-165"></span><span>        </span><span id="local-6989586621679702056"><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679702056"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; DatumHash -&gt; Map DatumHash Datum -&gt; TxGen Datum
forall k a. Ord k =&gt; String -&gt; k -&gt; Map k a -&gt; TxGen a
</span><a href="Cooked.MockChain.GenerateTx.html#throwOnLookup"><span class="hs-identifier hs-var">throwOnLookup</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;txSkelInToTxIn: Datum hash could not be resolved&quot;</span></span><span> </span><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679702055"><span class="hs-identifier hs-var">datumHash</span></a></span><span> </span><span class="annot"><span class="annottext">(Map DatumHash Datum -&gt; TxGen Datum)
-&gt; ReaderT Context (Either GenerateTxError) (Map DatumHash Datum)
-&gt; TxGen Datum
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">(Context -&gt; Map DatumHash Datum)
-&gt; ReaderT Context (Either GenerateTxError) (Map DatumHash Datum)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; Map DatumHash Datum
</span><a href="Cooked.MockChain.GenerateTx.html#managedData"><span class="hs-identifier hs-var">managedData</span></a></span><span>
</span><span id="line-166"></span><span>        </span><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
-&gt; ReaderT
     Context (Either GenerateTxError) (ScriptDatum WitCtxTxIn)
forall a. a -&gt; ReaderT Context (Either GenerateTxError) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ScriptDatum WitCtxTxIn
 -&gt; ReaderT
      Context (Either GenerateTxError) (ScriptDatum WitCtxTxIn))
-&gt; ScriptDatum WitCtxTxIn
-&gt; ReaderT
     Context (Either GenerateTxError) (ScriptDatum WitCtxTxIn)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashableScriptData -&gt; ScriptDatum WitCtxTxIn
</span><span class="hs-identifier hs-var">Cardano.ScriptDatumForTxIn</span></span><span> </span><span class="annot"><span class="annottext">(HashableScriptData -&gt; ScriptDatum WitCtxTxIn)
-&gt; HashableScriptData -&gt; ScriptDatum WitCtxTxIn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BuiltinData -&gt; HashableScriptData
</span><span class="hs-identifier hs-var">Ledger.toCardanoScriptData</span></span><span> </span><span class="annot"><span class="annottext">(BuiltinData -&gt; HashableScriptData)
-&gt; BuiltinData -&gt; HashableScriptData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Datum -&gt; BuiltinData
</span><span class="hs-identifier hs-var">Api.getDatum</span></span><span> </span><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679702056"><span class="hs-identifier hs-var">datum</span></a></span><span>
</span><span id="line-167"></span><span>  </span><span class="annot"><span class="annottext">(ValidatorHash, Versioned Validator, ScriptDatum WitCtxTxIn)
-&gt; TxGen
     (ValidatorHash, Versioned Validator, ScriptDatum WitCtxTxIn)
forall a. a -&gt; ReaderT Context (Either GenerateTxError) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValidatorHash
</span><a href="#local-6989586621679702040"><span class="hs-identifier hs-var">validatorHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Versioned Validator
</span><a href="#local-6989586621679702048"><span class="hs-identifier hs-var">validator</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><a href="#local-6989586621679702049"><span class="hs-identifier hs-var">datum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#txSkelRedeemerToWitness"><span class="hs-identifier hs-type">txSkelRedeemerToWitness</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOutRef</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cooked.Skeleton.html#TxSkelRedeemer"><span class="hs-identifier hs-type">TxSkelRedeemer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#TxGen"><span class="hs-identifier hs-type">TxGen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Cardano.Witness</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.WitCtxTxIn</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.ConwayEra</span></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span id="txSkelRedeemerToWitness"><span class="annot"><span class="annottext">txSkelRedeemerToWitness :: TxOutRef -&gt; TxSkelRedeemer -&gt; TxGen (Witness WitCtxTxIn ConwayEra)
</span><a href="Cooked.MockChain.GenerateTx.html#txSkelRedeemerToWitness"><span class="hs-identifier hs-var hs-var">txSkelRedeemerToWitness</span></a></span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TxSkelRedeemer
</span><a href="Cooked.Skeleton.html#TxSkelNoRedeemerForPK"><span class="hs-identifier hs-var">TxSkelNoRedeemerForPK</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Witness WitCtxTxIn ConwayEra
-&gt; TxGen (Witness WitCtxTxIn ConwayEra)
forall a. a -&gt; ReaderT Context (Either GenerateTxError) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Witness WitCtxTxIn ConwayEra
 -&gt; TxGen (Witness WitCtxTxIn ConwayEra))
-&gt; Witness WitCtxTxIn ConwayEra
-&gt; TxGen (Witness WitCtxTxIn ConwayEra)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">KeyWitnessInCtx WitCtxTxIn -&gt; Witness WitCtxTxIn ConwayEra
forall witctx era. KeyWitnessInCtx witctx -&gt; Witness witctx era
</span><span class="hs-identifier hs-var">Cardano.KeyWitness</span></span><span> </span><span class="annot"><span class="annottext">KeyWitnessInCtx WitCtxTxIn
</span><span class="hs-identifier hs-var">Cardano.KeyWitnessForSpending</span></span><span>
</span><span id="line-171"></span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#txSkelRedeemerToWitness"><span class="hs-identifier hs-var">txSkelRedeemerToWitness</span></a></span><span> </span><span id="local-6989586621679702063"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679702063"><span class="hs-identifier hs-var">txOutRef</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Skeleton.html#TxSkelRedeemerForReferencedScript"><span class="hs-identifier hs-type">TxSkelRedeemerForReferencedScript</span></a></span><span> </span><span id="local-6989586621679702083"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679702083"><span class="hs-identifier hs-var">validatorOref</span></a></span></span><span> </span><span id="local-6989586621679702084"><span class="annot"><span class="annottext">redeemer
</span><a href="#local-6989586621679702084"><span class="hs-identifier hs-var">redeemer</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-172"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Script.ValidatorHash</span></span><span> </span><span id="local-6989586621679702085"><span class="annot"><span class="annottext">BuiltinByteString
</span><a href="#local-6989586621679702085"><span class="hs-identifier hs-var">validatorHash</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script.Versioned</span></span><span> </span><span class="annot"><span class="annottext">Validator
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679702087"><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621679702087"><span class="hs-identifier hs-var">version</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679702088"><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><a href="#local-6989586621679702088"><span class="hs-identifier hs-var">datum</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOutRef
-&gt; TxGen
     (ValidatorHash, Versioned Validator, ScriptDatum WitCtxTxIn)
</span><a href="Cooked.MockChain.GenerateTx.html#resolveScriptOutputOwnerAndDatum"><span class="hs-identifier hs-var">resolveScriptOutputOwnerAndDatum</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679702063"><span class="hs-identifier hs-var">txOutRef</span></a></span><span>
</span><span id="line-173"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Api.ScriptHash</span></span><span> </span><span id="local-6989586621679702089"><span class="annot"><span class="annottext">BuiltinByteString
</span><a href="#local-6989586621679702089"><span class="hs-identifier hs-var">scriptHashAtOref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-174"></span><span>    </span><span class="hs-comment">-- In our own MockChainT implementation, this error should never been</span><span>
</span><span id="line-175"></span><span>    </span><span class="hs-comment">-- thrown, because we collect the 'managedTxOuts' using (eventually)</span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-comment">-- 'lookupUtxos', which will already fail on un-resolvable 'TxOutRef's.</span><span>
</span><span id="line-177"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; TxOutRef -&gt; Map TxOutRef ScriptHash -&gt; TxGen ScriptHash
forall k a. Ord k =&gt; String -&gt; k -&gt; Map k a -&gt; TxGen a
</span><a href="Cooked.MockChain.GenerateTx.html#throwOnLookup"><span class="hs-identifier hs-var">throwOnLookup</span></a></span><span>
</span><span id="line-178"></span><span>      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;txSkelRedeemerToWitness: Can't resolve reference script outref. This might mean that you either never created or accidentally consumed the UTxO where the reference script is stored&quot;</span></span><span>
</span><span id="line-179"></span><span>      </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679702083"><span class="hs-identifier hs-var">validatorOref</span></a></span><span>
</span><span id="line-180"></span><span>      </span><span class="annot"><span class="annottext">(Map TxOutRef ScriptHash -&gt; TxGen ScriptHash)
-&gt; ReaderT
     Context (Either GenerateTxError) (Map TxOutRef ScriptHash)
-&gt; TxGen ScriptHash
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">(Context -&gt; Map TxOutRef ScriptHash)
-&gt; ReaderT
     Context (Either GenerateTxError) (Map TxOutRef ScriptHash)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TxOut -&gt; Maybe ScriptHash)
-&gt; Map TxOutRef TxOut -&gt; Map TxOutRef ScriptHash
forall a b k. (a -&gt; Maybe b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">Map.mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut
-&gt; Optic' A_Lens NoIx TxOut (Maybe ScriptHash) -&gt; Maybe ScriptHash
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx TxOut (Maybe ScriptHash)
Lens' TxOut (Maybe (ReferenceScriptType TxOut))
forall o.
IsAbstractOutput o =&gt;
Lens' o (Maybe (ReferenceScriptType o))
</span><a href="Cooked.Output.html#outputReferenceScriptL"><span class="hs-identifier hs-var">outputReferenceScriptL</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Map TxOutRef TxOut -&gt; Map TxOutRef ScriptHash)
-&gt; (Context -&gt; Map TxOutRef TxOut)
-&gt; Context
-&gt; Map TxOutRef ScriptHash
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; Map TxOutRef TxOut
</span><a href="Cooked.MockChain.GenerateTx.html#managedTxOuts"><span class="hs-identifier hs-var">managedTxOuts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>  </span><span class="annot"><span class="annottext">Bool
-&gt; ReaderT Context (Either GenerateTxError) ()
-&gt; ReaderT Context (Either GenerateTxError) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuiltinByteString
</span><a href="#local-6989586621679702089"><span class="hs-identifier hs-var">scriptHashAtOref</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinByteString -&gt; BuiltinByteString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">BuiltinByteString
</span><a href="#local-6989586621679702085"><span class="hs-identifier hs-var">validatorHash</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ReaderT Context (Either GenerateTxError) ()
 -&gt; ReaderT Context (Either GenerateTxError) ())
-&gt; ReaderT Context (Either GenerateTxError) ()
-&gt; ReaderT Context (Either GenerateTxError) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-182"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ReaderT Context (Either GenerateTxError) ()
forall a. String -&gt; TxGen a
</span><a href="Cooked.MockChain.GenerateTx.html#throwOnString"><span class="hs-identifier hs-var">throwOnString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;txSkelRedeemerToWitness: Wrong reference script hash. Are you using the correct TxOutRef on your TxSkelRedeemerForReferencedScript?&quot;</span></span><span>
</span><span id="line-183"></span><span>  </span><span id="local-6989586621679702095"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679702095"><span class="hs-identifier hs-var">validatorTxIn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-184"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Either ToCardanoError TxIn -&gt; TxGen TxIn
forall a. String -&gt; Either ToCardanoError a -&gt; TxGen a
</span><a href="Cooked.MockChain.GenerateTx.html#throwOnToCardanoError"><span class="hs-identifier hs-var">throwOnToCardanoError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;txSkelRedeemerToWitness: translating TxOutRef where the reference script sits&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Either ToCardanoError TxIn -&gt; TxGen TxIn)
-&gt; Either ToCardanoError TxIn -&gt; TxGen TxIn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; Either ToCardanoError TxIn
</span><span class="hs-identifier hs-var">Ledger.toCardanoTxIn</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679702083"><span class="hs-identifier hs-var">validatorOref</span></a></span><span>
</span><span id="line-185"></span><span>  </span><span id="local-6989586621679702096"><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621679702096"><span class="hs-identifier hs-var">scriptHash</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-186"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Either ToCardanoError ScriptHash -&gt; TxGen ScriptHash
forall a. String -&gt; Either ToCardanoError a -&gt; TxGen a
</span><a href="Cooked.MockChain.GenerateTx.html#throwOnToCardanoError"><span class="hs-identifier hs-var">throwOnToCardanoError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;txSkelRedeemerToWitness: could not convert script hash of referenced script&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Either ToCardanoError ScriptHash -&gt; TxGen ScriptHash)
-&gt; Either ToCardanoError ScriptHash -&gt; TxGen ScriptHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ScriptHash -&gt; Either ToCardanoError ScriptHash
</span><span class="hs-identifier hs-var">Ledger.toCardanoScriptHash</span></span><span> </span><span class="annot"><span class="annottext">(ScriptHash -&gt; Either ToCardanoError ScriptHash)
-&gt; ScriptHash -&gt; Either ToCardanoError ScriptHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BuiltinByteString -&gt; ScriptHash
</span><span class="hs-identifier hs-var">Api.ScriptHash</span></span><span> </span><span class="annot"><span class="annottext">BuiltinByteString
</span><a href="#local-6989586621679702085"><span class="hs-identifier hs-var">validatorHash</span></a></span><span>
</span><span id="line-187"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679702098"><span class="annot"><span class="annottext">scriptWitnessBuilder :: ScriptDatum WitCtxTxIn
-&gt; HashableScriptData
-&gt; ExecutionUnits
-&gt; ScriptWitness WitCtxTxIn ConwayEra
</span><a href="#local-6989586621679702098"><span class="hs-identifier hs-var hs-var">scriptWitnessBuilder</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621679702087"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-188"></span><span>        </span><span class="annot"><span class="annottext">Language
</span><span class="hs-identifier hs-var">Script.PlutusV1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ScriptLanguageInEra PlutusScriptV1 ConwayEra
-&gt; PlutusScriptVersion PlutusScriptV1
-&gt; PlutusScriptOrReferenceInput PlutusScriptV1
-&gt; ScriptDatum WitCtxTxIn
-&gt; HashableScriptData
-&gt; ExecutionUnits
-&gt; ScriptWitness WitCtxTxIn ConwayEra
forall lang era witctx.
ScriptLanguageInEra lang era
-&gt; PlutusScriptVersion lang
-&gt; PlutusScriptOrReferenceInput lang
-&gt; ScriptDatum witctx
-&gt; HashableScriptData
-&gt; ExecutionUnits
-&gt; ScriptWitness witctx era
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptWitness</span></span><span> </span><span class="annot"><span class="annottext">ScriptLanguageInEra PlutusScriptV1 ConwayEra
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptV1InConway</span></span><span> </span><span class="annot"><span class="annottext">PlutusScriptVersion PlutusScriptV1
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptV1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
-&gt; Maybe ScriptHash -&gt; PlutusScriptOrReferenceInput PlutusScriptV1
forall lang.
TxIn -&gt; Maybe ScriptHash -&gt; PlutusScriptOrReferenceInput lang
</span><span class="hs-identifier hs-var">Cardano.PReferenceScript</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679702095"><span class="hs-identifier hs-var">validatorTxIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptHash -&gt; Maybe ScriptHash
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621679702096"><span class="hs-identifier hs-var">scriptHash</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>        </span><span class="annot"><span class="annottext">Language
</span><span class="hs-identifier hs-var">Script.PlutusV2</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ScriptLanguageInEra PlutusScriptV2 ConwayEra
-&gt; PlutusScriptVersion PlutusScriptV2
-&gt; PlutusScriptOrReferenceInput PlutusScriptV2
-&gt; ScriptDatum WitCtxTxIn
-&gt; HashableScriptData
-&gt; ExecutionUnits
-&gt; ScriptWitness WitCtxTxIn ConwayEra
forall lang era witctx.
ScriptLanguageInEra lang era
-&gt; PlutusScriptVersion lang
-&gt; PlutusScriptOrReferenceInput lang
-&gt; ScriptDatum witctx
-&gt; HashableScriptData
-&gt; ExecutionUnits
-&gt; ScriptWitness witctx era
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptWitness</span></span><span> </span><span class="annot"><span class="annottext">ScriptLanguageInEra PlutusScriptV2 ConwayEra
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptV2InConway</span></span><span> </span><span class="annot"><span class="annottext">PlutusScriptVersion PlutusScriptV2
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptV2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
-&gt; Maybe ScriptHash -&gt; PlutusScriptOrReferenceInput PlutusScriptV2
forall lang.
TxIn -&gt; Maybe ScriptHash -&gt; PlutusScriptOrReferenceInput lang
</span><span class="hs-identifier hs-var">Cardano.PReferenceScript</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679702095"><span class="hs-identifier hs-var">validatorTxIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptHash -&gt; Maybe ScriptHash
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621679702096"><span class="hs-identifier hs-var">scriptHash</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>        </span><span class="annot"><span class="annottext">Language
</span><span class="hs-identifier hs-var">Script.PlutusV3</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ScriptLanguageInEra PlutusScriptV3 ConwayEra
-&gt; PlutusScriptVersion PlutusScriptV3
-&gt; PlutusScriptOrReferenceInput PlutusScriptV3
-&gt; ScriptDatum WitCtxTxIn
-&gt; HashableScriptData
-&gt; ExecutionUnits
-&gt; ScriptWitness WitCtxTxIn ConwayEra
forall lang era witctx.
ScriptLanguageInEra lang era
-&gt; PlutusScriptVersion lang
-&gt; PlutusScriptOrReferenceInput lang
-&gt; ScriptDatum witctx
-&gt; HashableScriptData
-&gt; ExecutionUnits
-&gt; ScriptWitness witctx era
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptWitness</span></span><span> </span><span class="annot"><span class="annottext">ScriptLanguageInEra PlutusScriptV3 ConwayEra
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptV3InConway</span></span><span> </span><span class="annot"><span class="annottext">PlutusScriptVersion PlutusScriptV3
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptV3</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
-&gt; Maybe ScriptHash -&gt; PlutusScriptOrReferenceInput PlutusScriptV3
forall lang.
TxIn -&gt; Maybe ScriptHash -&gt; PlutusScriptOrReferenceInput lang
</span><span class="hs-identifier hs-var">Cardano.PReferenceScript</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679702095"><span class="hs-identifier hs-var">validatorTxIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptHash -&gt; Maybe ScriptHash
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621679702096"><span class="hs-identifier hs-var">scriptHash</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>  </span><span class="annot"><span class="annottext">Witness WitCtxTxIn ConwayEra
-&gt; TxGen (Witness WitCtxTxIn ConwayEra)
forall a. a -&gt; ReaderT Context (Either GenerateTxError) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Witness WitCtxTxIn ConwayEra
 -&gt; TxGen (Witness WitCtxTxIn ConwayEra))
-&gt; Witness WitCtxTxIn ConwayEra
-&gt; TxGen (Witness WitCtxTxIn ConwayEra)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-192"></span><span>    </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
-&gt; ScriptWitness WitCtxTxIn ConwayEra
-&gt; Witness WitCtxTxIn ConwayEra
forall witctx era.
ScriptWitnessInCtx witctx
-&gt; ScriptWitness witctx era -&gt; Witness witctx era
</span><span class="hs-identifier hs-var">Cardano.ScriptWitness</span></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
</span><span class="hs-identifier hs-var">Cardano.ScriptWitnessForSpending</span></span><span> </span><span class="annot"><span class="annottext">(ScriptWitness WitCtxTxIn ConwayEra
 -&gt; Witness WitCtxTxIn ConwayEra)
-&gt; ScriptWitness WitCtxTxIn ConwayEra
-&gt; Witness WitCtxTxIn ConwayEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-193"></span><span>      </span><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
-&gt; HashableScriptData
-&gt; ExecutionUnits
-&gt; ScriptWitness WitCtxTxIn ConwayEra
</span><a href="#local-6989586621679702098"><span class="hs-identifier hs-var">scriptWitnessBuilder</span></a></span><span>
</span><span id="line-194"></span><span>        </span><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><a href="#local-6989586621679702088"><span class="hs-identifier hs-var">datum</span></a></span><span>
</span><span id="line-195"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuiltinData -&gt; HashableScriptData
</span><span class="hs-identifier hs-var">Ledger.toCardanoScriptData</span></span><span> </span><span class="annot"><span class="annottext">(BuiltinData -&gt; HashableScriptData)
-&gt; BuiltinData -&gt; HashableScriptData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">redeemer -&gt; BuiltinData
forall a. ToData a =&gt; a -&gt; BuiltinData
</span><span class="hs-identifier hs-var">Api.toBuiltinData</span></span><span> </span><span class="annot"><span class="annottext">redeemer
</span><a href="#local-6989586621679702084"><span class="hs-identifier hs-var">redeemer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>        </span><span class="annot"><span class="annottext">ExecutionUnits
</span><span class="hs-identifier hs-var">Ledger.zeroExecutionUnits</span></span><span> </span><span class="hs-comment">-- We can't guess that yet, no?</span><span>
</span><span id="line-197"></span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#txSkelRedeemerToWitness"><span class="hs-identifier hs-var">txSkelRedeemerToWitness</span></a></span><span> </span><span id="local-6989586621679702114"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679702114"><span class="hs-identifier hs-var">txOutRef</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Skeleton.html#TxSkelRedeemerForScript"><span class="hs-identifier hs-type">TxSkelRedeemerForScript</span></a></span><span> </span><span id="local-6989586621679702121"><span class="annot"><span class="annottext">redeemer
</span><a href="#local-6989586621679702121"><span class="hs-identifier hs-var">redeemer</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-198"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679702122"><span class="annot"><span class="annottext">ValidatorHash
</span><a href="#local-6989586621679702122"><span class="hs-identifier hs-var">_validatorHash</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script.Versioned</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Script.Validator</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Script.Script</span></span><span> </span><span id="local-6989586621679702125"><span class="annot"><span class="annottext">SerialisedScript
</span><a href="#local-6989586621679702125"><span class="hs-identifier hs-var">script</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679702126"><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621679702126"><span class="hs-identifier hs-var">version</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679702127"><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><a href="#local-6989586621679702127"><span class="hs-identifier hs-var">datum</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOutRef
-&gt; TxGen
     (ValidatorHash, Versioned Validator, ScriptDatum WitCtxTxIn)
</span><a href="Cooked.MockChain.GenerateTx.html#resolveScriptOutputOwnerAndDatum"><span class="hs-identifier hs-var">resolveScriptOutputOwnerAndDatum</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679702114"><span class="hs-identifier hs-var">txOutRef</span></a></span><span>
</span><span id="line-199"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679702128"><span class="annot"><span class="annottext">scriptWitnessBuilder :: ScriptDatum WitCtxTxIn
-&gt; HashableScriptData
-&gt; ExecutionUnits
-&gt; ScriptWitness WitCtxTxIn ConwayEra
</span><a href="#local-6989586621679702128"><span class="hs-identifier hs-var hs-var">scriptWitnessBuilder</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621679702126"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-200"></span><span>        </span><span class="annot"><span class="annottext">Language
</span><span class="hs-identifier hs-var">Script.PlutusV1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ScriptLanguageInEra PlutusScriptV1 ConwayEra
-&gt; PlutusScriptVersion PlutusScriptV1
-&gt; PlutusScriptOrReferenceInput PlutusScriptV1
-&gt; ScriptDatum WitCtxTxIn
-&gt; HashableScriptData
-&gt; ExecutionUnits
-&gt; ScriptWitness WitCtxTxIn ConwayEra
forall lang era witctx.
ScriptLanguageInEra lang era
-&gt; PlutusScriptVersion lang
-&gt; PlutusScriptOrReferenceInput lang
-&gt; ScriptDatum witctx
-&gt; HashableScriptData
-&gt; ExecutionUnits
-&gt; ScriptWitness witctx era
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptWitness</span></span><span> </span><span class="annot"><span class="annottext">ScriptLanguageInEra PlutusScriptV1 ConwayEra
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptV1InConway</span></span><span> </span><span class="annot"><span class="annottext">PlutusScriptVersion PlutusScriptV1
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptV1</span></span><span> </span><span class="annot"><span class="annottext">(PlutusScriptOrReferenceInput PlutusScriptV1
 -&gt; ScriptDatum WitCtxTxIn
 -&gt; HashableScriptData
 -&gt; ExecutionUnits
 -&gt; ScriptWitness WitCtxTxIn ConwayEra)
-&gt; PlutusScriptOrReferenceInput PlutusScriptV1
-&gt; ScriptDatum WitCtxTxIn
-&gt; HashableScriptData
-&gt; ExecutionUnits
-&gt; ScriptWitness WitCtxTxIn ConwayEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PlutusScript PlutusScriptV1
-&gt; PlutusScriptOrReferenceInput PlutusScriptV1
forall lang. PlutusScript lang -&gt; PlutusScriptOrReferenceInput lang
</span><span class="hs-identifier hs-var">Cardano.PScript</span></span><span> </span><span class="annot"><span class="annottext">(PlutusScript PlutusScriptV1
 -&gt; PlutusScriptOrReferenceInput PlutusScriptV1)
-&gt; PlutusScript PlutusScriptV1
-&gt; PlutusScriptOrReferenceInput PlutusScriptV1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript PlutusScriptV1
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptSerialised</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><a href="#local-6989586621679702125"><span class="hs-identifier hs-var">script</span></a></span><span>
</span><span id="line-201"></span><span>        </span><span class="annot"><span class="annottext">Language
</span><span class="hs-identifier hs-var">Script.PlutusV2</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ScriptLanguageInEra PlutusScriptV2 ConwayEra
-&gt; PlutusScriptVersion PlutusScriptV2
-&gt; PlutusScriptOrReferenceInput PlutusScriptV2
-&gt; ScriptDatum WitCtxTxIn
-&gt; HashableScriptData
-&gt; ExecutionUnits
-&gt; ScriptWitness WitCtxTxIn ConwayEra
forall lang era witctx.
ScriptLanguageInEra lang era
-&gt; PlutusScriptVersion lang
-&gt; PlutusScriptOrReferenceInput lang
-&gt; ScriptDatum witctx
-&gt; HashableScriptData
-&gt; ExecutionUnits
-&gt; ScriptWitness witctx era
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptWitness</span></span><span> </span><span class="annot"><span class="annottext">ScriptLanguageInEra PlutusScriptV2 ConwayEra
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptV2InConway</span></span><span> </span><span class="annot"><span class="annottext">PlutusScriptVersion PlutusScriptV2
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">(PlutusScriptOrReferenceInput PlutusScriptV2
 -&gt; ScriptDatum WitCtxTxIn
 -&gt; HashableScriptData
 -&gt; ExecutionUnits
 -&gt; ScriptWitness WitCtxTxIn ConwayEra)
-&gt; PlutusScriptOrReferenceInput PlutusScriptV2
-&gt; ScriptDatum WitCtxTxIn
-&gt; HashableScriptData
-&gt; ExecutionUnits
-&gt; ScriptWitness WitCtxTxIn ConwayEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PlutusScript PlutusScriptV2
-&gt; PlutusScriptOrReferenceInput PlutusScriptV2
forall lang. PlutusScript lang -&gt; PlutusScriptOrReferenceInput lang
</span><span class="hs-identifier hs-var">Cardano.PScript</span></span><span> </span><span class="annot"><span class="annottext">(PlutusScript PlutusScriptV2
 -&gt; PlutusScriptOrReferenceInput PlutusScriptV2)
-&gt; PlutusScript PlutusScriptV2
-&gt; PlutusScriptOrReferenceInput PlutusScriptV2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript PlutusScriptV2
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptSerialised</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><a href="#local-6989586621679702125"><span class="hs-identifier hs-var">script</span></a></span><span>
</span><span id="line-202"></span><span>        </span><span class="annot"><span class="annottext">Language
</span><span class="hs-identifier hs-var">Script.PlutusV3</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ScriptLanguageInEra PlutusScriptV3 ConwayEra
-&gt; PlutusScriptVersion PlutusScriptV3
-&gt; PlutusScriptOrReferenceInput PlutusScriptV3
-&gt; ScriptDatum WitCtxTxIn
-&gt; HashableScriptData
-&gt; ExecutionUnits
-&gt; ScriptWitness WitCtxTxIn ConwayEra
forall lang era witctx.
ScriptLanguageInEra lang era
-&gt; PlutusScriptVersion lang
-&gt; PlutusScriptOrReferenceInput lang
-&gt; ScriptDatum witctx
-&gt; HashableScriptData
-&gt; ExecutionUnits
-&gt; ScriptWitness witctx era
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptWitness</span></span><span> </span><span class="annot"><span class="annottext">ScriptLanguageInEra PlutusScriptV3 ConwayEra
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptV3InConway</span></span><span> </span><span class="annot"><span class="annottext">PlutusScriptVersion PlutusScriptV3
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptV3</span></span><span> </span><span class="annot"><span class="annottext">(PlutusScriptOrReferenceInput PlutusScriptV3
 -&gt; ScriptDatum WitCtxTxIn
 -&gt; HashableScriptData
 -&gt; ExecutionUnits
 -&gt; ScriptWitness WitCtxTxIn ConwayEra)
-&gt; PlutusScriptOrReferenceInput PlutusScriptV3
-&gt; ScriptDatum WitCtxTxIn
-&gt; HashableScriptData
-&gt; ExecutionUnits
-&gt; ScriptWitness WitCtxTxIn ConwayEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PlutusScript PlutusScriptV3
-&gt; PlutusScriptOrReferenceInput PlutusScriptV3
forall lang. PlutusScript lang -&gt; PlutusScriptOrReferenceInput lang
</span><span class="hs-identifier hs-var">Cardano.PScript</span></span><span> </span><span class="annot"><span class="annottext">(PlutusScript PlutusScriptV3
 -&gt; PlutusScriptOrReferenceInput PlutusScriptV3)
-&gt; PlutusScript PlutusScriptV3
-&gt; PlutusScriptOrReferenceInput PlutusScriptV3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript PlutusScriptV3
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptSerialised</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><a href="#local-6989586621679702125"><span class="hs-identifier hs-var">script</span></a></span><span>
</span><span id="line-203"></span><span>  </span><span class="annot"><span class="annottext">Witness WitCtxTxIn ConwayEra
-&gt; TxGen (Witness WitCtxTxIn ConwayEra)
forall a. a -&gt; ReaderT Context (Either GenerateTxError) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Witness WitCtxTxIn ConwayEra
 -&gt; TxGen (Witness WitCtxTxIn ConwayEra))
-&gt; Witness WitCtxTxIn ConwayEra
-&gt; TxGen (Witness WitCtxTxIn ConwayEra)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-204"></span><span>    </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
-&gt; ScriptWitness WitCtxTxIn ConwayEra
-&gt; Witness WitCtxTxIn ConwayEra
forall witctx era.
ScriptWitnessInCtx witctx
-&gt; ScriptWitness witctx era -&gt; Witness witctx era
</span><span class="hs-identifier hs-var">Cardano.ScriptWitness</span></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
</span><span class="hs-identifier hs-var">Cardano.ScriptWitnessForSpending</span></span><span> </span><span class="annot"><span class="annottext">(ScriptWitness WitCtxTxIn ConwayEra
 -&gt; Witness WitCtxTxIn ConwayEra)
-&gt; ScriptWitness WitCtxTxIn ConwayEra
-&gt; Witness WitCtxTxIn ConwayEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-205"></span><span>      </span><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
-&gt; HashableScriptData
-&gt; ExecutionUnits
-&gt; ScriptWitness WitCtxTxIn ConwayEra
</span><a href="#local-6989586621679702128"><span class="hs-identifier hs-var">scriptWitnessBuilder</span></a></span><span>
</span><span id="line-206"></span><span>        </span><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><a href="#local-6989586621679702127"><span class="hs-identifier hs-var">datum</span></a></span><span>
</span><span id="line-207"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuiltinData -&gt; HashableScriptData
</span><span class="hs-identifier hs-var">Ledger.toCardanoScriptData</span></span><span> </span><span class="annot"><span class="annottext">(BuiltinData -&gt; HashableScriptData)
-&gt; BuiltinData -&gt; HashableScriptData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">redeemer -&gt; BuiltinData
forall a. ToData a =&gt; a -&gt; BuiltinData
</span><span class="hs-identifier hs-var">Api.toBuiltinData</span></span><span> </span><span class="annot"><span class="annottext">redeemer
</span><a href="#local-6989586621679702121"><span class="hs-identifier hs-var">redeemer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>        </span><span class="annot"><span class="annottext">ExecutionUnits
</span><span class="hs-identifier hs-var">Ledger.zeroExecutionUnits</span></span><span> </span><span class="hs-comment">-- We can't guess that yet, no?</span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span class="hs-comment">-- Convert a list of 'Api.TxOutRef' into a 'Cardano.TxInsReference'</span><span>
</span><span id="line-211"></span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#txOutRefsToTxInsReference"><span class="hs-identifier hs-type">txOutRefsToTxInsReference</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Api.TxOutRef</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#TxGen"><span class="hs-identifier hs-type">TxGen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Cardano.TxInsReference</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.BuildTx</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.ConwayEra</span></span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span id="txOutRefsToTxInsReference"><span class="annot"><span class="annottext">txOutRefsToTxInsReference :: [TxOutRef] -&gt; TxGen (TxInsReference BuildTx ConwayEra)
</span><a href="Cooked.MockChain.GenerateTx.html#txOutRefsToTxInsReference"><span class="hs-identifier hs-var hs-var">txOutRefsToTxInsReference</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-213"></span><span>  </span><span class="annot"><span class="annottext">String
-&gt; ([TxIn] -&gt; TxInsReference BuildTx ConwayEra)
-&gt; Either ToCardanoError [TxIn]
-&gt; TxGen (TxInsReference BuildTx ConwayEra)
forall a b.
String -&gt; (a -&gt; b) -&gt; Either ToCardanoError a -&gt; TxGen b
</span><a href="Cooked.MockChain.GenerateTx.html#throwOnToCardanoErrorOrApply"><span class="hs-identifier hs-var">throwOnToCardanoErrorOrApply</span></a></span><span>
</span><span id="line-214"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;txOutRefsToTxInsReference&quot;</span></span><span>
</span><span id="line-215"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-216"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxInsReference BuildTx ConwayEra
forall build era. TxInsReference build era
</span><span class="hs-identifier hs-var">Cardano.TxInsReferenceNone</span></span><span>
</span><span id="line-217"></span><span>        </span><span id="local-6989586621679702132"><span class="annot"><span class="annottext">[TxIn]
</span><a href="#local-6989586621679702132"><span class="hs-identifier hs-var">txIns</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BabbageEraOnwards ConwayEra
-&gt; [TxIn] -&gt; TxInsReference BuildTx ConwayEra
forall era build.
BabbageEraOnwards era -&gt; [TxIn] -&gt; TxInsReference build era
</span><span class="hs-identifier hs-var">Cardano.TxInsReference</span></span><span> </span><span class="annot"><span class="annottext">BabbageEraOnwards ConwayEra
</span><span class="hs-identifier hs-var">Cardano.BabbageEraOnwardsConway</span></span><span> </span><span class="annot"><span class="annottext">[TxIn]
</span><a href="#local-6989586621679702132"><span class="hs-identifier hs-var">txIns</span></a></span><span>
</span><span id="line-218"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>    </span><span class="annot"><span class="annottext">(Either ToCardanoError [TxIn]
 -&gt; TxGen (TxInsReference BuildTx ConwayEra))
-&gt; ([TxOutRef] -&gt; Either ToCardanoError [TxIn])
-&gt; [TxOutRef]
-&gt; TxGen (TxInsReference BuildTx ConwayEra)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(TxOutRef -&gt; Either ToCardanoError TxIn)
-&gt; [TxOutRef] -&gt; Either ToCardanoError [TxIn]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; Either ToCardanoError TxIn
</span><span class="hs-identifier hs-var">Ledger.toCardanoTxIn</span></span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span class="hs-comment">-- | Computes the collateral triplet from the fees and the collateral inputs in</span><span>
</span><span id="line-222"></span><span class="hs-comment">-- the context. What we call a collateral triplet is composed of:</span><span>
</span><span id="line-223"></span><span class="hs-comment">-- * The set of collateral inputs</span><span>
</span><span id="line-224"></span><span class="hs-comment">-- * The total collateral paid by the transaction in case of phase 2 failure</span><span>
</span><span id="line-225"></span><span class="hs-comment">-- * An output returning excess collateral value when collaterals are used</span><span>
</span><span id="line-226"></span><span class="hs-comment">-- These quantity should satisfy the equation (in terms of their values):</span><span>
</span><span id="line-227"></span><span class="hs-comment">-- collateral inputs = total collateral + return collateral</span><span>
</span><span id="line-228"></span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#toCollateralTriplet"><span class="hs-identifier hs-type">toCollateralTriplet</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-229"></span><span>  </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#TxGen"><span class="hs-identifier hs-type">TxGen</span></a></span><span>
</span><span id="line-230"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.TxInsCollateral</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.ConwayEra</span></span><span class="hs-special">,</span><span>
</span><span id="line-231"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Cardano.TxTotalCollateral</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.ConwayEra</span></span><span class="hs-special">,</span><span>
</span><span id="line-232"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Cardano.TxReturnCollateral</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.CtxTx</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.ConwayEra</span></span><span>
</span><span id="line-233"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span id="toCollateralTriplet"><span class="annot"><span class="annottext">toCollateralTriplet :: TxGen
  (TxInsCollateral ConwayEra, TxTotalCollateral ConwayEra,
   TxReturnCollateral CtxTx ConwayEra)
</span><a href="Cooked.MockChain.GenerateTx.html#toCollateralTriplet"><span class="hs-identifier hs-var hs-var">toCollateralTriplet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-235"></span><span>  </span><span class="hs-comment">-- Retrieving know outputs</span><span>
</span><span id="line-236"></span><span>  </span><span id="local-6989586621679702135"><span class="annot"><span class="annottext">Map TxOutRef TxOut
</span><a href="#local-6989586621679702135"><span class="hs-identifier hs-var">knownTxOuts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Context -&gt; Map TxOutRef TxOut)
-&gt; ReaderT Context (Either GenerateTxError) (Map TxOutRef TxOut)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; Map TxOutRef TxOut
</span><a href="Cooked.MockChain.GenerateTx.html#managedTxOuts"><span class="hs-identifier hs-var">managedTxOuts</span></a></span><span>
</span><span id="line-237"></span><span>  </span><span class="hs-comment">-- Retrieving the outputs to be used as collateral inputs</span><span>
</span><span id="line-238"></span><span>  </span><span id="local-6989586621679702136"><span class="annot"><span class="annottext">[TxOutRef]
</span><a href="#local-6989586621679702136"><span class="hs-identifier hs-var">collateralInsList</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Context -&gt; [TxOutRef])
-&gt; ReaderT Context (Either GenerateTxError) [TxOutRef]
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set TxOutRef -&gt; [TxOutRef]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">(Set TxOutRef -&gt; [TxOutRef])
-&gt; (Context -&gt; Set TxOutRef) -&gt; Context -&gt; [TxOutRef]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; Set TxOutRef
</span><a href="Cooked.MockChain.GenerateTx.html#collateralIns"><span class="hs-identifier hs-var">collateralIns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-comment">-- We build the collateral inputs from this list</span><span>
</span><span id="line-240"></span><span>  </span><span id="local-6989586621679702137"><span class="annot"><span class="annottext">TxInsCollateral ConwayEra
</span><a href="#local-6989586621679702137"><span class="hs-identifier hs-var">txInsCollateral</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-241"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[TxOutRef]
</span><a href="#local-6989586621679702136"><span class="hs-identifier hs-var">collateralInsList</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-242"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxInsCollateral ConwayEra
-&gt; ReaderT
     Context (Either GenerateTxError) (TxInsCollateral ConwayEra)
forall a. a -&gt; ReaderT Context (Either GenerateTxError) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TxInsCollateral ConwayEra
forall era. TxInsCollateral era
</span><span class="hs-identifier hs-var">Cardano.TxInsCollateralNone</span></span><span>
</span><span id="line-243"></span><span>      </span><span id="local-6989586621679702139"><span class="annot"><span class="annottext">[TxOutRef]
</span><a href="#local-6989586621679702139"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
-&gt; Either ToCardanoError (TxInsCollateral ConwayEra)
-&gt; ReaderT
     Context (Either GenerateTxError) (TxInsCollateral ConwayEra)
forall a. String -&gt; Either ToCardanoError a -&gt; TxGen a
</span><a href="Cooked.MockChain.GenerateTx.html#throwOnToCardanoError"><span class="hs-identifier hs-var">throwOnToCardanoError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;txOutRefsToTxInCollateral&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AlonzoEraOnwards ConwayEra -&gt; [TxIn] -&gt; TxInsCollateral ConwayEra
forall era. AlonzoEraOnwards era -&gt; [TxIn] -&gt; TxInsCollateral era
</span><span class="hs-identifier hs-var">Cardano.TxInsCollateral</span></span><span> </span><span class="annot"><span class="annottext">AlonzoEraOnwards ConwayEra
</span><span class="hs-identifier hs-var">Cardano.AlonzoEraOnwardsConway</span></span><span> </span><span class="annot"><span class="annottext">([TxIn] -&gt; TxInsCollateral ConwayEra)
-&gt; Either ToCardanoError [TxIn]
-&gt; Either ToCardanoError (TxInsCollateral ConwayEra)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(TxOutRef -&gt; Either ToCardanoError TxIn)
-&gt; [TxOutRef] -&gt; Either ToCardanoError [TxIn]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; Either ToCardanoError TxIn
</span><span class="hs-identifier hs-var">Ledger.toCardanoTxIn</span></span><span> </span><span class="annot"><span class="annottext">[TxOutRef]
</span><a href="#local-6989586621679702139"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>  </span><span class="hs-comment">-- Retrieving the total value in collateral inputs. This fails if one of the</span><span>
</span><span id="line-245"></span><span>  </span><span class="hs-comment">-- collaterals has been been successfully resolved.</span><span>
</span><span id="line-246"></span><span>  </span><span id="local-6989586621679702142"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679702142"><span class="hs-identifier hs-var">collateralInsValue</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679702143"><span class="annot"><span class="annottext">collateralInsResolved :: [TxOut]
</span><a href="#local-6989586621679702143"><span class="hs-identifier hs-var hs-var">collateralInsResolved</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TxOutRef -&gt; Maybe TxOut) -&gt; [TxOutRef] -&gt; [TxOut]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef -&gt; Map TxOutRef TxOut -&gt; Maybe TxOut
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-operator hs-var">`Map.lookup`</span></span><span> </span><span class="annot"><span class="annottext">Map TxOutRef TxOut
</span><a href="#local-6989586621679702135"><span class="hs-identifier hs-var">knownTxOuts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TxOutRef]
</span><a href="#local-6989586621679702136"><span class="hs-identifier hs-var">collateralInsList</span></a></span><span>
</span><span id="line-248"></span><span>    </span><span class="annot"><span class="annottext">Bool
-&gt; ReaderT Context (Either GenerateTxError) ()
-&gt; ReaderT Context (Either GenerateTxError) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TxOut] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621679702143"><span class="hs-identifier hs-var">collateralInsResolved</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">[TxOutRef] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[TxOutRef]
</span><a href="#local-6989586621679702136"><span class="hs-identifier hs-var">collateralInsList</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ReaderT Context (Either GenerateTxError) ()
 -&gt; ReaderT Context (Either GenerateTxError) ())
-&gt; ReaderT Context (Either GenerateTxError) ()
-&gt; ReaderT Context (Either GenerateTxError) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ReaderT Context (Either GenerateTxError) ()
forall a. String -&gt; TxGen a
</span><a href="Cooked.MockChain.GenerateTx.html#throwOnString"><span class="hs-identifier hs-var">throwOnString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;toCollateralTriplet: unresolved txOutRefs&quot;</span></span><span>
</span><span id="line-249"></span><span>    </span><span class="annot"><span class="annottext">Value -&gt; ReaderT Context (Either GenerateTxError) Value
forall a. a -&gt; ReaderT Context (Either GenerateTxError) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; ReaderT Context (Either GenerateTxError) Value)
-&gt; Value -&gt; ReaderT Context (Either GenerateTxError) Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Value] -&gt; Value
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut -&gt; Value
</span><span class="hs-identifier hs-var">Api.txOutValue</span></span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; Value) -&gt; [TxOut] -&gt; [Value]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621679702143"><span class="hs-identifier hs-var">collateralInsResolved</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>  </span><span class="hs-comment">-- We retrieve the collateral percentage compared to fees. By default, we use</span><span>
</span><span id="line-251"></span><span>  </span><span class="hs-comment">-- 150% which is the current value in the parameters, although the default</span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-comment">-- value should never be used here, as the call is supposed to always succeed.</span><span>
</span><span id="line-253"></span><span>  </span><span id="local-6989586621679702146"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679702146"><span class="hs-identifier hs-var">collateralPercentage</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Context -&gt; Integer)
-&gt; ReaderT Context (Either GenerateTxError) Integer
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><span class="hs-identifier hs-var">toInteger</span></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Integer) -&gt; (Context -&gt; Natural) -&gt; Context -&gt; Integer
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Maybe Natural -&gt; Natural
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">150</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Natural -&gt; Natural)
-&gt; (Context -&gt; Maybe Natural) -&gt; Context -&gt; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters -&gt; Maybe Natural
</span><span class="hs-identifier hs-var">Cardano.protocolParamCollateralPercent</span></span><span> </span><span class="annot"><span class="annottext">(ProtocolParameters -&gt; Maybe Natural)
-&gt; (Context -&gt; ProtocolParameters) -&gt; Context -&gt; Maybe Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Params -&gt; ProtocolParameters
</span><span class="hs-identifier hs-var">Emulator.pProtocolParams</span></span><span> </span><span class="annot"><span class="annottext">(Params -&gt; ProtocolParameters)
-&gt; (Context -&gt; Params) -&gt; Context -&gt; ProtocolParameters
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; Params
</span><a href="Cooked.MockChain.GenerateTx.html#params"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>  </span><span class="hs-comment">-- The total collateral corresponds to the fees multiplied by the collateral</span><span>
</span><span id="line-255"></span><span>  </span><span class="hs-comment">-- percentage. We add 1 because the ledger apparently rounds up this value.</span><span>
</span><span id="line-256"></span><span>  </span><span id="local-6989586621679702150"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679702150"><span class="hs-identifier hs-var">coinTotalCollateral</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Context -&gt; Coin) -&gt; ReaderT Context (Either GenerateTxError) Coin
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><span class="hs-identifier hs-var">Emulator.Coin</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Coin) -&gt; (Context -&gt; Integer) -&gt; Context -&gt; Coin
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Integer) -&gt; (Context -&gt; Integer) -&gt; Context -&gt; Integer
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">100</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Integer) -&gt; (Context -&gt; Integer) -&gt; Context -&gt; Integer
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679702146"><span class="hs-identifier hs-var">collateralPercentage</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Integer) -&gt; (Context -&gt; Integer) -&gt; Context -&gt; Integer
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; Integer
</span><a href="Cooked.MockChain.GenerateTx.html#fee"><span class="hs-identifier hs-var">fee</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>  </span><span class="hs-comment">-- We create the total collateral based on the computed value</span><span>
</span><span id="line-258"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679702154"><span class="annot"><span class="annottext">txTotalCollateral :: TxTotalCollateral ConwayEra
</span><a href="#local-6989586621679702154"><span class="hs-identifier hs-var hs-var">txTotalCollateral</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BabbageEraOnwards ConwayEra -&gt; Coin -&gt; TxTotalCollateral ConwayEra
forall era. BabbageEraOnwards era -&gt; Coin -&gt; TxTotalCollateral era
</span><span class="hs-identifier hs-var">Cardano.TxTotalCollateral</span></span><span> </span><span class="annot"><span class="annottext">BabbageEraOnwards ConwayEra
</span><span class="hs-identifier hs-var">Cardano.BabbageEraOnwardsConway</span></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679702150"><span class="hs-identifier hs-var">coinTotalCollateral</span></a></span><span>
</span><span id="line-259"></span><span>  </span><span class="hs-comment">-- We compute a return collateral value by subtracting the total collateral to</span><span>
</span><span id="line-260"></span><span>  </span><span class="hs-comment">-- the value in collateral inputs</span><span>
</span><span id="line-261"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679702156"><span class="annot"><span class="annottext">returnCollateralValue :: Value
</span><a href="#local-6989586621679702156"><span class="hs-identifier hs-var hs-var">returnCollateralValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679702142"><span class="hs-identifier hs-var">collateralInsValue</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value
forall a. AdditiveGroup a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">PlutusTx.negate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin -&gt; Value
forall a. ToValue a =&gt; a -&gt; Value
</span><a href="Cooked.Conversion.ToValue.html#toValue"><span class="hs-identifier hs-var">toValue</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679702150"><span class="hs-identifier hs-var">coinTotalCollateral</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>  </span><span class="hs-comment">-- This should never happen, as we always compute the collaterals for the</span><span>
</span><span id="line-263"></span><span>  </span><span class="hs-comment">-- user, but we guard against having some negative elements in the value in</span><span>
</span><span id="line-264"></span><span>  </span><span class="hs-comment">-- case we give more freedom to the users in the future</span><span>
</span><span id="line-265"></span><span>  </span><span class="annot"><span class="annottext">Bool
-&gt; ReaderT Context (Either GenerateTxError) ()
-&gt; ReaderT Context (Either GenerateTxError) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Value, Value) -&gt; Value
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; (Value, Value)
</span><span class="hs-identifier hs-var">Api.split</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679702156"><span class="hs-identifier hs-var">returnCollateralValue</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Value
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ReaderT Context (Either GenerateTxError) ()
 -&gt; ReaderT Context (Either GenerateTxError) ())
-&gt; ReaderT Context (Either GenerateTxError) ()
-&gt; ReaderT Context (Either GenerateTxError) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ReaderT Context (Either GenerateTxError) ()
forall a. String -&gt; TxGen a
</span><a href="Cooked.MockChain.GenerateTx.html#throwOnString"><span class="hs-identifier hs-var">throwOnString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;toCollateralTriplet: negative parts in return collateral value&quot;</span></span><span>
</span><span id="line-266"></span><span>  </span><span class="hs-comment">-- The return collateral is then computed</span><span>
</span><span id="line-267"></span><span>  </span><span id="local-6989586621679702161"><span class="annot"><span class="annottext">TxReturnCollateral CtxTx ConwayEra
</span><a href="#local-6989586621679702161"><span class="hs-identifier hs-var">txReturnCollateral</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-268"></span><span>    </span><span class="hs-comment">-- If the total collateral equal what the inputs provide, we return `None`</span><span>
</span><span id="line-269"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679702156"><span class="hs-identifier hs-var">returnCollateralValue</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Value
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-270"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TxReturnCollateral CtxTx ConwayEra
-&gt; ReaderT
     Context
     (Either GenerateTxError)
     (TxReturnCollateral CtxTx ConwayEra)
forall a. a -&gt; ReaderT Context (Either GenerateTxError) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TxReturnCollateral CtxTx ConwayEra
forall ctx era. TxReturnCollateral ctx era
</span><span class="hs-identifier hs-var">Cardano.TxReturnCollateralNone</span></span><span>
</span><span id="line-271"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-comment">-- Otherwise, we compute the elements of a new output</span><span>
</span><span id="line-272"></span><span>      </span><span class="hs-keyword">do</span><span>
</span><span id="line-273"></span><span>        </span><span class="hs-comment">-- The value is a translation of the remaining value</span><span>
</span><span id="line-274"></span><span>        </span><span id="local-6989586621679702163"><span class="annot"><span class="annottext">TxOutValue ConwayEra
</span><a href="#local-6989586621679702163"><span class="hs-identifier hs-var">txReturnCollateralValue</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-275"></span><span>          </span><span class="annot"><span class="annottext">Value -&gt; TxOutValue ConwayEra
</span><span class="hs-identifier hs-var">Ledger.toCardanoTxOutValue</span></span><span>
</span><span id="line-276"></span><span>            </span><span class="annot"><span class="annottext">(Value -&gt; TxOutValue ConwayEra)
-&gt; ReaderT Context (Either GenerateTxError) Value
-&gt; ReaderT Context (Either GenerateTxError) (TxOutValue ConwayEra)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
-&gt; Either ToCardanoError Value
-&gt; ReaderT Context (Either GenerateTxError) Value
forall a. String -&gt; Either ToCardanoError a -&gt; TxGen a
</span><a href="Cooked.MockChain.GenerateTx.html#throwOnToCardanoError"><span class="hs-identifier hs-var">throwOnToCardanoError</span></a></span><span>
</span><span id="line-277"></span><span>              </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;toCollateralTriplet: cannot build return collateral value&quot;</span></span><span>
</span><span id="line-278"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Either ToCardanoError Value
</span><span class="hs-identifier hs-var">Ledger.toCardanoValue</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679702156"><span class="hs-identifier hs-var">returnCollateralValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>        </span><span class="hs-comment">-- The address is the one from the return collateral wallet, which is</span><span>
</span><span id="line-280"></span><span>        </span><span class="hs-comment">-- required to exist here.</span><span>
</span><span id="line-281"></span><span>        </span><span id="local-6989586621679702166"><span class="annot"><span class="annottext">AddressInEra ConwayEra
</span><a href="#local-6989586621679702166"><span class="hs-identifier hs-var">address</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-282"></span><span>          </span><span id="local-6989586621679702167"><span class="annot"><span class="annottext">Maybe Wallet
</span><a href="#local-6989586621679702167"><span class="hs-identifier hs-var">mReturnCollateralWallet</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Context -&gt; Maybe Wallet)
-&gt; ReaderT Context (Either GenerateTxError) (Maybe Wallet)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; Maybe Wallet
</span><a href="Cooked.MockChain.GenerateTx.html#returnCollateralWallet"><span class="hs-identifier hs-var">returnCollateralWallet</span></a></span><span>
</span><span id="line-283"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Wallet
</span><a href="#local-6989586621679702167"><span class="hs-identifier hs-var">mReturnCollateralWallet</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-284"></span><span>            </span><span class="annot"><span class="annottext">Maybe Wallet
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
-&gt; ReaderT
     Context (Either GenerateTxError) (AddressInEra ConwayEra)
forall a. String -&gt; TxGen a
</span><a href="Cooked.MockChain.GenerateTx.html#throwOnString"><span class="hs-identifier hs-var">throwOnString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;toCollateralTriplet: unable to find a return collateral wallet&quot;</span></span><span>
</span><span id="line-285"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679702168"><span class="annot"><span class="annottext">Wallet
</span><a href="#local-6989586621679702168"><span class="hs-identifier hs-var">returnCollateralWallet</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-286"></span><span>              </span><span id="local-6989586621679702169"><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621679702169"><span class="hs-identifier hs-var">networkId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Context -&gt; NetworkId)
-&gt; ReaderT Context (Either GenerateTxError) NetworkId
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Params -&gt; NetworkId
</span><span class="hs-identifier hs-var">Emulator.pNetworkId</span></span><span> </span><span class="annot"><span class="annottext">(Params -&gt; NetworkId)
-&gt; (Context -&gt; Params) -&gt; Context -&gt; NetworkId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; Params
</span><a href="Cooked.MockChain.GenerateTx.html#params"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>              </span><span class="annot"><span class="annottext">String
-&gt; Either ToCardanoError (AddressInEra ConwayEra)
-&gt; ReaderT
     Context (Either GenerateTxError) (AddressInEra ConwayEra)
forall a. String -&gt; Either ToCardanoError a -&gt; TxGen a
</span><a href="Cooked.MockChain.GenerateTx.html#throwOnToCardanoError"><span class="hs-identifier hs-var">throwOnToCardanoError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;toCollateralTriplet: cannot build return collateral address&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Either ToCardanoError (AddressInEra ConwayEra)
 -&gt; ReaderT
      Context (Either GenerateTxError) (AddressInEra ConwayEra))
-&gt; Either ToCardanoError (AddressInEra ConwayEra)
-&gt; ReaderT
     Context (Either GenerateTxError) (AddressInEra ConwayEra)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-288"></span><span>                </span><span class="annot"><span class="annottext">NetworkId
-&gt; Address -&gt; Either ToCardanoError (AddressInEra ConwayEra)
</span><span class="hs-identifier hs-var">Ledger.toCardanoAddressInEra</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621679702169"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Wallet -&gt; Address
</span><a href="Cooked.Wallet.html#walletAddress"><span class="hs-identifier hs-var">walletAddress</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet
</span><a href="#local-6989586621679702168"><span class="hs-identifier hs-var">returnCollateralWallet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>        </span><span class="hs-comment">-- The return collateral is built up from those elements</span><span>
</span><span id="line-290"></span><span>        </span><span class="annot"><span class="annottext">TxReturnCollateral CtxTx ConwayEra
-&gt; ReaderT
     Context
     (Either GenerateTxError)
     (TxReturnCollateral CtxTx ConwayEra)
forall a. a -&gt; ReaderT Context (Either GenerateTxError) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(TxReturnCollateral CtxTx ConwayEra
 -&gt; ReaderT
      Context
      (Either GenerateTxError)
      (TxReturnCollateral CtxTx ConwayEra))
-&gt; TxReturnCollateral CtxTx ConwayEra
-&gt; ReaderT
     Context
     (Either GenerateTxError)
     (TxReturnCollateral CtxTx ConwayEra)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-291"></span><span>          </span><span class="annot"><span class="annottext">BabbageEraOnwards ConwayEra
-&gt; TxOut CtxTx ConwayEra -&gt; TxReturnCollateral CtxTx ConwayEra
forall era ctx.
BabbageEraOnwards era
-&gt; TxOut ctx era -&gt; TxReturnCollateral ctx era
</span><span class="hs-identifier hs-var">Cardano.TxReturnCollateral</span></span><span> </span><span class="annot"><span class="annottext">BabbageEraOnwards ConwayEra
</span><span class="hs-identifier hs-var">Cardano.BabbageEraOnwardsConway</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxTx ConwayEra -&gt; TxReturnCollateral CtxTx ConwayEra)
-&gt; TxOut CtxTx ConwayEra -&gt; TxReturnCollateral CtxTx ConwayEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-292"></span><span>            </span><span class="annot"><span class="annottext">AddressInEra ConwayEra
-&gt; TxOutValue ConwayEra
-&gt; TxOutDatum CtxTx ConwayEra
-&gt; ReferenceScript ConwayEra
-&gt; TxOut CtxTx ConwayEra
forall ctx era.
AddressInEra era
-&gt; TxOutValue era
-&gt; TxOutDatum ctx era
-&gt; ReferenceScript era
-&gt; TxOut ctx era
</span><span class="hs-identifier hs-var">Cardano.TxOut</span></span><span> </span><span class="annot"><span class="annottext">AddressInEra ConwayEra
</span><a href="#local-6989586621679702166"><span class="hs-identifier hs-var">address</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutValue ConwayEra
</span><a href="#local-6989586621679702163"><span class="hs-identifier hs-var">txReturnCollateralValue</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxTx ConwayEra
forall ctx era. TxOutDatum ctx era
</span><span class="hs-identifier hs-var">Cardano.TxOutDatumNone</span></span><span> </span><span class="annot"><span class="annottext">ReferenceScript ConwayEra
forall era. ReferenceScript era
</span><span class="hs-identifier hs-var">Cardano.ReferenceScriptNone</span></span><span>
</span><span id="line-293"></span><span>  </span><span class="annot"><span class="annottext">(TxInsCollateral ConwayEra, TxTotalCollateral ConwayEra,
 TxReturnCollateral CtxTx ConwayEra)
-&gt; TxGen
     (TxInsCollateral ConwayEra, TxTotalCollateral ConwayEra,
      TxReturnCollateral CtxTx ConwayEra)
forall a. a -&gt; ReaderT Context (Either GenerateTxError) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxInsCollateral ConwayEra
</span><a href="#local-6989586621679702137"><span class="hs-identifier hs-var">txInsCollateral</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxTotalCollateral ConwayEra
</span><a href="#local-6989586621679702154"><span class="hs-identifier hs-var">txTotalCollateral</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxReturnCollateral CtxTx ConwayEra
</span><a href="#local-6989586621679702161"><span class="hs-identifier hs-var">txReturnCollateral</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span class="hs-comment">-- Convert the 'TxSkelMints' into a 'TxMintValue'</span><span>
</span><span id="line-296"></span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#txSkelMintsToTxMintValue"><span class="hs-identifier hs-type">txSkelMintsToTxMintValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cooked.Skeleton.html#TxSkelMints"><span class="hs-identifier hs-type">TxSkelMints</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#TxGen"><span class="hs-identifier hs-type">TxGen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Cardano.TxMintValue</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.BuildTx</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.ConwayEra</span></span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span id="txSkelMintsToTxMintValue"><span class="annot"><span class="annottext">txSkelMintsToTxMintValue :: TxSkelMints -&gt; TxGen (TxMintValue BuildTx ConwayEra)
</span><a href="Cooked.MockChain.GenerateTx.html#txSkelMintsToTxMintValue"><span class="hs-identifier hs-var hs-var">txSkelMintsToTxMintValue</span></a></span></span><span> </span><span id="local-6989586621679702177"><span class="annot"><span class="annottext">TxSkelMints
</span><a href="#local-6989586621679702177"><span class="hs-identifier hs-var">mints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-298"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TxSkelMints
</span><a href="#local-6989586621679702177"><span class="hs-identifier hs-var">mints</span></a></span><span> </span><span class="annot"><span class="annottext">TxSkelMints -&gt; TxSkelMints -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TxSkelMints
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span>
</span><span id="line-299"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TxMintValue BuildTx ConwayEra
-&gt; TxGen (TxMintValue BuildTx ConwayEra)
forall a. a -&gt; ReaderT Context (Either GenerateTxError) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TxMintValue BuildTx ConwayEra
forall build era. TxMintValue build era
</span><span class="hs-identifier hs-var">Cardano.TxMintNone</span></span><span>
</span><span id="line-300"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-301"></span><span>      </span><span id="local-6989586621679702179"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679702179"><span class="hs-identifier hs-var">mintVal</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-302"></span><span>        </span><span class="annot"><span class="annottext">String
-&gt; Either ToCardanoError Value
-&gt; ReaderT Context (Either GenerateTxError) Value
forall a. String -&gt; Either ToCardanoError a -&gt; TxGen a
</span><a href="Cooked.MockChain.GenerateTx.html#throwOnToCardanoError"><span class="hs-identifier hs-var">throwOnToCardanoError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;txSkelMintsToTxMintValue, translating minted value&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Either ToCardanoError Value
 -&gt; ReaderT Context (Either GenerateTxError) Value)
-&gt; Either ToCardanoError Value
-&gt; ReaderT Context (Either GenerateTxError) Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Either ToCardanoError Value
</span><span class="hs-identifier hs-var">Ledger.toCardanoValue</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Either ToCardanoError Value)
-&gt; Value -&gt; Either ToCardanoError Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TxSkelMints -&gt; Value
</span><a href="Cooked.Skeleton.html#txSkelMintsValue"><span class="hs-identifier hs-var">txSkelMintsValue</span></a></span><span> </span><span class="annot"><span class="annottext">TxSkelMints
</span><a href="#local-6989586621679702177"><span class="hs-identifier hs-var">mints</span></a></span><span>
</span><span id="line-303"></span><span>      </span><span id="local-6989586621679702181"><span class="annot"><span class="annottext">Map PolicyId (ScriptWitness WitCtxMint ConwayEra)
</span><a href="#local-6989586621679702181"><span class="hs-identifier hs-var">witnessMap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-304"></span><span>        </span><span class="annot"><span class="annottext">(Map PolicyId (ScriptWitness WitCtxMint ConwayEra)
 -&gt; (Versioned MintingPolicy, MintsRedeemer, TokenName, Integer)
 -&gt; ReaderT
      Context
      (Either GenerateTxError)
      (Map PolicyId (ScriptWitness WitCtxMint ConwayEra)))
-&gt; Map PolicyId (ScriptWitness WitCtxMint ConwayEra)
-&gt; [(Versioned MintingPolicy, MintsRedeemer, TokenName, Integer)]
-&gt; ReaderT
     Context
     (Either GenerateTxError)
     (Map PolicyId (ScriptWitness WitCtxMint ConwayEra))
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldM</span></span><span>
</span><span id="line-305"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679702183"><span class="annot"><span class="annottext">Map PolicyId (ScriptWitness WitCtxMint ConwayEra)
</span><a href="#local-6989586621679702183"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679702184"><span class="annot"><span class="annottext">Versioned MintingPolicy
</span><a href="#local-6989586621679702184"><span class="hs-identifier hs-var">policy</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679702185"><span class="annot"><span class="annottext">MintsRedeemer
</span><a href="#local-6989586621679702185"><span class="hs-identifier hs-var">redeemer</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679702186"><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621679702186"><span class="hs-identifier hs-var">_tName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679702187"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679702187"><span class="hs-identifier hs-var">_amount</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-306"></span><span>              </span><span id="local-6989586621679702188"><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621679702188"><span class="hs-identifier hs-var">policyId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-307"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; Either ToCardanoError PolicyId -&gt; TxGen PolicyId
forall a. String -&gt; Either ToCardanoError a -&gt; TxGen a
</span><a href="Cooked.MockChain.GenerateTx.html#throwOnToCardanoError"><span class="hs-identifier hs-var">throwOnToCardanoError</span></a></span><span>
</span><span id="line-308"></span><span>                  </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;txSkelMintsToTxMintValue, calculating the witness map&quot;</span></span><span>
</span><span id="line-309"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MintingPolicyHash -&gt; Either ToCardanoError PolicyId
</span><span class="hs-identifier hs-var">Ledger.toCardanoPolicyId</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Versioned MintingPolicy -&gt; MintingPolicyHash
</span><span class="hs-identifier hs-var">Script.mintingPolicyHash</span></span><span> </span><span class="annot"><span class="annottext">Versioned MintingPolicy
</span><a href="#local-6989586621679702184"><span class="hs-identifier hs-var">policy</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>              </span><span id="local-6989586621679702191"><span class="annot"><span class="annottext">ScriptWitness WitCtxMint ConwayEra
</span><a href="#local-6989586621679702191"><span class="hs-identifier hs-var">mintWitness</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Versioned MintingPolicy
-&gt; MintsRedeemer -&gt; TxGen (ScriptWitness WitCtxMint ConwayEra)
</span><a href="Cooked.MockChain.GenerateTx.html#mintingPolicyToMintWitness"><span class="hs-identifier hs-var">mintingPolicyToMintWitness</span></a></span><span> </span><span class="annot"><span class="annottext">Versioned MintingPolicy
</span><a href="#local-6989586621679702184"><span class="hs-identifier hs-var">policy</span></a></span><span> </span><span class="annot"><span class="annottext">MintsRedeemer
</span><a href="#local-6989586621679702185"><span class="hs-identifier hs-var">redeemer</span></a></span><span>
</span><span id="line-311"></span><span>              </span><span class="annot"><span class="annottext">Map PolicyId (ScriptWitness WitCtxMint ConwayEra)
-&gt; ReaderT
     Context
     (Either GenerateTxError)
     (Map PolicyId (ScriptWitness WitCtxMint ConwayEra))
forall a. a -&gt; ReaderT Context (Either GenerateTxError) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Map PolicyId (ScriptWitness WitCtxMint ConwayEra)
 -&gt; ReaderT
      Context
      (Either GenerateTxError)
      (Map PolicyId (ScriptWitness WitCtxMint ConwayEra)))
-&gt; Map PolicyId (ScriptWitness WitCtxMint ConwayEra)
-&gt; ReaderT
     Context
     (Either GenerateTxError)
     (Map PolicyId (ScriptWitness WitCtxMint ConwayEra))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
-&gt; ScriptWitness WitCtxMint ConwayEra
-&gt; Map PolicyId (ScriptWitness WitCtxMint ConwayEra)
-&gt; Map PolicyId (ScriptWitness WitCtxMint ConwayEra)
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621679702188"><span class="hs-identifier hs-var">policyId</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptWitness WitCtxMint ConwayEra
</span><a href="#local-6989586621679702191"><span class="hs-identifier hs-var">mintWitness</span></a></span><span> </span><span class="annot"><span class="annottext">Map PolicyId (ScriptWitness WitCtxMint ConwayEra)
</span><a href="#local-6989586621679702183"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-312"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>          </span><span class="annot"><span class="annottext">Map PolicyId (ScriptWitness WitCtxMint ConwayEra)
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span>
</span><span id="line-314"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxSkelMints
-&gt; [(Versioned MintingPolicy, MintsRedeemer, TokenName, Integer)]
</span><a href="Cooked.Skeleton.html#txSkelMintsToList"><span class="hs-identifier hs-var">txSkelMintsToList</span></a></span><span> </span><span class="annot"><span class="annottext">TxSkelMints
</span><a href="#local-6989586621679702177"><span class="hs-identifier hs-var">mints</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span>      </span><span class="annot"><span class="annottext">TxMintValue BuildTx ConwayEra
-&gt; TxGen (TxMintValue BuildTx ConwayEra)
forall a. a -&gt; ReaderT Context (Either GenerateTxError) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(TxMintValue BuildTx ConwayEra
 -&gt; TxGen (TxMintValue BuildTx ConwayEra))
-&gt; TxMintValue BuildTx ConwayEra
-&gt; TxGen (TxMintValue BuildTx ConwayEra)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MaryEraOnwards ConwayEra
-&gt; Value
-&gt; BuildTxWith
     BuildTx (Map PolicyId (ScriptWitness WitCtxMint ConwayEra))
-&gt; TxMintValue BuildTx ConwayEra
forall era build.
MaryEraOnwards era
-&gt; Value
-&gt; BuildTxWith build (Map PolicyId (ScriptWitness WitCtxMint era))
-&gt; TxMintValue build era
</span><span class="hs-identifier hs-var">Cardano.TxMintValue</span></span><span> </span><span class="annot"><span class="annottext">MaryEraOnwards ConwayEra
</span><span class="hs-identifier hs-var">Cardano.MaryEraOnwardsConway</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679702179"><span class="hs-identifier hs-var">mintVal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map PolicyId (ScriptWitness WitCtxMint ConwayEra)
-&gt; BuildTxWith
     BuildTx (Map PolicyId (ScriptWitness WitCtxMint ConwayEra))
forall a. a -&gt; BuildTxWith BuildTx a
</span><span class="hs-identifier hs-var">Cardano.BuildTxWith</span></span><span> </span><span class="annot"><span class="annottext">Map PolicyId (ScriptWitness WitCtxMint ConwayEra)
</span><a href="#local-6989586621679702181"><span class="hs-identifier hs-var">witnessMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>
</span><span id="line-317"></span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#mintingPolicyToMintWitness"><span class="hs-identifier hs-type">mintingPolicyToMintWitness</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script.Versioned</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script.MintingPolicy</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cooked.Skeleton.html#MintsRedeemer"><span class="hs-identifier hs-type">MintsRedeemer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#TxGen"><span class="hs-identifier hs-type">TxGen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Cardano.ScriptWitness</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.WitCtxMint</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.ConwayEra</span></span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span id="mintingPolicyToMintWitness"><span class="annot"><span class="annottext">mintingPolicyToMintWitness :: Versioned MintingPolicy
-&gt; MintsRedeemer -&gt; TxGen (ScriptWitness WitCtxMint ConwayEra)
</span><a href="Cooked.MockChain.GenerateTx.html#mintingPolicyToMintWitness"><span class="hs-identifier hs-var hs-var">mintingPolicyToMintWitness</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Script.Versioned</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Script.MintingPolicy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Script.Script</span></span><span> </span><span id="local-6989586621679702198"><span class="annot"><span class="annottext">SerialisedScript
</span><a href="#local-6989586621679702198"><span class="hs-identifier hs-var">script</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679702199"><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621679702199"><span class="hs-identifier hs-var">version</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679702200"><span class="annot"><span class="annottext">MintsRedeemer
</span><a href="#local-6989586621679702200"><span class="hs-identifier hs-var">redeemer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-319"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679702201"><span class="annot"><span class="annottext">scriptWitnessBuilder :: ScriptDatum WitCtxMint
-&gt; HashableScriptData
-&gt; ExecutionUnits
-&gt; ScriptWitness WitCtxMint ConwayEra
</span><a href="#local-6989586621679702201"><span class="hs-identifier hs-var hs-var">scriptWitnessBuilder</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621679702199"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-320"></span><span>        </span><span class="annot"><span class="annottext">Language
</span><span class="hs-identifier hs-var">Script.PlutusV1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ScriptLanguageInEra PlutusScriptV1 ConwayEra
-&gt; PlutusScriptVersion PlutusScriptV1
-&gt; PlutusScriptOrReferenceInput PlutusScriptV1
-&gt; ScriptDatum WitCtxMint
-&gt; HashableScriptData
-&gt; ExecutionUnits
-&gt; ScriptWitness WitCtxMint ConwayEra
forall lang era witctx.
ScriptLanguageInEra lang era
-&gt; PlutusScriptVersion lang
-&gt; PlutusScriptOrReferenceInput lang
-&gt; ScriptDatum witctx
-&gt; HashableScriptData
-&gt; ExecutionUnits
-&gt; ScriptWitness witctx era
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptWitness</span></span><span> </span><span class="annot"><span class="annottext">ScriptLanguageInEra PlutusScriptV1 ConwayEra
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptV1InConway</span></span><span> </span><span class="annot"><span class="annottext">PlutusScriptVersion PlutusScriptV1
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptV1</span></span><span> </span><span class="annot"><span class="annottext">(PlutusScriptOrReferenceInput PlutusScriptV1
 -&gt; ScriptDatum WitCtxMint
 -&gt; HashableScriptData
 -&gt; ExecutionUnits
 -&gt; ScriptWitness WitCtxMint ConwayEra)
-&gt; PlutusScriptOrReferenceInput PlutusScriptV1
-&gt; ScriptDatum WitCtxMint
-&gt; HashableScriptData
-&gt; ExecutionUnits
-&gt; ScriptWitness WitCtxMint ConwayEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PlutusScript PlutusScriptV1
-&gt; PlutusScriptOrReferenceInput PlutusScriptV1
forall lang. PlutusScript lang -&gt; PlutusScriptOrReferenceInput lang
</span><span class="hs-identifier hs-var">Cardano.PScript</span></span><span> </span><span class="annot"><span class="annottext">(PlutusScript PlutusScriptV1
 -&gt; PlutusScriptOrReferenceInput PlutusScriptV1)
-&gt; PlutusScript PlutusScriptV1
-&gt; PlutusScriptOrReferenceInput PlutusScriptV1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript PlutusScriptV1
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptSerialised</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><a href="#local-6989586621679702198"><span class="hs-identifier hs-var">script</span></a></span><span>
</span><span id="line-321"></span><span>        </span><span class="annot"><span class="annottext">Language
</span><span class="hs-identifier hs-var">Script.PlutusV2</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ScriptLanguageInEra PlutusScriptV2 ConwayEra
-&gt; PlutusScriptVersion PlutusScriptV2
-&gt; PlutusScriptOrReferenceInput PlutusScriptV2
-&gt; ScriptDatum WitCtxMint
-&gt; HashableScriptData
-&gt; ExecutionUnits
-&gt; ScriptWitness WitCtxMint ConwayEra
forall lang era witctx.
ScriptLanguageInEra lang era
-&gt; PlutusScriptVersion lang
-&gt; PlutusScriptOrReferenceInput lang
-&gt; ScriptDatum witctx
-&gt; HashableScriptData
-&gt; ExecutionUnits
-&gt; ScriptWitness witctx era
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptWitness</span></span><span> </span><span class="annot"><span class="annottext">ScriptLanguageInEra PlutusScriptV2 ConwayEra
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptV2InConway</span></span><span> </span><span class="annot"><span class="annottext">PlutusScriptVersion PlutusScriptV2
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">(PlutusScriptOrReferenceInput PlutusScriptV2
 -&gt; ScriptDatum WitCtxMint
 -&gt; HashableScriptData
 -&gt; ExecutionUnits
 -&gt; ScriptWitness WitCtxMint ConwayEra)
-&gt; PlutusScriptOrReferenceInput PlutusScriptV2
-&gt; ScriptDatum WitCtxMint
-&gt; HashableScriptData
-&gt; ExecutionUnits
-&gt; ScriptWitness WitCtxMint ConwayEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PlutusScript PlutusScriptV2
-&gt; PlutusScriptOrReferenceInput PlutusScriptV2
forall lang. PlutusScript lang -&gt; PlutusScriptOrReferenceInput lang
</span><span class="hs-identifier hs-var">Cardano.PScript</span></span><span> </span><span class="annot"><span class="annottext">(PlutusScript PlutusScriptV2
 -&gt; PlutusScriptOrReferenceInput PlutusScriptV2)
-&gt; PlutusScript PlutusScriptV2
-&gt; PlutusScriptOrReferenceInput PlutusScriptV2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript PlutusScriptV2
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptSerialised</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><a href="#local-6989586621679702198"><span class="hs-identifier hs-var">script</span></a></span><span>
</span><span id="line-322"></span><span>        </span><span class="annot"><span class="annottext">Language
</span><span class="hs-identifier hs-var">Script.PlutusV3</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ScriptLanguageInEra PlutusScriptV3 ConwayEra
-&gt; PlutusScriptVersion PlutusScriptV3
-&gt; PlutusScriptOrReferenceInput PlutusScriptV3
-&gt; ScriptDatum WitCtxMint
-&gt; HashableScriptData
-&gt; ExecutionUnits
-&gt; ScriptWitness WitCtxMint ConwayEra
forall lang era witctx.
ScriptLanguageInEra lang era
-&gt; PlutusScriptVersion lang
-&gt; PlutusScriptOrReferenceInput lang
-&gt; ScriptDatum witctx
-&gt; HashableScriptData
-&gt; ExecutionUnits
-&gt; ScriptWitness witctx era
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptWitness</span></span><span> </span><span class="annot"><span class="annottext">ScriptLanguageInEra PlutusScriptV3 ConwayEra
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptV3InConway</span></span><span> </span><span class="annot"><span class="annottext">PlutusScriptVersion PlutusScriptV3
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptV3</span></span><span> </span><span class="annot"><span class="annottext">(PlutusScriptOrReferenceInput PlutusScriptV3
 -&gt; ScriptDatum WitCtxMint
 -&gt; HashableScriptData
 -&gt; ExecutionUnits
 -&gt; ScriptWitness WitCtxMint ConwayEra)
-&gt; PlutusScriptOrReferenceInput PlutusScriptV3
-&gt; ScriptDatum WitCtxMint
-&gt; HashableScriptData
-&gt; ExecutionUnits
-&gt; ScriptWitness WitCtxMint ConwayEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PlutusScript PlutusScriptV3
-&gt; PlutusScriptOrReferenceInput PlutusScriptV3
forall lang. PlutusScript lang -&gt; PlutusScriptOrReferenceInput lang
</span><span class="hs-identifier hs-var">Cardano.PScript</span></span><span> </span><span class="annot"><span class="annottext">(PlutusScript PlutusScriptV3
 -&gt; PlutusScriptOrReferenceInput PlutusScriptV3)
-&gt; PlutusScript PlutusScriptV3
-&gt; PlutusScriptOrReferenceInput PlutusScriptV3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript PlutusScriptV3
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptSerialised</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><a href="#local-6989586621679702198"><span class="hs-identifier hs-var">script</span></a></span><span>
</span><span id="line-323"></span><span>  </span><span class="annot"><span class="annottext">ScriptWitness WitCtxMint ConwayEra
-&gt; TxGen (ScriptWitness WitCtxMint ConwayEra)
forall a. a -&gt; ReaderT Context (Either GenerateTxError) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ScriptWitness WitCtxMint ConwayEra
 -&gt; TxGen (ScriptWitness WitCtxMint ConwayEra))
-&gt; ScriptWitness WitCtxMint ConwayEra
-&gt; TxGen (ScriptWitness WitCtxMint ConwayEra)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-324"></span><span>    </span><span class="annot"><span class="annottext">ScriptDatum WitCtxMint
-&gt; HashableScriptData
-&gt; ExecutionUnits
-&gt; ScriptWitness WitCtxMint ConwayEra
</span><a href="#local-6989586621679702201"><span class="hs-identifier hs-var">scriptWitnessBuilder</span></a></span><span>
</span><span id="line-325"></span><span>      </span><span class="annot"><span class="annottext">ScriptDatum WitCtxMint
</span><span class="hs-identifier hs-var">Cardano.NoScriptDatumForMint</span></span><span> </span><span class="hs-comment">-- This seems to be the only well-typed option (?)</span><span>
</span><span id="line-326"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MintsRedeemer
</span><a href="#local-6989586621679702200"><span class="hs-identifier hs-var">redeemer</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-327"></span><span>          </span><span class="annot"><span class="annottext">MintsRedeemer
</span><a href="Cooked.Skeleton.html#NoMintsRedeemer"><span class="hs-identifier hs-var">NoMintsRedeemer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BuiltinData -&gt; HashableScriptData
</span><span class="hs-identifier hs-var">Ledger.toCardanoScriptData</span></span><span> </span><span class="annot"><span class="annottext">(BuiltinData -&gt; HashableScriptData)
-&gt; BuiltinData -&gt; HashableScriptData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; BuiltinData
forall a. ToData a =&gt; a -&gt; BuiltinData
</span><span class="hs-identifier hs-var">Api.toBuiltinData</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>          </span><span class="annot"><a href="Cooked.Skeleton.html#SomeMintsRedeemer"><span class="hs-identifier hs-type">SomeMintsRedeemer</span></a></span><span> </span><span id="local-6989586621679702208"><span class="annot"><span class="annottext">redeemer
</span><a href="#local-6989586621679702208"><span class="hs-identifier hs-var">red</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BuiltinData -&gt; HashableScriptData
</span><span class="hs-identifier hs-var">Ledger.toCardanoScriptData</span></span><span> </span><span class="annot"><span class="annottext">(BuiltinData -&gt; HashableScriptData)
-&gt; BuiltinData -&gt; HashableScriptData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">redeemer -&gt; BuiltinData
forall a. ToData a =&gt; a -&gt; BuiltinData
</span><span class="hs-identifier hs-var">Api.toBuiltinData</span></span><span> </span><span class="annot"><span class="annottext">redeemer
</span><a href="#local-6989586621679702208"><span class="hs-identifier hs-var">red</span></a></span><span>
</span><span id="line-329"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>      </span><span class="annot"><span class="annottext">ExecutionUnits
</span><span class="hs-identifier hs-var">Ledger.zeroExecutionUnits</span></span><span> </span><span class="hs-comment">-- This is what plutus-apps does as well, we can't know this yet, no?</span><span>
</span><span id="line-331"></span><span>
</span><span id="line-332"></span><span class="hs-comment">-- Convert a 'TxSkelOut' to the corresponding 'Cardano.TxOut'.</span><span>
</span><span id="line-333"></span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#txSkelOutToCardanoTxOut"><span class="hs-identifier hs-type">txSkelOutToCardanoTxOut</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cooked.Skeleton.html#TxSkelOut"><span class="hs-identifier hs-type">TxSkelOut</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#TxGen"><span class="hs-identifier hs-type">TxGen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Cardano.TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.CtxTx</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.ConwayEra</span></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span id="txSkelOutToCardanoTxOut"><span class="annot"><span class="annottext">txSkelOutToCardanoTxOut :: TxSkelOut
-&gt; ReaderT Context (Either GenerateTxError) (TxOut CtxTx ConwayEra)
</span><a href="Cooked.MockChain.GenerateTx.html#txSkelOutToCardanoTxOut"><span class="hs-identifier hs-var hs-var">txSkelOutToCardanoTxOut</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Skeleton.html#Pays"><span class="hs-identifier hs-type">Pays</span></a></span><span> </span><span id="local-6989586621679702247"><span class="annot"><span class="annottext">o
</span><a href="#local-6989586621679702247"><span class="hs-identifier hs-var">output</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-335"></span><span>  </span><span id="local-6989586621679702248"><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621679702248"><span class="hs-identifier hs-var">networkId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Context -&gt; NetworkId)
-&gt; ReaderT Context (Either GenerateTxError) NetworkId
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">((Context -&gt; NetworkId)
 -&gt; ReaderT Context (Either GenerateTxError) NetworkId)
-&gt; (Context -&gt; NetworkId)
-&gt; ReaderT Context (Either GenerateTxError) NetworkId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Params -&gt; NetworkId
</span><span class="hs-identifier hs-var">Emulator.pNetworkId</span></span><span> </span><span class="annot"><span class="annottext">(Params -&gt; NetworkId)
-&gt; (Context -&gt; Params) -&gt; Context -&gt; NetworkId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; Params
</span><a href="Cooked.MockChain.GenerateTx.html#params"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-336"></span><span>  </span><span id="local-6989586621679702249"><span class="annot"><span class="annottext">AddressInEra ConwayEra
</span><a href="#local-6989586621679702249"><span class="hs-identifier hs-var">address</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String
-&gt; Either ToCardanoError (AddressInEra ConwayEra)
-&gt; ReaderT
     Context (Either GenerateTxError) (AddressInEra ConwayEra)
forall a. String -&gt; Either ToCardanoError a -&gt; TxGen a
</span><a href="Cooked.MockChain.GenerateTx.html#throwOnToCardanoError"><span class="hs-identifier hs-var">throwOnToCardanoError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;txSkelOutToCardanoTxOut: wrong address&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Either ToCardanoError (AddressInEra ConwayEra)
 -&gt; ReaderT
      Context (Either GenerateTxError) (AddressInEra ConwayEra))
-&gt; Either ToCardanoError (AddressInEra ConwayEra)
-&gt; ReaderT
     Context (Either GenerateTxError) (AddressInEra ConwayEra)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
-&gt; Address -&gt; Either ToCardanoError (AddressInEra ConwayEra)
</span><span class="hs-identifier hs-var">Ledger.toCardanoAddressInEra</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621679702248"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">o -&gt; Address
forall o.
(IsAbstractOutput o, ToCredential (OwnerType o)) =&gt;
o -&gt; Address
</span><a href="Cooked.Output.html#outputAddress"><span class="hs-identifier hs-var">outputAddress</span></a></span><span> </span><span class="annot"><span class="annottext">o
</span><a href="#local-6989586621679702247"><span class="hs-identifier hs-var">output</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>  </span><span id="local-6989586621679702250"><span class="annot"><span class="annottext">TxOutValue ConwayEra
</span><a href="#local-6989586621679702250"><span class="hs-identifier hs-var">value</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Value -&gt; TxOutValue ConwayEra
</span><span class="hs-identifier hs-var">Ledger.toCardanoTxOutValue</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; TxOutValue ConwayEra)
-&gt; ReaderT Context (Either GenerateTxError) Value
-&gt; ReaderT Context (Either GenerateTxError) (TxOutValue ConwayEra)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
-&gt; Either ToCardanoError Value
-&gt; ReaderT Context (Either GenerateTxError) Value
forall a. String -&gt; Either ToCardanoError a -&gt; TxGen a
</span><a href="Cooked.MockChain.GenerateTx.html#throwOnToCardanoError"><span class="hs-identifier hs-var">throwOnToCardanoError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;txSkelOutToCardanoTxOut: cannot build value&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Either ToCardanoError Value
</span><span class="hs-identifier hs-var">Ledger.toCardanoValue</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Either ToCardanoError Value)
-&gt; Value -&gt; Either ToCardanoError Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">o -&gt; Value
forall o. (IsAbstractOutput o, ToValue (ValueType o)) =&gt; o -&gt; Value
</span><a href="Cooked.Output.html#outputValue"><span class="hs-identifier hs-var">outputValue</span></a></span><span> </span><span class="annot"><span class="annottext">o
</span><a href="#local-6989586621679702247"><span class="hs-identifier hs-var">output</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>  </span><span id="local-6989586621679702252"><span class="annot"><span class="annottext">TxOutDatum CtxTx ConwayEra
</span><a href="#local-6989586621679702252"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">o
</span><a href="#local-6989586621679702247"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="annot"><span class="annottext">o -&gt; Optic' A_Lens NoIx o TxSkelOutDatum -&gt; TxSkelOutDatum
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Lens' o (DatumType o)
Optic' A_Lens NoIx o TxSkelOutDatum
forall o. IsAbstractOutput o =&gt; Lens' o (DatumType o)
</span><a href="Cooked.Output.html#outputDatumL"><span class="hs-identifier hs-var">outputDatumL</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-339"></span><span>    </span><span class="annot"><span class="annottext">TxSkelOutDatum
</span><a href="Cooked.Skeleton.html#TxSkelOutNoDatum"><span class="hs-identifier hs-var">TxSkelOutNoDatum</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxTx ConwayEra
-&gt; ReaderT
     Context (Either GenerateTxError) (TxOutDatum CtxTx ConwayEra)
forall a. a -&gt; ReaderT Context (Either GenerateTxError) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxTx ConwayEra
forall ctx era. TxOutDatum ctx era
</span><span class="hs-identifier hs-var">Cardano.TxOutDatumNone</span></span><span>
</span><span id="line-340"></span><span>    </span><span class="annot"><a href="Cooked.Skeleton.html#TxSkelOutDatumHash"><span class="hs-identifier hs-type">TxSkelOutDatumHash</span></a></span><span> </span><span id="local-6989586621679702260"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679702260"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-341"></span><span>      </span><span class="annot"><span class="annottext">String
-&gt; Either ToCardanoError (TxOutDatum CtxTx ConwayEra)
-&gt; ReaderT
     Context (Either GenerateTxError) (TxOutDatum CtxTx ConwayEra)
forall a. String -&gt; Either ToCardanoError a -&gt; TxGen a
</span><a href="Cooked.MockChain.GenerateTx.html#throwOnToCardanoError"><span class="hs-identifier hs-var">throwOnToCardanoError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;txSkelOutToTxOut: unresolved datum hash&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Either ToCardanoError (TxOutDatum CtxTx ConwayEra)
 -&gt; ReaderT
      Context (Either GenerateTxError) (TxOutDatum CtxTx ConwayEra))
-&gt; Either ToCardanoError (TxOutDatum CtxTx ConwayEra)
-&gt; ReaderT
     Context (Either GenerateTxError) (TxOutDatum CtxTx ConwayEra)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-342"></span><span>        </span><span class="annot"><span class="annottext">AlonzoEraOnwards ConwayEra
-&gt; Hash ScriptData -&gt; TxOutDatum CtxTx ConwayEra
forall era ctx.
AlonzoEraOnwards era -&gt; Hash ScriptData -&gt; TxOutDatum ctx era
</span><span class="hs-identifier hs-var">Cardano.TxOutDatumHash</span></span><span> </span><span class="annot"><span class="annottext">AlonzoEraOnwards ConwayEra
</span><span class="hs-identifier hs-var">Cardano.AlonzoEraOnwardsConway</span></span><span>
</span><span id="line-343"></span><span>          </span><span class="annot"><span class="annottext">(Hash ScriptData -&gt; TxOutDatum CtxTx ConwayEra)
-&gt; Either ToCardanoError (Hash ScriptData)
-&gt; Either ToCardanoError (TxOutDatum CtxTx ConwayEra)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">DatumHash -&gt; Either ToCardanoError (Hash ScriptData)
</span><span class="hs-identifier hs-var">Ledger.toCardanoScriptDataHash</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Datum -&gt; DatumHash
</span><span class="hs-identifier hs-var">Script.datumHash</span></span><span> </span><span class="annot"><span class="annottext">(Datum -&gt; DatumHash) -&gt; Datum -&gt; DatumHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BuiltinData -&gt; Datum
</span><span class="hs-identifier hs-var">Api.Datum</span></span><span> </span><span class="annot"><span class="annottext">(BuiltinData -&gt; Datum) -&gt; BuiltinData -&gt; Datum
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; BuiltinData
forall a. ToData a =&gt; a -&gt; BuiltinData
</span><span class="hs-identifier hs-var">Api.toBuiltinData</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679702260"><span class="hs-identifier hs-var">datum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>    </span><span class="annot"><a href="Cooked.Skeleton.html#TxSkelOutDatum"><span class="hs-identifier hs-type">TxSkelOutDatum</span></a></span><span> </span><span id="local-6989586621679702270"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679702270"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-345"></span><span>      </span><span class="annot"><span class="annottext">TxOutDatum CtxTx ConwayEra
-&gt; ReaderT
     Context (Either GenerateTxError) (TxOutDatum CtxTx ConwayEra)
forall a. a -&gt; ReaderT Context (Either GenerateTxError) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-346"></span><span>        </span><span class="annot"><span class="annottext">(TxOutDatum CtxTx ConwayEra
 -&gt; ReaderT
      Context (Either GenerateTxError) (TxOutDatum CtxTx ConwayEra))
-&gt; TxOutDatum CtxTx ConwayEra
-&gt; ReaderT
     Context (Either GenerateTxError) (TxOutDatum CtxTx ConwayEra)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AlonzoEraOnwards ConwayEra
-&gt; HashableScriptData -&gt; TxOutDatum CtxTx ConwayEra
forall era.
AlonzoEraOnwards era -&gt; HashableScriptData -&gt; TxOutDatum CtxTx era
</span><span class="hs-identifier hs-var">Cardano.TxOutDatumInTx</span></span><span> </span><span class="annot"><span class="annottext">AlonzoEraOnwards ConwayEra
</span><span class="hs-identifier hs-var">Cardano.AlonzoEraOnwardsConway</span></span><span>
</span><span id="line-347"></span><span>          </span><span class="annot"><span class="annottext">(HashableScriptData -&gt; TxOutDatum CtxTx ConwayEra)
-&gt; (a -&gt; HashableScriptData) -&gt; a -&gt; TxOutDatum CtxTx ConwayEra
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ScriptData -&gt; HashableScriptData
</span><span class="hs-identifier hs-var">Cardano.unsafeHashableScriptData</span></span><span>
</span><span id="line-348"></span><span>          </span><span class="annot"><span class="annottext">(ScriptData -&gt; HashableScriptData)
-&gt; (a -&gt; ScriptData) -&gt; a -&gt; HashableScriptData
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Data -&gt; ScriptData
</span><span class="hs-identifier hs-var">Cardano.fromPlutusData</span></span><span>
</span><span id="line-349"></span><span>          </span><span class="annot"><span class="annottext">(Data -&gt; ScriptData) -&gt; (a -&gt; Data) -&gt; a -&gt; ScriptData
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BuiltinData -&gt; Data
</span><span class="hs-identifier hs-var">Api.builtinDataToData</span></span><span>
</span><span id="line-350"></span><span>          </span><span class="annot"><span class="annottext">(BuiltinData -&gt; Data) -&gt; (a -&gt; BuiltinData) -&gt; a -&gt; Data
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; BuiltinData
forall a. ToData a =&gt; a -&gt; BuiltinData
</span><span class="hs-identifier hs-var">Api.toBuiltinData</span></span><span>
</span><span id="line-351"></span><span>        </span><span class="annot"><span class="annottext">(a -&gt; TxOutDatum CtxTx ConwayEra)
-&gt; a -&gt; TxOutDatum CtxTx ConwayEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679702270"><span class="hs-identifier hs-var">datum</span></a></span><span>
</span><span id="line-352"></span><span>    </span><span class="annot"><a href="Cooked.Skeleton.html#TxSkelOutInlineDatum"><span class="hs-identifier hs-type">TxSkelOutInlineDatum</span></a></span><span> </span><span id="local-6989586621679702280"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679702280"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-353"></span><span>      </span><span class="annot"><span class="annottext">TxOutDatum CtxTx ConwayEra
-&gt; ReaderT
     Context (Either GenerateTxError) (TxOutDatum CtxTx ConwayEra)
forall a. a -&gt; ReaderT Context (Either GenerateTxError) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-354"></span><span>        </span><span class="annot"><span class="annottext">(TxOutDatum CtxTx ConwayEra
 -&gt; ReaderT
      Context (Either GenerateTxError) (TxOutDatum CtxTx ConwayEra))
-&gt; TxOutDatum CtxTx ConwayEra
-&gt; ReaderT
     Context (Either GenerateTxError) (TxOutDatum CtxTx ConwayEra)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BabbageEraOnwards ConwayEra
-&gt; HashableScriptData -&gt; TxOutDatum CtxTx ConwayEra
forall era ctx.
BabbageEraOnwards era -&gt; HashableScriptData -&gt; TxOutDatum ctx era
</span><span class="hs-identifier hs-var">Cardano.TxOutDatumInline</span></span><span> </span><span class="annot"><span class="annottext">BabbageEraOnwards ConwayEra
</span><span class="hs-identifier hs-var">Cardano.BabbageEraOnwardsConway</span></span><span>
</span><span id="line-355"></span><span>          </span><span class="annot"><span class="annottext">(HashableScriptData -&gt; TxOutDatum CtxTx ConwayEra)
-&gt; (a -&gt; HashableScriptData) -&gt; a -&gt; TxOutDatum CtxTx ConwayEra
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ScriptData -&gt; HashableScriptData
</span><span class="hs-identifier hs-var">Cardano.unsafeHashableScriptData</span></span><span>
</span><span id="line-356"></span><span>          </span><span class="annot"><span class="annottext">(ScriptData -&gt; HashableScriptData)
-&gt; (a -&gt; ScriptData) -&gt; a -&gt; HashableScriptData
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Data -&gt; ScriptData
</span><span class="hs-identifier hs-var">Cardano.fromPlutusData</span></span><span>
</span><span id="line-357"></span><span>          </span><span class="annot"><span class="annottext">(Data -&gt; ScriptData) -&gt; (a -&gt; Data) -&gt; a -&gt; ScriptData
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BuiltinData -&gt; Data
</span><span class="hs-identifier hs-var">Api.builtinDataToData</span></span><span>
</span><span id="line-358"></span><span>          </span><span class="annot"><span class="annottext">(BuiltinData -&gt; Data) -&gt; (a -&gt; BuiltinData) -&gt; a -&gt; Data
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; BuiltinData
forall a. ToData a =&gt; a -&gt; BuiltinData
</span><span class="hs-identifier hs-var">Api.toBuiltinData</span></span><span>
</span><span id="line-359"></span><span>        </span><span class="annot"><span class="annottext">(a -&gt; TxOutDatum CtxTx ConwayEra)
-&gt; a -&gt; TxOutDatum CtxTx ConwayEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679702280"><span class="hs-identifier hs-var">datum</span></a></span><span>
</span><span id="line-360"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679702282"><span class="annot"><span class="annottext">refScript :: ReferenceScript ConwayEra
</span><a href="#local-6989586621679702282"><span class="hs-identifier hs-var hs-var">refScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Versioned Script) -&gt; ReferenceScript ConwayEra
</span><span class="hs-identifier hs-var">Ledger.toCardanoReferenceScript</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ReferenceScriptType o -&gt; Versioned Script
forall a. ToScript a =&gt; a -&gt; Versioned Script
</span><a href="Cooked.Conversion.ToScript.html#toScript"><span class="hs-identifier hs-var">toScript</span></a></span><span> </span><span class="annot"><span class="annottext">(ReferenceScriptType o -&gt; Versioned Script)
-&gt; Maybe (ReferenceScriptType o) -&gt; Maybe (Versioned Script)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">o
</span><a href="#local-6989586621679702247"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="annot"><span class="annottext">o
-&gt; Optic' A_Lens NoIx o (Maybe (ReferenceScriptType o))
-&gt; Maybe (ReferenceScriptType o)
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx o (Maybe (ReferenceScriptType o))
forall o.
IsAbstractOutput o =&gt;
Lens' o (Maybe (ReferenceScriptType o))
</span><a href="Cooked.Output.html#outputReferenceScriptL"><span class="hs-identifier hs-var">outputReferenceScriptL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-361"></span><span>  </span><span class="annot"><span class="annottext">TxOut CtxTx ConwayEra
-&gt; ReaderT Context (Either GenerateTxError) (TxOut CtxTx ConwayEra)
forall a. a -&gt; ReaderT Context (Either GenerateTxError) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxTx ConwayEra
 -&gt; ReaderT
      Context (Either GenerateTxError) (TxOut CtxTx ConwayEra))
-&gt; TxOut CtxTx ConwayEra
-&gt; ReaderT Context (Either GenerateTxError) (TxOut CtxTx ConwayEra)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AddressInEra ConwayEra
-&gt; TxOutValue ConwayEra
-&gt; TxOutDatum CtxTx ConwayEra
-&gt; ReferenceScript ConwayEra
-&gt; TxOut CtxTx ConwayEra
forall ctx era.
AddressInEra era
-&gt; TxOutValue era
-&gt; TxOutDatum ctx era
-&gt; ReferenceScript era
-&gt; TxOut ctx era
</span><span class="hs-identifier hs-var">Cardano.TxOut</span></span><span> </span><span class="annot"><span class="annottext">AddressInEra ConwayEra
</span><a href="#local-6989586621679702249"><span class="hs-identifier hs-var">address</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutValue ConwayEra
</span><a href="#local-6989586621679702250"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxTx ConwayEra
</span><a href="#local-6989586621679702252"><span class="hs-identifier hs-var">datum</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceScript ConwayEra
</span><a href="#local-6989586621679702282"><span class="hs-identifier hs-var">refScript</span></a></span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#generateTxOut"><span class="hs-identifier hs-type">generateTxOut</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.NetworkId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cooked.Skeleton.html#TxSkelOut"><span class="hs-identifier hs-type">TxSkelOut</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#GenerateTxError"><span class="hs-identifier hs-type">GenerateTxError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Cardano.TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.CtxTx</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.ConwayEra</span></span><span class="hs-special">)</span><span>
</span><span id="line-364"></span><span id="generateTxOut"><span class="annot"><span class="annottext">generateTxOut :: NetworkId
-&gt; TxSkelOut -&gt; Either GenerateTxError (TxOut CtxTx ConwayEra)
</span><a href="Cooked.MockChain.GenerateTx.html#generateTxOut"><span class="hs-identifier hs-var hs-var">generateTxOut</span></a></span></span><span> </span><span id="local-6989586621679702285"><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621679702285"><span class="hs-identifier hs-var">networkId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-365"></span><span>  </span><span class="annot"><span class="annottext">(ReaderT Context (Either GenerateTxError) (TxOut CtxTx ConwayEra)
 -&gt; Context -&gt; Either GenerateTxError (TxOut CtxTx ConwayEra))
-&gt; Context
-&gt; ReaderT Context (Either GenerateTxError) (TxOut CtxTx ConwayEra)
-&gt; Either GenerateTxError (TxOut CtxTx ConwayEra)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">ReaderT Context (Either GenerateTxError) (TxOut CtxTx ConwayEra)
-&gt; Context -&gt; Either GenerateTxError (TxOut CtxTx ConwayEra)
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var">runReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#params"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">def</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="hs-identifier hs-var">Emulator.pNetworkId</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679702285"><span class="hs-identifier hs-type">networkId</span></a></span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ReaderT Context (Either GenerateTxError) (TxOut CtxTx ConwayEra)
 -&gt; Either GenerateTxError (TxOut CtxTx ConwayEra))
-&gt; (TxSkelOut
    -&gt; ReaderT
         Context (Either GenerateTxError) (TxOut CtxTx ConwayEra))
-&gt; TxSkelOut
-&gt; Either GenerateTxError (TxOut CtxTx ConwayEra)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TxSkelOut
-&gt; ReaderT Context (Either GenerateTxError) (TxOut CtxTx ConwayEra)
</span><a href="Cooked.MockChain.GenerateTx.html#txSkelOutToCardanoTxOut"><span class="hs-identifier hs-var">txSkelOutToCardanoTxOut</span></a></span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#txSkelToCardanoTx"><span class="hs-identifier hs-type">txSkelToCardanoTx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cooked.Skeleton.html#TxSkel"><span class="hs-identifier hs-type">TxSkel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#TxGen"><span class="hs-identifier hs-type">TxGen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Cardano.Tx</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.ConwayEra</span></span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span id="txSkelToCardanoTx"><span class="annot"><span class="annottext">txSkelToCardanoTx :: TxSkel -&gt; TxGen (Tx ConwayEra)
</span><a href="Cooked.MockChain.GenerateTx.html#txSkelToCardanoTx"><span class="hs-identifier hs-var hs-var">txSkelToCardanoTx</span></a></span></span><span> </span><span id="local-6989586621679702287"><span class="annot"><span class="annottext">TxSkel
</span><a href="#local-6989586621679702287"><span class="hs-identifier hs-var">txSkel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-369"></span><span>  </span><span id="local-6989586621679702288"><span class="annot"><span class="annottext">TxBodyContent BuildTx ConwayEra
</span><a href="#local-6989586621679702288"><span class="hs-identifier hs-var">txBodyContent</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxSkel -&gt; TxGen (TxBodyContent BuildTx ConwayEra)
</span><a href="Cooked.MockChain.GenerateTx.html#txSkelToBodyContent"><span class="hs-identifier hs-var">txSkelToBodyContent</span></a></span><span> </span><span class="annot"><span class="annottext">TxSkel
</span><a href="#local-6989586621679702287"><span class="hs-identifier hs-var">txSkel</span></a></span><span>
</span><span id="line-370"></span><span>  </span><span id="local-6989586621679702289"><span class="annot"><span class="annottext">Tx ConwayEra
</span><a href="#local-6989586621679702289"><span class="hs-identifier hs-var">cardanoTxUnsigned</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-371"></span><span>    </span><span class="annot"><span class="annottext">Either GenerateTxError (Tx ConwayEra) -&gt; TxGen (Tx ConwayEra)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ReaderT Context m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(Either GenerateTxError (Tx ConwayEra) -&gt; TxGen (Tx ConwayEra))
-&gt; Either GenerateTxError (Tx ConwayEra) -&gt; TxGen (Tx ConwayEra)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-372"></span><span>      </span><span class="annot"><span class="annottext">(TxBodyError -&gt; GenerateTxError)
-&gt; (TxBody ConwayEra -&gt; Tx ConwayEra)
-&gt; Either TxBodyError (TxBody ConwayEra)
-&gt; Either GenerateTxError (Tx ConwayEra)
forall a b c d. (a -&gt; b) -&gt; (c -&gt; d) -&gt; Either a c -&gt; Either b d
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span>
</span><span id="line-373"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; TxBodyError -&gt; GenerateTxError
</span><a href="Cooked.MockChain.GenerateTx.html#TxBodyError"><span class="hs-identifier hs-var">TxBodyError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;generateTx: &quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxBody ConwayEra -&gt; [KeyWitness ConwayEra] -&gt; Tx ConwayEra
forall era. TxBody era -&gt; [KeyWitness era] -&gt; Tx era
</span><span class="hs-operator hs-var">`Cardano.Tx`</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyBasedEra ConwayEra
-&gt; TxBodyContent BuildTx ConwayEra
-&gt; Either TxBodyError (TxBody ConwayEra)
forall era.
ShelleyBasedEra era
-&gt; TxBodyContent BuildTx era -&gt; Either TxBodyError (TxBody era)
</span><span class="hs-identifier hs-var">Cardano.createAndValidateTransactionBody</span></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra ConwayEra
</span><span class="hs-identifier hs-var">Cardano.ShelleyBasedEraConway</span></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx ConwayEra
</span><a href="#local-6989586621679702288"><span class="hs-identifier hs-var">txBodyContent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span>  </span><span class="annot"><span class="annottext">(Tx ConwayEra -&gt; Wallet -&gt; TxGen (Tx ConwayEra))
-&gt; Tx ConwayEra -&gt; [Wallet] -&gt; TxGen (Tx ConwayEra)
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldM</span></span><span>
</span><span id="line-377"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679702292"><span class="annot"><span class="annottext">Tx ConwayEra
</span><a href="#local-6989586621679702292"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span id="local-6989586621679702293"><span class="annot"><span class="annottext">Wallet
</span><a href="#local-6989586621679702293"><span class="hs-identifier hs-var">wal</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-378"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ShelleyWitnessSigningKey -&gt; CardanoTx -&gt; CardanoTx
</span><span class="hs-identifier hs-var">Ledger.addCardanoTxWitness</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PaymentPrivateKey -&gt; ShelleyWitnessSigningKey
forall a. ToWitness a =&gt; a -&gt; ShelleyWitnessSigningKey
</span><span class="hs-identifier hs-var">Ledger.toWitness</span></span><span> </span><span class="annot"><span class="annottext">(PaymentPrivateKey -&gt; ShelleyWitnessSigningKey)
-&gt; PaymentPrivateKey -&gt; ShelleyWitnessSigningKey
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">XPrv -&gt; PaymentPrivateKey
</span><span class="hs-identifier hs-var">Ledger.PaymentPrivateKey</span></span><span> </span><span class="annot"><span class="annottext">(XPrv -&gt; PaymentPrivateKey) -&gt; XPrv -&gt; PaymentPrivateKey
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Wallet -&gt; XPrv
</span><a href="Cooked.Wallet.html#walletSK"><span class="hs-identifier hs-var">walletSK</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet
</span><a href="#local-6989586621679702293"><span class="hs-identifier hs-var">wal</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx ConwayEra -&gt; ShelleyBasedEra ConwayEra -&gt; CardanoTx
forall era. Tx era -&gt; ShelleyBasedEra era -&gt; CardanoTx
</span><span class="hs-identifier hs-var">Ledger.CardanoTx</span></span><span> </span><span class="annot"><span class="annottext">Tx ConwayEra
</span><a href="#local-6989586621679702292"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra ConwayEra
</span><span class="hs-identifier hs-var">Cardano.ShelleyBasedEraConway</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-379"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Ledger.CardanoTx</span></span><span> </span><span id="local-6989586621679702299"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679702299"><span class="hs-identifier hs-var">tx'</span></a></span></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><span class="hs-identifier hs-var">Cardano.ShelleyBasedEraConway</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Tx ConwayEra -&gt; TxGen (Tx ConwayEra)
forall a. a -&gt; ReaderT Context (Either GenerateTxError) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Tx era
Tx ConwayEra
</span><a href="#local-6989586621679702299"><span class="hs-identifier hs-var">tx'</span></a></span><span>
</span><span id="line-380"></span><span>          </span><span class="annot"><span class="annottext">CardanoTx
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TxGen (Tx ConwayEra)
forall a. String -&gt; TxGen a
</span><a href="Cooked.MockChain.GenerateTx.html#throwOnString"><span class="hs-identifier hs-var">throwOnString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;txSkelToCardanoTx: Wrong output era&quot;</span></span><span>
</span><span id="line-381"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-382"></span><span>    </span><span class="annot"><span class="annottext">Tx ConwayEra
</span><a href="#local-6989586621679702289"><span class="hs-identifier hs-var">cardanoTxUnsigned</span></a></span><span>
</span><span id="line-383"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxSkel -&gt; [Wallet]
</span><a href="Cooked.Skeleton.html#txSkelSigners"><span class="hs-identifier hs-var">txSkelSigners</span></a></span><span> </span><span class="annot"><span class="annottext">TxSkel
</span><a href="#local-6989586621679702287"><span class="hs-identifier hs-var">txSkel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#generateTx"><span class="hs-identifier hs-type">generateTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-386"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-387"></span><span>  </span><span class="annot"><a href="Cooked.Wallet.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-388"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOutRef</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-389"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Emulator.Params</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-390"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script.DatumHash</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script.Datum</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-391"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOutRef</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOut</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-392"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script.ValidatorHash</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Script.Versioned</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script.Validator</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-393"></span><span>  </span><span class="annot"><a href="Cooked.Skeleton.html#TxSkel"><span class="hs-identifier hs-type">TxSkel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-394"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#GenerateTxError"><span class="hs-identifier hs-type">GenerateTxError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Cardano.Tx</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.ConwayEra</span></span><span class="hs-special">)</span><span>
</span><span id="line-395"></span><span id="generateTx"><span class="annot"><span class="annottext">generateTx :: Integer
-&gt; Wallet
-&gt; Set TxOutRef
-&gt; Params
-&gt; Map DatumHash Datum
-&gt; Map TxOutRef TxOut
-&gt; Map ValidatorHash (Versioned Validator)
-&gt; TxSkel
-&gt; Either GenerateTxError (Tx ConwayEra)
</span><a href="Cooked.MockChain.GenerateTx.html#generateTx"><span class="hs-identifier hs-var hs-var">generateTx</span></a></span></span><span> </span><span id="local-6989586621679702302"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679702302"><span class="hs-identifier hs-var">fee</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Wallet -&gt; Maybe Wallet
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679702303"><span class="annot"><span class="annottext">Maybe Wallet
</span><a href="#local-6989586621679702303"><span class="hs-identifier hs-var">returnCollateralWallet</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679702304"><span class="annot"><span class="annottext">Set TxOutRef
</span><a href="#local-6989586621679702304"><span class="hs-identifier hs-var">collateralIns</span></a></span></span><span> </span><span id="local-6989586621679702305"><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679702305"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621679702306"><span class="annot"><span class="annottext">Map DatumHash Datum
</span><a href="#local-6989586621679702306"><span class="hs-identifier hs-var">managedData</span></a></span></span><span> </span><span id="local-6989586621679702307"><span class="annot"><span class="annottext">Map TxOutRef TxOut
</span><a href="#local-6989586621679702307"><span class="hs-identifier hs-var">managedTxOuts</span></a></span></span><span> </span><span id="local-6989586621679702308"><span class="annot"><span class="annottext">Map ValidatorHash (Versioned Validator)
</span><a href="#local-6989586621679702308"><span class="hs-identifier hs-var">managedValidators</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-396"></span><span>  </span><span class="annot"><span class="annottext">(TxGen (Tx ConwayEra)
 -&gt; Context -&gt; Either GenerateTxError (Tx ConwayEra))
-&gt; Context
-&gt; TxGen (Tx ConwayEra)
-&gt; Either GenerateTxError (Tx ConwayEra)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">TxGen (Tx ConwayEra)
-&gt; Context -&gt; Either GenerateTxError (Tx ConwayEra)
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var">runReaderT</span></span><span> </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">Integer
Maybe Wallet
Set TxOutRef
Map DatumHash Datum
Map TxOutRef TxOut
Map ValidatorHash (Versioned Validator)
Params
fee :: Integer
collateralIns :: Set TxOutRef
returnCollateralWallet :: Maybe Wallet
params :: Params
managedData :: Map DatumHash Datum
managedTxOuts :: Map TxOutRef TxOut
managedValidators :: Map ValidatorHash (Versioned Validator)
fee :: Integer
returnCollateralWallet :: Maybe Wallet
collateralIns :: Set TxOutRef
params :: Params
managedData :: Map DatumHash Datum
managedTxOuts :: Map TxOutRef TxOut
managedValidators :: Map ValidatorHash (Versioned Validator)
</span><a href="Cooked.MockChain.GenerateTx.html#fee"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">(TxGen (Tx ConwayEra) -&gt; Either GenerateTxError (Tx ConwayEra))
-&gt; (TxSkel -&gt; TxGen (Tx ConwayEra))
-&gt; TxSkel
-&gt; Either GenerateTxError (Tx ConwayEra)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TxSkel -&gt; TxGen (Tx ConwayEra)
</span><a href="Cooked.MockChain.GenerateTx.html#txSkelToCardanoTx"><span class="hs-identifier hs-var">txSkelToCardanoTx</span></a></span><span>
</span><span id="line-397"></span></pre></body></html>