<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-comment">-- | This modules provides a specification for our blockchain monads, in three</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- layers:</span><span>
</span><span id="line-5"></span><span class="hs-comment">--</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- 1. MonadBlockChainBalancing provides what's needing for balancing purposes</span><span>
</span><span id="line-7"></span><span class="hs-comment">--</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- 2. MonadBlockChainWithoutValidation adds up remaining primitives without</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- transaction validation</span><span>
</span><span id="line-10"></span><span class="hs-comment">--</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- 3. MonadBlockChain concludes with the addition of transaction validation,</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- thus modifying the internal index of outputs</span><span>
</span><span id="line-13"></span><span class="hs-comment">--</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- In addition, you will find here many helpers functions which can be derived</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- from the core definition of our blockchain.</span><span>
</span><span id="line-16"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cooked.MockChain.BlockChain</span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#GenerateTxError"><span class="hs-identifier">GenerateTxError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MockChainError"><span class="hs-identifier">MockChainError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MockChainLogEntry"><span class="hs-identifier">MockChainLogEntry</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier">MonadBlockChainBalancing</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainWithoutValidation"><span class="hs-identifier">MonadBlockChainWithoutValidation</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChain"><span class="hs-identifier">MonadBlockChain</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.UtxoState.html#SkelContext"><span class="hs-identifier">SkelContext</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#AsTrans"><span class="hs-identifier">AsTrans</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#currentTime"><span class="hs-identifier">currentTime</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#waitNSlots"><span class="hs-identifier">waitNSlots</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#utxosFromCardanoTx"><span class="hs-identifier">utxosFromCardanoTx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#typedDatumFromTxOutRef"><span class="hs-identifier">typedDatumFromTxOutRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#valueFromTxOutRef"><span class="hs-identifier">valueFromTxOutRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#outputDatumFromTxOutRef"><span class="hs-identifier">outputDatumFromTxOutRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#datumFromTxOutRef"><span class="hs-identifier">datumFromTxOutRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#resolveDatum"><span class="hs-identifier">resolveDatum</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#resolveTypedDatum"><span class="hs-identifier">resolveTypedDatum</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#resolveValidator"><span class="hs-identifier">resolveValidator</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#resolveReferenceScript"><span class="hs-identifier">resolveReferenceScript</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#getEnclosingSlot"><span class="hs-identifier">getEnclosingSlot</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#awaitEnclosingSlot"><span class="hs-identifier">awaitEnclosingSlot</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#awaitDurationFromLowerBound"><span class="hs-identifier">awaitDurationFromLowerBound</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#awaitDurationFromUpperBound"><span class="hs-identifier">awaitDurationFromUpperBound</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#slotRangeBefore"><span class="hs-identifier">slotRangeBefore</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#slotRangeAfter"><span class="hs-identifier">slotRangeAfter</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#slotToTimeInterval"><span class="hs-identifier">slotToTimeInterval</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#txSkelInputUtxos"><span class="hs-identifier">txSkelInputUtxos</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#txSkelReferenceInputUtxos"><span class="hs-identifier">txSkelReferenceInputUtxos</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#txSkelInputValidators"><span class="hs-identifier">txSkelInputValidators</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#txSkelInputValue"><span class="hs-identifier">txSkelInputValue</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#txSkelInputDataAsHashes"><span class="hs-identifier">txSkelInputDataAsHashes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#lookupUtxos"><span class="hs-identifier">lookupUtxos</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#validateTxSkel%27"><span class="hs-identifier">validateTxSkel'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#validateTxSkel_"><span class="hs-identifier">validateTxSkel_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#txSkelProposalsDeposit"><span class="hs-identifier">txSkelProposalsDeposit</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#govActionDeposit"><span class="hs-identifier">govActionDeposit</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#txOutRefToTxSkelOut"><span class="hs-identifier">txOutRefToTxSkelOut</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#txOutRefToTxSkelOut%27"><span class="hs-identifier">txOutRefToTxSkelOut'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#defineM"><span class="hs-identifier">defineM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">where</span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Api</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Cardano</span></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Api.Ledger</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Cardano</span></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Conway.PParams</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Conway</span></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Node.Emulator</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Emulator</span></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Node.Emulator.Internal.Node</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Emulator</span></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Lens</span></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Control</span></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Writer</span></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.MockChain.UtxoState.html"><span class="hs-identifier">Cooked.MockChain.UtxoState</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.Output.html"><span class="hs-identifier">Cooked.Output</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.Pretty.Hashable.html"><span class="hs-identifier">Cooked.Pretty.Hashable</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.Skeleton.html"><span class="hs-identifier">Cooked.Skeleton</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.Wallet.html"><span class="hs-identifier">Cooked.Wallet</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Kind</span></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Index</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ledger</span></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Slot</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ledger</span></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Tx</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ledger</span></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Tx.CardanoAPI</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ledger</span></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">ListT</span></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Optics.Core</span></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.Script.Utils.Address</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Script</span></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.Script.Utils.Data</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Script</span></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.Script.Utils.Scripts</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Script</span></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusLedgerApi.V3</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Api</span></span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span class="annot"><span class="hs-comment">-- * Mockchain errors</span></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="annot"><span class="hs-comment">-- | Errors that can arise during transaction generation</span></span><span>
</span><span id="line-95"></span><span class="hs-keyword">data</span><span> </span><span id="GenerateTxError"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#GenerateTxError"><span class="hs-identifier hs-var">GenerateTxError</span></a></span></span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-comment">-- | Error when translating a skeleton element to its Cardano counterpart</span></span><span>
</span><span id="line-97"></span><span>    </span><span id="ToCardanoError"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#ToCardanoError"><span class="hs-identifier hs-var">ToCardanoError</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.ToCardanoError</span></span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | Error when generating a Cardano transaction body</span></span><span>
</span><span id="line-99"></span><span>    </span><span id="TxBodyError"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#TxBodyError"><span class="hs-identifier hs-var">TxBodyError</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.TxBodyError</span></span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | Other generation error</span></span><span>
</span><span id="line-101"></span><span>    </span><span id="GenerateTxErrorGeneral"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#GenerateTxErrorGeneral"><span class="hs-identifier hs-var">GenerateTxErrorGeneral</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679818683"><span id="local-6989586621679818698"><span id="local-6989586621679818702"><span class="annot"><span class="annottext">Int -&gt; GenerateTxError -&gt; ShowS
[GenerateTxError] -&gt; ShowS
GenerateTxError -&gt; String
(Int -&gt; GenerateTxError -&gt; ShowS)
-&gt; (GenerateTxError -&gt; String)
-&gt; ([GenerateTxError] -&gt; ShowS)
-&gt; Show GenerateTxError
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; GenerateTxError -&gt; ShowS
showsPrec :: Int -&gt; GenerateTxError -&gt; ShowS
$cshow :: GenerateTxError -&gt; String
show :: GenerateTxError -&gt; String
$cshowList :: [GenerateTxError] -&gt; ShowS
showList :: [GenerateTxError] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679818707"><span id="local-6989586621679818718"><span class="annot"><span class="annottext">GenerateTxError -&gt; GenerateTxError -&gt; Bool
(GenerateTxError -&gt; GenerateTxError -&gt; Bool)
-&gt; (GenerateTxError -&gt; GenerateTxError -&gt; Bool)
-&gt; Eq GenerateTxError
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: GenerateTxError -&gt; GenerateTxError -&gt; Bool
== :: GenerateTxError -&gt; GenerateTxError -&gt; Bool
$c/= :: GenerateTxError -&gt; GenerateTxError -&gt; Bool
/= :: GenerateTxError -&gt; GenerateTxError -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="annot"><span class="hs-comment">-- | Errors that can be produced by the blockchain</span></span><span>
</span><span id="line-105"></span><span class="hs-keyword">data</span><span> </span><span id="MockChainError"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MockChainError"><span class="hs-identifier hs-var">MockChainError</span></a></span></span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-comment">-- | Validation errors, either in Phase 1 or Phase 2</span></span><span>
</span><span id="line-107"></span><span>    </span><span id="MCEValidationError"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MCEValidationError"><span class="hs-identifier hs-var">MCEValidationError</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.ValidationPhase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.ValidationError</span></span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | Thrown when the balancing wallet does not have enough funds</span></span><span>
</span><span id="line-109"></span><span>    </span><span id="MCEUnbalanceable"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MCEUnbalanceable"><span class="hs-identifier hs-var">MCEUnbalanceable</span></a></span></span><span> </span><span class="annot"><a href="Cooked.Wallet.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.Value</span></span><span> </span><span class="annot"><a href="Cooked.Skeleton.html#TxSkel"><span class="hs-identifier hs-type">TxSkel</span></a></span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Thrown when not enough collateral are provided. Built upon the fee, the</span><span>
</span><span id="line-111"></span><span>    </span><span class="hs-comment">-- percentage and the expected minimal collateral value.</span><span>
</span><span id="line-112"></span><span>    </span><span id="MCENoSuitableCollateral"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MCENoSuitableCollateral"><span class="hs-identifier hs-var">MCENoSuitableCollateral</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.Value</span></span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | Thrown when an error occured during transaction generation</span></span><span>
</span><span id="line-114"></span><span>    </span><span id="MCEGenerationError"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MCEGenerationError"><span class="hs-identifier hs-var">MCEGenerationError</span></a></span></span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#GenerateTxError"><span class="hs-identifier hs-type">GenerateTxError</span></a></span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | Thrown when an output reference is missing from the mockchain state</span></span><span>
</span><span id="line-116"></span><span>    </span><span id="MCEUnknownOutRefError"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MCEUnknownOutRefError"><span class="hs-identifier hs-var">MCEUnknownOutRefError</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOutRef</span></span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | Same as 'MCEUnknownOutRefError' for validators.</span></span><span>
</span><span id="line-118"></span><span>    </span><span id="MCEUnknownValidator"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MCEUnknownValidator"><span class="hs-identifier hs-var">MCEUnknownValidator</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script.ValidatorHash</span></span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | Same as 'MCEUnknownOutRefError' for datums.</span></span><span>
</span><span id="line-120"></span><span>    </span><span id="MCEUnknownDatum"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MCEUnknownDatum"><span class="hs-identifier hs-var">MCEUnknownDatum</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.DatumHash</span></span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | Used to provide 'MonadFail' instances.</span></span><span>
</span><span id="line-122"></span><span>    </span><span id="FailWith"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#FailWith"><span class="hs-identifier hs-var">FailWith</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679818732"><span id="local-6989586621679818768"><span id="local-6989586621679818772"><span class="annot"><span class="annottext">Int -&gt; MockChainError -&gt; ShowS
[MockChainError] -&gt; ShowS
MockChainError -&gt; String
(Int -&gt; MockChainError -&gt; ShowS)
-&gt; (MockChainError -&gt; String)
-&gt; ([MockChainError] -&gt; ShowS)
-&gt; Show MockChainError
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; MockChainError -&gt; ShowS
showsPrec :: Int -&gt; MockChainError -&gt; ShowS
$cshow :: MockChainError -&gt; String
show :: MockChainError -&gt; String
$cshowList :: [MockChainError] -&gt; ShowS
showList :: [MockChainError] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679818775"><span id="local-6989586621679818803"><span class="annot"><span class="annottext">MockChainError -&gt; MockChainError -&gt; Bool
(MockChainError -&gt; MockChainError -&gt; Bool)
-&gt; (MockChainError -&gt; MockChainError -&gt; Bool) -&gt; Eq MockChainError
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: MockChainError -&gt; MockChainError -&gt; Bool
== :: MockChainError -&gt; MockChainError -&gt; Bool
$c/= :: MockChainError -&gt; MockChainError -&gt; Bool
/= :: MockChainError -&gt; MockChainError -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span class="annot"><span class="hs-comment">-- * Mockchain logs</span></span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span class="hs-comment">-- | This represents the specific events that should be logged when processing</span><span>
</span><span id="line-128"></span><span class="hs-comment">-- transactions. If a new kind of event arises, then a new constructor should be</span><span>
</span><span id="line-129"></span><span class="hs-comment">-- provided here.</span><span>
</span><span id="line-130"></span><span class="hs-keyword">data</span><span> </span><span id="MockChainLogEntry"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MockChainLogEntry"><span class="hs-identifier hs-var">MockChainLogEntry</span></a></span></span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-comment">-- | Logging a Skeleton as it is submitted by the user.</span></span><span>
</span><span id="line-132"></span><span>    </span><span id="MCLogSubmittedTxSkel"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MCLogSubmittedTxSkel"><span class="hs-identifier hs-var">MCLogSubmittedTxSkel</span></a></span></span><span> </span><span class="annot"><a href="Cooked.MockChain.UtxoState.html#SkelContext"><span class="hs-identifier hs-type">SkelContext</span></a></span><span> </span><span class="annot"><a href="Cooked.Skeleton.html#TxSkel"><span class="hs-identifier hs-type">TxSkel</span></a></span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Logging a Skeleton as it has been adjusted by the balancing mechanism,</span><span>
</span><span id="line-134"></span><span>    </span><span class="hs-comment">-- alongside fee, and possible collateral utxos and return collateral wallet.</span><span>
</span><span id="line-135"></span><span>    </span><span id="MCLogAdjustedTxSkel"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MCLogAdjustedTxSkel"><span class="hs-identifier hs-var">MCLogAdjustedTxSkel</span></a></span></span><span> </span><span class="annot"><a href="Cooked.MockChain.UtxoState.html#SkelContext"><span class="hs-identifier hs-type">SkelContext</span></a></span><span> </span><span class="annot"><a href="Cooked.Skeleton.html#TxSkel"><span class="hs-identifier hs-type">TxSkel</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOutRef</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cooked.Wallet.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Logging the appearance of a new transaction, after a skeleton has been</span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-comment">-- successfully sent for validation.</span><span>
</span><span id="line-138"></span><span>    </span><span id="MCLogNewTx"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MCLogNewTx"><span class="hs-identifier hs-var">MCLogNewTx</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxId</span></span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Logging the fact that utxos provided by the user for balancing have to be</span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-comment">-- discarded for a specific reason.</span><span>
</span><span id="line-141"></span><span>    </span><span id="MCLogDiscardedUtxos"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MCLogDiscardedUtxos"><span class="hs-identifier hs-var">MCLogDiscardedUtxos</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-142"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Logging the fact that utxos provided as collaterals will not be used</span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-comment">-- because the transaction does not involve scripts. There are 2 cases,</span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-comment">-- depending on whether the user has provided an explicit wallet or a set of</span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-comment">-- utxos to be used as collaterals.</span><span>
</span><span id="line-146"></span><span>    </span><span id="MCLogUnusedCollaterals"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MCLogUnusedCollaterals"><span class="hs-identifier hs-var">MCLogUnusedCollaterals</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Cooked.Wallet.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOutRef</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | Logging the automatic addition of a reference script</span></span><span>
</span><span id="line-148"></span><span>    </span><span id="MCLogAddedReferenceScript"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MCLogAddedReferenceScript"><span class="hs-identifier hs-var">MCLogAddedReferenceScript</span></a></span></span><span> </span><span class="annot"><a href="Cooked.Skeleton.Redeemer.html#TxSkelRedeemer"><span class="hs-identifier hs-type">TxSkelRedeemer</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOutRef</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script.ScriptHash</span></span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | Logging the automatic adjusment of a min ada amount</span></span><span>
</span><span id="line-150"></span><span>    </span><span id="MCLogAdjustedTxSkelOut"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MCLogAdjustedTxSkelOut"><span class="hs-identifier hs-var">MCLogAdjustedTxSkelOut</span></a></span></span><span> </span><span class="annot"><a href="Cooked.Skeleton.Output.html#TxSkelOut"><span class="hs-identifier hs-type">TxSkelOut</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.Lovelace</span></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="annot"><span class="hs-comment">-- * Mockchain layers</span></span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="hs-comment">-- | This is the first layer of our blockchain, which provides the minimal</span><span>
</span><span id="line-155"></span><span class="hs-comment">-- subset of primitives required to perform balancing.</span><span>
</span><span id="line-156"></span><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679818174"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MockChainError"><span class="hs-identifier hs-type">MockChainError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818174"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="MonadBlockChainBalancing"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-var">MonadBlockChainBalancing</span></a></span></span><span> </span><span id="local-6989586621679818174"><span class="annot"><a href="#local-6989586621679818174"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-comment">-- | Returns the emulator parameters, including protocol parameters</span><span>
</span><span id="line-158"></span><span>  </span><span id="getParams"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#getParams"><span class="hs-identifier hs-type">getParams</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679818174"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Emulator.Params</span></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span>  </span><span class="hs-comment">-- | Returns a list of all UTxOs at a certain address.</span><span>
</span><span id="line-161"></span><span>  </span><span id="utxosAt"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#utxosAt"><span class="hs-identifier hs-type">utxosAt</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.Address</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818174"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Api.TxOutRef</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOut</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-comment">-- | Returns the datum with the given hash if present.</span><span>
</span><span id="line-164"></span><span>  </span><span id="datumFromHash"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#datumFromHash"><span class="hs-identifier hs-type">datumFromHash</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.DatumHash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818174"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.Datum</span></span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span>  </span><span class="hs-comment">-- | Returns the full validator corresponding to hash, if that validator owns</span><span>
</span><span id="line-167"></span><span>  </span><span class="hs-comment">-- something or if it is stored in the reference script field of some UTxO.</span><span>
</span><span id="line-168"></span><span>  </span><span id="scriptFromHash"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#scriptFromHash"><span class="hs-identifier hs-type">scriptFromHash</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script.ScriptHash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818174"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Script.Versioned</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script.Script</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span>  </span><span class="hs-comment">-- | Returns an output given a reference to it</span><span>
</span><span id="line-171"></span><span>  </span><span id="txOutByRef"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#txOutByRef"><span class="hs-identifier hs-type">txOutByRef</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOutRef</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818174"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOut</span></span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span>  </span><span class="hs-comment">-- | Logs an event that occured during a BlockChain run</span><span>
</span><span id="line-174"></span><span>  </span><span id="logEvent"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#logEvent"><span class="hs-identifier hs-type">logEvent</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MockChainLogEntry"><span class="hs-identifier hs-type">MockChainLogEntry</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818174"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="hs-comment">-- | This is the second layer of our block, which provides all the other</span><span>
</span><span id="line-177"></span><span class="hs-comment">-- blockchain primitives not needed for balancing, except transaction</span><span>
</span><span id="line-178"></span><span class="hs-comment">-- validation. This layers is the one where</span><span>
</span><span id="line-179"></span><span class="hs-comment">-- 'Cooked.MockChain.Tweak.Common.Tweak's are plugged to.</span><span>
</span><span id="line-180"></span><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-type">MonadBlockChainBalancing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818177"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="MonadBlockChainWithoutValidation"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainWithoutValidation"><span class="hs-identifier hs-var">MonadBlockChainWithoutValidation</span></a></span></span><span> </span><span id="local-6989586621679818177"><span class="annot"><a href="#local-6989586621679818177"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-181"></span><span>  </span><span class="hs-comment">-- | Returns a list of all currently known outputs.</span><span>
</span><span id="line-182"></span><span>  </span><span id="allUtxos"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#allUtxos"><span class="hs-identifier hs-type">allUtxos</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679818177"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Api.TxOutRef</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOut</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span>  </span><span class="hs-comment">-- | Updates parameters</span><span>
</span><span id="line-185"></span><span>  </span><span id="setParams"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#setParams"><span class="hs-identifier hs-type">setParams</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Emulator.Params</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818177"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span>  </span><span class="hs-comment">-- | Returns the current slot number</span><span>
</span><span id="line-188"></span><span>  </span><span id="currentSlot"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#currentSlot"><span class="hs-identifier hs-type">currentSlot</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679818177"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.Slot</span></span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span>  </span><span class="hs-comment">-- | Waits until the current slot becomes greater or equal to the given slot,</span><span>
</span><span id="line-191"></span><span>  </span><span class="hs-comment">-- and returns the current slot after waiting.</span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-193"></span><span>  </span><span class="hs-comment">-- Note that it might not wait for anything if the current slot is large</span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-comment">-- enough.</span><span>
</span><span id="line-195"></span><span>  </span><span id="awaitSlot"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#awaitSlot"><span class="hs-identifier hs-type">awaitSlot</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.Slot</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818177"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.Slot</span></span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span>  </span><span class="hs-comment">-- | Binds a hashable quantity of type @a@ to a variable in the mockchain,</span><span>
</span><span id="line-198"></span><span>  </span><span class="hs-comment">-- while registering its alias for printing purposes.</span><span>
</span><span id="line-199"></span><span>  </span><span id="define"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#define"><span class="hs-identifier hs-type">define</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679818188"><span class="hs-special">(</span><span class="annot"><a href="Cooked.Pretty.Hashable.html#ToHash"><span class="hs-identifier hs-type">ToHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818188"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818188"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818177"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818188"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span class="annot"><span class="hs-comment">-- | Like 'define', but binds the result of a monadic computation instead</span></span><span>
</span><span id="line-202"></span><span id="local-6989586621679818179"><span id="local-6989586621679818180"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#defineM"><span class="hs-identifier hs-type">defineM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainWithoutValidation"><span class="hs-identifier hs-type">MonadBlockChainWithoutValidation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818179"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cooked.Pretty.Hashable.html#ToHash"><span class="hs-identifier hs-type">ToHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818180"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818179"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818180"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818179"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818180"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-203"></span><span id="defineM"><span class="annot"><span class="annottext">defineM :: forall (m :: * -&gt; *) a.
(MonadBlockChainWithoutValidation m, ToHash a) =&gt;
String -&gt; m a -&gt; m a
</span><a href="Cooked.MockChain.BlockChain.html#defineM"><span class="hs-identifier hs-var hs-var">defineM</span></a></span></span><span> </span><span id="local-6989586621679818837"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679818837"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679818838"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679818838"><span class="hs-identifier hs-var">comp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679818838"><span class="hs-identifier hs-var">comp</span></a></span><span> </span><span class="annot"><span class="annottext">m a -&gt; (a -&gt; m a) -&gt; m a
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; a -&gt; m a
forall a. ToHash a =&gt; String -&gt; a -&gt; m a
forall (m :: * -&gt; *) a.
(MonadBlockChainWithoutValidation m, ToHash a) =&gt;
String -&gt; a -&gt; m a
</span><a href="Cooked.MockChain.BlockChain.html#define"><span class="hs-identifier hs-var">define</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679818837"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="hs-comment">-- | The final layer of our blockchain, adding transaction validation to the</span><span>
</span><span id="line-206"></span><span class="hs-comment">-- mix. This is the only primitive that actually modifies the ledger state.</span><span>
</span><span id="line-207"></span><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainWithoutValidation"><span class="hs-identifier hs-type">MonadBlockChainWithoutValidation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818189"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="MonadBlockChain"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChain"><span class="hs-identifier hs-var">MonadBlockChain</span></a></span></span><span> </span><span id="local-6989586621679818189"><span class="annot"><a href="#local-6989586621679818189"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-208"></span><span>  </span><span class="hs-comment">-- | Generates, balances and validates a transaction from a skeleton. It</span><span>
</span><span id="line-209"></span><span>  </span><span class="hs-comment">-- returns the validated transaction and updates the state of the</span><span>
</span><span id="line-210"></span><span>  </span><span class="hs-comment">-- blockchain.</span><span>
</span><span id="line-211"></span><span>  </span><span id="validateTxSkel"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#validateTxSkel"><span class="hs-identifier hs-type">validateTxSkel</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cooked.Skeleton.html#TxSkel"><span class="hs-identifier hs-type">TxSkel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818189"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.CardanoTx</span></span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span class="hs-comment">-- | Validates a skeleton, and retuns the ordered list of produced output</span><span>
</span><span id="line-214"></span><span class="hs-comment">-- references</span><span>
</span><span id="line-215"></span><span id="local-6989586621679818191"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#validateTxSkel%27"><span class="hs-identifier hs-type">validateTxSkel'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChain"><span class="hs-identifier hs-type">MonadBlockChain</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818191"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cooked.Skeleton.html#TxSkel"><span class="hs-identifier hs-type">TxSkel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818191"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Api.TxOutRef</span></span><span class="hs-special">]</span></span><span>
</span><span id="line-216"></span><span id="validateTxSkel%27"><span class="annot"><span class="annottext">validateTxSkel' :: forall (m :: * -&gt; *). MonadBlockChain m =&gt; TxSkel -&gt; m [TxOutRef]
</span><a href="Cooked.MockChain.BlockChain.html#validateTxSkel%27"><span class="hs-identifier hs-var hs-var">validateTxSkel'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((TxOutRef, TxOut) -&gt; TxOutRef)
-&gt; [(TxOutRef, TxOut)] -&gt; [TxOutRef]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(TxOutRef, TxOut) -&gt; TxOutRef
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">([(TxOutRef, TxOut)] -&gt; [TxOutRef])
-&gt; (CardanoTx -&gt; [(TxOutRef, TxOut)]) -&gt; CardanoTx -&gt; [TxOutRef]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CardanoTx -&gt; [(TxOutRef, TxOut)]
</span><a href="Cooked.MockChain.BlockChain.html#utxosFromCardanoTx"><span class="hs-identifier hs-var">utxosFromCardanoTx</span></a></span><span> </span><span class="annot"><span class="annottext">(CardanoTx -&gt; [TxOutRef]) -&gt; m CardanoTx -&gt; m [TxOutRef]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m CardanoTx -&gt; m [TxOutRef])
-&gt; (TxSkel -&gt; m CardanoTx) -&gt; TxSkel -&gt; m [TxOutRef]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TxSkel -&gt; m CardanoTx
forall (m :: * -&gt; *). MonadBlockChain m =&gt; TxSkel -&gt; m CardanoTx
</span><a href="Cooked.MockChain.BlockChain.html#validateTxSkel"><span class="hs-identifier hs-var">validateTxSkel</span></a></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span class="annot"><span class="hs-comment">-- | Validates a skeleton, and erases the outputs</span></span><span>
</span><span id="line-219"></span><span id="local-6989586621679818206"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#validateTxSkel_"><span class="hs-identifier hs-type">validateTxSkel_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChain"><span class="hs-identifier hs-type">MonadBlockChain</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818206"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cooked.Skeleton.html#TxSkel"><span class="hs-identifier hs-type">TxSkel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818206"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-220"></span><span id="validateTxSkel_"><span class="annot"><span class="annottext">validateTxSkel_ :: forall (m :: * -&gt; *). MonadBlockChain m =&gt; TxSkel -&gt; m ()
</span><a href="Cooked.MockChain.BlockChain.html#validateTxSkel_"><span class="hs-identifier hs-var hs-var">validateTxSkel_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m CardanoTx -&gt; m ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(m CardanoTx -&gt; m ()) -&gt; (TxSkel -&gt; m CardanoTx) -&gt; TxSkel -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TxSkel -&gt; m CardanoTx
forall (m :: * -&gt; *). MonadBlockChain m =&gt; TxSkel -&gt; m CardanoTx
</span><a href="Cooked.MockChain.BlockChain.html#validateTxSkel"><span class="hs-identifier hs-var">validateTxSkel</span></a></span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span class="hs-comment">-- | Retrieves the ordered list of outputs of the given &quot;CardanoTx&quot;.</span><span>
</span><span id="line-223"></span><span class="hs-comment">--</span><span>
</span><span id="line-224"></span><span class="hs-comment">-- This is useful when writing endpoints and/or traces to fetch utxos of</span><span>
</span><span id="line-225"></span><span class="hs-comment">-- interest right from the start and avoid querying the chain for them</span><span>
</span><span id="line-226"></span><span class="hs-comment">-- afterwards using 'allUtxos' or similar functions.</span><span>
</span><span id="line-227"></span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#utxosFromCardanoTx"><span class="hs-identifier hs-type">utxosFromCardanoTx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.CardanoTx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Api.TxOutRef</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOut</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-228"></span><span id="utxosFromCardanoTx"><span class="annot"><span class="annottext">utxosFromCardanoTx :: CardanoTx -&gt; [(TxOutRef, TxOut)]
</span><a href="Cooked.MockChain.BlockChain.html#utxosFromCardanoTx"><span class="hs-identifier hs-var hs-var">utxosFromCardanoTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-229"></span><span>  </span><span class="annot"><span class="annottext">((TxOut, TxIn) -&gt; (TxOutRef, TxOut))
-&gt; [(TxOut, TxIn)] -&gt; [(TxOutRef, TxOut)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span>
</span><span id="line-230"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679818865"><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621679818865"><span class="hs-identifier hs-var">txOut</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679818866"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679818866"><span class="hs-identifier hs-var">txOutRef</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-231"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; TxOutRef
</span><span class="hs-identifier hs-var">Ledger.fromCardanoTxIn</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679818866"><span class="hs-identifier hs-var">txOutRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-232"></span><span>          </span><span class="annot"><span class="annottext">TxOut CtxTx ConwayEra -&gt; TxOut
forall era. TxOut CtxTx era -&gt; TxOut
</span><span class="hs-identifier hs-var">Ledger.fromCardanoTxOutToPV2TxInfoTxOut</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxTx ConwayEra -&gt; TxOut) -&gt; TxOut CtxTx ConwayEra -&gt; TxOut
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TxOut -&gt; TxOut CtxTx ConwayEra
</span><span class="hs-identifier hs-var">Ledger.getTxOut</span></span><span> </span><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621679818865"><span class="hs-identifier hs-var">txOut</span></a></span><span>
</span><span id="line-233"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>    </span><span class="annot"><span class="annottext">([(TxOut, TxIn)] -&gt; [(TxOutRef, TxOut)])
-&gt; (CardanoTx -&gt; [(TxOut, TxIn)])
-&gt; CardanoTx
-&gt; [(TxOutRef, TxOut)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CardanoTx -&gt; [(TxOut, TxIn)]
</span><span class="hs-identifier hs-var">Ledger.getCardanoTxOutRefs</span></span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span class="annot"><span class="hs-comment">-- * Mockchain helpers</span></span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span class="hs-comment">-- | Try to resolve the datum on the output: If there's an inline datum, take</span><span>
</span><span id="line-240"></span><span class="hs-comment">-- that; if there's a datum hash, look the corresponding datum up (with</span><span>
</span><span id="line-241"></span><span class="hs-comment">-- 'datumFromHash'), returning @Nothing@ if it can't be found; if there's no</span><span>
</span><span id="line-242"></span><span class="hs-comment">-- datum or hash at all, return @Nothing@.</span><span>
</span><span id="line-243"></span><span id="local-6989586621679818219"><span id="local-6989586621679818223"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#resolveDatum"><span class="hs-identifier hs-type">resolveDatum</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-244"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cooked.Output.html#IsAbstractOutput"><span class="hs-identifier hs-type">IsAbstractOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818219"><span class="hs-identifier hs-type">out</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-245"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Script.ToOutputDatum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Output.html#DatumType"><span class="hs-identifier hs-type">DatumType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818219"><span class="hs-identifier hs-type">out</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-246"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-type">MonadBlockChainBalancing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818223"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-247"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-248"></span><span>  </span><span class="annot"><a href="#local-6989586621679818219"><span class="hs-identifier hs-type">out</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-249"></span><span>  </span><span class="annot"><a href="#local-6989586621679818223"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Output.html#ConcreteOutput"><span class="hs-identifier hs-type">ConcreteOutput</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Output.html#OwnerType"><span class="hs-identifier hs-type">OwnerType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818219"><span class="hs-identifier hs-type">out</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.Datum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Output.html#ValueType"><span class="hs-identifier hs-type">ValueType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818219"><span class="hs-identifier hs-type">out</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Output.html#ReferenceScriptType"><span class="hs-identifier hs-type">ReferenceScriptType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818219"><span class="hs-identifier hs-type">out</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-250"></span><span id="resolveDatum"><span class="annot"><span class="annottext">resolveDatum :: forall out (m :: * -&gt; *).
(IsAbstractOutput out, ToOutputDatum (DatumType out),
 MonadBlockChainBalancing m) =&gt;
out
-&gt; m (Maybe
        (ConcreteOutput
           (OwnerType out) Datum (ValueType out) (ReferenceScriptType out)))
</span><a href="Cooked.MockChain.BlockChain.html#resolveDatum"><span class="hs-identifier hs-var hs-var">resolveDatum</span></a></span></span><span> </span><span id="local-6989586621679818886"><span class="annot"><span class="annottext">out
</span><a href="#local-6989586621679818886"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-251"></span><span>  </span><span id="local-6989586621679818887"><span class="annot"><span class="annottext">Maybe Datum
</span><a href="#local-6989586621679818887"><span class="hs-identifier hs-var">mDatum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">out -&gt; OutputDatum
forall o.
(IsAbstractOutput o, ToOutputDatum (DatumType o)) =&gt;
o -&gt; OutputDatum
</span><a href="Cooked.Output.html#outputOutputDatum"><span class="hs-identifier hs-var">outputOutputDatum</span></a></span><span> </span><span class="annot"><span class="annottext">out
</span><a href="#local-6989586621679818886"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-252"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Api.OutputDatumHash</span></span><span> </span><span id="local-6989586621679818890"><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679818890"><span class="hs-identifier hs-var">datumHash</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DatumHash -&gt; m (Maybe Datum)
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
DatumHash -&gt; m (Maybe Datum)
</span><a href="Cooked.MockChain.BlockChain.html#datumFromHash"><span class="hs-identifier hs-var">datumFromHash</span></a></span><span> </span><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679818890"><span class="hs-identifier hs-var">datumHash</span></a></span><span>
</span><span id="line-253"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Api.OutputDatum</span></span><span> </span><span id="local-6989586621679818892"><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679818892"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Datum -&gt; m (Maybe Datum)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Datum -&gt; m (Maybe Datum)) -&gt; Maybe Datum -&gt; m (Maybe Datum)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Datum -&gt; Maybe Datum
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679818892"><span class="hs-identifier hs-var">datum</span></a></span><span>
</span><span id="line-254"></span><span>    </span><span class="annot"><span class="annottext">OutputDatum
</span><span class="hs-identifier hs-var">Api.NoOutputDatum</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Datum -&gt; m (Maybe Datum)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Datum
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-255"></span><span>  </span><span class="annot"><span class="annottext">Maybe
  (ConcreteOutput
     (OwnerType out) Datum (ValueType out) (ReferenceScriptType out))
-&gt; m (Maybe
        (ConcreteOutput
           (OwnerType out) Datum (ValueType out) (ReferenceScriptType out)))
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe
   (ConcreteOutput
      (OwnerType out) Datum (ValueType out) (ReferenceScriptType out))
 -&gt; m (Maybe
         (ConcreteOutput
            (OwnerType out) Datum (ValueType out) (ReferenceScriptType out))))
-&gt; Maybe
     (ConcreteOutput
        (OwnerType out) Datum (ValueType out) (ReferenceScriptType out))
-&gt; m (Maybe
        (ConcreteOutput
           (OwnerType out) Datum (ValueType out) (ReferenceScriptType out)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">out
-&gt; Datum
-&gt; ConcreteOutput
     (OwnerType out) Datum (ValueType out) (ReferenceScriptType out)
forall out dat.
IsAbstractOutput out =&gt;
out
-&gt; dat
-&gt; ConcreteOutput
     (OwnerType out) dat (ValueType out) (ReferenceScriptType out)
</span><a href="Cooked.Output.html#setDatum"><span class="hs-identifier hs-var">setDatum</span></a></span><span> </span><span class="annot"><span class="annottext">out
</span><a href="#local-6989586621679818886"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="annot"><span class="annottext">(Datum
 -&gt; ConcreteOutput
      (OwnerType out) Datum (ValueType out) (ReferenceScriptType out))
-&gt; Maybe Datum
-&gt; Maybe
     (ConcreteOutput
        (OwnerType out) Datum (ValueType out) (ReferenceScriptType out))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Datum
</span><a href="#local-6989586621679818887"><span class="hs-identifier hs-var">mDatum</span></a></span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span class="hs-comment">-- | Like 'resolveDatum', but also tries to use 'Api.fromBuiltinData' to extract</span><span>
</span><span id="line-258"></span><span class="hs-comment">-- a datum of the suitable type.</span><span>
</span><span id="line-259"></span><span id="local-6989586621679818237"><span id="local-6989586621679818238"><span id="local-6989586621679818239"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#resolveTypedDatum"><span class="hs-identifier hs-type">resolveTypedDatum</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-260"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cooked.Output.html#IsAbstractOutput"><span class="hs-identifier hs-type">IsAbstractOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818237"><span class="hs-identifier hs-type">out</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-261"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Script.ToOutputDatum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Output.html#DatumType"><span class="hs-identifier hs-type">DatumType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818237"><span class="hs-identifier hs-type">out</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-262"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-type">MonadBlockChainBalancing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818238"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-263"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Api.FromData</span></span><span> </span><span class="annot"><a href="#local-6989586621679818239"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-264"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-265"></span><span>  </span><span class="annot"><a href="#local-6989586621679818237"><span class="hs-identifier hs-type">out</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-266"></span><span>  </span><span class="annot"><a href="#local-6989586621679818238"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Output.html#ConcreteOutput"><span class="hs-identifier hs-type">ConcreteOutput</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Output.html#OwnerType"><span class="hs-identifier hs-type">OwnerType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818237"><span class="hs-identifier hs-type">out</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679818239"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Output.html#ValueType"><span class="hs-identifier hs-type">ValueType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818237"><span class="hs-identifier hs-type">out</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Output.html#ReferenceScriptType"><span class="hs-identifier hs-type">ReferenceScriptType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818237"><span class="hs-identifier hs-type">out</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-267"></span><span id="resolveTypedDatum"><span class="annot"><span class="annottext">resolveTypedDatum :: forall out (m :: * -&gt; *) a.
(IsAbstractOutput out, ToOutputDatum (DatumType out),
 MonadBlockChainBalancing m, FromData a) =&gt;
out
-&gt; m (Maybe
        (ConcreteOutput
           (OwnerType out) a (ValueType out) (ReferenceScriptType out)))
</span><a href="Cooked.MockChain.BlockChain.html#resolveTypedDatum"><span class="hs-identifier hs-var hs-var">resolveTypedDatum</span></a></span></span><span> </span><span id="local-6989586621679818916"><span class="annot"><span class="annottext">out
</span><a href="#local-6989586621679818916"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-268"></span><span>  </span><span id="local-6989586621679818917"><span class="annot"><span class="annottext">Maybe
  (ConcreteOutput
     (OwnerType out) Datum (ValueType out) (ReferenceScriptType out))
</span><a href="#local-6989586621679818917"><span class="hs-identifier hs-var">mOut</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">out
-&gt; m (Maybe
        (ConcreteOutput
           (OwnerType out) Datum (ValueType out) (ReferenceScriptType out)))
forall out (m :: * -&gt; *).
(IsAbstractOutput out, ToOutputDatum (DatumType out),
 MonadBlockChainBalancing m) =&gt;
out
-&gt; m (Maybe
        (ConcreteOutput
           (OwnerType out) Datum (ValueType out) (ReferenceScriptType out)))
</span><a href="Cooked.MockChain.BlockChain.html#resolveDatum"><span class="hs-identifier hs-var">resolveDatum</span></a></span><span> </span><span class="annot"><span class="annottext">out
</span><a href="#local-6989586621679818916"><span class="hs-identifier hs-var">out</span></a></span><span>
</span><span id="line-269"></span><span>  </span><span class="annot"><span class="annottext">Maybe
  (ConcreteOutput
     (OwnerType out) a (ValueType out) (ReferenceScriptType out))
-&gt; m (Maybe
        (ConcreteOutput
           (OwnerType out) a (ValueType out) (ReferenceScriptType out)))
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe
   (ConcreteOutput
      (OwnerType out) a (ValueType out) (ReferenceScriptType out))
 -&gt; m (Maybe
         (ConcreteOutput
            (OwnerType out) a (ValueType out) (ReferenceScriptType out))))
-&gt; Maybe
     (ConcreteOutput
        (OwnerType out) a (ValueType out) (ReferenceScriptType out))
-&gt; m (Maybe
        (ConcreteOutput
           (OwnerType out) a (ValueType out) (ReferenceScriptType out)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-270"></span><span>    </span><span id="local-6989586621679818918"><span class="annot"><span class="annottext">ConcreteOutput
  (OwnerType out) Datum (ValueType out) (ReferenceScriptType out)
</span><a href="#local-6989586621679818918"><span class="hs-identifier hs-var">out'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe
  (ConcreteOutput
     (OwnerType out) Datum (ValueType out) (ReferenceScriptType out))
</span><a href="#local-6989586621679818917"><span class="hs-identifier hs-var">mOut</span></a></span><span>
</span><span id="line-271"></span><span>    </span><span class="annot"><span class="annottext">out
-&gt; a
-&gt; ConcreteOutput
     (OwnerType out) a (ValueType out) (ReferenceScriptType out)
forall out dat.
IsAbstractOutput out =&gt;
out
-&gt; dat
-&gt; ConcreteOutput
     (OwnerType out) dat (ValueType out) (ReferenceScriptType out)
</span><a href="Cooked.Output.html#setDatum"><span class="hs-identifier hs-var">setDatum</span></a></span><span> </span><span class="annot"><span class="annottext">out
</span><a href="#local-6989586621679818916"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="annot"><span class="annottext">(a
 -&gt; ConcreteOutput
      (OwnerType out) a (ValueType out) (ReferenceScriptType out))
-&gt; Maybe a
-&gt; Maybe
     (ConcreteOutput
        (OwnerType out) a (ValueType out) (ReferenceScriptType out))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">BuiltinData -&gt; Maybe a
forall a. FromData a =&gt; BuiltinData -&gt; Maybe a
</span><span class="hs-identifier hs-var">Api.fromBuiltinData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Datum -&gt; BuiltinData
</span><span class="hs-identifier hs-var">Api.getDatum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConcreteOutput
  (OwnerType out) Datum (ValueType out) (ReferenceScriptType out)
</span><a href="#local-6989586621679818918"><span class="hs-identifier hs-var">out'</span></a></span><span> </span><span class="annot"><span class="annottext">ConcreteOutput
  (OwnerType out) Datum (ValueType out) (ReferenceScriptType out)
-&gt; Optic'
     A_Lens
     NoIx
     (ConcreteOutput
        (OwnerType out) Datum (ValueType out) (ReferenceScriptType out))
     Datum
-&gt; Datum
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic'
  A_Lens
  NoIx
  (ConcreteOutput
     (OwnerType out) Datum (ValueType out) (ReferenceScriptType out))
  Datum
Lens'
  (ConcreteOutput
     (OwnerType out) Datum (ValueType out) (ReferenceScriptType out))
  (DatumType
     (ConcreteOutput
        (OwnerType out) Datum (ValueType out) (ReferenceScriptType out)))
forall o. IsAbstractOutput o =&gt; Lens' o (DatumType o)
</span><a href="Cooked.Output.html#outputDatumL"><span class="hs-identifier hs-var">outputDatumL</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span class="hs-comment">-- | Tries to resolve the validator that owns an output: If the output is owned by</span><span>
</span><span id="line-274"></span><span class="hs-comment">-- a public key, or if the validator's hash is not known (i.e. if</span><span>
</span><span id="line-275"></span><span class="hs-comment">-- 'scriptFromHash' returns @Nothing@) return @Nothing@.</span><span>
</span><span id="line-276"></span><span id="local-6989586621679818262"><span id="local-6989586621679818264"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#resolveValidator"><span class="hs-identifier hs-type">resolveValidator</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cooked.Output.html#IsAbstractOutput"><span class="hs-identifier hs-type">IsAbstractOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818262"><span class="hs-identifier hs-type">out</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-278"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Script.ToCredential</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Output.html#OwnerType"><span class="hs-identifier hs-type">OwnerType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818262"><span class="hs-identifier hs-type">out</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-279"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-type">MonadBlockChainBalancing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818264"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-280"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-281"></span><span>  </span><span class="annot"><a href="#local-6989586621679818262"><span class="hs-identifier hs-type">out</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-282"></span><span>  </span><span class="annot"><a href="#local-6989586621679818264"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Output.html#ConcreteOutput"><span class="hs-identifier hs-type">ConcreteOutput</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Script.Versioned</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script.Validator</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Output.html#DatumType"><span class="hs-identifier hs-type">DatumType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818262"><span class="hs-identifier hs-type">out</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Output.html#ValueType"><span class="hs-identifier hs-type">ValueType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818262"><span class="hs-identifier hs-type">out</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Output.html#ReferenceScriptType"><span class="hs-identifier hs-type">ReferenceScriptType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818262"><span class="hs-identifier hs-type">out</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-283"></span><span id="resolveValidator"><span class="annot"><span class="annottext">resolveValidator :: forall out (m :: * -&gt; *).
(IsAbstractOutput out, ToCredential (OwnerType out),
 MonadBlockChainBalancing m) =&gt;
out
-&gt; m (Maybe
        (ConcreteOutput
           (Versioned Validator)
           (DatumType out)
           (ValueType out)
           (ReferenceScriptType out)))
</span><a href="Cooked.MockChain.BlockChain.html#resolveValidator"><span class="hs-identifier hs-var hs-var">resolveValidator</span></a></span></span><span> </span><span id="local-6989586621679818939"><span class="annot"><span class="annottext">out
</span><a href="#local-6989586621679818939"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-284"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">OwnerType out -&gt; Credential
forall a. ToCredential a =&gt; a -&gt; Credential
</span><span class="hs-identifier hs-var">Script.toCredential</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">out
</span><a href="#local-6989586621679818939"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="annot"><span class="annottext">out -&gt; Optic' A_Lens NoIx out (OwnerType out) -&gt; OwnerType out
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx out (OwnerType out)
forall o. IsAbstractOutput o =&gt; Lens' o (OwnerType o)
</span><a href="Cooked.Output.html#outputOwnerL"><span class="hs-identifier hs-var">outputOwnerL</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-285"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Api.PubKeyCredential</span></span><span> </span><span class="annot"><span class="annottext">PubKeyHash
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe
  (ConcreteOutput
     (Versioned Validator)
     (DatumType out)
     (ValueType out)
     (ReferenceScriptType out))
-&gt; m (Maybe
        (ConcreteOutput
           (Versioned Validator)
           (DatumType out)
           (ValueType out)
           (ReferenceScriptType out)))
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe
  (ConcreteOutput
     (Versioned Validator)
     (DatumType out)
     (ValueType out)
     (ReferenceScriptType out))
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-286"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Api.ScriptCredential</span></span><span> </span><span id="local-6989586621679818944"><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621679818944"><span class="hs-identifier hs-var">scriptHash</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-287"></span><span>      </span><span id="local-6989586621679818945"><span class="annot"><span class="annottext">Maybe (Versioned Script)
</span><a href="#local-6989586621679818945"><span class="hs-identifier hs-var">mVal</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ScriptHash -&gt; m (Maybe (Versioned Script))
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
ScriptHash -&gt; m (Maybe (Versioned Script))
</span><a href="Cooked.MockChain.BlockChain.html#scriptFromHash"><span class="hs-identifier hs-var">scriptFromHash</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621679818944"><span class="hs-identifier hs-var">scriptHash</span></a></span><span>
</span><span id="line-288"></span><span>      </span><span class="annot"><span class="annottext">Maybe
  (ConcreteOutput
     (Versioned Validator)
     (DatumType out)
     (ValueType out)
     (ReferenceScriptType out))
-&gt; m (Maybe
        (ConcreteOutput
           (Versioned Validator)
           (DatumType out)
           (ValueType out)
           (ReferenceScriptType out)))
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe
   (ConcreteOutput
      (Versioned Validator)
      (DatumType out)
      (ValueType out)
      (ReferenceScriptType out))
 -&gt; m (Maybe
         (ConcreteOutput
            (Versioned Validator)
            (DatumType out)
            (ValueType out)
            (ReferenceScriptType out))))
-&gt; Maybe
     (ConcreteOutput
        (Versioned Validator)
        (DatumType out)
        (ValueType out)
        (ReferenceScriptType out))
-&gt; m (Maybe
        (ConcreteOutput
           (Versioned Validator)
           (DatumType out)
           (ValueType out)
           (ReferenceScriptType out)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-289"></span><span>        </span><span id="local-6989586621679818946"><span class="annot"><span class="annottext">Versioned Script
</span><a href="#local-6989586621679818946"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (Versioned Script)
</span><a href="#local-6989586621679818945"><span class="hs-identifier hs-var">mVal</span></a></span><span>
</span><span id="line-290"></span><span>        </span><span class="annot"><span class="annottext">ConcreteOutput
  (Versioned Validator)
  (DatumType out)
  (ValueType out)
  (ReferenceScriptType out)
-&gt; Maybe
     (ConcreteOutput
        (Versioned Validator)
        (DatumType out)
        (ValueType out)
        (ReferenceScriptType out))
forall a. a -&gt; Maybe a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ConcreteOutput
   (Versioned Validator)
   (DatumType out)
   (ValueType out)
   (ReferenceScriptType out)
 -&gt; Maybe
      (ConcreteOutput
         (Versioned Validator)
         (DatumType out)
         (ValueType out)
         (ReferenceScriptType out)))
-&gt; ConcreteOutput
     (Versioned Validator)
     (DatumType out)
     (ValueType out)
     (ReferenceScriptType out)
-&gt; Maybe
     (ConcreteOutput
        (Versioned Validator)
        (DatumType out)
        (ValueType out)
        (ReferenceScriptType out))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">out
-&gt; ConcreteOutput
     (OwnerType out)
     (DatumType out)
     (ValueType out)
     (ReferenceScriptType out)
forall out.
IsAbstractOutput out =&gt;
out
-&gt; ConcreteOutput
     (OwnerType out)
     (DatumType out)
     (ValueType out)
     (ReferenceScriptType out)
</span><a href="Cooked.Output.html#fromAbstractOutput"><span class="hs-identifier hs-var">fromAbstractOutput</span></a></span><span> </span><span class="annot"><span class="annottext">out
</span><a href="#local-6989586621679818939"><span class="hs-identifier hs-var">out</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cooked.Output.html#concreteOutputOwner"><span class="hs-identifier hs-var">concreteOutputOwner</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script.toVersioned</span></span><span> </span><span class="annot"><a href="#local-6989586621679818946"><span class="hs-identifier hs-type">val</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span class="hs-comment">-- | Tries to resolve the reference script on an output: If the output has no</span><span>
</span><span id="line-293"></span><span class="hs-comment">-- reference script, or if the reference script's hash is not known (i.e. if</span><span>
</span><span id="line-294"></span><span class="hs-comment">-- 'scriptFromHash' returns 'Nothing'), this function will return 'Nothing'.</span><span>
</span><span id="line-295"></span><span id="local-6989586621679818278"><span id="local-6989586621679818280"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#resolveReferenceScript"><span class="hs-identifier hs-type">resolveReferenceScript</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-296"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cooked.Output.html#IsAbstractOutput"><span class="hs-identifier hs-type">IsAbstractOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818278"><span class="hs-identifier hs-type">out</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-297"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Script.ToScriptHash</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Output.html#ReferenceScriptType"><span class="hs-identifier hs-type">ReferenceScriptType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818278"><span class="hs-identifier hs-type">out</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-298"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-type">MonadBlockChainBalancing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818280"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-299"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-300"></span><span>  </span><span class="annot"><a href="#local-6989586621679818278"><span class="hs-identifier hs-type">out</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-301"></span><span>  </span><span class="annot"><a href="#local-6989586621679818280"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Output.html#ConcreteOutput"><span class="hs-identifier hs-type">ConcreteOutput</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Output.html#OwnerType"><span class="hs-identifier hs-type">OwnerType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818278"><span class="hs-identifier hs-type">out</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Output.html#DatumType"><span class="hs-identifier hs-type">DatumType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818278"><span class="hs-identifier hs-type">out</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Output.html#ValueType"><span class="hs-identifier hs-type">ValueType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818278"><span class="hs-identifier hs-type">out</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Script.Versioned</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script.Validator</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-302"></span><span id="resolveReferenceScript"><span class="annot"><span class="annottext">resolveReferenceScript :: forall out (m :: * -&gt; *).
(IsAbstractOutput out, ToScriptHash (ReferenceScriptType out),
 MonadBlockChainBalancing m) =&gt;
out
-&gt; m (Maybe
        (ConcreteOutput
           (OwnerType out)
           (DatumType out)
           (ValueType out)
           (Versioned Validator)))
</span><a href="Cooked.MockChain.BlockChain.html#resolveReferenceScript"><span class="hs-identifier hs-var hs-var">resolveReferenceScript</span></a></span></span><span> </span><span id="local-6989586621679818965"><span class="annot"><span class="annottext">out
</span><a href="#local-6989586621679818965"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679818966"><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621679818966"><span class="hs-identifier hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">out -&gt; Maybe ScriptHash
forall o.
(IsAbstractOutput o, ToScriptHash (ReferenceScriptType o)) =&gt;
o -&gt; Maybe ScriptHash
</span><a href="Cooked.Output.html#outputReferenceScriptHash"><span class="hs-identifier hs-var">outputReferenceScriptHash</span></a></span><span> </span><span class="annot"><span class="annottext">out
</span><a href="#local-6989586621679818965"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-303"></span><span>  </span><span id="local-6989586621679818968"><span class="annot"><span class="annottext">Maybe (Versioned Script)
</span><a href="#local-6989586621679818968"><span class="hs-identifier hs-var">mVal</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ScriptHash -&gt; m (Maybe (Versioned Script))
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
ScriptHash -&gt; m (Maybe (Versioned Script))
</span><a href="Cooked.MockChain.BlockChain.html#scriptFromHash"><span class="hs-identifier hs-var">scriptFromHash</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621679818966"><span class="hs-identifier hs-var">hash</span></a></span><span>
</span><span id="line-304"></span><span>  </span><span class="annot"><span class="annottext">Maybe
  (ConcreteOutput
     (OwnerType out)
     (DatumType out)
     (ValueType out)
     (Versioned Validator))
-&gt; m (Maybe
        (ConcreteOutput
           (OwnerType out)
           (DatumType out)
           (ValueType out)
           (Versioned Validator)))
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe
   (ConcreteOutput
      (OwnerType out)
      (DatumType out)
      (ValueType out)
      (Versioned Validator))
 -&gt; m (Maybe
         (ConcreteOutput
            (OwnerType out)
            (DatumType out)
            (ValueType out)
            (Versioned Validator))))
-&gt; Maybe
     (ConcreteOutput
        (OwnerType out)
        (DatumType out)
        (ValueType out)
        (Versioned Validator))
-&gt; m (Maybe
        (ConcreteOutput
           (OwnerType out)
           (DatumType out)
           (ValueType out)
           (Versioned Validator)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-305"></span><span>    </span><span id="local-6989586621679818969"><span class="annot"><span class="annottext">Versioned Script
</span><a href="#local-6989586621679818969"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (Versioned Script)
</span><a href="#local-6989586621679818968"><span class="hs-identifier hs-var">mVal</span></a></span><span>
</span><span id="line-306"></span><span>    </span><span class="annot"><span class="annottext">ConcreteOutput
  (OwnerType out)
  (DatumType out)
  (ValueType out)
  (Versioned Validator)
-&gt; Maybe
     (ConcreteOutput
        (OwnerType out)
        (DatumType out)
        (ValueType out)
        (Versioned Validator))
forall a. a -&gt; Maybe a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ConcreteOutput
   (OwnerType out)
   (DatumType out)
   (ValueType out)
   (Versioned Validator)
 -&gt; Maybe
      (ConcreteOutput
         (OwnerType out)
         (DatumType out)
         (ValueType out)
         (Versioned Validator)))
-&gt; ConcreteOutput
     (OwnerType out)
     (DatumType out)
     (ValueType out)
     (Versioned Validator)
-&gt; Maybe
     (ConcreteOutput
        (OwnerType out)
        (DatumType out)
        (ValueType out)
        (Versioned Validator))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">out
-&gt; ConcreteOutput
     (OwnerType out)
     (DatumType out)
     (ValueType out)
     (ReferenceScriptType out)
forall out.
IsAbstractOutput out =&gt;
out
-&gt; ConcreteOutput
     (OwnerType out)
     (DatumType out)
     (ValueType out)
     (ReferenceScriptType out)
</span><a href="Cooked.Output.html#fromAbstractOutput"><span class="hs-identifier hs-var">fromAbstractOutput</span></a></span><span> </span><span class="annot"><span class="annottext">out
</span><a href="#local-6989586621679818965"><span class="hs-identifier hs-var">out</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cooked.Output.html#concreteOutputReferenceScript"><span class="hs-identifier hs-var">concreteOutputReferenceScript</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script.toVersioned</span></span><span> </span><span class="annot"><a href="#local-6989586621679818969"><span class="hs-identifier hs-type">val</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-307"></span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#resolveReferenceScript"><span class="hs-identifier hs-var">resolveReferenceScript</span></a></span><span> </span><span class="annot"><span class="annottext">out
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe
  (ConcreteOutput
     (OwnerType out)
     (DatumType out)
     (ValueType out)
     (Versioned Validator))
-&gt; m (Maybe
        (ConcreteOutput
           (OwnerType out)
           (DatumType out)
           (ValueType out)
           (Versioned Validator)))
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe
  (ConcreteOutput
     (OwnerType out)
     (DatumType out)
     (ValueType out)
     (Versioned Validator))
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span class="annot"><span class="hs-comment">-- | Extracts a potential 'Api.OutputDatum' from a given 'Api.TxOutRef'</span></span><span>
</span><span id="line-310"></span><span id="local-6989586621679818284"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#outputDatumFromTxOutRef"><span class="hs-identifier hs-type">outputDatumFromTxOutRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-type">MonadBlockChainBalancing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818284"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOutRef</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818284"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.OutputDatum</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-311"></span><span id="outputDatumFromTxOutRef"><span class="annot"><span class="annottext">outputDatumFromTxOutRef :: forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
TxOutRef -&gt; m (Maybe OutputDatum)
</span><a href="Cooked.MockChain.BlockChain.html#outputDatumFromTxOutRef"><span class="hs-identifier hs-var hs-var">outputDatumFromTxOutRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut -&gt; OutputDatum
forall o.
(IsAbstractOutput o, ToOutputDatum (DatumType o)) =&gt;
o -&gt; OutputDatum
</span><a href="Cooked.Output.html#outputOutputDatum"><span class="hs-identifier hs-var">outputOutputDatum</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; OutputDatum) -&gt; Maybe TxOut -&gt; Maybe OutputDatum
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe TxOut -&gt; Maybe OutputDatum)
-&gt; m (Maybe TxOut) -&gt; m (Maybe OutputDatum)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m (Maybe TxOut) -&gt; m (Maybe OutputDatum))
-&gt; (TxOutRef -&gt; m (Maybe TxOut))
-&gt; TxOutRef
-&gt; m (Maybe OutputDatum)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; m (Maybe TxOut)
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
TxOutRef -&gt; m (Maybe TxOut)
</span><a href="Cooked.MockChain.BlockChain.html#txOutByRef"><span class="hs-identifier hs-var">txOutByRef</span></a></span><span>
</span><span id="line-312"></span><span>
</span><span id="line-313"></span><span class="annot"><span class="hs-comment">-- | Extracts a potential 'Api.Datum' from a given 'Api.TxOutRef'</span></span><span>
</span><span id="line-314"></span><span id="local-6989586621679818286"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#datumFromTxOutRef"><span class="hs-identifier hs-type">datumFromTxOutRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-type">MonadBlockChainBalancing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818286"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOutRef</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818286"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.Datum</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-315"></span><span id="datumFromTxOutRef"><span class="annot"><span class="annottext">datumFromTxOutRef :: forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
TxOutRef -&gt; m (Maybe Datum)
</span><a href="Cooked.MockChain.BlockChain.html#datumFromTxOutRef"><span class="hs-identifier hs-var hs-var">datumFromTxOutRef</span></a></span></span><span> </span><span id="local-6989586621679818995"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679818995"><span class="hs-identifier hs-var">oref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-316"></span><span>  </span><span id="local-6989586621679818996"><span class="annot"><span class="annottext">Maybe OutputDatum
</span><a href="#local-6989586621679818996"><span class="hs-identifier hs-var">mOutputDatum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; m (Maybe OutputDatum)
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
TxOutRef -&gt; m (Maybe OutputDatum)
</span><a href="Cooked.MockChain.BlockChain.html#outputDatumFromTxOutRef"><span class="hs-identifier hs-var">outputDatumFromTxOutRef</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679818995"><span class="hs-identifier hs-var">oref</span></a></span><span>
</span><span id="line-317"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe OutputDatum
</span><a href="#local-6989586621679818996"><span class="hs-identifier hs-var">mOutputDatum</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-318"></span><span>    </span><span class="annot"><span class="annottext">Maybe OutputDatum
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Datum -&gt; m (Maybe Datum)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Datum
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-319"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">OutputDatum
</span><span class="hs-identifier hs-var">Api.NoOutputDatum</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Datum -&gt; m (Maybe Datum)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Datum
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-320"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Api.OutputDatum</span></span><span> </span><span id="local-6989586621679818997"><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679818997"><span class="hs-identifier hs-var">datum</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Datum -&gt; m (Maybe Datum)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Datum -&gt; m (Maybe Datum)) -&gt; Maybe Datum -&gt; m (Maybe Datum)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Datum -&gt; Maybe Datum
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679818997"><span class="hs-identifier hs-var">datum</span></a></span><span>
</span><span id="line-321"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Api.OutputDatumHash</span></span><span> </span><span id="local-6989586621679818998"><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679818998"><span class="hs-identifier hs-var">datumHash</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DatumHash -&gt; m (Maybe Datum)
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
DatumHash -&gt; m (Maybe Datum)
</span><a href="Cooked.MockChain.BlockChain.html#datumFromHash"><span class="hs-identifier hs-var">datumFromHash</span></a></span><span> </span><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679818998"><span class="hs-identifier hs-var">datumHash</span></a></span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span class="hs-comment">-- | Like 'datumFromTxOutRef', but uses 'Api.fromBuiltinData' to attempt to</span><span>
</span><span id="line-324"></span><span class="hs-comment">-- deserialize this datum into a given type</span><span>
</span><span id="line-325"></span><span id="local-6989586621679818288"><span id="local-6989586621679818289"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#typedDatumFromTxOutRef"><span class="hs-identifier hs-type">typedDatumFromTxOutRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Api.FromData</span></span><span> </span><span class="annot"><a href="#local-6989586621679818288"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-type">MonadBlockChainBalancing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818289"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOutRef</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818289"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679818288"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-326"></span><span id="typedDatumFromTxOutRef"><span class="annot"><span class="annottext">typedDatumFromTxOutRef :: forall a (m :: * -&gt; *).
(FromData a, MonadBlockChainBalancing m) =&gt;
TxOutRef -&gt; m (Maybe a)
</span><a href="Cooked.MockChain.BlockChain.html#typedDatumFromTxOutRef"><span class="hs-identifier hs-var hs-var">typedDatumFromTxOutRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Datum -&gt; (Datum -&gt; Maybe a) -&gt; Maybe a
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Api.Datum</span></span><span> </span><span id="local-6989586621679819009"><span class="annot"><span class="annottext">BuiltinData
</span><a href="#local-6989586621679819009"><span class="hs-identifier hs-var">datum</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BuiltinData -&gt; Maybe a
forall a. FromData a =&gt; BuiltinData -&gt; Maybe a
</span><span class="hs-identifier hs-var">Api.fromBuiltinData</span></span><span> </span><span class="annot"><span class="annottext">BuiltinData
</span><a href="#local-6989586621679819009"><span class="hs-identifier hs-var">datum</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe Datum -&gt; Maybe a) -&gt; m (Maybe Datum) -&gt; m (Maybe a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m (Maybe Datum) -&gt; m (Maybe a))
-&gt; (TxOutRef -&gt; m (Maybe Datum)) -&gt; TxOutRef -&gt; m (Maybe a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; m (Maybe Datum)
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
TxOutRef -&gt; m (Maybe Datum)
</span><a href="Cooked.MockChain.BlockChain.html#datumFromTxOutRef"><span class="hs-identifier hs-var">datumFromTxOutRef</span></a></span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span class="annot"><span class="hs-comment">-- | Resolves an 'Api.TxOutRef' and extracts the value it contains</span></span><span>
</span><span id="line-329"></span><span id="local-6989586621679818292"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#valueFromTxOutRef"><span class="hs-identifier hs-type">valueFromTxOutRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-type">MonadBlockChainBalancing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818292"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOutRef</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818292"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.Value</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-330"></span><span id="valueFromTxOutRef"><span class="annot"><span class="annottext">valueFromTxOutRef :: forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
TxOutRef -&gt; m (Maybe Value)
</span><a href="Cooked.MockChain.BlockChain.html#valueFromTxOutRef"><span class="hs-identifier hs-var hs-var">valueFromTxOutRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut -&gt; Value
forall o. (IsAbstractOutput o, ToValue (ValueType o)) =&gt; o -&gt; Value
</span><a href="Cooked.Output.html#outputValue"><span class="hs-identifier hs-var">outputValue</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; Value) -&gt; Maybe TxOut -&gt; Maybe Value
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe TxOut -&gt; Maybe Value) -&gt; m (Maybe TxOut) -&gt; m (Maybe Value)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m (Maybe TxOut) -&gt; m (Maybe Value))
-&gt; (TxOutRef -&gt; m (Maybe TxOut)) -&gt; TxOutRef -&gt; m (Maybe Value)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; m (Maybe TxOut)
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
TxOutRef -&gt; m (Maybe TxOut)
</span><a href="Cooked.MockChain.BlockChain.html#txOutByRef"><span class="hs-identifier hs-var">txOutByRef</span></a></span><span>
</span><span id="line-331"></span><span>
</span><span id="line-332"></span><span class="annot"><span class="hs-comment">-- | Resolves all the inputs of a given 'Cooked.Skeleton.TxSkel'</span></span><span>
</span><span id="line-333"></span><span id="local-6989586621679818296"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#txSkelInputUtxos"><span class="hs-identifier hs-type">txSkelInputUtxos</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-type">MonadBlockChainBalancing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818296"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cooked.Skeleton.html#TxSkel"><span class="hs-identifier hs-type">TxSkel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818296"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOutRef</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOut</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-334"></span><span id="txSkelInputUtxos"><span class="annot"><span class="annottext">txSkelInputUtxos :: forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
TxSkel -&gt; m (Map TxOutRef TxOut)
</span><a href="Cooked.MockChain.BlockChain.html#txSkelInputUtxos"><span class="hs-identifier hs-var hs-var">txSkelInputUtxos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TxOutRef] -&gt; m (Map TxOutRef TxOut)
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
[TxOutRef] -&gt; m (Map TxOutRef TxOut)
</span><a href="Cooked.MockChain.BlockChain.html#lookupUtxos"><span class="hs-identifier hs-var">lookupUtxos</span></a></span><span> </span><span class="annot"><span class="annottext">([TxOutRef] -&gt; m (Map TxOutRef TxOut))
-&gt; (TxSkel -&gt; [TxOutRef]) -&gt; TxSkel -&gt; m (Map TxOutRef TxOut)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map TxOutRef TxSkelRedeemer -&gt; [TxOutRef]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">Map.keys</span></span><span> </span><span class="annot"><span class="annottext">(Map TxOutRef TxSkelRedeemer -&gt; [TxOutRef])
-&gt; (TxSkel -&gt; Map TxOutRef TxSkelRedeemer) -&gt; TxSkel -&gt; [TxOutRef]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TxSkel -&gt; Map TxOutRef TxSkelRedeemer
</span><a href="Cooked.Skeleton.html#txSkelIns"><span class="hs-identifier hs-var">txSkelIns</span></a></span><span>
</span><span id="line-335"></span><span>
</span><span id="line-336"></span><span class="annot"><span class="hs-comment">-- | Resolves all the reference inputs of a given 'Cooked.Skeleton.TxSkel'</span></span><span>
</span><span id="line-337"></span><span id="local-6989586621679819028"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#txSkelReferenceInputUtxos"><span class="hs-identifier hs-type">txSkelReferenceInputUtxos</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-type">MonadBlockChainBalancing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679819028"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cooked.Skeleton.html#TxSkel"><span class="hs-identifier hs-type">TxSkel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679819028"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOutRef</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOut</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-338"></span><span id="txSkelReferenceInputUtxos"><span class="annot"><span class="annottext">txSkelReferenceInputUtxos :: forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
TxSkel -&gt; m (Map TxOutRef TxOut)
</span><a href="Cooked.MockChain.BlockChain.html#txSkelReferenceInputUtxos"><span class="hs-identifier hs-var hs-var">txSkelReferenceInputUtxos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TxOutRef] -&gt; m (Map TxOutRef TxOut)
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
[TxOutRef] -&gt; m (Map TxOutRef TxOut)
</span><a href="Cooked.MockChain.BlockChain.html#lookupUtxos"><span class="hs-identifier hs-var">lookupUtxos</span></a></span><span> </span><span class="annot"><span class="annottext">([TxOutRef] -&gt; m (Map TxOutRef TxOut))
-&gt; (TxSkel -&gt; [TxOutRef]) -&gt; TxSkel -&gt; m (Map TxOutRef TxOut)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TxSkel -&gt; [TxOutRef]
</span><a href="Cooked.Skeleton.html#txSkelReferenceTxOutRefs"><span class="hs-identifier hs-var">txSkelReferenceTxOutRefs</span></a></span><span>
</span><span id="line-339"></span><span>
</span><span id="line-340"></span><span class="annot"><span class="hs-comment">-- | Retrieves the required deposit amount for issuing governance actions.</span></span><span>
</span><span id="line-341"></span><span id="local-6989586621679818304"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#govActionDeposit"><span class="hs-identifier hs-type">govActionDeposit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-type">MonadBlockChainBalancing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818304"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818304"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.Lovelace</span></span></span><span>
</span><span id="line-342"></span><span id="govActionDeposit"><span class="annot"><span class="annottext">govActionDeposit :: forall (m :: * -&gt; *). MonadBlockChainBalancing m =&gt; m Lovelace
</span><a href="Cooked.MockChain.BlockChain.html#govActionDeposit"><span class="hs-identifier hs-var hs-var">govActionDeposit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Lovelace
</span><span class="hs-identifier hs-var">Api.Lovelace</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Lovelace) -&gt; (Params -&gt; Integer) -&gt; Params -&gt; Lovelace
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Integer
</span><span class="hs-identifier hs-var">Cardano.unCoin</span></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Integer) -&gt; (Params -&gt; Coin) -&gt; Params -&gt; Integer
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Getting Coin (PParams EmulatorEra) Coin
-&gt; PParams EmulatorEra -&gt; Coin
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">Lens.view</span></span><span> </span><span class="annot"><span class="annottext">Getting Coin (PParams EmulatorEra) Coin
forall era. ConwayEraPParams era =&gt; Lens' (PParams era) Coin
Lens' (PParams EmulatorEra) Coin
</span><span class="hs-identifier hs-var">Conway.ppGovActionDepositL</span></span><span> </span><span class="annot"><span class="annottext">(PParams EmulatorEra -&gt; Coin)
-&gt; (Params -&gt; PParams EmulatorEra) -&gt; Params -&gt; Coin
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Params -&gt; PParams EmulatorEra
</span><span class="hs-identifier hs-var">Emulator.emulatorPParams</span></span><span> </span><span class="annot"><span class="annottext">(Params -&gt; Lovelace) -&gt; m Params -&gt; m Lovelace
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m Params
forall (m :: * -&gt; *). MonadBlockChainBalancing m =&gt; m Params
</span><a href="Cooked.MockChain.BlockChain.html#getParams"><span class="hs-identifier hs-var">getParams</span></a></span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span class="hs-comment">-- | Retrieves the total amount of lovelace deposited in proposals in this</span><span>
</span><span id="line-345"></span><span class="hs-comment">-- skeleton (equal to `govActionDeposit` times the number of proposals).</span><span>
</span><span id="line-346"></span><span id="local-6989586621679818322"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#txSkelProposalsDeposit"><span class="hs-identifier hs-type">txSkelProposalsDeposit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-type">MonadBlockChainBalancing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818322"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cooked.Skeleton.html#TxSkel"><span class="hs-identifier hs-type">TxSkel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818322"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.Lovelace</span></span></span><span>
</span><span id="line-347"></span><span id="txSkelProposalsDeposit"><span class="annot"><span class="annottext">txSkelProposalsDeposit :: forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
TxSkel -&gt; m Lovelace
</span><a href="Cooked.MockChain.BlockChain.html#txSkelProposalsDeposit"><span class="hs-identifier hs-var hs-var">txSkelProposalsDeposit</span></a></span></span><span> </span><span class="annot"><a href="Cooked.Skeleton.html#TxSkel"><span class="hs-identifier hs-type">TxSkel</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679819063"><span id="local-6989586621679819064"><span id="local-6989586621679819065"><span id="local-6989586621679819066"><span id="local-6989586621679819067"><span id="local-6989586621679819068"><span id="local-6989586621679819069"><span id="local-6989586621679819070"><span id="local-6989586621679819071"><span id="local-6989586621679819072"><span class="annot"><span class="annottext">[Wallet]
[TxSkelProposal]
[TxSkelOut]
Set TxOutRef
Set TxLabel
TxSkelWithdrawals
Map TxOutRef TxSkelRedeemer
TxSkelMints
SlotRange
TxOpts
txSkelIns :: TxSkel -&gt; Map TxOutRef TxSkelRedeemer
txSkelLabel :: Set TxLabel
txSkelOpts :: TxOpts
txSkelMints :: TxSkelMints
txSkelSigners :: [Wallet]
txSkelValidityRange :: SlotRange
txSkelIns :: Map TxOutRef TxSkelRedeemer
txSkelInsReference :: Set TxOutRef
txSkelOuts :: [TxSkelOut]
txSkelProposals :: [TxSkelProposal]
txSkelWithdrawals :: TxSkelWithdrawals
txSkelLabel :: TxSkel -&gt; Set TxLabel
txSkelOpts :: TxSkel -&gt; TxOpts
txSkelMints :: TxSkel -&gt; TxSkelMints
txSkelSigners :: TxSkel -&gt; [Wallet]
txSkelValidityRange :: TxSkel -&gt; SlotRange
txSkelInsReference :: TxSkel -&gt; Set TxOutRef
txSkelOuts :: TxSkel -&gt; [TxSkelOut]
txSkelProposals :: TxSkel -&gt; [TxSkelProposal]
txSkelWithdrawals :: TxSkel -&gt; TxSkelWithdrawals
</span><a href="Cooked.Skeleton.html#txSkelIns"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Lovelace
</span><span class="hs-identifier hs-var">Api.Lovelace</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Lovelace)
-&gt; (Lovelace -&gt; Integer) -&gt; Lovelace -&gt; Lovelace
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><span class="hs-identifier hs-var">toInteger</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TxSkelProposal] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[TxSkelProposal]
</span><a href="#local-6989586621679819071"><span class="hs-identifier hs-var">txSkelProposals</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Integer)
-&gt; (Lovelace -&gt; Integer) -&gt; Lovelace -&gt; Integer
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Lovelace -&gt; Integer
</span><span class="hs-identifier hs-var">Api.getLovelace</span></span><span> </span><span class="annot"><span class="annottext">(Lovelace -&gt; Lovelace) -&gt; m Lovelace -&gt; m Lovelace
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m Lovelace
forall (m :: * -&gt; *). MonadBlockChainBalancing m =&gt; m Lovelace
</span><a href="Cooked.MockChain.BlockChain.html#govActionDeposit"><span class="hs-identifier hs-var">govActionDeposit</span></a></span><span>
</span><span id="line-348"></span><span>
</span><span id="line-349"></span><span class="annot"><span class="hs-comment">-- | Converts 'Nothing' to an error</span></span><span>
</span><span id="line-350"></span><span id="local-6989586621679818336"><span id="local-6989586621679818337"><span id="local-6989586621679818338"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#maybeErrM"><span class="hs-identifier hs-type">maybeErrM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-type">MonadBlockChainBalancing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818336"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MockChainError"><span class="hs-identifier hs-type">MockChainError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679818337"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818338"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818336"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679818337"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818336"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818338"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-351"></span><span id="maybeErrM"><span class="annot"><span class="annottext">maybeErrM :: forall (m :: * -&gt; *) a b.
MonadBlockChainBalancing m =&gt;
MockChainError -&gt; (a -&gt; b) -&gt; m (Maybe a) -&gt; m b
</span><a href="Cooked.MockChain.BlockChain.html#maybeErrM"><span class="hs-identifier hs-var hs-var">maybeErrM</span></a></span></span><span> </span><span id="local-6989586621679819093"><span class="annot"><span class="annottext">MockChainError
</span><a href="#local-6989586621679819093"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span id="local-6989586621679819094"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679819094"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m b -&gt; (a -&gt; m b) -&gt; Maybe a -&gt; m b
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MockChainError -&gt; m b
forall a. MockChainError -&gt; m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">MockChainError
</span><a href="#local-6989586621679819093"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; m b
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(b -&gt; m b) -&gt; (a -&gt; b) -&gt; a -&gt; m b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679819094"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe a -&gt; m b) -&gt; m (Maybe a) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span class="annot"><span class="hs-comment">-- | Returns all validators which protect transaction inputs</span></span><span>
</span><span id="line-354"></span><span id="local-6989586621679818350"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#txSkelInputValidators"><span class="hs-identifier hs-type">txSkelInputValidators</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-type">MonadBlockChainBalancing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818350"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cooked.Skeleton.html#TxSkel"><span class="hs-identifier hs-type">TxSkel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818350"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script.ValidatorHash</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Script.Versioned</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script.Validator</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-355"></span><span id="txSkelInputValidators"><span class="annot"><span class="annottext">txSkelInputValidators :: forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
TxSkel -&gt; m (Map ValidatorHash (Versioned Validator))
</span><a href="Cooked.MockChain.BlockChain.html#txSkelInputValidators"><span class="hs-identifier hs-var hs-var">txSkelInputValidators</span></a></span></span><span> </span><span id="local-6989586621679819124"><span class="annot"><span class="annottext">TxSkel
</span><a href="#local-6989586621679819124"><span class="hs-identifier hs-var">skel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-356"></span><span>  </span><span id="local-6989586621679819125"><span class="annot"><span class="annottext">[(TxOutRef, TxOut)]
</span><a href="#local-6989586621679819125"><span class="hs-identifier hs-var">utxos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map TxOutRef TxOut -&gt; [(TxOutRef, TxOut)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">(Map TxOutRef TxOut -&gt; [(TxOutRef, TxOut)])
-&gt; m (Map TxOutRef TxOut) -&gt; m [(TxOutRef, TxOut)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[TxOutRef] -&gt; m (Map TxOutRef TxOut)
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
[TxOutRef] -&gt; m (Map TxOutRef TxOut)
</span><a href="Cooked.MockChain.BlockChain.html#lookupUtxos"><span class="hs-identifier hs-var">lookupUtxos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map TxOutRef TxSkelRedeemer -&gt; [TxOutRef]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">Map.keys</span></span><span> </span><span class="annot"><span class="annottext">(Map TxOutRef TxSkelRedeemer -&gt; [TxOutRef])
-&gt; (TxSkel -&gt; Map TxOutRef TxSkelRedeemer) -&gt; TxSkel -&gt; [TxOutRef]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TxSkel -&gt; Map TxOutRef TxSkelRedeemer
</span><a href="Cooked.Skeleton.html#txSkelIns"><span class="hs-identifier hs-var">txSkelIns</span></a></span><span> </span><span class="annot"><span class="annottext">(TxSkel -&gt; [TxOutRef]) -&gt; TxSkel -&gt; [TxOutRef]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TxSkel
</span><a href="#local-6989586621679819124"><span class="hs-identifier hs-var">skel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>  </span><span class="annot"><span class="annottext">[(ValidatorHash, Versioned Validator)]
-&gt; Map ValidatorHash (Versioned Validator)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(ValidatorHash, Versioned Validator)]
 -&gt; Map ValidatorHash (Versioned Validator))
-&gt; ([Maybe (ValidatorHash, Versioned Validator)]
    -&gt; [(ValidatorHash, Versioned Validator)])
-&gt; [Maybe (ValidatorHash, Versioned Validator)]
-&gt; Map ValidatorHash (Versioned Validator)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Maybe (ValidatorHash, Versioned Validator)]
-&gt; [(ValidatorHash, Versioned Validator)]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span>
</span><span id="line-358"></span><span>    </span><span class="annot"><span class="annottext">([Maybe (ValidatorHash, Versioned Validator)]
 -&gt; Map ValidatorHash (Versioned Validator))
-&gt; m [Maybe (ValidatorHash, Versioned Validator)]
-&gt; m (Map ValidatorHash (Versioned Validator))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">((TxOutRef, TxOut)
 -&gt; m (Maybe (ValidatorHash, Versioned Validator)))
-&gt; [(TxOutRef, TxOut)]
-&gt; m [Maybe (ValidatorHash, Versioned Validator)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span>
</span><span id="line-359"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679819130"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679819130"><span class="hs-identifier hs-var">_oref</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679819131"><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621679819131"><span class="hs-identifier hs-var">out</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TxOut -&gt; Address
forall o.
(IsAbstractOutput o, ToCredential (OwnerType o)) =&gt;
o -&gt; Address
</span><a href="Cooked.Output.html#outputAddress"><span class="hs-identifier hs-var">outputAddress</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621679819131"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-360"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Api.Address</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Api.ScriptCredential</span></span><span> </span><span id="local-6989586621679819134"><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621679819134"><span class="hs-identifier hs-var">sHash</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe StakingCredential
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-361"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679819135"><span class="annot"><span class="annottext">valHash :: ValidatorHash
</span><a href="#local-6989586621679819135"><span class="hs-identifier hs-var hs-var">valHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScriptHash -&gt; ValidatorHash
forall a. ToValidatorHash a =&gt; a -&gt; ValidatorHash
</span><span class="hs-identifier hs-var">Script.toValidatorHash</span></span><span> </span><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621679819134"><span class="hs-identifier hs-var">sHash</span></a></span><span>
</span><span id="line-362"></span><span>            </span><span class="annot"><span class="annottext">MockChainError
-&gt; (Versioned Validator
    -&gt; Maybe (ValidatorHash, Versioned Validator))
-&gt; m (Maybe (Versioned Validator))
-&gt; m (Maybe (ValidatorHash, Versioned Validator))
forall (m :: * -&gt; *) a b.
MonadBlockChainBalancing m =&gt;
MockChainError -&gt; (a -&gt; b) -&gt; m (Maybe a) -&gt; m b
</span><a href="Cooked.MockChain.BlockChain.html#maybeErrM"><span class="hs-identifier hs-var">maybeErrM</span></a></span><span>
</span><span id="line-363"></span><span>              </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String -&gt; ValidatorHash -&gt; MockChainError
</span><a href="Cooked.MockChain.BlockChain.html#MCEUnknownValidator"><span class="hs-identifier hs-var">MCEUnknownValidator</span></a></span><span>
</span><span id="line-364"></span><span>                  </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;txSkelInputValidators: unknown validator hash on transaction input&quot;</span></span><span>
</span><span id="line-365"></span><span>                  </span><span class="annot"><span class="annottext">ValidatorHash
</span><a href="#local-6989586621679819135"><span class="hs-identifier hs-var">valHash</span></a></span><span>
</span><span id="line-366"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ValidatorHash, Versioned Validator)
-&gt; Maybe (ValidatorHash, Versioned Validator)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">((ValidatorHash, Versioned Validator)
 -&gt; Maybe (ValidatorHash, Versioned Validator))
-&gt; (Versioned Validator -&gt; (ValidatorHash, Versioned Validator))
-&gt; Versioned Validator
-&gt; Maybe (ValidatorHash, Versioned Validator)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValidatorHash
</span><a href="#local-6989586621679819135"><span class="hs-identifier hs-var">valHash</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Versioned Script -&gt; Versioned Validator)
-&gt; Maybe (Versioned Script) -&gt; Maybe (Versioned Validator)
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Versioned Script -&gt; Versioned Validator
forall s a. ToVersioned s a =&gt; a -&gt; Versioned s
</span><span class="hs-identifier hs-var">Script.toVersioned</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Versioned Script) -&gt; Maybe (Versioned Validator))
-&gt; m (Maybe (Versioned Script)) -&gt; m (Maybe (Versioned Validator))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ScriptHash -&gt; m (Maybe (Versioned Script))
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
ScriptHash -&gt; m (Maybe (Versioned Script))
</span><a href="Cooked.MockChain.BlockChain.html#scriptFromHash"><span class="hs-identifier hs-var">scriptFromHash</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621679819134"><span class="hs-identifier hs-var">sHash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>          </span><span class="annot"><span class="annottext">Address
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (ValidatorHash, Versioned Validator)
-&gt; m (Maybe (ValidatorHash, Versioned Validator))
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (ValidatorHash, Versioned Validator)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-370"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-371"></span><span>      </span><span class="annot"><span class="annottext">[(TxOutRef, TxOut)]
</span><a href="#local-6989586621679819125"><span class="hs-identifier hs-var">utxos</span></a></span><span>
</span><span id="line-372"></span><span>
</span><span id="line-373"></span><span class="hs-comment">-- | Go through all of the 'Api.TxOutRef's in the list and look them up in the</span><span>
</span><span id="line-374"></span><span class="hs-comment">-- state of the blockchain, throwing an error if one of them cannot be resolved.</span><span>
</span><span id="line-375"></span><span id="local-6989586621679818299"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#lookupUtxos"><span class="hs-identifier hs-type">lookupUtxos</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-type">MonadBlockChainBalancing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818299"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Api.TxOutRef</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818299"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOutRef</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOut</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-376"></span><span id="lookupUtxos"><span class="annot"><span class="annottext">lookupUtxos :: forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
[TxOutRef] -&gt; m (Map TxOutRef TxOut)
</span><a href="Cooked.MockChain.BlockChain.html#lookupUtxos"><span class="hs-identifier hs-var hs-var">lookupUtxos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-377"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(TxOutRef, TxOut)] -&gt; Map TxOutRef TxOut
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(TxOutRef, TxOut)] -&gt; Map TxOutRef TxOut)
-&gt; m [(TxOutRef, TxOut)] -&gt; m (Map TxOutRef TxOut)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span class="hs-special">)</span><span>
</span><span id="line-378"></span><span>    </span><span class="annot"><span class="annottext">(m [(TxOutRef, TxOut)] -&gt; m (Map TxOutRef TxOut))
-&gt; ([TxOutRef] -&gt; m [(TxOutRef, TxOut)])
-&gt; [TxOutRef]
-&gt; m (Map TxOutRef TxOut)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(TxOutRef -&gt; m (TxOutRef, TxOut))
-&gt; [TxOutRef] -&gt; m [(TxOutRef, TxOut)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679819150"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679819150"><span class="hs-identifier hs-var">oRef</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679819150"><span class="hs-identifier hs-var">oRef</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; (TxOutRef, TxOut)) -&gt; m TxOut -&gt; m (TxOutRef, TxOut)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MockChainError -&gt; (TxOut -&gt; TxOut) -&gt; m (Maybe TxOut) -&gt; m TxOut
forall (m :: * -&gt; *) a b.
MonadBlockChainBalancing m =&gt;
MockChainError -&gt; (a -&gt; b) -&gt; m (Maybe a) -&gt; m b
</span><a href="Cooked.MockChain.BlockChain.html#maybeErrM"><span class="hs-identifier hs-var">maybeErrM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; TxOutRef -&gt; MockChainError
</span><a href="Cooked.MockChain.BlockChain.html#MCEUnknownOutRefError"><span class="hs-identifier hs-var">MCEUnknownOutRefError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lookupUtxos: unknown TxOutRef&quot;</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679819150"><span class="hs-identifier hs-var">oRef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxOut -&gt; TxOut
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef -&gt; m (Maybe TxOut)
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
TxOutRef -&gt; m (Maybe TxOut)
</span><a href="Cooked.MockChain.BlockChain.html#txOutByRef"><span class="hs-identifier hs-var">txOutByRef</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679819150"><span class="hs-identifier hs-var">oRef</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-379"></span><span>
</span><span id="line-380"></span><span class="annot"><span class="hs-comment">-- | look up the UTxOs the transaction consumes, and sum their values.</span></span><span>
</span><span id="line-381"></span><span id="local-6989586621679818371"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#txSkelInputValue"><span class="hs-identifier hs-type">txSkelInputValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-type">MonadBlockChainBalancing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818371"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cooked.Skeleton.html#TxSkel"><span class="hs-identifier hs-type">TxSkel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818371"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.Value</span></span></span><span>
</span><span id="line-382"></span><span id="txSkelInputValue"><span class="annot"><span class="annottext">txSkelInputValue :: forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
TxSkel -&gt; m Value
</span><a href="Cooked.MockChain.BlockChain.html#txSkelInputValue"><span class="hs-identifier hs-var hs-var">txSkelInputValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TxOut -&gt; Value) -&gt; Map TxOutRef TxOut -&gt; Value
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; Map TxOutRef a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">TxOut -&gt; Value
</span><span class="hs-identifier hs-var">Api.txOutValue</span></span><span> </span><span class="annot"><span class="annottext">(Map TxOutRef TxOut -&gt; Value) -&gt; m (Map TxOutRef TxOut) -&gt; m Value
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m (Map TxOutRef TxOut) -&gt; m Value)
-&gt; (TxSkel -&gt; m (Map TxOutRef TxOut)) -&gt; TxSkel -&gt; m Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TxSkel -&gt; m (Map TxOutRef TxOut)
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
TxSkel -&gt; m (Map TxOutRef TxOut)
</span><a href="Cooked.MockChain.BlockChain.html#txSkelInputUtxos"><span class="hs-identifier hs-var">txSkelInputUtxos</span></a></span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span class="hs-comment">-- | Looks up the data on UTxOs the transaction consumes and returns their</span><span>
</span><span id="line-385"></span><span class="hs-comment">-- hashes.</span><span>
</span><span id="line-386"></span><span id="local-6989586621679818376"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#txSkelInputDataAsHashes"><span class="hs-identifier hs-type">txSkelInputDataAsHashes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-type">MonadBlockChainBalancing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818376"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cooked.Skeleton.html#TxSkel"><span class="hs-identifier hs-type">TxSkel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818376"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Api.DatumHash</span></span><span class="hs-special">]</span></span><span>
</span><span id="line-387"></span><span id="txSkelInputDataAsHashes"><span class="annot"><span class="annottext">txSkelInputDataAsHashes :: forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
TxSkel -&gt; m [DatumHash]
</span><a href="Cooked.MockChain.BlockChain.html#txSkelInputDataAsHashes"><span class="hs-identifier hs-var hs-var">txSkelInputDataAsHashes</span></a></span></span><span> </span><span id="local-6989586621679819174"><span class="annot"><span class="annottext">TxSkel
</span><a href="#local-6989586621679819174"><span class="hs-identifier hs-var">skel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-388"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679819180"><span class="annot"><span class="annottext">outputToDatumHash :: s -&gt; Maybe DatumHash
</span><a href="#local-6989586621679819180"><span class="hs-identifier hs-var hs-var">outputToDatumHash</span></a></span></span><span> </span><span id="local-6989586621679819181"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679819181"><span class="hs-identifier hs-var">output</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679819181"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="annot"><span class="annottext">s -&gt; Optic' A_Lens NoIx s OutputDatum -&gt; OutputDatum
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx s OutputDatum
Lens' s (DatumType s)
forall o. IsAbstractOutput o =&gt; Lens' o (DatumType o)
</span><a href="Cooked.Output.html#outputDatumL"><span class="hs-identifier hs-var">outputDatumL</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-389"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Api.OutputDatumHash</span></span><span> </span><span id="local-6989586621679819182"><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679819182"><span class="hs-identifier hs-var">dHash</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DatumHash -&gt; Maybe DatumHash
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679819182"><span class="hs-identifier hs-var">dHash</span></a></span><span>
</span><span id="line-390"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Api.OutputDatum</span></span><span> </span><span id="local-6989586621679819183"><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679819183"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DatumHash -&gt; Maybe DatumHash
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(DatumHash -&gt; Maybe DatumHash) -&gt; DatumHash -&gt; Maybe DatumHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Datum -&gt; DatumHash
</span><span class="hs-identifier hs-var">Script.datumHash</span></span><span> </span><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679819183"><span class="hs-identifier hs-var">datum</span></a></span><span>
</span><span id="line-391"></span><span>        </span><span class="annot"><span class="annottext">OutputDatum
</span><span class="hs-identifier hs-var">Api.NoOutputDatum</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe DatumHash
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-392"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map TxOutRef TxOut -&gt; [TxOut]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">Map.elems</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679819186"><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621679819186"><span class="hs-identifier hs-var">inputTxOuts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxSkel -&gt; m (Map TxOutRef TxOut)
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
TxSkel -&gt; m (Map TxOutRef TxOut)
</span><a href="Cooked.MockChain.BlockChain.html#txSkelInputUtxos"><span class="hs-identifier hs-var">txSkelInputUtxos</span></a></span><span> </span><span class="annot"><span class="annottext">TxSkel
</span><a href="#local-6989586621679819174"><span class="hs-identifier hs-var">skel</span></a></span><span>
</span><span id="line-393"></span><span>  </span><span class="annot"><span class="annottext">[DatumHash] -&gt; m [DatumHash]
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([DatumHash] -&gt; m [DatumHash]) -&gt; [DatumHash] -&gt; m [DatumHash]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; Maybe DatumHash) -&gt; [TxOut] -&gt; [DatumHash]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">TxOut -&gt; Maybe DatumHash
forall {s}.
(DatumType s ~ OutputDatum, IsAbstractOutput s) =&gt;
s -&gt; Maybe DatumHash
</span><a href="#local-6989586621679819180"><span class="hs-identifier hs-var">outputToDatumHash</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621679819186"><span class="hs-identifier hs-var">inputTxOuts</span></a></span><span>
</span><span id="line-394"></span><span>
</span><span id="line-395"></span><span class="annot"><span class="hs-comment">-- | This creates a payment from an existing UTXO</span></span><span>
</span><span id="line-396"></span><span id="local-6989586621679818385"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#txOutRefToTxSkelOut"><span class="hs-identifier hs-type">txOutRefToTxSkelOut</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-397"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-type">MonadBlockChainBalancing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818385"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-398"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The UTXO to translate</span></span><span>
</span><span id="line-399"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOutRef</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-400"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Whether to include the datum in the transaction</span></span><span>
</span><span id="line-401"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-402"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Whether to allow further adjustment of the Ada value</span></span><span>
</span><span id="line-403"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-404"></span><span>  </span><span class="annot"><a href="#local-6989586621679818385"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Cooked.Skeleton.Output.html#TxSkelOut"><span class="hs-identifier hs-type">TxSkelOut</span></a></span></span><span>
</span><span id="line-405"></span><span id="txOutRefToTxSkelOut"><span class="annot"><span class="annottext">txOutRefToTxSkelOut :: forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
TxOutRef -&gt; Bool -&gt; Bool -&gt; m TxSkelOut
</span><a href="Cooked.MockChain.BlockChain.html#txOutRefToTxSkelOut"><span class="hs-identifier hs-var hs-var">txOutRefToTxSkelOut</span></a></span></span><span> </span><span id="local-6989586621679819289"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679819289"><span class="hs-identifier hs-var">oRef</span></a></span></span><span> </span><span id="local-6989586621679819290"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679819290"><span class="hs-identifier hs-var">includeInTransactionBody</span></a></span></span><span> </span><span id="local-6989586621679819291"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679819291"><span class="hs-identifier hs-var">allowAdaAdjustment</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-406"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679819292"><span class="annot"><span class="annottext">txOut :: TxOut
</span><a href="#local-6989586621679819292"><span class="hs-identifier hs-var">txOut</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Api.TxOut</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Api.Address</span></span><span> </span><span id="local-6989586621679819294"><span class="annot"><span class="annottext">Credential
</span><a href="#local-6989586621679819294"><span class="hs-identifier hs-var">cred</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe StakingCredential
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679819295"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679819295"><span class="hs-identifier hs-var">value</span></a></span></span><span> </span><span id="local-6989586621679819296"><span class="annot"><span class="annottext">OutputDatum
</span><a href="#local-6989586621679819296"><span class="hs-identifier hs-var">dat</span></a></span></span><span> </span><span id="local-6989586621679819297"><span class="annot"><span class="annottext">Maybe ScriptHash
</span><a href="#local-6989586621679819297"><span class="hs-identifier hs-var">refS</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; m (Maybe TxOut)
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
TxOutRef -&gt; m (Maybe TxOut)
</span><a href="Cooked.MockChain.BlockChain.html#txOutByRef"><span class="hs-identifier hs-var">txOutByRef</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679819289"><span class="hs-identifier hs-var">oRef</span></a></span><span>
</span><span id="line-407"></span><span>  </span><span id="local-6989586621679819298"><span class="annot"><span class="annottext">Either PubKeyHash (Versioned Validator)
</span><a href="#local-6989586621679819298"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Credential
</span><a href="#local-6989586621679819294"><span class="hs-identifier hs-var">cred</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-408"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Api.PubKeyCredential</span></span><span> </span><span id="local-6989586621679819299"><span class="annot"><span class="annottext">PubKeyHash
</span><a href="#local-6989586621679819299"><span class="hs-identifier hs-var">pkh</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either PubKeyHash (Versioned Validator)
-&gt; m (Either PubKeyHash (Versioned Validator))
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either PubKeyHash (Versioned Validator)
 -&gt; m (Either PubKeyHash (Versioned Validator)))
-&gt; Either PubKeyHash (Versioned Validator)
-&gt; m (Either PubKeyHash (Versioned Validator))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PubKeyHash -&gt; Either PubKeyHash (Versioned Validator)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">PubKeyHash
</span><a href="#local-6989586621679819299"><span class="hs-identifier hs-var">pkh</span></a></span><span>
</span><span id="line-409"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Api.ScriptCredential</span></span><span> </span><span id="local-6989586621679819300"><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621679819300"><span class="hs-identifier hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-410"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679819301"><span class="annot"><span class="annottext">Versioned Script
</span><a href="#local-6989586621679819301"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ScriptHash -&gt; m (Maybe (Versioned Script))
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
ScriptHash -&gt; m (Maybe (Versioned Script))
</span><a href="Cooked.MockChain.BlockChain.html#scriptFromHash"><span class="hs-identifier hs-var">scriptFromHash</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621679819300"><span class="hs-identifier hs-var">hash</span></a></span><span>
</span><span id="line-411"></span><span>      </span><span class="annot"><span class="annottext">Either PubKeyHash (Versioned Validator)
-&gt; m (Either PubKeyHash (Versioned Validator))
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either PubKeyHash (Versioned Validator)
 -&gt; m (Either PubKeyHash (Versioned Validator)))
-&gt; Either PubKeyHash (Versioned Validator)
-&gt; m (Either PubKeyHash (Versioned Validator))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Versioned Validator -&gt; Either PubKeyHash (Versioned Validator)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(Versioned Validator -&gt; Either PubKeyHash (Versioned Validator))
-&gt; Versioned Validator -&gt; Either PubKeyHash (Versioned Validator)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s a. ToVersioned s a =&gt; a -&gt; Versioned s
</span><span class="hs-identifier hs-var">Script.toVersioned</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Script.Validator</span></span><span> </span><span class="annot"><span class="annottext">Versioned Script
</span><a href="#local-6989586621679819301"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-412"></span><span>  </span><span id="local-6989586621679819302"><span class="annot"><span class="annottext">TxSkelOutDatum
</span><a href="#local-6989586621679819302"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">OutputDatum
</span><a href="#local-6989586621679819296"><span class="hs-identifier hs-var">dat</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-413"></span><span>    </span><span class="annot"><span class="annottext">OutputDatum
</span><span class="hs-identifier hs-var">Api.NoOutputDatum</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxSkelOutDatum -&gt; m TxSkelOutDatum
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TxSkelOutDatum
</span><a href="Cooked.Skeleton.Datum.html#TxSkelOutNoDatum"><span class="hs-identifier hs-var">TxSkelOutNoDatum</span></a></span><span>
</span><span id="line-414"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Api.OutputDatumHash</span></span><span> </span><span id="local-6989586621679819304"><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679819304"><span class="hs-identifier hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-415"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Api.Datum</span></span><span> </span><span id="local-6989586621679819305"><span class="annot"><span class="annottext">BuiltinData
</span><a href="#local-6989586621679819305"><span class="hs-identifier hs-var">dat'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DatumHash -&gt; m (Maybe Datum)
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
DatumHash -&gt; m (Maybe Datum)
</span><a href="Cooked.MockChain.BlockChain.html#datumFromHash"><span class="hs-identifier hs-var">datumFromHash</span></a></span><span> </span><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679819304"><span class="hs-identifier hs-var">hash</span></a></span><span>
</span><span id="line-416"></span><span>      </span><span class="annot"><span class="annottext">TxSkelOutDatum -&gt; m TxSkelOutDatum
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(TxSkelOutDatum -&gt; m TxSkelOutDatum)
-&gt; TxSkelOutDatum -&gt; m TxSkelOutDatum
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679819290"><span class="hs-identifier hs-var">includeInTransactionBody</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">BuiltinData -&gt; TxSkelOutDatum
forall a. TxSkelOutDatumConstrs a =&gt; a -&gt; TxSkelOutDatum
</span><a href="Cooked.Skeleton.Datum.html#TxSkelOutDatum"><span class="hs-identifier hs-var">TxSkelOutDatum</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">BuiltinData -&gt; TxSkelOutDatum
forall a. TxSkelOutDatumConstrs a =&gt; a -&gt; TxSkelOutDatum
</span><a href="Cooked.Skeleton.Datum.html#TxSkelOutDatumHash"><span class="hs-identifier hs-var">TxSkelOutDatumHash</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BuiltinData
</span><a href="#local-6989586621679819305"><span class="hs-identifier hs-var">dat'</span></a></span><span>
</span><span id="line-417"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Api.OutputDatum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Api.Datum</span></span><span> </span><span id="local-6989586621679819308"><span class="annot"><span class="annottext">BuiltinData
</span><a href="#local-6989586621679819308"><span class="hs-identifier hs-var">dat'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxSkelOutDatum -&gt; m TxSkelOutDatum
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(TxSkelOutDatum -&gt; m TxSkelOutDatum)
-&gt; TxSkelOutDatum -&gt; m TxSkelOutDatum
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BuiltinData -&gt; TxSkelOutDatum
forall a. TxSkelOutDatumConstrs a =&gt; a -&gt; TxSkelOutDatum
</span><a href="Cooked.Skeleton.Datum.html#TxSkelOutInlineDatum"><span class="hs-identifier hs-var">TxSkelOutInlineDatum</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinData
</span><a href="#local-6989586621679819308"><span class="hs-identifier hs-var">dat'</span></a></span><span>
</span><span id="line-418"></span><span>  </span><span id="local-6989586621679819310"><span class="annot"><span class="annottext">Maybe (Versioned Script)
</span><a href="#local-6989586621679819310"><span class="hs-identifier hs-var">refScript</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ScriptHash
</span><a href="#local-6989586621679819297"><span class="hs-identifier hs-var">refS</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-419"></span><span>    </span><span class="annot"><span class="annottext">Maybe ScriptHash
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Versioned Script) -&gt; m (Maybe (Versioned Script))
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Versioned Script)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-420"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679819311"><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621679819311"><span class="hs-identifier hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ScriptHash -&gt; m (Maybe (Versioned Script))
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
ScriptHash -&gt; m (Maybe (Versioned Script))
</span><a href="Cooked.MockChain.BlockChain.html#scriptFromHash"><span class="hs-identifier hs-var">scriptFromHash</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621679819311"><span class="hs-identifier hs-var">hash</span></a></span><span>
</span><span id="line-421"></span><span>  </span><span class="annot"><span class="annottext">TxSkelOut -&gt; m TxSkelOut
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(TxSkelOut -&gt; m TxSkelOut) -&gt; TxSkelOut -&gt; m TxSkelOut
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-422"></span><span>    </span><span class="annot"><span class="annottext">ConcreteOutput
  (Either PubKeyHash (Versioned Validator))
  TxSkelOutDatum
  TxSkelOutValue
  (Versioned Script)
-&gt; TxSkelOut
forall o.
(Show o, Typeable o, IsTxInfoOutput o,
 OwnerConstraints (OwnerType o), DatumType o ~ TxSkelOutDatum,
 ValueType o ~ TxSkelOutValue,
 ReferenceScriptConstraints (ReferenceScriptType o)) =&gt;
o -&gt; TxSkelOut
</span><a href="Cooked.Skeleton.Output.html#Pays"><span class="hs-identifier hs-var">Pays</span></a></span><span> </span><span class="annot"><span class="annottext">(ConcreteOutput
   (Either PubKeyHash (Versioned Validator))
   TxSkelOutDatum
   TxSkelOutValue
   (Versioned Script)
 -&gt; TxSkelOut)
-&gt; ConcreteOutput
     (Either PubKeyHash (Versioned Validator))
     TxSkelOutDatum
     TxSkelOutValue
     (Versioned Script)
-&gt; TxSkelOut
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-423"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut
-&gt; ConcreteOutput
     (OwnerType TxOut)
     (DatumType TxOut)
     (ValueType TxOut)
     (ReferenceScriptType TxOut)
forall out.
IsAbstractOutput out =&gt;
out
-&gt; ConcreteOutput
     (OwnerType out)
     (DatumType out)
     (ValueType out)
     (ReferenceScriptType out)
</span><a href="Cooked.Output.html#fromAbstractOutput"><span class="hs-identifier hs-var">fromAbstractOutput</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621679819292"><span class="hs-identifier hs-var">txOut</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-424"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Cooked.Output.html#concreteOutputOwner"><span class="hs-identifier hs-var">concreteOutputOwner</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679819298"><span class="hs-identifier hs-type">target</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-425"></span><span>          </span><span class="annot"><a href="Cooked.Output.html#concreteOutputValue"><span class="hs-identifier hs-var">concreteOutputValue</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Cooked.Skeleton.Value.html#TxSkelOutValue"><span class="hs-identifier hs-type">TxSkelOutValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679819295"><span class="hs-identifier hs-type">value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679819291"><span class="hs-identifier hs-type">allowAdaAdjustment</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-426"></span><span>          </span><span class="annot"><a href="Cooked.Output.html#concreteOutputDatum"><span class="hs-identifier hs-var">concreteOutputDatum</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679819302"><span class="hs-identifier hs-type">datum</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-427"></span><span>          </span><span class="annot"><a href="Cooked.Output.html#concreteOutputReferenceScript"><span class="hs-identifier hs-var">concreteOutputReferenceScript</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679819310"><span class="hs-identifier hs-type">refScript</span></a></span><span>
</span><span id="line-428"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-429"></span><span>
</span><span id="line-430"></span><span class="hs-comment">-- | A default version of 'txOutRefToTxSkelOut' where we both include the datum</span><span>
</span><span id="line-431"></span><span class="hs-comment">-- in the transaction if it was hashed in the 'Api.TxOut', and allow further ADA</span><span>
</span><span id="line-432"></span><span class="hs-comment">-- adjustment in case changes in the output require it.</span><span>
</span><span id="line-433"></span><span id="local-6989586621679818417"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#txOutRefToTxSkelOut%27"><span class="hs-identifier hs-type">txOutRefToTxSkelOut'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-type">MonadBlockChainBalancing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818417"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOutRef</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818417"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Cooked.Skeleton.Output.html#TxSkelOut"><span class="hs-identifier hs-type">TxSkelOut</span></a></span></span><span>
</span><span id="line-434"></span><span id="txOutRefToTxSkelOut%27"><span class="annot"><span class="annottext">txOutRefToTxSkelOut' :: forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
TxOutRef -&gt; m TxSkelOut
</span><a href="Cooked.MockChain.BlockChain.html#txOutRefToTxSkelOut%27"><span class="hs-identifier hs-var hs-var">txOutRefToTxSkelOut'</span></a></span></span><span> </span><span id="local-6989586621679819318"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679819318"><span class="hs-identifier hs-var">oRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; Bool -&gt; Bool -&gt; m TxSkelOut
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
TxOutRef -&gt; Bool -&gt; Bool -&gt; m TxSkelOut
</span><a href="Cooked.MockChain.BlockChain.html#txOutRefToTxSkelOut"><span class="hs-identifier hs-var">txOutRefToTxSkelOut</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679819318"><span class="hs-identifier hs-var">oRef</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-435"></span><span>
</span><span id="line-436"></span><span class="annot"><span class="hs-comment">-- * Slot and Time Management</span></span><span>
</span><span id="line-437"></span><span>
</span><span id="line-438"></span><span class="hs-comment">-- $slotandtime</span><span>
</span><span id="line-439"></span><span class="hs-comment">-- #slotandtime#</span><span>
</span><span id="line-440"></span><span class="hs-comment">--</span><span>
</span><span id="line-441"></span><span class="hs-comment">-- Slots are integers that monotonically increase and model the passage of</span><span>
</span><span id="line-442"></span><span class="hs-comment">-- time. By looking at the current slot, a validator gets to know that it is</span><span>
</span><span id="line-443"></span><span class="hs-comment">-- being executed within a certain window of wall-clock time. Things can get</span><span>
</span><span id="line-444"></span><span class="hs-comment">-- annoying pretty fast when trying to mock traces and trying to exercise</span><span>
</span><span id="line-445"></span><span class="hs-comment">-- certain branches of certain validators; make sure you also read the docs on</span><span>
</span><span id="line-446"></span><span class="hs-comment">-- 'autoSlotIncrease' to be able to simulate sending transactions in parallel.</span><span>
</span><span id="line-447"></span><span>
</span><span id="line-448"></span><span class="annot"><span class="hs-comment">-- | Moves n slots fowards</span></span><span>
</span><span id="line-449"></span><span id="local-6989586621679818419"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#waitNSlots"><span class="hs-identifier hs-type">waitNSlots</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainWithoutValidation"><span class="hs-identifier hs-type">MonadBlockChainWithoutValidation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818419"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818419"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.Slot</span></span></span><span>
</span><span id="line-450"></span><span id="waitNSlots"><span class="annot"><span class="annottext">waitNSlots :: forall (m :: * -&gt; *).
MonadBlockChainWithoutValidation m =&gt;
Integer -&gt; m Slot
</span><a href="Cooked.MockChain.BlockChain.html#waitNSlots"><span class="hs-identifier hs-var hs-var">waitNSlots</span></a></span></span><span> </span><span id="local-6989586621679819335"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679819335"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-451"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679819335"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-452"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; m Slot
forall a. String -&gt; m a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;waitNSlots: negative argument&quot;</span></span><span>
</span><span id="line-453"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">m Slot
forall (m :: * -&gt; *). MonadBlockChainWithoutValidation m =&gt; m Slot
</span><a href="Cooked.MockChain.BlockChain.html#currentSlot"><span class="hs-identifier hs-var">currentSlot</span></a></span><span> </span><span class="annot"><span class="annottext">m Slot -&gt; (Slot -&gt; m Slot) -&gt; m Slot
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Slot -&gt; m Slot
forall (m :: * -&gt; *).
MonadBlockChainWithoutValidation m =&gt;
Slot -&gt; m Slot
</span><a href="Cooked.MockChain.BlockChain.html#awaitSlot"><span class="hs-identifier hs-var">awaitSlot</span></a></span><span> </span><span class="annot"><span class="annottext">(Slot -&gt; m Slot) -&gt; (Slot -&gt; Slot) -&gt; Slot -&gt; m Slot
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slot -&gt; Slot -&gt; Slot
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Slot
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679819335"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-454"></span><span>
</span><span id="line-455"></span><span class="annot"><span class="hs-comment">-- | Returns the closed ms interval corresponding to the current slot</span></span><span>
</span><span id="line-456"></span><span id="local-6989586621679818426"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#currentTime"><span class="hs-identifier hs-type">currentTime</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainWithoutValidation"><span class="hs-identifier hs-type">MonadBlockChainWithoutValidation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818426"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818426"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Api.POSIXTime</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.POSIXTime</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-457"></span><span id="currentTime"><span class="annot"><span class="annottext">currentTime :: forall (m :: * -&gt; *).
MonadBlockChainWithoutValidation m =&gt;
m (POSIXTime, POSIXTime)
</span><a href="Cooked.MockChain.BlockChain.html#currentTime"><span class="hs-identifier hs-var hs-var">currentTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Slot -&gt; m (POSIXTime, POSIXTime)
forall (m :: * -&gt; *).
MonadBlockChainWithoutValidation m =&gt;
Slot -&gt; m (POSIXTime, POSIXTime)
</span><a href="Cooked.MockChain.BlockChain.html#slotToTimeInterval"><span class="hs-identifier hs-var">slotToTimeInterval</span></a></span><span> </span><span class="annot"><span class="annottext">(Slot -&gt; m (POSIXTime, POSIXTime))
-&gt; m Slot -&gt; m (POSIXTime, POSIXTime)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">m Slot
forall (m :: * -&gt; *). MonadBlockChainWithoutValidation m =&gt; m Slot
</span><a href="Cooked.MockChain.BlockChain.html#currentSlot"><span class="hs-identifier hs-var">currentSlot</span></a></span><span>
</span><span id="line-458"></span><span>
</span><span id="line-459"></span><span class="hs-comment">-- | Returns the closed ms interval corresponding to the slot with the given</span><span>
</span><span id="line-460"></span><span class="hs-comment">-- number. It holds that</span><span>
</span><span id="line-461"></span><span class="hs-comment">--</span><span>
</span><span id="line-462"></span><span class="hs-comment">-- &gt; slotToTimeInterval (getEnclosingSlot t) == (a, b)    ==&gt;   a &lt;= t &lt;= b</span><span>
</span><span id="line-463"></span><span class="hs-comment">--</span><span>
</span><span id="line-464"></span><span class="hs-comment">-- and</span><span>
</span><span id="line-465"></span><span class="hs-comment">--</span><span>
</span><span id="line-466"></span><span class="hs-comment">-- &gt; slotToTimeInterval n == (a, b)   ==&gt;   getEnclosingSlot a == n &amp;&amp; getEnclosingSlot b == n</span><span>
</span><span id="line-467"></span><span class="hs-comment">--</span><span>
</span><span id="line-468"></span><span class="hs-comment">-- and</span><span>
</span><span id="line-469"></span><span class="hs-comment">--</span><span>
</span><span id="line-470"></span><span class="hs-comment">-- &gt; slotToTimeInterval n == (a, b)   ==&gt;   getEnclosingSlot (a-1) == n-1 &amp;&amp; getEnclosingSlot (b+1) == n+1</span><span>
</span><span id="line-471"></span><span id="local-6989586621679818429"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#slotToTimeInterval"><span class="hs-identifier hs-type">slotToTimeInterval</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainWithoutValidation"><span class="hs-identifier hs-type">MonadBlockChainWithoutValidation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818429"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.Slot</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818429"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Api.POSIXTime</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.POSIXTime</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-472"></span><span id="slotToTimeInterval"><span class="annot"><span class="annottext">slotToTimeInterval :: forall (m :: * -&gt; *).
MonadBlockChainWithoutValidation m =&gt;
Slot -&gt; m (POSIXTime, POSIXTime)
</span><a href="Cooked.MockChain.BlockChain.html#slotToTimeInterval"><span class="hs-identifier hs-var hs-var">slotToTimeInterval</span></a></span></span><span> </span><span id="local-6989586621679819362"><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679819362"><span class="hs-identifier hs-var">slot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-473"></span><span>  </span><span id="local-6989586621679819363"><span class="annot"><span class="annottext">SlotConfig
</span><a href="#local-6989586621679819363"><span class="hs-identifier hs-var">slotConfig</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Params -&gt; SlotConfig
</span><span class="hs-identifier hs-var">Emulator.pSlotConfig</span></span><span> </span><span class="annot"><span class="annottext">(Params -&gt; SlotConfig) -&gt; m Params -&gt; m SlotConfig
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m Params
forall (m :: * -&gt; *). MonadBlockChainBalancing m =&gt; m Params
</span><a href="Cooked.MockChain.BlockChain.html#getParams"><span class="hs-identifier hs-var">getParams</span></a></span><span>
</span><span id="line-474"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SlotConfig -&gt; Slot -&gt; POSIXTimeRange
</span><span class="hs-identifier hs-var">Emulator.slotToPOSIXTimeRange</span></span><span> </span><span class="annot"><span class="annottext">SlotConfig
</span><a href="#local-6989586621679819363"><span class="hs-identifier hs-var">slotConfig</span></a></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679819362"><span class="hs-identifier hs-var">slot</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-475"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Api.Interval</span></span><span>
</span><span id="line-476"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Api.LowerBound</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Api.Finite</span></span><span> </span><span id="local-6989586621679819369"><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679819369"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679819370"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679819370"><span class="hs-identifier hs-var">leftclosed</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-477"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Api.UpperBound</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Api.Finite</span></span><span> </span><span id="local-6989586621679819372"><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679819372"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679819373"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679819373"><span class="hs-identifier hs-var">rightclosed</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-478"></span><span>        </span><span class="annot"><span class="annottext">(POSIXTime, POSIXTime) -&gt; m (POSIXTime, POSIXTime)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-479"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679819370"><span class="hs-identifier hs-var">leftclosed</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679819369"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679819369"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; POSIXTime -&gt; POSIXTime
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span>
</span><span id="line-480"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679819373"><span class="hs-identifier hs-var">rightclosed</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679819372"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679819372"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; POSIXTime -&gt; POSIXTime
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><span class="hs-number">1</span></span><span>
</span><span id="line-481"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-482"></span><span>    </span><span class="annot"><span class="annottext">POSIXTimeRange
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; m (POSIXTime, POSIXTime)
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The time interval corresponding to a slot should be finite on both ends.&quot;</span></span><span>
</span><span id="line-483"></span><span>
</span><span id="line-484"></span><span class="hs-comment">-- | Return the slot that contains the given time. See 'slotToTimeInterval' for</span><span>
</span><span id="line-485"></span><span class="hs-comment">-- some satisfied equational properties.</span><span>
</span><span id="line-486"></span><span id="local-6989586621679818439"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#getEnclosingSlot"><span class="hs-identifier hs-type">getEnclosingSlot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainWithoutValidation"><span class="hs-identifier hs-type">MonadBlockChainWithoutValidation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818439"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.POSIXTime</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818439"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.Slot</span></span></span><span>
</span><span id="line-487"></span><span id="getEnclosingSlot"><span class="annot"><span class="annottext">getEnclosingSlot :: forall (m :: * -&gt; *).
MonadBlockChainWithoutValidation m =&gt;
POSIXTime -&gt; m Slot
</span><a href="Cooked.MockChain.BlockChain.html#getEnclosingSlot"><span class="hs-identifier hs-var hs-var">getEnclosingSlot</span></a></span></span><span> </span><span id="local-6989586621679819383"><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679819383"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotConfig -&gt; POSIXTime -&gt; Slot
</span><span class="hs-operator hs-var">`Emulator.posixTimeToEnclosingSlot`</span></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679819383"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SlotConfig -&gt; Slot) -&gt; (Params -&gt; SlotConfig) -&gt; Params -&gt; Slot
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Params -&gt; SlotConfig
</span><span class="hs-identifier hs-var">Emulator.pSlotConfig</span></span><span> </span><span class="annot"><span class="annottext">(Params -&gt; Slot) -&gt; m Params -&gt; m Slot
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m Params
forall (m :: * -&gt; *). MonadBlockChainBalancing m =&gt; m Params
</span><a href="Cooked.MockChain.BlockChain.html#getParams"><span class="hs-identifier hs-var">getParams</span></a></span><span>
</span><span id="line-488"></span><span>
</span><span id="line-489"></span><span class="hs-comment">-- | Waits until the current slot becomes greater or equal to the slot</span><span>
</span><span id="line-490"></span><span class="hs-comment">--  containing the given POSIX time.  Note that that it might not wait for</span><span>
</span><span id="line-491"></span><span class="hs-comment">--  anything if the current slot is large enough.</span><span>
</span><span id="line-492"></span><span id="local-6989586621679819385"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#awaitEnclosingSlot"><span class="hs-identifier hs-type">awaitEnclosingSlot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainWithoutValidation"><span class="hs-identifier hs-type">MonadBlockChainWithoutValidation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679819385"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.POSIXTime</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679819385"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.Slot</span></span></span><span>
</span><span id="line-493"></span><span id="awaitEnclosingSlot"><span class="annot"><span class="annottext">awaitEnclosingSlot :: forall (m :: * -&gt; *).
MonadBlockChainWithoutValidation m =&gt;
POSIXTime -&gt; m Slot
</span><a href="Cooked.MockChain.BlockChain.html#awaitEnclosingSlot"><span class="hs-identifier hs-var hs-var">awaitEnclosingSlot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Slot -&gt; m Slot
forall (m :: * -&gt; *).
MonadBlockChainWithoutValidation m =&gt;
Slot -&gt; m Slot
</span><a href="Cooked.MockChain.BlockChain.html#awaitSlot"><span class="hs-identifier hs-var">awaitSlot</span></a></span><span> </span><span class="annot"><span class="annottext">(Slot -&gt; m Slot) -&gt; (POSIXTime -&gt; m Slot) -&gt; POSIXTime -&gt; m Slot
forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&lt;=&lt;</span></span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; m Slot
forall (m :: * -&gt; *).
MonadBlockChainWithoutValidation m =&gt;
POSIXTime -&gt; m Slot
</span><a href="Cooked.MockChain.BlockChain.html#getEnclosingSlot"><span class="hs-identifier hs-var">getEnclosingSlot</span></a></span><span>
</span><span id="line-494"></span><span>
</span><span id="line-495"></span><span class="hs-comment">-- | Wait a given number of ms from the lower bound of the current slot and</span><span>
</span><span id="line-496"></span><span class="hs-comment">-- returns the current slot after waiting.</span><span>
</span><span id="line-497"></span><span id="local-6989586621679819394"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#awaitDurationFromLowerBound"><span class="hs-identifier hs-type">awaitDurationFromLowerBound</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainWithoutValidation"><span class="hs-identifier hs-type">MonadBlockChainWithoutValidation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679819394"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679819394"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.Slot</span></span></span><span>
</span><span id="line-498"></span><span id="awaitDurationFromLowerBound"><span class="annot"><span class="annottext">awaitDurationFromLowerBound :: forall (m :: * -&gt; *).
MonadBlockChainWithoutValidation m =&gt;
Integer -&gt; m Slot
</span><a href="Cooked.MockChain.BlockChain.html#awaitDurationFromLowerBound"><span class="hs-identifier hs-var hs-var">awaitDurationFromLowerBound</span></a></span></span><span> </span><span id="local-6989586621679819405"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679819405"><span class="hs-identifier hs-var">duration</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (POSIXTime, POSIXTime)
forall (m :: * -&gt; *).
MonadBlockChainWithoutValidation m =&gt;
m (POSIXTime, POSIXTime)
</span><a href="Cooked.MockChain.BlockChain.html#currentTime"><span class="hs-identifier hs-var">currentTime</span></a></span><span> </span><span class="annot"><span class="annottext">m (POSIXTime, POSIXTime)
-&gt; ((POSIXTime, POSIXTime) -&gt; m Slot) -&gt; m Slot
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; m Slot
forall (m :: * -&gt; *).
MonadBlockChainWithoutValidation m =&gt;
POSIXTime -&gt; m Slot
</span><a href="Cooked.MockChain.BlockChain.html#awaitEnclosingSlot"><span class="hs-identifier hs-var">awaitEnclosingSlot</span></a></span><span> </span><span class="annot"><span class="annottext">(POSIXTime -&gt; m Slot)
-&gt; ((POSIXTime, POSIXTime) -&gt; POSIXTime)
-&gt; (POSIXTime, POSIXTime)
-&gt; m Slot
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">POSIXTime -&gt; POSIXTime -&gt; POSIXTime
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; POSIXTime
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679819405"><span class="hs-identifier hs-var">duration</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(POSIXTime -&gt; POSIXTime)
-&gt; ((POSIXTime, POSIXTime) -&gt; POSIXTime)
-&gt; (POSIXTime, POSIXTime)
-&gt; POSIXTime
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(POSIXTime, POSIXTime) -&gt; POSIXTime
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span>
</span><span id="line-499"></span><span>
</span><span id="line-500"></span><span class="hs-comment">-- | Wait a given number of ms from the upper bound of the current slot and</span><span>
</span><span id="line-501"></span><span class="hs-comment">-- returns the current slot after waiting.</span><span>
</span><span id="line-502"></span><span id="local-6989586621679819406"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#awaitDurationFromUpperBound"><span class="hs-identifier hs-type">awaitDurationFromUpperBound</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainWithoutValidation"><span class="hs-identifier hs-type">MonadBlockChainWithoutValidation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679819406"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679819406"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.Slot</span></span></span><span>
</span><span id="line-503"></span><span id="awaitDurationFromUpperBound"><span class="annot"><span class="annottext">awaitDurationFromUpperBound :: forall (m :: * -&gt; *).
MonadBlockChainWithoutValidation m =&gt;
Integer -&gt; m Slot
</span><a href="Cooked.MockChain.BlockChain.html#awaitDurationFromUpperBound"><span class="hs-identifier hs-var hs-var">awaitDurationFromUpperBound</span></a></span></span><span> </span><span id="local-6989586621679819417"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679819417"><span class="hs-identifier hs-var">duration</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (POSIXTime, POSIXTime)
forall (m :: * -&gt; *).
MonadBlockChainWithoutValidation m =&gt;
m (POSIXTime, POSIXTime)
</span><a href="Cooked.MockChain.BlockChain.html#currentTime"><span class="hs-identifier hs-var">currentTime</span></a></span><span> </span><span class="annot"><span class="annottext">m (POSIXTime, POSIXTime)
-&gt; ((POSIXTime, POSIXTime) -&gt; m Slot) -&gt; m Slot
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; m Slot
forall (m :: * -&gt; *).
MonadBlockChainWithoutValidation m =&gt;
POSIXTime -&gt; m Slot
</span><a href="Cooked.MockChain.BlockChain.html#awaitEnclosingSlot"><span class="hs-identifier hs-var">awaitEnclosingSlot</span></a></span><span> </span><span class="annot"><span class="annottext">(POSIXTime -&gt; m Slot)
-&gt; ((POSIXTime, POSIXTime) -&gt; POSIXTime)
-&gt; (POSIXTime, POSIXTime)
-&gt; m Slot
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">POSIXTime -&gt; POSIXTime -&gt; POSIXTime
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; POSIXTime
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679819417"><span class="hs-identifier hs-var">duration</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(POSIXTime -&gt; POSIXTime)
-&gt; ((POSIXTime, POSIXTime) -&gt; POSIXTime)
-&gt; (POSIXTime, POSIXTime)
-&gt; POSIXTime
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(POSIXTime, POSIXTime) -&gt; POSIXTime
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span class="annot"><span class="hs-comment">-- | The infinite range of slots ending before or at the given time</span></span><span>
</span><span id="line-506"></span><span id="local-6989586621679818448"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#slotRangeBefore"><span class="hs-identifier hs-type">slotRangeBefore</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainWithoutValidation"><span class="hs-identifier hs-type">MonadBlockChainWithoutValidation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818448"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.POSIXTime</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679818448"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.SlotRange</span></span></span><span>
</span><span id="line-507"></span><span id="slotRangeBefore"><span class="annot"><span class="annottext">slotRangeBefore :: forall (m :: * -&gt; *).
MonadBlockChainWithoutValidation m =&gt;
POSIXTime -&gt; m SlotRange
</span><a href="Cooked.MockChain.BlockChain.html#slotRangeBefore"><span class="hs-identifier hs-var hs-var">slotRangeBefore</span></a></span></span><span> </span><span id="local-6989586621679819431"><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679819431"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-508"></span><span>  </span><span id="local-6989586621679819432"><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679819432"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; m Slot
forall (m :: * -&gt; *).
MonadBlockChainWithoutValidation m =&gt;
POSIXTime -&gt; m Slot
</span><a href="Cooked.MockChain.BlockChain.html#getEnclosingSlot"><span class="hs-identifier hs-var">getEnclosingSlot</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679819431"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-509"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">POSIXTime
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679819433"><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679819433"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Slot -&gt; m (POSIXTime, POSIXTime)
forall (m :: * -&gt; *).
MonadBlockChainWithoutValidation m =&gt;
Slot -&gt; m (POSIXTime, POSIXTime)
</span><a href="Cooked.MockChain.BlockChain.html#slotToTimeInterval"><span class="hs-identifier hs-var">slotToTimeInterval</span></a></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679819432"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-510"></span><span>  </span><span class="hs-comment">-- If the given time @t@ happens to be the last ms of its slot, we can include</span><span>
</span><span id="line-511"></span><span>  </span><span class="hs-comment">-- the whole slot. Otherwise, the only way to be sure that the returned slot</span><span>
</span><span id="line-512"></span><span>  </span><span class="hs-comment">-- range contains no time after @t@ is to go to the preceding slot.</span><span>
</span><span id="line-513"></span><span>  </span><span class="annot"><span class="annottext">SlotRange -&gt; m SlotRange
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(SlotRange -&gt; m SlotRange) -&gt; SlotRange -&gt; m SlotRange
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Slot -&gt; SlotRange
forall a. a -&gt; Interval a
</span><span class="hs-identifier hs-var">Api.to</span></span><span> </span><span class="annot"><span class="annottext">(Slot -&gt; SlotRange) -&gt; Slot -&gt; SlotRange
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679819431"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; POSIXTime -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679819433"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679819432"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679819432"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Slot -&gt; Slot -&gt; Slot
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Slot
</span><span class="hs-number">1</span></span><span>
</span><span id="line-514"></span><span>
</span><span id="line-515"></span><span class="annot"><span class="hs-comment">-- | The infinite range of slots starting after or at the given time</span></span><span>
</span><span id="line-516"></span><span id="local-6989586621679819435"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#slotRangeAfter"><span class="hs-identifier hs-type">slotRangeAfter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainWithoutValidation"><span class="hs-identifier hs-type">MonadBlockChainWithoutValidation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679819435"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.POSIXTime</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679819435"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.SlotRange</span></span></span><span>
</span><span id="line-517"></span><span id="slotRangeAfter"><span class="annot"><span class="annottext">slotRangeAfter :: forall (m :: * -&gt; *).
MonadBlockChainWithoutValidation m =&gt;
POSIXTime -&gt; m SlotRange
</span><a href="Cooked.MockChain.BlockChain.html#slotRangeAfter"><span class="hs-identifier hs-var hs-var">slotRangeAfter</span></a></span></span><span> </span><span id="local-6989586621679819448"><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679819448"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-518"></span><span>  </span><span id="local-6989586621679819449"><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679819449"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; m Slot
forall (m :: * -&gt; *).
MonadBlockChainWithoutValidation m =&gt;
POSIXTime -&gt; m Slot
</span><a href="Cooked.MockChain.BlockChain.html#getEnclosingSlot"><span class="hs-identifier hs-var">getEnclosingSlot</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679819448"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-519"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679819450"><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679819450"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Slot -&gt; m (POSIXTime, POSIXTime)
forall (m :: * -&gt; *).
MonadBlockChainWithoutValidation m =&gt;
Slot -&gt; m (POSIXTime, POSIXTime)
</span><a href="Cooked.MockChain.BlockChain.html#slotToTimeInterval"><span class="hs-identifier hs-var">slotToTimeInterval</span></a></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679819449"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-520"></span><span>  </span><span class="annot"><span class="annottext">SlotRange -&gt; m SlotRange
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(SlotRange -&gt; m SlotRange) -&gt; SlotRange -&gt; m SlotRange
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Slot -&gt; SlotRange
forall a. a -&gt; Interval a
</span><span class="hs-identifier hs-var">Api.from</span></span><span> </span><span class="annot"><span class="annottext">(Slot -&gt; SlotRange) -&gt; Slot -&gt; SlotRange
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679819448"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; POSIXTime -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679819450"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679819449"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679819449"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Slot -&gt; Slot -&gt; Slot
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Slot
</span><span class="hs-number">1</span></span><span>
</span><span id="line-521"></span><span>
</span><span id="line-522"></span><span class="annot"><span class="hs-comment">-- * Deriving further 'MonadBlockChain' instances</span></span><span>
</span><span id="line-523"></span><span>
</span><span id="line-524"></span><span class="hs-comment">-- | A newtype wrapper to be used with '-XDerivingVia' to derive instances of</span><span>
</span><span id="line-525"></span><span class="hs-comment">-- 'MonadBlockChain' for any 'MonadTransControl'.</span><span>
</span><span id="line-526"></span><span class="hs-comment">--</span><span>
</span><span id="line-527"></span><span class="hs-comment">-- For example, to derive 'MonadBlockChain m =&gt; MonadBlockChain (ReaderT r m)',</span><span>
</span><span id="line-528"></span><span class="hs-comment">-- you'd write</span><span>
</span><span id="line-529"></span><span class="hs-comment">--</span><span>
</span><span id="line-530"></span><span class="hs-comment">-- &gt; deriving via (AsTrans (ReaderT r) m) instance MonadBlockChain m =&gt; MonadBlockChain (ReaderT r m)</span><span>
</span><span id="line-531"></span><span class="hs-comment">--</span><span>
</span><span id="line-532"></span><span class="hs-comment">-- and avoid the trouble of defining all the class methods yourself.</span><span>
</span><span id="line-533"></span><span class="hs-keyword">newtype</span><span> </span><span id="AsTrans"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#AsTrans"><span class="hs-identifier hs-var">AsTrans</span></a></span></span><span> </span><span id="local-6989586621679818454"><span class="annot"><a href="#local-6989586621679818454"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679818455"><span class="annot"><a href="#local-6989586621679818455"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679818456"><span class="annot"><a href="#local-6989586621679818456"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="AsTrans"><span class="annot"><a href="Cooked.MockChain.BlockChain.html#AsTrans"><span class="hs-identifier hs-var">AsTrans</span></a></span></span><span> </span><span class="hs-special">{</span><span id="getTrans"><span class="annot"><span class="annottext">forall {k} (t :: (* -&gt; *) -&gt; k -&gt; *) (m :: * -&gt; *) (a :: k).
AsTrans t m a -&gt; t m a
</span><a href="Cooked.MockChain.BlockChain.html#getTrans"><span class="hs-identifier hs-var hs-var">getTrans</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679818454"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818455"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818456"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-534"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679819456"><span id="local-6989586621679819460"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; AsTrans t m a -&gt; AsTrans t m b)
-&gt; (forall a b. a -&gt; AsTrans t m b -&gt; AsTrans t m a)
-&gt; Functor (AsTrans t m)
forall a b. a -&gt; AsTrans t m b -&gt; AsTrans t m a
forall a b. (a -&gt; b) -&gt; AsTrans t m a -&gt; AsTrans t m b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b.
Functor (t m) =&gt;
a -&gt; AsTrans t m b -&gt; AsTrans t m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b.
Functor (t m) =&gt;
(a -&gt; b) -&gt; AsTrans t m a -&gt; AsTrans t m b
$cfmap :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b.
Functor (t m) =&gt;
(a -&gt; b) -&gt; AsTrans t m a -&gt; AsTrans t m b
fmap :: forall a b. (a -&gt; b) -&gt; AsTrans t m a -&gt; AsTrans t m b
$c&lt;$ :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b.
Functor (t m) =&gt;
a -&gt; AsTrans t m b -&gt; AsTrans t m a
&lt;$ :: forall a b. a -&gt; AsTrans t m b -&gt; AsTrans t m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679819470"><span id="local-6989586621679819474"><span id="local-6989586621679819478"><span id="local-6989586621679819482"><span id="local-6989586621679819486"><span class="annot"><span class="annottext">Functor (AsTrans t m)
Functor (AsTrans t m) =&gt;
(forall a. a -&gt; AsTrans t m a)
-&gt; (forall a b.
    AsTrans t m (a -&gt; b) -&gt; AsTrans t m a -&gt; AsTrans t m b)
-&gt; (forall a b c.
    (a -&gt; b -&gt; c) -&gt; AsTrans t m a -&gt; AsTrans t m b -&gt; AsTrans t m c)
-&gt; (forall a b. AsTrans t m a -&gt; AsTrans t m b -&gt; AsTrans t m b)
-&gt; (forall a b. AsTrans t m a -&gt; AsTrans t m b -&gt; AsTrans t m a)
-&gt; Applicative (AsTrans t m)
forall a. a -&gt; AsTrans t m a
forall a b. AsTrans t m a -&gt; AsTrans t m b -&gt; AsTrans t m a
forall a b. AsTrans t m a -&gt; AsTrans t m b -&gt; AsTrans t m b
forall a b. AsTrans t m (a -&gt; b) -&gt; AsTrans t m a -&gt; AsTrans t m b
forall a b c.
(a -&gt; b -&gt; c) -&gt; AsTrans t m a -&gt; AsTrans t m b -&gt; AsTrans t m c
forall (f :: * -&gt; *).
Functor f =&gt;
(forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *).
Applicative (t m) =&gt;
Functor (AsTrans t m)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
Applicative (t m) =&gt;
a -&gt; AsTrans t m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b.
Applicative (t m) =&gt;
AsTrans t m a -&gt; AsTrans t m b -&gt; AsTrans t m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b.
Applicative (t m) =&gt;
AsTrans t m a -&gt; AsTrans t m b -&gt; AsTrans t m b
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b.
Applicative (t m) =&gt;
AsTrans t m (a -&gt; b) -&gt; AsTrans t m a -&gt; AsTrans t m b
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b c.
Applicative (t m) =&gt;
(a -&gt; b -&gt; c) -&gt; AsTrans t m a -&gt; AsTrans t m b -&gt; AsTrans t m c
$cpure :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
Applicative (t m) =&gt;
a -&gt; AsTrans t m a
pure :: forall a. a -&gt; AsTrans t m a
$c&lt;*&gt; :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b.
Applicative (t m) =&gt;
AsTrans t m (a -&gt; b) -&gt; AsTrans t m a -&gt; AsTrans t m b
&lt;*&gt; :: forall a b. AsTrans t m (a -&gt; b) -&gt; AsTrans t m a -&gt; AsTrans t m b
$cliftA2 :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b c.
Applicative (t m) =&gt;
(a -&gt; b -&gt; c) -&gt; AsTrans t m a -&gt; AsTrans t m b -&gt; AsTrans t m c
liftA2 :: forall a b c.
(a -&gt; b -&gt; c) -&gt; AsTrans t m a -&gt; AsTrans t m b -&gt; AsTrans t m c
$c*&gt; :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b.
Applicative (t m) =&gt;
AsTrans t m a -&gt; AsTrans t m b -&gt; AsTrans t m b
*&gt; :: forall a b. AsTrans t m a -&gt; AsTrans t m b -&gt; AsTrans t m b
$c&lt;* :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b.
Applicative (t m) =&gt;
AsTrans t m a -&gt; AsTrans t m b -&gt; AsTrans t m a
&lt;* :: forall a b. AsTrans t m a -&gt; AsTrans t m b -&gt; AsTrans t m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679819496"><span id="local-6989586621679819500"><span id="local-6989586621679819504"><span class="annot"><span class="annottext">Applicative (AsTrans t m)
Applicative (AsTrans t m) =&gt;
(forall a b.
 AsTrans t m a -&gt; (a -&gt; AsTrans t m b) -&gt; AsTrans t m b)
-&gt; (forall a b. AsTrans t m a -&gt; AsTrans t m b -&gt; AsTrans t m b)
-&gt; (forall a. a -&gt; AsTrans t m a)
-&gt; Monad (AsTrans t m)
forall a. a -&gt; AsTrans t m a
forall a b. AsTrans t m a -&gt; AsTrans t m b -&gt; AsTrans t m b
forall a b. AsTrans t m a -&gt; (a -&gt; AsTrans t m b) -&gt; AsTrans t m b
forall (m :: * -&gt; *).
Applicative m =&gt;
(forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *).
Monad (t m) =&gt;
Applicative (AsTrans t m)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
Monad (t m) =&gt;
a -&gt; AsTrans t m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b.
Monad (t m) =&gt;
AsTrans t m a -&gt; AsTrans t m b -&gt; AsTrans t m b
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b.
Monad (t m) =&gt;
AsTrans t m a -&gt; (a -&gt; AsTrans t m b) -&gt; AsTrans t m b
$c&gt;&gt;= :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b.
Monad (t m) =&gt;
AsTrans t m a -&gt; (a -&gt; AsTrans t m b) -&gt; AsTrans t m b
&gt;&gt;= :: forall a b. AsTrans t m a -&gt; (a -&gt; AsTrans t m b) -&gt; AsTrans t m b
$c&gt;&gt; :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a b.
Monad (t m) =&gt;
AsTrans t m a -&gt; AsTrans t m b -&gt; AsTrans t m b
&gt;&gt; :: forall a b. AsTrans t m a -&gt; AsTrans t m b -&gt; AsTrans t m b
$creturn :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
Monad (t m) =&gt;
a -&gt; AsTrans t m a
return :: forall a. a -&gt; AsTrans t m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679819515"><span class="annot"><span class="annottext">(forall (m :: * -&gt; *). Monad m =&gt; Monad (AsTrans t m)) =&gt;
(forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; AsTrans t m a)
-&gt; MonadTrans (AsTrans t)
forall (m :: * -&gt; *). Monad m =&gt; Monad (AsTrans t m)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; AsTrans t m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *).
(MonadTrans t, Monad m) =&gt;
Monad (AsTrans t m)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; AsTrans t m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *).
(forall (m :: * -&gt; *). Monad m =&gt; Monad (t m)) =&gt;
(forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; t m a) -&gt; MonadTrans t
$clift :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; AsTrans t m a
lift :: forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; AsTrans t m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadTrans</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679819533"><span id="local-6989586621679819542"><span class="annot"><span class="annottext">MonadTrans (AsTrans t)
MonadTrans (AsTrans t) =&gt;
(forall (m :: * -&gt; *) a.
 Monad m =&gt;
 (Run (AsTrans t) -&gt; m a) -&gt; AsTrans t m a)
-&gt; (forall (m :: * -&gt; *) a.
    Monad m =&gt;
    m (StT (AsTrans t) a) -&gt; AsTrans t m a)
-&gt; MonadTransControl (AsTrans t)
forall (m :: * -&gt; *) a.
Monad m =&gt;
m (StT (AsTrans t) a) -&gt; AsTrans t m a
forall (m :: * -&gt; *) a.
Monad m =&gt;
(Run (AsTrans t) -&gt; m a) -&gt; AsTrans t m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *).
MonadTrans t =&gt;
(forall (m :: * -&gt; *) a. Monad m =&gt; (Run t -&gt; m a) -&gt; t m a)
-&gt; (forall (m :: * -&gt; *) a. Monad m =&gt; m (StT t a) -&gt; t m a)
-&gt; MonadTransControl t
forall (t :: (* -&gt; *) -&gt; * -&gt; *).
MonadTransControl t =&gt;
MonadTrans (AsTrans t)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTransControl t, Monad m) =&gt;
m (StT (AsTrans t) a) -&gt; AsTrans t m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTransControl t, Monad m) =&gt;
(Run (AsTrans t) -&gt; m a) -&gt; AsTrans t m a
$cliftWith :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTransControl t, Monad m) =&gt;
(Run (AsTrans t) -&gt; m a) -&gt; AsTrans t m a
liftWith :: forall (m :: * -&gt; *) a.
Monad m =&gt;
(Run (AsTrans t) -&gt; m a) -&gt; AsTrans t m a
$crestoreT :: forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTransControl t, Monad m) =&gt;
m (StT (AsTrans t) a) -&gt; AsTrans t m a
restoreT :: forall (m :: * -&gt; *) a.
Monad m =&gt;
m (StT (AsTrans t) a) -&gt; AsTrans t m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var">MonadTransControl</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-535"></span><span>
</span><span id="line-536"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679818538"><span id="local-6989586621679818539"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadTrans</span></span><span> </span><span class="annot"><a href="#local-6989586621679818538"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679818539"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679818538"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818539"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#AsTrans"><span class="hs-identifier hs-type">AsTrans</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818538"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818539"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-537"></span><span>  </span><span id="local-6989586621679819563"><span class="annot"><span class="annottext">fail :: forall a. String -&gt; AsTrans t m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">fail</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m a -&gt; AsTrans t m a
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; AsTrans t m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m a -&gt; AsTrans t m a)
-&gt; (String -&gt; m a) -&gt; String -&gt; AsTrans t m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; m a
forall a. String -&gt; m a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span>
</span><span id="line-538"></span><span>
</span><span id="line-539"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679818544"><span id="local-6989586621679818545"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadTransControl</span></span><span> </span><span class="annot"><a href="#local-6989586621679818544"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MockChainError"><span class="hs-identifier hs-type">MockChainError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818545"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679818544"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818545"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MockChainError"><span class="hs-identifier hs-type">MockChainError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#AsTrans"><span class="hs-identifier hs-type">AsTrans</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818544"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818545"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-540"></span><span>  </span><span id="local-6989586621679819580"><span class="annot"><span class="annottext">throwError :: forall a. MockChainError -&gt; AsTrans t m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">throwError</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m a -&gt; AsTrans t m a
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; AsTrans t m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m a -&gt; AsTrans t m a)
-&gt; (MockChainError -&gt; m a) -&gt; MockChainError -&gt; AsTrans t m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MockChainError -&gt; m a
forall a. MockChainError -&gt; m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span>
</span><span id="line-541"></span><span>  </span><span id="local-6989586621679819590"><span class="annot"><span class="annottext">catchError :: forall a.
AsTrans t m a -&gt; (MockChainError -&gt; AsTrans t m a) -&gt; AsTrans t m a
</span><a href="#local-6989586621679819590"><span class="hs-identifier hs-var hs-var hs-var hs-var">catchError</span></a></span></span><span> </span><span id="local-6989586621679819592"><span class="annot"><span class="annottext">AsTrans t m a
</span><a href="#local-6989586621679819592"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span id="local-6989586621679819593"><span class="annot"><span class="annottext">MockChainError -&gt; AsTrans t m a
</span><a href="#local-6989586621679819593"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Run (AsTrans t) -&gt; m (StT t a)) -&gt; AsTrans t m (StT t a)
forall (m :: * -&gt; *) a.
Monad m =&gt;
(Run (AsTrans t) -&gt; m a) -&gt; AsTrans t m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTransControl t, Monad m) =&gt;
(Run t -&gt; m a) -&gt; t m a
</span><span class="hs-identifier hs-var">liftWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679819595"><span class="annot"><span class="annottext">Run (AsTrans t)
</span><a href="#local-6989586621679819595"><span class="hs-identifier hs-var">run</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (StT t a) -&gt; (MockChainError -&gt; m (StT t a)) -&gt; m (StT t a)
forall a. m a -&gt; (MockChainError -&gt; m a) -&gt; m a
forall e (m :: * -&gt; *) a.
MonadError e m =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><span class="hs-identifier hs-var">catchError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AsTrans t m a -&gt; m (StT (AsTrans t) a)
Run (AsTrans t)
</span><a href="#local-6989586621679819595"><span class="hs-identifier hs-var">run</span></a></span><span> </span><span class="annot"><span class="annottext">AsTrans t m a
</span><a href="#local-6989586621679819592"><span class="hs-identifier hs-var">act</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AsTrans t m a -&gt; m (StT t a)
AsTrans t m a -&gt; m (StT (AsTrans t) a)
Run (AsTrans t)
</span><a href="#local-6989586621679819595"><span class="hs-identifier hs-var">run</span></a></span><span> </span><span class="annot"><span class="annottext">(AsTrans t m a -&gt; m (StT t a))
-&gt; (MockChainError -&gt; AsTrans t m a)
-&gt; MockChainError
-&gt; m (StT t a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MockChainError -&gt; AsTrans t m a
</span><a href="#local-6989586621679819593"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AsTrans t m (StT t a)
-&gt; (StT t a -&gt; AsTrans t m a) -&gt; AsTrans t m a
forall a b. AsTrans t m a -&gt; (a -&gt; AsTrans t m b) -&gt; AsTrans t m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">m (StT t a) -&gt; AsTrans t m a
m (StT (AsTrans t) a) -&gt; AsTrans t m a
forall (m :: * -&gt; *) a.
Monad m =&gt;
m (StT (AsTrans t) a) -&gt; AsTrans t m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTransControl t, Monad m) =&gt;
m (StT t a) -&gt; t m a
</span><span class="hs-identifier hs-var">restoreT</span></span><span> </span><span class="annot"><span class="annottext">(m (StT t a) -&gt; AsTrans t m a)
-&gt; (StT t a -&gt; m (StT t a)) -&gt; StT t a -&gt; AsTrans t m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">StT t a -&gt; m (StT t a)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-542"></span><span>
</span><span id="line-543"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679818551"><span id="local-6989586621679818552"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadTrans</span></span><span> </span><span class="annot"><a href="#local-6989586621679818551"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-type">MonadBlockChainBalancing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818552"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679818551"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818552"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MockChainError"><span class="hs-identifier hs-type">MockChainError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#AsTrans"><span class="hs-identifier hs-type">AsTrans</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818551"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818552"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-type">MonadBlockChainBalancing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#AsTrans"><span class="hs-identifier hs-type">AsTrans</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818551"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818552"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-544"></span><span>  </span><span id="local-6989586621679819618"><span class="annot"><span class="annottext">getParams :: AsTrans t m Params
</span><a href="Cooked.MockChain.BlockChain.html#getParams"><span class="hs-identifier hs-var hs-var hs-var hs-var">getParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m Params -&gt; AsTrans t m Params
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; AsTrans t m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">m Params
forall (m :: * -&gt; *). MonadBlockChainBalancing m =&gt; m Params
</span><a href="Cooked.MockChain.BlockChain.html#getParams"><span class="hs-identifier hs-var">getParams</span></a></span><span>
</span><span id="line-545"></span><span>  </span><span id="local-6989586621679819622"><span class="annot"><span class="annottext">scriptFromHash :: ScriptHash -&gt; AsTrans t m (Maybe (Versioned Script))
</span><a href="Cooked.MockChain.BlockChain.html#scriptFromHash"><span class="hs-identifier hs-var hs-var hs-var hs-var">scriptFromHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Maybe (Versioned Script))
-&gt; AsTrans t m (Maybe (Versioned Script))
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; AsTrans t m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Maybe (Versioned Script))
 -&gt; AsTrans t m (Maybe (Versioned Script)))
-&gt; (ScriptHash -&gt; m (Maybe (Versioned Script)))
-&gt; ScriptHash
-&gt; AsTrans t m (Maybe (Versioned Script))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ScriptHash -&gt; m (Maybe (Versioned Script))
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
ScriptHash -&gt; m (Maybe (Versioned Script))
</span><a href="Cooked.MockChain.BlockChain.html#scriptFromHash"><span class="hs-identifier hs-var">scriptFromHash</span></a></span><span>
</span><span id="line-546"></span><span>  </span><span id="local-6989586621679819626"><span class="annot"><span class="annottext">utxosAt :: Address -&gt; AsTrans t m [(TxOutRef, TxOut)]
</span><a href="Cooked.MockChain.BlockChain.html#utxosAt"><span class="hs-identifier hs-var hs-var hs-var hs-var">utxosAt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m [(TxOutRef, TxOut)] -&gt; AsTrans t m [(TxOutRef, TxOut)]
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; AsTrans t m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m [(TxOutRef, TxOut)] -&gt; AsTrans t m [(TxOutRef, TxOut)])
-&gt; (Address -&gt; m [(TxOutRef, TxOut)])
-&gt; Address
-&gt; AsTrans t m [(TxOutRef, TxOut)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Address -&gt; m [(TxOutRef, TxOut)]
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
Address -&gt; m [(TxOutRef, TxOut)]
</span><a href="Cooked.MockChain.BlockChain.html#utxosAt"><span class="hs-identifier hs-var">utxosAt</span></a></span><span>
</span><span id="line-547"></span><span>  </span><span id="local-6989586621679819630"><span class="annot"><span class="annottext">txOutByRef :: TxOutRef -&gt; AsTrans t m (Maybe TxOut)
</span><a href="Cooked.MockChain.BlockChain.html#txOutByRef"><span class="hs-identifier hs-var hs-var hs-var hs-var">txOutByRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Maybe TxOut) -&gt; AsTrans t m (Maybe TxOut)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; AsTrans t m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Maybe TxOut) -&gt; AsTrans t m (Maybe TxOut))
-&gt; (TxOutRef -&gt; m (Maybe TxOut))
-&gt; TxOutRef
-&gt; AsTrans t m (Maybe TxOut)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; m (Maybe TxOut)
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
TxOutRef -&gt; m (Maybe TxOut)
</span><a href="Cooked.MockChain.BlockChain.html#txOutByRef"><span class="hs-identifier hs-var">txOutByRef</span></a></span><span>
</span><span id="line-548"></span><span>  </span><span id="local-6989586621679819634"><span class="annot"><span class="annottext">datumFromHash :: DatumHash -&gt; AsTrans t m (Maybe Datum)
</span><a href="Cooked.MockChain.BlockChain.html#datumFromHash"><span class="hs-identifier hs-var hs-var hs-var hs-var">datumFromHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Maybe Datum) -&gt; AsTrans t m (Maybe Datum)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; AsTrans t m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Maybe Datum) -&gt; AsTrans t m (Maybe Datum))
-&gt; (DatumHash -&gt; m (Maybe Datum))
-&gt; DatumHash
-&gt; AsTrans t m (Maybe Datum)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">DatumHash -&gt; m (Maybe Datum)
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
DatumHash -&gt; m (Maybe Datum)
</span><a href="Cooked.MockChain.BlockChain.html#datumFromHash"><span class="hs-identifier hs-var">datumFromHash</span></a></span><span>
</span><span id="line-549"></span><span>  </span><span id="local-6989586621679819638"><span class="annot"><span class="annottext">logEvent :: MockChainLogEntry -&gt; AsTrans t m ()
</span><a href="Cooked.MockChain.BlockChain.html#logEvent"><span class="hs-identifier hs-var hs-var hs-var hs-var">logEvent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m () -&gt; AsTrans t m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; AsTrans t m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; AsTrans t m ())
-&gt; (MockChainLogEntry -&gt; m ())
-&gt; MockChainLogEntry
-&gt; AsTrans t m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MockChainLogEntry -&gt; m ()
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
MockChainLogEntry -&gt; m ()
</span><a href="Cooked.MockChain.BlockChain.html#logEvent"><span class="hs-identifier hs-var">logEvent</span></a></span><span>
</span><span id="line-550"></span><span>
</span><span id="line-551"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679818555"><span id="local-6989586621679818556"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadTrans</span></span><span> </span><span class="annot"><a href="#local-6989586621679818555"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainWithoutValidation"><span class="hs-identifier hs-type">MonadBlockChainWithoutValidation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818556"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679818555"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818556"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MockChainError"><span class="hs-identifier hs-type">MockChainError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#AsTrans"><span class="hs-identifier hs-type">AsTrans</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818555"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818556"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainWithoutValidation"><span class="hs-identifier hs-type">MonadBlockChainWithoutValidation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#AsTrans"><span class="hs-identifier hs-type">AsTrans</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818555"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818556"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-552"></span><span>  </span><span id="local-6989586621679819658"><span class="annot"><span class="annottext">allUtxos :: AsTrans t m [(TxOutRef, TxOut)]
</span><a href="Cooked.MockChain.BlockChain.html#allUtxos"><span class="hs-identifier hs-var hs-var hs-var hs-var">allUtxos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m [(TxOutRef, TxOut)] -&gt; AsTrans t m [(TxOutRef, TxOut)]
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; AsTrans t m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">m [(TxOutRef, TxOut)]
forall (m :: * -&gt; *).
MonadBlockChainWithoutValidation m =&gt;
m [(TxOutRef, TxOut)]
</span><a href="Cooked.MockChain.BlockChain.html#allUtxos"><span class="hs-identifier hs-var">allUtxos</span></a></span><span>
</span><span id="line-553"></span><span>  </span><span id="local-6989586621679819662"><span class="annot"><span class="annottext">setParams :: Params -&gt; AsTrans t m ()
</span><a href="Cooked.MockChain.BlockChain.html#setParams"><span class="hs-identifier hs-var hs-var hs-var hs-var">setParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m () -&gt; AsTrans t m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; AsTrans t m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; AsTrans t m ())
-&gt; (Params -&gt; m ()) -&gt; Params -&gt; AsTrans t m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Params -&gt; m ()
forall (m :: * -&gt; *).
MonadBlockChainWithoutValidation m =&gt;
Params -&gt; m ()
</span><a href="Cooked.MockChain.BlockChain.html#setParams"><span class="hs-identifier hs-var">setParams</span></a></span><span>
</span><span id="line-554"></span><span>  </span><span id="local-6989586621679819666"><span class="annot"><span class="annottext">currentSlot :: AsTrans t m Slot
</span><a href="Cooked.MockChain.BlockChain.html#currentSlot"><span class="hs-identifier hs-var hs-var hs-var hs-var">currentSlot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m Slot -&gt; AsTrans t m Slot
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; AsTrans t m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">m Slot
forall (m :: * -&gt; *). MonadBlockChainWithoutValidation m =&gt; m Slot
</span><a href="Cooked.MockChain.BlockChain.html#currentSlot"><span class="hs-identifier hs-var">currentSlot</span></a></span><span>
</span><span id="line-555"></span><span>  </span><span id="local-6989586621679819670"><span class="annot"><span class="annottext">awaitSlot :: Slot -&gt; AsTrans t m Slot
</span><a href="Cooked.MockChain.BlockChain.html#awaitSlot"><span class="hs-identifier hs-var hs-var hs-var hs-var">awaitSlot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m Slot -&gt; AsTrans t m Slot
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; AsTrans t m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m Slot -&gt; AsTrans t m Slot)
-&gt; (Slot -&gt; m Slot) -&gt; Slot -&gt; AsTrans t m Slot
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Slot -&gt; m Slot
forall (m :: * -&gt; *).
MonadBlockChainWithoutValidation m =&gt;
Slot -&gt; m Slot
</span><a href="Cooked.MockChain.BlockChain.html#awaitSlot"><span class="hs-identifier hs-var">awaitSlot</span></a></span><span>
</span><span id="line-556"></span><span>  </span><span id="local-6989586621679819676"><span class="annot"><span class="annottext">define :: forall a. ToHash a =&gt; String -&gt; a -&gt; AsTrans t m a
</span><a href="Cooked.MockChain.BlockChain.html#define"><span class="hs-identifier hs-var hs-var hs-var hs-var">define</span></a></span></span><span> </span><span id="local-6989586621679819677"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679819677"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m a -&gt; AsTrans t m a
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; AsTrans t m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m a -&gt; AsTrans t m a) -&gt; (a -&gt; m a) -&gt; a -&gt; AsTrans t m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; a -&gt; m a
forall a. ToHash a =&gt; String -&gt; a -&gt; m a
forall (m :: * -&gt; *) a.
(MonadBlockChainWithoutValidation m, ToHash a) =&gt;
String -&gt; a -&gt; m a
</span><a href="Cooked.MockChain.BlockChain.html#define"><span class="hs-identifier hs-var">define</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679819677"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-557"></span><span>
</span><span id="line-558"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679818560"><span id="local-6989586621679818561"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadTrans</span></span><span> </span><span class="annot"><a href="#local-6989586621679818560"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChain"><span class="hs-identifier hs-type">MonadBlockChain</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818561"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainWithoutValidation"><span class="hs-identifier hs-type">MonadBlockChainWithoutValidation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#AsTrans"><span class="hs-identifier hs-type">AsTrans</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818560"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818561"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChain"><span class="hs-identifier hs-type">MonadBlockChain</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#AsTrans"><span class="hs-identifier hs-type">AsTrans</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818560"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818561"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-559"></span><span>  </span><span id="local-6989586621679819693"><span class="annot"><span class="annottext">validateTxSkel :: TxSkel -&gt; AsTrans t m CardanoTx
</span><a href="Cooked.MockChain.BlockChain.html#validateTxSkel"><span class="hs-identifier hs-var hs-var hs-var hs-var">validateTxSkel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m CardanoTx -&gt; AsTrans t m CardanoTx
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; AsTrans t m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m CardanoTx -&gt; AsTrans t m CardanoTx)
-&gt; (TxSkel -&gt; m CardanoTx) -&gt; TxSkel -&gt; AsTrans t m CardanoTx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TxSkel -&gt; m CardanoTx
forall (m :: * -&gt; *). MonadBlockChain m =&gt; TxSkel -&gt; m CardanoTx
</span><a href="Cooked.MockChain.BlockChain.html#validateTxSkel"><span class="hs-identifier hs-var">validateTxSkel</span></a></span><span>
</span><span id="line-560"></span><span>
</span><span id="line-561"></span><span id="local-6989586621679819705"><span id="local-6989586621679819712"><span id="local-6989586621679819719"><span id="local-6989586621679819726"><span id="local-6989586621679819733"><span id="local-6989586621679819740"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">via</span><span> </span><span id="local-6989586621679818574"><span id="local-6989586621679818575"><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#AsTrans"><span class="hs-identifier hs-type">AsTrans</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WriterT</span></span><span> </span><span class="annot"><a href="#local-6989586621679818574"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679818575"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679818574"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-type">MonadBlockChainBalancing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818575"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-type">MonadBlockChainBalancing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WriterT</span></span><span> </span><span class="annot"><a href="#local-6989586621679818574"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818575"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-562"></span><span>
</span><span id="line-563"></span><span id="local-6989586621679819763"><span id="local-6989586621679819770"><span id="local-6989586621679819777"><span id="local-6989586621679819784"><span id="local-6989586621679819793"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">via</span><span> </span><span id="local-6989586621679818580"><span id="local-6989586621679818581"><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#AsTrans"><span class="hs-identifier hs-type">AsTrans</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WriterT</span></span><span> </span><span class="annot"><a href="#local-6989586621679818580"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679818581"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679818580"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainWithoutValidation"><span class="hs-identifier hs-type">MonadBlockChainWithoutValidation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818581"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainWithoutValidation"><span class="hs-identifier hs-type">MonadBlockChainWithoutValidation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WriterT</span></span><span> </span><span class="annot"><a href="#local-6989586621679818580"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818581"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-564"></span><span>
</span><span id="line-565"></span><span id="local-6989586621679819816"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">via</span><span> </span><span id="local-6989586621679818584"><span id="local-6989586621679818585"><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#AsTrans"><span class="hs-identifier hs-type">AsTrans</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WriterT</span></span><span> </span><span class="annot"><a href="#local-6989586621679818584"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679818585"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679818584"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChain"><span class="hs-identifier hs-type">MonadBlockChain</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818585"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChain"><span class="hs-identifier hs-type">MonadBlockChain</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WriterT</span></span><span> </span><span class="annot"><a href="#local-6989586621679818584"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818585"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-566"></span><span>
</span><span id="line-567"></span><span id="local-6989586621679819839"><span id="local-6989586621679819846"><span id="local-6989586621679819853"><span id="local-6989586621679819860"><span id="local-6989586621679819867"><span id="local-6989586621679819874"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">via</span><span> </span><span id="local-6989586621679818598"><span id="local-6989586621679818599"><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#AsTrans"><span class="hs-identifier hs-type">AsTrans</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="#local-6989586621679818599"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679818598"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-type">MonadBlockChainBalancing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818598"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-type">MonadBlockChainBalancing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="#local-6989586621679818599"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818598"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-568"></span><span>
</span><span id="line-569"></span><span id="local-6989586621679819896"><span id="local-6989586621679819903"><span id="local-6989586621679819910"><span id="local-6989586621679819917"><span id="local-6989586621679819926"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">via</span><span> </span><span id="local-6989586621679818604"><span id="local-6989586621679818605"><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#AsTrans"><span class="hs-identifier hs-type">AsTrans</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="#local-6989586621679818605"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679818604"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainWithoutValidation"><span class="hs-identifier hs-type">MonadBlockChainWithoutValidation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818604"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainWithoutValidation"><span class="hs-identifier hs-type">MonadBlockChainWithoutValidation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="#local-6989586621679818605"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818604"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-570"></span><span>
</span><span id="line-571"></span><span id="local-6989586621679819948"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">via</span><span> </span><span id="local-6989586621679818608"><span id="local-6989586621679818609"><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#AsTrans"><span class="hs-identifier hs-type">AsTrans</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="#local-6989586621679818609"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679818608"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChain"><span class="hs-identifier hs-type">MonadBlockChain</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818608"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChain"><span class="hs-identifier hs-type">MonadBlockChain</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="#local-6989586621679818609"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818608"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-572"></span><span>
</span><span id="line-573"></span><span id="local-6989586621679819971"><span id="local-6989586621679819978"><span id="local-6989586621679819985"><span id="local-6989586621679819992"><span id="local-6989586621679819999"><span id="local-6989586621679820006"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">via</span><span> </span><span id="local-6989586621679818622"><span id="local-6989586621679818623"><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#AsTrans"><span class="hs-identifier hs-type">AsTrans</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="#local-6989586621679818623"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679818622"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-type">MonadBlockChainBalancing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818622"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-type">MonadBlockChainBalancing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="#local-6989586621679818623"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818622"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-574"></span><span>
</span><span id="line-575"></span><span id="local-6989586621679820028"><span id="local-6989586621679820035"><span id="local-6989586621679820042"><span id="local-6989586621679820049"><span id="local-6989586621679820058"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">via</span><span> </span><span id="local-6989586621679818628"><span id="local-6989586621679818629"><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#AsTrans"><span class="hs-identifier hs-type">AsTrans</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="#local-6989586621679818629"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679818628"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainWithoutValidation"><span class="hs-identifier hs-type">MonadBlockChainWithoutValidation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818628"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainWithoutValidation"><span class="hs-identifier hs-type">MonadBlockChainWithoutValidation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="#local-6989586621679818629"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818628"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-576"></span><span>
</span><span id="line-577"></span><span id="local-6989586621679820080"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">via</span><span> </span><span id="local-6989586621679818632"><span id="local-6989586621679818633"><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#AsTrans"><span class="hs-identifier hs-type">AsTrans</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="#local-6989586621679818633"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679818632"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChain"><span class="hs-identifier hs-type">MonadBlockChain</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818632"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChain"><span class="hs-identifier hs-type">MonadBlockChain</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="#local-6989586621679818633"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818632"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-578"></span><span>
</span><span id="line-579"></span><span class="hs-comment">-- 'ListT' has no 'MonadTransControl' instance, so the @deriving via ...@</span><span>
</span><span id="line-580"></span><span class="hs-comment">-- machinery is unusable here. However, there is</span><span>
</span><span id="line-581"></span><span class="hs-comment">--</span><span>
</span><span id="line-582"></span><span class="hs-comment">-- &gt; MonadError e m =&gt; MonadError e (ListT m)</span><span>
</span><span id="line-583"></span><span class="hs-comment">--</span><span>
</span><span id="line-584"></span><span class="hs-comment">-- so I decided to go with a bit of code duplication to implement the</span><span>
</span><span id="line-585"></span><span class="hs-comment">-- 'MonadBlockChainWithoutValidation' and 'MonadBlockChain' instances for</span><span>
</span><span id="line-586"></span><span class="hs-comment">-- 'ListT', instead of more black magic...</span><span>
</span><span id="line-587"></span><span>
</span><span id="line-588"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679818639"><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-type">MonadBlockChainBalancing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818639"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-type">MonadBlockChainBalancing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ListT</span></span><span> </span><span class="annot"><a href="#local-6989586621679818639"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-589"></span><span>  </span><span id="local-6989586621679820114"><span class="annot"><span class="annottext">getParams :: ListT m Params
</span><a href="Cooked.MockChain.BlockChain.html#getParams"><span class="hs-identifier hs-var hs-var hs-var hs-var">getParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m Params -&gt; ListT m Params
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ListT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">m Params
forall (m :: * -&gt; *). MonadBlockChainBalancing m =&gt; m Params
</span><a href="Cooked.MockChain.BlockChain.html#getParams"><span class="hs-identifier hs-var">getParams</span></a></span><span>
</span><span id="line-590"></span><span>  </span><span id="local-6989586621679820118"><span class="annot"><span class="annottext">scriptFromHash :: ScriptHash -&gt; ListT m (Maybe (Versioned Script))
</span><a href="Cooked.MockChain.BlockChain.html#scriptFromHash"><span class="hs-identifier hs-var hs-var hs-var hs-var">scriptFromHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Maybe (Versioned Script)) -&gt; ListT m (Maybe (Versioned Script))
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ListT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Maybe (Versioned Script))
 -&gt; ListT m (Maybe (Versioned Script)))
-&gt; (ScriptHash -&gt; m (Maybe (Versioned Script)))
-&gt; ScriptHash
-&gt; ListT m (Maybe (Versioned Script))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ScriptHash -&gt; m (Maybe (Versioned Script))
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
ScriptHash -&gt; m (Maybe (Versioned Script))
</span><a href="Cooked.MockChain.BlockChain.html#scriptFromHash"><span class="hs-identifier hs-var">scriptFromHash</span></a></span><span>
</span><span id="line-591"></span><span>  </span><span id="local-6989586621679820122"><span class="annot"><span class="annottext">utxosAt :: Address -&gt; ListT m [(TxOutRef, TxOut)]
</span><a href="Cooked.MockChain.BlockChain.html#utxosAt"><span class="hs-identifier hs-var hs-var hs-var hs-var">utxosAt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m [(TxOutRef, TxOut)] -&gt; ListT m [(TxOutRef, TxOut)]
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ListT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m [(TxOutRef, TxOut)] -&gt; ListT m [(TxOutRef, TxOut)])
-&gt; (Address -&gt; m [(TxOutRef, TxOut)])
-&gt; Address
-&gt; ListT m [(TxOutRef, TxOut)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Address -&gt; m [(TxOutRef, TxOut)]
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
Address -&gt; m [(TxOutRef, TxOut)]
</span><a href="Cooked.MockChain.BlockChain.html#utxosAt"><span class="hs-identifier hs-var">utxosAt</span></a></span><span>
</span><span id="line-592"></span><span>  </span><span id="local-6989586621679820126"><span class="annot"><span class="annottext">txOutByRef :: TxOutRef -&gt; ListT m (Maybe TxOut)
</span><a href="Cooked.MockChain.BlockChain.html#txOutByRef"><span class="hs-identifier hs-var hs-var hs-var hs-var">txOutByRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Maybe TxOut) -&gt; ListT m (Maybe TxOut)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ListT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Maybe TxOut) -&gt; ListT m (Maybe TxOut))
-&gt; (TxOutRef -&gt; m (Maybe TxOut))
-&gt; TxOutRef
-&gt; ListT m (Maybe TxOut)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; m (Maybe TxOut)
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
TxOutRef -&gt; m (Maybe TxOut)
</span><a href="Cooked.MockChain.BlockChain.html#txOutByRef"><span class="hs-identifier hs-var">txOutByRef</span></a></span><span>
</span><span id="line-593"></span><span>  </span><span id="local-6989586621679820130"><span class="annot"><span class="annottext">datumFromHash :: DatumHash -&gt; ListT m (Maybe Datum)
</span><a href="Cooked.MockChain.BlockChain.html#datumFromHash"><span class="hs-identifier hs-var hs-var hs-var hs-var">datumFromHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Maybe Datum) -&gt; ListT m (Maybe Datum)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ListT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Maybe Datum) -&gt; ListT m (Maybe Datum))
-&gt; (DatumHash -&gt; m (Maybe Datum))
-&gt; DatumHash
-&gt; ListT m (Maybe Datum)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">DatumHash -&gt; m (Maybe Datum)
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
DatumHash -&gt; m (Maybe Datum)
</span><a href="Cooked.MockChain.BlockChain.html#datumFromHash"><span class="hs-identifier hs-var">datumFromHash</span></a></span><span>
</span><span id="line-594"></span><span>  </span><span id="local-6989586621679820134"><span class="annot"><span class="annottext">logEvent :: MockChainLogEntry -&gt; ListT m ()
</span><a href="Cooked.MockChain.BlockChain.html#logEvent"><span class="hs-identifier hs-var hs-var hs-var hs-var">logEvent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m () -&gt; ListT m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ListT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; ListT m ())
-&gt; (MockChainLogEntry -&gt; m ()) -&gt; MockChainLogEntry -&gt; ListT m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MockChainLogEntry -&gt; m ()
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
MockChainLogEntry -&gt; m ()
</span><a href="Cooked.MockChain.BlockChain.html#logEvent"><span class="hs-identifier hs-var">logEvent</span></a></span><span>
</span><span id="line-595"></span><span>
</span><span id="line-596"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679818641"><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainWithoutValidation"><span class="hs-identifier hs-type">MonadBlockChainWithoutValidation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818641"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainWithoutValidation"><span class="hs-identifier hs-type">MonadBlockChainWithoutValidation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ListT</span></span><span> </span><span class="annot"><a href="#local-6989586621679818641"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-597"></span><span>  </span><span id="local-6989586621679820150"><span class="annot"><span class="annottext">allUtxos :: ListT m [(TxOutRef, TxOut)]
</span><a href="Cooked.MockChain.BlockChain.html#allUtxos"><span class="hs-identifier hs-var hs-var hs-var hs-var">allUtxos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m [(TxOutRef, TxOut)] -&gt; ListT m [(TxOutRef, TxOut)]
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ListT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">m [(TxOutRef, TxOut)]
forall (m :: * -&gt; *).
MonadBlockChainWithoutValidation m =&gt;
m [(TxOutRef, TxOut)]
</span><a href="Cooked.MockChain.BlockChain.html#allUtxos"><span class="hs-identifier hs-var">allUtxos</span></a></span><span>
</span><span id="line-598"></span><span>  </span><span id="local-6989586621679820154"><span class="annot"><span class="annottext">setParams :: Params -&gt; ListT m ()
</span><a href="Cooked.MockChain.BlockChain.html#setParams"><span class="hs-identifier hs-var hs-var hs-var hs-var">setParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m () -&gt; ListT m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ListT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; ListT m ()) -&gt; (Params -&gt; m ()) -&gt; Params -&gt; ListT m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Params -&gt; m ()
forall (m :: * -&gt; *).
MonadBlockChainWithoutValidation m =&gt;
Params -&gt; m ()
</span><a href="Cooked.MockChain.BlockChain.html#setParams"><span class="hs-identifier hs-var">setParams</span></a></span><span>
</span><span id="line-599"></span><span>  </span><span id="local-6989586621679820158"><span class="annot"><span class="annottext">currentSlot :: ListT m Slot
</span><a href="Cooked.MockChain.BlockChain.html#currentSlot"><span class="hs-identifier hs-var hs-var hs-var hs-var">currentSlot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m Slot -&gt; ListT m Slot
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ListT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">m Slot
forall (m :: * -&gt; *). MonadBlockChainWithoutValidation m =&gt; m Slot
</span><a href="Cooked.MockChain.BlockChain.html#currentSlot"><span class="hs-identifier hs-var">currentSlot</span></a></span><span>
</span><span id="line-600"></span><span>  </span><span id="local-6989586621679820162"><span class="annot"><span class="annottext">awaitSlot :: Slot -&gt; ListT m Slot
</span><a href="Cooked.MockChain.BlockChain.html#awaitSlot"><span class="hs-identifier hs-var hs-var hs-var hs-var">awaitSlot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m Slot -&gt; ListT m Slot
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ListT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m Slot -&gt; ListT m Slot)
-&gt; (Slot -&gt; m Slot) -&gt; Slot -&gt; ListT m Slot
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Slot -&gt; m Slot
forall (m :: * -&gt; *).
MonadBlockChainWithoutValidation m =&gt;
Slot -&gt; m Slot
</span><a href="Cooked.MockChain.BlockChain.html#awaitSlot"><span class="hs-identifier hs-var">awaitSlot</span></a></span><span>
</span><span id="line-601"></span><span>  </span><span id="local-6989586621679820168"><span class="annot"><span class="annottext">define :: forall a. ToHash a =&gt; String -&gt; a -&gt; ListT m a
</span><a href="Cooked.MockChain.BlockChain.html#define"><span class="hs-identifier hs-var hs-var hs-var hs-var">define</span></a></span></span><span> </span><span id="local-6989586621679820169"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679820169"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m a -&gt; ListT m a
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ListT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m a -&gt; ListT m a) -&gt; (a -&gt; m a) -&gt; a -&gt; ListT m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; a -&gt; m a
forall a. ToHash a =&gt; String -&gt; a -&gt; m a
forall (m :: * -&gt; *) a.
(MonadBlockChainWithoutValidation m, ToHash a) =&gt;
String -&gt; a -&gt; m a
</span><a href="Cooked.MockChain.BlockChain.html#define"><span class="hs-identifier hs-var">define</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679820169"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-602"></span><span>
</span><span id="line-603"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679818644"><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChain"><span class="hs-identifier hs-type">MonadBlockChain</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679818644"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChain"><span class="hs-identifier hs-type">MonadBlockChain</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ListT</span></span><span> </span><span class="annot"><a href="#local-6989586621679818644"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-604"></span><span>  </span><span id="local-6989586621679820182"><span class="annot"><span class="annottext">validateTxSkel :: TxSkel -&gt; ListT m CardanoTx
</span><a href="Cooked.MockChain.BlockChain.html#validateTxSkel"><span class="hs-identifier hs-var hs-var hs-var hs-var">validateTxSkel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m CardanoTx -&gt; ListT m CardanoTx
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ListT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m CardanoTx -&gt; ListT m CardanoTx)
-&gt; (TxSkel -&gt; m CardanoTx) -&gt; TxSkel -&gt; ListT m CardanoTx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TxSkel -&gt; m CardanoTx
forall (m :: * -&gt; *). MonadBlockChain m =&gt; TxSkel -&gt; m CardanoTx
</span><a href="Cooked.MockChain.BlockChain.html#validateTxSkel"><span class="hs-identifier hs-var">validateTxSkel</span></a></span><span>
</span><span id="line-605"></span></pre></body></html>