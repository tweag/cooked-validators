<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cooked.MockChain.MockChainSt</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Api</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Cardano</span></span><span>
</span><span id="line-4"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Api.Shelley</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Cardano</span></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Shelley.API</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Shelley</span></span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Shelley.LedgerState</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Shelley</span></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Node.Emulator.Internal.Node</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Emulator</span></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Arrow</span></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.Conversion.ToScriptHash.html"><span class="hs-identifier">Cooked.Conversion.ToScriptHash</span></a></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.Conversion.ToVersionedScript.html"><span class="hs-identifier">Cooked.Conversion.ToVersionedScript</span></a></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.InitialDistribution.html"><span class="hs-identifier">Cooked.InitialDistribution</span></a></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html"><span class="hs-identifier">Cooked.MockChain.GenerateTx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.GenerateTx.Common.html#GenerateTxError"><span class="hs-identifier">GenerateTxError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.html#generateTxOut"><span class="hs-identifier">generateTxOut</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.MockChain.UtxoState.html"><span class="hs-identifier">Cooked.MockChain.UtxoState</span></a></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.Output.html"><span class="hs-identifier">Cooked.Output</span></a></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.Skeleton.html"><span class="hs-identifier">Cooked.Skeleton</span></a></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bifunctor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">bimap</span></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Default</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Either.Combinators</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mapLeft</span></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">foldl'</span></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mapMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Index</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ledger</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Orphans</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Slot</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ledger</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Tx</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ledger</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Tx.CardanoAPI</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ledger</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Optics.Core</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">view</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.Script.Utils.Scripts</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Script</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusLedgerApi.V3</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Api</span></span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-comment">-- | Slightly more concrete version of 'UtxoState', used to actually run the</span><span>
</span><span id="line-33"></span><span class="hs-comment">-- simulation.</span><span>
</span><span id="line-34"></span><span class="hs-keyword">data</span><span> </span><span id="MockChainSt"><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#MockChainSt"><span class="hs-identifier hs-var">MockChainSt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="MockChainSt"><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#MockChainSt"><span class="hs-identifier hs-var">MockChainSt</span></a></span></span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="mcstParams"><span class="annot"><span class="annottext">MockChainSt -&gt; Params
</span><a href="Cooked.MockChain.MockChainSt.html#mcstParams"><span class="hs-identifier hs-var hs-var">mcstParams</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Emulator.Params</span></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>    </span><span id="mcstIndex"><span class="annot"><span class="annottext">MockChainSt -&gt; UtxoIndex
</span><a href="Cooked.MockChain.MockChainSt.html#mcstIndex"><span class="hs-identifier hs-var hs-var">mcstIndex</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.UtxoIndex</span></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-comment">-- map from datum hash to (datum, count), where count is the number of UTxOs</span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-comment">-- that currently have the datum. This map is used to display the contents</span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-comment">-- of the state to the user, and to recover datums for transaction</span><span>
</span><span id="line-40"></span><span>    </span><span class="hs-comment">-- generation.</span><span>
</span><span id="line-41"></span><span>    </span><span id="mcstDatums"><span class="annot"><span class="annottext">MockChainSt -&gt; Map DatumHash (TxSkelOutDatum, Integer)
</span><a href="Cooked.MockChain.MockChainSt.html#mcstDatums"><span class="hs-identifier hs-var hs-var">mcstDatums</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.DatumHash</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Skeleton.html#TxSkelOutDatum"><span class="hs-identifier hs-type">TxSkelOutDatum</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>    </span><span id="mcstValidators"><span class="annot"><span class="annottext">MockChainSt -&gt; Map ValidatorHash (Versioned Validator)
</span><a href="Cooked.MockChain.MockChainSt.html#mcstValidators"><span class="hs-identifier hs-var hs-var">mcstValidators</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script.ValidatorHash</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Script.Versioned</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script.Validator</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>    </span><span id="mcstCurrentSlot"><span class="annot"><span class="annottext">MockChainSt -&gt; Slot
</span><a href="Cooked.MockChain.MockChainSt.html#mcstCurrentSlot"><span class="hs-identifier hs-var hs-var">mcstCurrentSlot</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.Slot</span></span><span>
</span><span id="line-44"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-45"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679830090"><span id="local-6989586621679830107"><span id="local-6989586621679830111"><span class="annot"><span class="annottext">Int -&gt; MockChainSt -&gt; ShowS
[MockChainSt] -&gt; ShowS
MockChainSt -&gt; String
(Int -&gt; MockChainSt -&gt; ShowS)
-&gt; (MockChainSt -&gt; String)
-&gt; ([MockChainSt] -&gt; ShowS)
-&gt; Show MockChainSt
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; MockChainSt -&gt; ShowS
showsPrec :: Int -&gt; MockChainSt -&gt; ShowS
$cshow :: MockChainSt -&gt; String
show :: MockChainSt -&gt; String
$cshowList :: [MockChainSt] -&gt; ShowS
showList :: [MockChainSt] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679830125"><span id="local-6989586621679830140"><span class="annot"><span class="annottext">MockChainSt -&gt; MockChainSt -&gt; Bool
(MockChainSt -&gt; MockChainSt -&gt; Bool)
-&gt; (MockChainSt -&gt; MockChainSt -&gt; Bool) -&gt; Eq MockChainSt
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: MockChainSt -&gt; MockChainSt -&gt; Bool
== :: MockChainSt -&gt; MockChainSt -&gt; Bool
$c/= :: MockChainSt -&gt; MockChainSt -&gt; Bool
/= :: MockChainSt -&gt; MockChainSt -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Default</span></span><span> </span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#MockChainSt"><span class="hs-identifier hs-type">MockChainSt</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-48"></span><span>  </span><span id="local-6989586621679830155"><span class="annot"><span class="annottext">def :: MockChainSt
</span><a href="#local-6989586621679830155"><span class="hs-identifier hs-var hs-var hs-var hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MockChainSt
</span><a href="Cooked.MockChain.MockChainSt.html#mockChainSt0"><span class="hs-identifier hs-var">mockChainSt0</span></a></span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-comment">-- | Converts a builtin UtxoIndex into our own usable map between utxos and</span><span>
</span><span id="line-51"></span><span class="hs-comment">-- associated outputs.</span><span>
</span><span id="line-52"></span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#getIndex"><span class="hs-identifier hs-type">getIndex</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.UtxoIndex</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOutRef</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOut</span></span><span>
</span><span id="line-53"></span><span id="getIndex"><span class="annot"><span class="annottext">getIndex :: UtxoIndex -&gt; Map TxOutRef TxOut
</span><a href="Cooked.MockChain.MockChainSt.html#getIndex"><span class="hs-identifier hs-var hs-var">getIndex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-54"></span><span>  </span><span class="annot"><span class="annottext">[(TxOutRef, TxOut)] -&gt; Map TxOutRef TxOut
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><span class="annottext">([(TxOutRef, TxOut)] -&gt; Map TxOutRef TxOut)
-&gt; (UtxoIndex -&gt; [(TxOutRef, TxOut)])
-&gt; UtxoIndex
-&gt; Map TxOutRef TxOut
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((TxIn, TxOut CtxUTxO ConwayEra) -&gt; (TxOutRef, TxOut))
-&gt; [(TxIn, TxOut CtxUTxO ConwayEra)] -&gt; [(TxOutRef, TxOut)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TxIn -&gt; TxOutRef)
-&gt; (TxOut CtxUTxO ConwayEra -&gt; TxOut)
-&gt; (TxIn, TxOut CtxUTxO ConwayEra)
-&gt; (TxOutRef, TxOut)
forall a b c d. (a -&gt; b) -&gt; (c -&gt; d) -&gt; (a, c) -&gt; (b, d)
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; TxOutRef
</span><span class="hs-identifier hs-var">Ledger.fromCardanoTxIn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut CtxTx ConwayEra -&gt; TxOut
forall era. TxOut CtxTx era -&gt; TxOut
</span><span class="hs-identifier hs-var">Ledger.fromCardanoTxOutToPV2TxInfoTxOut</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxTx ConwayEra -&gt; TxOut)
-&gt; (TxOut CtxUTxO ConwayEra -&gt; TxOut CtxTx ConwayEra)
-&gt; TxOut CtxUTxO ConwayEra
-&gt; TxOut
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO ConwayEra -&gt; TxOut CtxTx ConwayEra
forall era. TxOut CtxUTxO era -&gt; TxOut CtxTx era
</span><a href="#local-6989586621679830163"><span class="hs-identifier hs-var">toCtxTxTxOut</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>    </span><span class="annot"><span class="annottext">([(TxIn, TxOut CtxUTxO ConwayEra)] -&gt; [(TxOutRef, TxOut)])
-&gt; (UtxoIndex -&gt; [(TxIn, TxOut CtxUTxO ConwayEra)])
-&gt; UtxoIndex
-&gt; [(TxOutRef, TxOut)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO ConwayEra)
-&gt; [(TxIn, TxOut CtxUTxO ConwayEra)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span>
</span><span id="line-57"></span><span>    </span><span class="annot"><span class="annottext">(Map TxIn (TxOut CtxUTxO ConwayEra)
 -&gt; [(TxIn, TxOut CtxUTxO ConwayEra)])
-&gt; (UtxoIndex -&gt; Map TxIn (TxOut CtxUTxO ConwayEra))
-&gt; UtxoIndex
-&gt; [(TxIn, TxOut CtxUTxO ConwayEra)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UtxoIndex -&gt; Map TxIn (TxOut CtxUTxO ConwayEra)
forall era. UTxO era -&gt; Map TxIn (TxOut CtxUTxO era)
</span><span class="hs-identifier hs-var">Cardano.unUTxO</span></span><span>
</span><span id="line-58"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-comment">-- We need to convert a UTxO context TxOut to a Transaction context Tx out.</span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-comment">-- It's complicated because the datum type is indexed by the context.</span><span>
</span><span id="line-61"></span><span>    </span><span id="local-6989586621679829824"><span class="annot"><a href="#local-6989586621679830163"><span class="hs-identifier hs-type">toCtxTxTxOut</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.CtxUTxO</span></span><span> </span><span class="annot"><a href="#local-6989586621679829824"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.CtxTx</span></span><span> </span><span class="annot"><a href="#local-6989586621679829824"><span class="hs-identifier hs-type">era</span></a></span></span><span>
</span><span id="line-62"></span><span>    </span><span id="local-6989586621679830163"><span class="annot"><span class="annottext">toCtxTxTxOut :: forall era. TxOut CtxUTxO era -&gt; TxOut CtxTx era
</span><a href="#local-6989586621679830163"><span class="hs-identifier hs-var hs-var">toCtxTxTxOut</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Cardano.TxOut</span></span><span> </span><span id="local-6989586621679830167"><span class="annot"><span class="annottext">AddressInEra era
</span><a href="#local-6989586621679830167"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span id="local-6989586621679830168"><span class="annot"><span class="annottext">TxOutValue era
</span><a href="#local-6989586621679830168"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span id="local-6989586621679830169"><span class="annot"><span class="annottext">TxOutDatum CtxUTxO era
</span><a href="#local-6989586621679830169"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621679830170"><span class="annot"><span class="annottext">ReferenceScript era
</span><a href="#local-6989586621679830170"><span class="hs-identifier hs-var">refS</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-63"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679830171"><span class="annot"><span class="annottext">dat :: TxOutDatum CtxTx era
</span><a href="#local-6989586621679830171"><span class="hs-identifier hs-var hs-var">dat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxUTxO era
</span><a href="#local-6989586621679830169"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-64"></span><span>            </span><span class="annot"><span class="annottext">TxOutDatum CtxUTxO era
</span><span class="hs-identifier hs-var">Cardano.TxOutDatumNone</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxTx era
forall ctx era. TxOutDatum ctx era
</span><span class="hs-identifier hs-var">Cardano.TxOutDatumNone</span></span><span>
</span><span id="line-65"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Cardano.TxOutDatumHash</span></span><span> </span><span id="local-6989586621679830174"><span class="annot"><span class="annottext">AlonzoEraOnwards era
</span><a href="#local-6989586621679830174"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679830175"><span class="annot"><span class="annottext">Hash ScriptData
</span><a href="#local-6989586621679830175"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AlonzoEraOnwards era -&gt; Hash ScriptData -&gt; TxOutDatum CtxTx era
forall era ctx.
AlonzoEraOnwards era -&gt; Hash ScriptData -&gt; TxOutDatum ctx era
</span><span class="hs-identifier hs-var">Cardano.TxOutDatumHash</span></span><span> </span><span class="annot"><span class="annottext">AlonzoEraOnwards era
</span><a href="#local-6989586621679830174"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Hash ScriptData
</span><a href="#local-6989586621679830175"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-66"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Cardano.TxOutDatumInline</span></span><span> </span><span id="local-6989586621679830177"><span class="annot"><span class="annottext">BabbageEraOnwards era
</span><a href="#local-6989586621679830177"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679830178"><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621679830178"><span class="hs-identifier hs-var">sd</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BabbageEraOnwards era -&gt; HashableScriptData -&gt; TxOutDatum CtxTx era
forall era ctx.
BabbageEraOnwards era -&gt; HashableScriptData -&gt; TxOutDatum ctx era
</span><span class="hs-identifier hs-var">Cardano.TxOutDatumInline</span></span><span> </span><span class="annot"><span class="annottext">BabbageEraOnwards era
</span><a href="#local-6989586621679830177"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621679830178"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-67"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">AddressInEra era
-&gt; TxOutValue era
-&gt; TxOutDatum CtxTx era
-&gt; ReferenceScript era
-&gt; TxOut CtxTx era
forall ctx era.
AddressInEra era
-&gt; TxOutValue era
-&gt; TxOutDatum ctx era
-&gt; ReferenceScript era
-&gt; TxOut ctx era
</span><span class="hs-identifier hs-var">Cardano.TxOut</span></span><span> </span><span class="annot"><span class="annottext">AddressInEra era
</span><a href="#local-6989586621679830167"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutValue era
</span><a href="#local-6989586621679830168"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxTx era
</span><a href="#local-6989586621679830171"><span class="hs-identifier hs-var">dat</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceScript era
</span><a href="#local-6989586621679830170"><span class="hs-identifier hs-var">refS</span></a></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#mcstToUtxoState"><span class="hs-identifier hs-type">mcstToUtxoState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#MockChainSt"><span class="hs-identifier hs-type">MockChainSt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.UtxoState.html#UtxoState"><span class="hs-identifier hs-type">UtxoState</span></a></span><span>
</span><span id="line-70"></span><span id="mcstToUtxoState"><span class="annot"><span class="annottext">mcstToUtxoState :: MockChainSt -&gt; UtxoState
</span><a href="Cooked.MockChain.MockChainSt.html#mcstToUtxoState"><span class="hs-identifier hs-var hs-var">mcstToUtxoState</span></a></span></span><span> </span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#MockChainSt"><span class="hs-identifier hs-type">MockChainSt</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679830180"><span class="annot"><span class="annottext">UtxoIndex
mcstIndex :: MockChainSt -&gt; UtxoIndex
mcstIndex :: UtxoIndex
</span><a href="Cooked.MockChain.MockChainSt.html#mcstIndex"><span class="hs-identifier hs-var hs-var">mcstIndex</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679830181"><span class="annot"><span class="annottext">Map DatumHash (TxSkelOutDatum, Integer)
mcstDatums :: MockChainSt -&gt; Map DatumHash (TxSkelOutDatum, Integer)
mcstDatums :: Map DatumHash (TxSkelOutDatum, Integer)
</span><a href="Cooked.MockChain.MockChainSt.html#mcstDatums"><span class="hs-identifier hs-var hs-var">mcstDatums</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-71"></span><span>  </span><span class="annot"><span class="annottext">Map Address UtxoPayloadSet -&gt; UtxoState
</span><a href="Cooked.MockChain.UtxoState.html#UtxoState"><span class="hs-identifier hs-var">UtxoState</span></a></span><span>
</span><span id="line-72"></span><span>    </span><span class="annot"><span class="annottext">(Map Address UtxoPayloadSet -&gt; UtxoState)
-&gt; (UtxoIndex -&gt; Map Address UtxoPayloadSet)
-&gt; UtxoIndex
-&gt; UtxoState
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Address, UtxoPayloadSet)
 -&gt; Map Address UtxoPayloadSet -&gt; Map Address UtxoPayloadSet)
-&gt; Map Address UtxoPayloadSet
-&gt; [(Address, UtxoPayloadSet)]
-&gt; Map Address UtxoPayloadSet
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679830183"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621679830183"><span class="hs-identifier hs-var">address</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679830184"><span class="annot"><span class="annottext">UtxoPayloadSet
</span><a href="#local-6989586621679830184"><span class="hs-identifier hs-var">utxoValueSet</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679830185"><span class="annot"><span class="annottext">Map Address UtxoPayloadSet
</span><a href="#local-6989586621679830185"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(UtxoPayloadSet -&gt; UtxoPayloadSet -&gt; UtxoPayloadSet)
-&gt; Address
-&gt; UtxoPayloadSet
-&gt; Map Address UtxoPayloadSet
-&gt; Map Address UtxoPayloadSet
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insertWith</span></span><span> </span><span class="annot"><span class="annottext">UtxoPayloadSet -&gt; UtxoPayloadSet -&gt; UtxoPayloadSet
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621679830183"><span class="hs-identifier hs-var">address</span></a></span><span> </span><span class="annot"><span class="annottext">UtxoPayloadSet
</span><a href="#local-6989586621679830184"><span class="hs-identifier hs-var">utxoValueSet</span></a></span><span> </span><span class="annot"><span class="annottext">Map Address UtxoPayloadSet
</span><a href="#local-6989586621679830185"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Address UtxoPayloadSet
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span>
</span><span id="line-73"></span><span>    </span><span class="annot"><span class="annottext">([(Address, UtxoPayloadSet)] -&gt; Map Address UtxoPayloadSet)
-&gt; (UtxoIndex -&gt; [(Address, UtxoPayloadSet)])
-&gt; UtxoIndex
-&gt; Map Address UtxoPayloadSet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((TxIn, TxOut CtxUTxO ConwayEra)
 -&gt; Maybe (Address, UtxoPayloadSet))
-&gt; [(TxIn, TxOut CtxUTxO ConwayEra)] -&gt; [(Address, UtxoPayloadSet)]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span>
</span><span id="line-74"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(TxOutRef, TxOut) -&gt; Maybe (Address, UtxoPayloadSet)
</span><a href="#local-6989586621679830188"><span class="hs-identifier hs-var">extractPayload</span></a></span><span>
</span><span id="line-75"></span><span>          </span><span class="annot"><span class="annottext">((TxOutRef, TxOut) -&gt; Maybe (Address, UtxoPayloadSet))
-&gt; ((TxIn, TxOut CtxUTxO ConwayEra) -&gt; (TxOutRef, TxOut))
-&gt; (TxIn, TxOut CtxUTxO ConwayEra)
-&gt; Maybe (Address, UtxoPayloadSet)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(TxIn -&gt; TxOutRef)
-&gt; (TxOut CtxUTxO ConwayEra -&gt; TxOut)
-&gt; (TxIn, TxOut CtxUTxO ConwayEra)
-&gt; (TxOutRef, TxOut)
forall a b c d. (a -&gt; b) -&gt; (c -&gt; d) -&gt; (a, c) -&gt; (b, d)
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span>
</span><span id="line-76"></span><span>            </span><span class="annot"><span class="annottext">TxIn -&gt; TxOutRef
</span><span class="hs-identifier hs-var">Ledger.fromCardanoTxIn</span></span><span>
</span><span id="line-77"></span><span>            </span><span class="annot"><span class="annottext">TxOut CtxUTxO ConwayEra -&gt; TxOut
forall era. TxOut CtxUTxO era -&gt; TxOut
</span><span class="hs-identifier hs-var">Ledger.fromCardanoTxOutToPV2TxInfoTxOut'</span></span><span>
</span><span id="line-78"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>    </span><span class="annot"><span class="annottext">([(TxIn, TxOut CtxUTxO ConwayEra)] -&gt; [(Address, UtxoPayloadSet)])
-&gt; (UtxoIndex -&gt; [(TxIn, TxOut CtxUTxO ConwayEra)])
-&gt; UtxoIndex
-&gt; [(Address, UtxoPayloadSet)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO ConwayEra)
-&gt; [(TxIn, TxOut CtxUTxO ConwayEra)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span>
</span><span id="line-80"></span><span>    </span><span class="annot"><span class="annottext">(Map TxIn (TxOut CtxUTxO ConwayEra)
 -&gt; [(TxIn, TxOut CtxUTxO ConwayEra)])
-&gt; (UtxoIndex -&gt; Map TxIn (TxOut CtxUTxO ConwayEra))
-&gt; UtxoIndex
-&gt; [(TxIn, TxOut CtxUTxO ConwayEra)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UtxoIndex -&gt; Map TxIn (TxOut CtxUTxO ConwayEra)
forall era. UTxO era -&gt; Map TxIn (TxOut CtxUTxO era)
</span><span class="hs-identifier hs-var">Cardano.unUTxO</span></span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><span class="annottext">(UtxoIndex -&gt; UtxoState) -&gt; UtxoIndex -&gt; UtxoState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UtxoIndex
</span><a href="#local-6989586621679830180"><span class="hs-identifier hs-var">mcstIndex</span></a></span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-83"></span><span>    </span><span class="annot"><a href="#local-6989586621679830188"><span class="hs-identifier hs-type">extractPayload</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Api.TxOutRef</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOut</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Api.Address</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cooked.MockChain.UtxoState.html#UtxoPayloadSet"><span class="hs-identifier hs-type">UtxoPayloadSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>    </span><span id="local-6989586621679830188"><span class="annot"><span class="annottext">extractPayload :: (TxOutRef, TxOut) -&gt; Maybe (Address, UtxoPayloadSet)
</span><a href="#local-6989586621679830188"><span class="hs-identifier hs-var hs-var">extractPayload</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679830190"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679830190"><span class="hs-identifier hs-var">txOutRef</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679830191"><span class="annot"><span class="annottext">out :: TxOut
</span><a href="#local-6989586621679830191"><span class="hs-identifier hs-var">out</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Api.TxOut</span></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679830193"><span class="annot"><span class="annottext">Address
txOutAddress :: Address
txOutAddress :: TxOut -&gt; Address
</span><a href="#local-6989586621679830193"><span class="hs-identifier hs-var hs-var">Api.txOutAddress</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679830195"><span class="annot"><span class="annottext">Value
txOutValue :: Value
txOutValue :: TxOut -&gt; Value
</span><a href="#local-6989586621679830195"><span class="hs-identifier hs-var hs-var">Api.txOutValue</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679830197"><span class="annot"><span class="annottext">OutputDatum
txOutDatum :: OutputDatum
txOutDatum :: TxOut -&gt; OutputDatum
</span><a href="#local-6989586621679830197"><span class="hs-identifier hs-var hs-var">Api.txOutDatum</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-85"></span><span>      </span><span class="hs-keyword">do</span><span>
</span><span id="line-86"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679830199"><span class="annot"><span class="annottext">mRefScript :: Maybe ScriptHash
</span><a href="#local-6989586621679830199"><span class="hs-identifier hs-var hs-var">mRefScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxOut -&gt; Maybe ScriptHash
forall o.
(IsAbstractOutput o, ToScriptHash (ReferenceScriptType o)) =&gt;
o -&gt; Maybe ScriptHash
</span><a href="Cooked.Output.html#outputReferenceScriptHash"><span class="hs-identifier hs-var">outputReferenceScriptHash</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621679830191"><span class="hs-identifier hs-var">out</span></a></span><span>
</span><span id="line-87"></span><span>        </span><span id="local-6989586621679830201"><span class="annot"><span class="annottext">TxSkelOutDatum
</span><a href="#local-6989586621679830201"><span class="hs-identifier hs-var">txSkelOutDatum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-88"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">OutputDatum
</span><a href="#local-6989586621679830197"><span class="hs-identifier hs-var">txOutDatum</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-89"></span><span>            </span><span class="annot"><span class="annottext">OutputDatum
</span><span class="hs-identifier hs-var">Api.NoOutputDatum</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxSkelOutDatum -&gt; Maybe TxSkelOutDatum
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TxSkelOutDatum
</span><a href="Cooked.Skeleton.html#TxSkelOutNoDatum"><span class="hs-identifier hs-var">TxSkelOutNoDatum</span></a></span><span>
</span><span id="line-90"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Api.OutputDatum</span></span><span> </span><span id="local-6989586621679830205"><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679830205"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TxSkelOutDatum, Integer) -&gt; TxSkelOutDatum
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((TxSkelOutDatum, Integer) -&gt; TxSkelOutDatum)
-&gt; Maybe (TxSkelOutDatum, Integer) -&gt; Maybe TxSkelOutDatum
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">DatumHash
-&gt; Map DatumHash (TxSkelOutDatum, Integer)
-&gt; Maybe (TxSkelOutDatum, Integer)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Datum -&gt; DatumHash
</span><span class="hs-identifier hs-var">Script.datumHash</span></span><span> </span><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679830205"><span class="hs-identifier hs-var">datum</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map DatumHash (TxSkelOutDatum, Integer)
</span><a href="#local-6989586621679830181"><span class="hs-identifier hs-var">mcstDatums</span></a></span><span>
</span><span id="line-91"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Api.OutputDatumHash</span></span><span> </span><span id="local-6989586621679830211"><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679830211"><span class="hs-identifier hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TxSkelOutDatum, Integer) -&gt; TxSkelOutDatum
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((TxSkelOutDatum, Integer) -&gt; TxSkelOutDatum)
-&gt; Maybe (TxSkelOutDatum, Integer) -&gt; Maybe TxSkelOutDatum
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">DatumHash
-&gt; Map DatumHash (TxSkelOutDatum, Integer)
-&gt; Maybe (TxSkelOutDatum, Integer)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679830211"><span class="hs-identifier hs-var">hash</span></a></span><span> </span><span class="annot"><span class="annottext">Map DatumHash (TxSkelOutDatum, Integer)
</span><a href="#local-6989586621679830181"><span class="hs-identifier hs-var">mcstDatums</span></a></span><span>
</span><span id="line-92"></span><span>        </span><span class="annot"><span class="annottext">(Address, UtxoPayloadSet) -&gt; Maybe (Address, UtxoPayloadSet)
forall a. a -&gt; Maybe a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-93"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621679830193"><span class="hs-identifier hs-var">txOutAddress</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-94"></span><span>            </span><span class="annot"><span class="annottext">[UtxoPayload] -&gt; UtxoPayloadSet
</span><a href="Cooked.MockChain.UtxoState.html#UtxoPayloadSet"><span class="hs-identifier hs-var">UtxoPayloadSet</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TxOutRef
-&gt; Value -&gt; TxSkelOutDatum -&gt; Maybe ScriptHash -&gt; UtxoPayload
</span><a href="Cooked.MockChain.UtxoState.html#UtxoPayload"><span class="hs-identifier hs-var">UtxoPayload</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679830190"><span class="hs-identifier hs-var">txOutRef</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679830195"><span class="hs-identifier hs-var">txOutValue</span></a></span><span> </span><span class="annot"><span class="annottext">TxSkelOutDatum
</span><a href="#local-6989586621679830201"><span class="hs-identifier hs-var">txSkelOutDatum</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ScriptHash
</span><a href="#local-6989586621679830199"><span class="hs-identifier hs-var">mRefScript</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-95"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="hs-comment">-- | Generating a skeleton context from a mockchain state. This is dedicated to</span><span>
</span><span id="line-98"></span><span class="hs-comment">-- allowing the pretty printer to resolve skeleton parts.</span><span>
</span><span id="line-99"></span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#mcstToSkelContext"><span class="hs-identifier hs-type">mcstToSkelContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#MockChainSt"><span class="hs-identifier hs-type">MockChainSt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cooked.Skeleton.html#SkelContext"><span class="hs-identifier hs-type">SkelContext</span></a></span><span>
</span><span id="line-100"></span><span id="mcstToSkelContext"><span class="annot"><span class="annottext">mcstToSkelContext :: MockChainSt -&gt; SkelContext
</span><a href="Cooked.MockChain.MockChainSt.html#mcstToSkelContext"><span class="hs-identifier hs-var hs-var">mcstToSkelContext</span></a></span></span><span> </span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#MockChainSt"><span class="hs-identifier hs-type">MockChainSt</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679830215"><span id="local-6989586621679830216"><span id="local-6989586621679830217"><span id="local-6989586621679830218"><span id="local-6989586621679830219"><span class="annot"><span class="annottext">Map DatumHash (TxSkelOutDatum, Integer)
Map ValidatorHash (Versioned Validator)
UtxoIndex
Params
Slot
mcstParams :: MockChainSt -&gt; Params
mcstIndex :: MockChainSt -&gt; UtxoIndex
mcstDatums :: MockChainSt -&gt; Map DatumHash (TxSkelOutDatum, Integer)
mcstValidators :: MockChainSt -&gt; Map ValidatorHash (Versioned Validator)
mcstCurrentSlot :: MockChainSt -&gt; Slot
mcstParams :: Params
mcstIndex :: UtxoIndex
mcstDatums :: Map DatumHash (TxSkelOutDatum, Integer)
mcstValidators :: Map ValidatorHash (Versioned Validator)
mcstCurrentSlot :: Slot
</span><a href="Cooked.MockChain.MockChainSt.html#mcstParams"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-101"></span><span>  </span><span class="annot"><span class="annottext">Map TxOutRef TxOut -&gt; Map DatumHash TxSkelOutDatum -&gt; SkelContext
</span><a href="Cooked.Skeleton.html#SkelContext"><span class="hs-identifier hs-var">SkelContext</span></a></span><span>
</span><span id="line-102"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UtxoIndex -&gt; Map TxOutRef TxOut
</span><a href="Cooked.MockChain.MockChainSt.html#getIndex"><span class="hs-identifier hs-var">getIndex</span></a></span><span> </span><span class="annot"><span class="annottext">UtxoIndex
</span><a href="#local-6989586621679830216"><span class="hs-identifier hs-var">mcstIndex</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((TxSkelOutDatum, Integer) -&gt; TxSkelOutDatum)
-&gt; Map DatumHash (TxSkelOutDatum, Integer)
-&gt; Map DatumHash TxSkelOutDatum
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">Map.map</span></span><span> </span><span class="annot"><span class="annottext">(TxSkelOutDatum, Integer) -&gt; TxSkelOutDatum
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">Map DatumHash (TxSkelOutDatum, Integer)
</span><a href="#local-6989586621679830217"><span class="hs-identifier hs-var">mcstDatums</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span class="hs-comment">-- | Generating an emulated state for the emulator from a mockchain state and</span><span>
</span><span id="line-106"></span><span class="hs-comment">-- some parameters, based on a standard initial state</span><span>
</span><span id="line-107"></span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#mcstToEmulatedLedgerState"><span class="hs-identifier hs-type">mcstToEmulatedLedgerState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#MockChainSt"><span class="hs-identifier hs-type">MockChainSt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Emulator.EmulatedLedgerState</span></span><span>
</span><span id="line-108"></span><span id="mcstToEmulatedLedgerState"><span class="annot"><span class="annottext">mcstToEmulatedLedgerState :: MockChainSt -&gt; EmulatedLedgerState
</span><a href="Cooked.MockChain.MockChainSt.html#mcstToEmulatedLedgerState"><span class="hs-identifier hs-var hs-var">mcstToEmulatedLedgerState</span></a></span></span><span> </span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#MockChainSt"><span class="hs-identifier hs-type">MockChainSt</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679830223"><span id="local-6989586621679830224"><span id="local-6989586621679830225"><span id="local-6989586621679830226"><span id="local-6989586621679830227"><span class="annot"><span class="annottext">Map DatumHash (TxSkelOutDatum, Integer)
Map ValidatorHash (Versioned Validator)
UtxoIndex
Params
Slot
mcstParams :: MockChainSt -&gt; Params
mcstIndex :: MockChainSt -&gt; UtxoIndex
mcstDatums :: MockChainSt -&gt; Map DatumHash (TxSkelOutDatum, Integer)
mcstValidators :: MockChainSt -&gt; Map ValidatorHash (Versioned Validator)
mcstCurrentSlot :: MockChainSt -&gt; Slot
mcstParams :: Params
mcstIndex :: UtxoIndex
mcstDatums :: Map DatumHash (TxSkelOutDatum, Integer)
mcstValidators :: Map ValidatorHash (Versioned Validator)
mcstCurrentSlot :: Slot
</span><a href="Cooked.MockChain.MockChainSt.html#mcstParams"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679830228"><span class="annot"><span class="annottext">els :: EmulatedLedgerState
</span><a href="#local-6989586621679830228"><span class="hs-identifier hs-var">els</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Emulator.EmulatedLedgerState</span></span><span> </span><span id="local-6989586621679830230"><span class="annot"><span class="annottext">MempoolEnv EmulatorEra
</span><a href="#local-6989586621679830230"><span class="hs-identifier hs-var">le</span></a></span></span><span> </span><span id="local-6989586621679830231"><span class="annot"><span class="annottext">LedgerState EmulatorEra
</span><a href="#local-6989586621679830231"><span class="hs-identifier hs-var">mps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Params -&gt; EmulatedLedgerState
</span><span class="hs-identifier hs-var">Emulator.initialState</span></span><span> </span><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679830223"><span class="hs-identifier hs-var">mcstParams</span></a></span><span>
</span><span id="line-110"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">EmulatedLedgerState
</span><a href="#local-6989586621679830228"><span class="hs-identifier hs-var">els</span></a></span><span>
</span><span id="line-111"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">Emulator._ledgerEnv</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679830230"><span class="hs-identifier hs-type">le</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="hs-identifier hs-var">Shelley.ledgerSlotNo</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fromIntegral</span></span><span> </span><span class="annot"><a href="#local-6989586621679830227"><span class="hs-identifier hs-type">mcstCurrentSlot</span></a></span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-112"></span><span>          </span><span class="annot"><span class="hs-identifier hs-var">Emulator._memPoolState</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-113"></span><span>            </span><span class="annot"><a href="#local-6989586621679830231"><span class="hs-identifier hs-type">mps</span></a></span><span>
</span><span id="line-114"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">Shelley.lsUTxOState</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-115"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Shelley.smartUTxOState</span></span><span>
</span><span id="line-116"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Emulator.emulatorPParams</span></span><span> </span><span class="annot"><a href="#local-6989586621679830223"><span class="hs-identifier hs-type">mcstParams</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ledger.fromPlutusIndex</span></span><span> </span><span class="annot"><a href="#local-6989586621679830224"><span class="hs-identifier hs-type">mcstIndex</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Emulator.Coin</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Emulator.Coin</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">def</span></span><span>
</span><span id="line-121"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Emulator.Coin</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-123"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#addDatums"><span class="hs-identifier hs-type">addDatums</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Api.DatumHash</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cooked.Skeleton.html#TxSkelOutDatum"><span class="hs-identifier hs-type">TxSkelOutDatum</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#MockChainSt"><span class="hs-identifier hs-type">MockChainSt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#MockChainSt"><span class="hs-identifier hs-type">MockChainSt</span></a></span><span>
</span><span id="line-126"></span><span id="addDatums"><span class="annot"><span class="annottext">addDatums :: [(DatumHash, TxSkelOutDatum)] -&gt; MockChainSt -&gt; MockChainSt
</span><a href="Cooked.MockChain.MockChainSt.html#addDatums"><span class="hs-identifier hs-var hs-var">addDatums</span></a></span></span><span> </span><span id="local-6989586621679830242"><span class="annot"><span class="annottext">[(DatumHash, TxSkelOutDatum)]
</span><a href="#local-6989586621679830242"><span class="hs-identifier hs-var">toAdd</span></a></span></span><span> </span><span id="local-6989586621679830243"><span class="annot"><span class="annottext">st :: MockChainSt
</span><a href="#local-6989586621679830243"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#MockChainSt"><span class="hs-identifier hs-type">MockChainSt</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679830244"><span class="annot"><span class="annottext">Map DatumHash (TxSkelOutDatum, Integer)
mcstDatums :: MockChainSt -&gt; Map DatumHash (TxSkelOutDatum, Integer)
mcstDatums :: Map DatumHash (TxSkelOutDatum, Integer)
</span><a href="Cooked.MockChain.MockChainSt.html#mcstDatums"><span class="hs-identifier hs-var hs-var">mcstDatums</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-127"></span><span>  </span><span class="annot"><span class="annottext">MockChainSt
</span><a href="#local-6989586621679830243"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-128"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#mcstDatums"><span class="hs-identifier hs-var">mcstDatums</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-129"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">foldl</span></span><span>
</span><span id="line-130"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679830246"><span class="annot"><span class="annottext">Map DatumHash (TxSkelOutDatum, Integer)
</span><a href="#local-6989586621679830246"><span class="hs-identifier hs-var">datumMap</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679830247"><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679830247"><span class="hs-identifier hs-var">dHash</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679830248"><span class="annot"><span class="annottext">TxSkelOutDatum
</span><a href="#local-6989586621679830248"><span class="hs-identifier hs-var">dat</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-131"></span><span>              </span><span class="annot"><span class="annottext">((TxSkelOutDatum, Integer)
 -&gt; (TxSkelOutDatum, Integer) -&gt; (TxSkelOutDatum, Integer))
-&gt; DatumHash
-&gt; (TxSkelOutDatum, Integer)
-&gt; Map DatumHash (TxSkelOutDatum, Integer)
-&gt; Map DatumHash (TxSkelOutDatum, Integer)
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insertWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679830249"><span class="annot"><span class="annottext">TxSkelOutDatum
</span><a href="#local-6989586621679830249"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679830250"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679830250"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxSkelOutDatum
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679830251"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679830251"><span class="hs-identifier hs-var">n'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxSkelOutDatum
</span><a href="#local-6989586621679830249"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679830250"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679830251"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679830247"><span class="hs-identifier hs-var">dHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxSkelOutDatum
</span><a href="#local-6989586621679830248"><span class="hs-identifier hs-var">dat</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map DatumHash (TxSkelOutDatum, Integer)
</span><a href="#local-6989586621679830246"><span class="hs-identifier hs-var">datumMap</span></a></span><span>
</span><span id="line-132"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>          </span><span class="annot"><a href="#local-6989586621679830244"><span class="hs-identifier hs-type">mcstDatums</span></a></span><span>
</span><span id="line-134"></span><span>          </span><span class="annot"><a href="#local-6989586621679830242"><span class="hs-identifier hs-type">toAdd</span></a></span><span>
</span><span id="line-135"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#removeDatums"><span class="hs-identifier hs-type">removeDatums</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Api.DatumHash</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#MockChainSt"><span class="hs-identifier hs-type">MockChainSt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#MockChainSt"><span class="hs-identifier hs-type">MockChainSt</span></a></span><span>
</span><span id="line-138"></span><span id="removeDatums"><span class="annot"><span class="annottext">removeDatums :: [DatumHash] -&gt; MockChainSt -&gt; MockChainSt
</span><a href="Cooked.MockChain.MockChainSt.html#removeDatums"><span class="hs-identifier hs-var hs-var">removeDatums</span></a></span></span><span> </span><span id="local-6989586621679830254"><span class="annot"><span class="annottext">[DatumHash]
</span><a href="#local-6989586621679830254"><span class="hs-identifier hs-var">toRemove</span></a></span></span><span> </span><span id="local-6989586621679830255"><span class="annot"><span class="annottext">st :: MockChainSt
</span><a href="#local-6989586621679830255"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#MockChainSt"><span class="hs-identifier hs-type">MockChainSt</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679830256"><span class="annot"><span class="annottext">Map DatumHash (TxSkelOutDatum, Integer)
mcstDatums :: MockChainSt -&gt; Map DatumHash (TxSkelOutDatum, Integer)
mcstDatums :: Map DatumHash (TxSkelOutDatum, Integer)
</span><a href="Cooked.MockChain.MockChainSt.html#mcstDatums"><span class="hs-identifier hs-var hs-var">mcstDatums</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-139"></span><span>  </span><span class="annot"><span class="annottext">MockChainSt
</span><a href="#local-6989586621679830255"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#mcstDatums"><span class="hs-identifier hs-var">mcstDatums</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-141"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">foldl</span></span><span>
</span><span id="line-142"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">flip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map.update</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679830259"><span class="annot"><span class="annottext">TxSkelOutDatum
</span><a href="#local-6989586621679830259"><span class="hs-identifier hs-var">dat</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679830260"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679830260"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxSkelOutDatum
</span><a href="#local-6989586621679830259"><span class="hs-identifier hs-var">dat</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; (TxSkelOutDatum, Integer))
-&gt; Maybe Integer -&gt; Maybe (TxSkelOutDatum, Integer)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Maybe Integer
</span><a href="#local-6989586621679830261"><span class="hs-identifier hs-var">minusMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679830260"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span>          </span><span class="annot"><a href="#local-6989586621679830256"><span class="hs-identifier hs-type">mcstDatums</span></a></span><span>
</span><span id="line-144"></span><span>          </span><span class="annot"><a href="#local-6989586621679830254"><span class="hs-identifier hs-type">toRemove</span></a></span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-146"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-comment">-- This is unsafe as this assumes n &gt;= 1</span><span>
</span><span id="line-148"></span><span>    </span><span class="annot"><a href="#local-6989586621679830261"><span class="hs-identifier hs-type">minusMaybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span>
</span><span id="line-149"></span><span>    </span><span id="local-6989586621679830261"><span class="annot"><span class="annottext">minusMaybe :: Integer -&gt; Maybe Integer
</span><a href="#local-6989586621679830261"><span class="hs-identifier hs-var hs-var">minusMaybe</span></a></span></span><span> </span><span id="local-6989586621679830262"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679830262"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679830262"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Integer
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-150"></span><span>    </span><span class="annot"><a href="#local-6989586621679830261"><span class="hs-identifier hs-var">minusMaybe</span></a></span><span> </span><span id="local-6989586621679830263"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679830263"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Maybe Integer
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Maybe Integer) -&gt; Integer -&gt; Maybe Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679830263"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#addValidators"><span class="hs-identifier hs-type">addValidators</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script.ValidatorHash</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Script.Versioned</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script.Validator</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#MockChainSt"><span class="hs-identifier hs-type">MockChainSt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#MockChainSt"><span class="hs-identifier hs-type">MockChainSt</span></a></span><span>
</span><span id="line-153"></span><span id="addValidators"><span class="annot"><span class="annottext">addValidators :: Map ValidatorHash (Versioned Validator)
-&gt; MockChainSt -&gt; MockChainSt
</span><a href="Cooked.MockChain.MockChainSt.html#addValidators"><span class="hs-identifier hs-var hs-var">addValidators</span></a></span></span><span> </span><span id="local-6989586621679830265"><span class="annot"><span class="annottext">Map ValidatorHash (Versioned Validator)
</span><a href="#local-6989586621679830265"><span class="hs-identifier hs-var">valMap</span></a></span></span><span> </span><span id="local-6989586621679830266"><span class="annot"><span class="annottext">st :: MockChainSt
</span><a href="#local-6989586621679830266"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#MockChainSt"><span class="hs-identifier hs-type">MockChainSt</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679830267"><span class="annot"><span class="annottext">Map ValidatorHash (Versioned Validator)
mcstValidators :: MockChainSt -&gt; Map ValidatorHash (Versioned Validator)
mcstValidators :: Map ValidatorHash (Versioned Validator)
</span><a href="Cooked.MockChain.MockChainSt.html#mcstValidators"><span class="hs-identifier hs-var hs-var">mcstValidators</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MockChainSt
</span><a href="#local-6989586621679830266"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#mcstValidators"><span class="hs-identifier hs-var">mcstValidators</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.union</span></span><span> </span><span class="annot"><a href="#local-6989586621679830265"><span class="hs-identifier hs-type">valMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679830267"><span class="hs-identifier hs-type">mcstValidators</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="annot"><span class="hs-comment">-- * Canonical initial values</span></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#utxoState0"><span class="hs-identifier hs-type">utxoState0</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cooked.MockChain.UtxoState.html#UtxoState"><span class="hs-identifier hs-type">UtxoState</span></a></span><span>
</span><span id="line-158"></span><span id="utxoState0"><span class="annot"><span class="annottext">utxoState0 :: UtxoState
</span><a href="Cooked.MockChain.MockChainSt.html#utxoState0"><span class="hs-identifier hs-var hs-var">utxoState0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MockChainSt -&gt; UtxoState
</span><a href="Cooked.MockChain.MockChainSt.html#mcstToUtxoState"><span class="hs-identifier hs-var">mcstToUtxoState</span></a></span><span> </span><span class="annot"><span class="annottext">MockChainSt
</span><a href="Cooked.MockChain.MockChainSt.html#mockChainSt0"><span class="hs-identifier hs-var">mockChainSt0</span></a></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#mockChainSt0"><span class="hs-identifier hs-type">mockChainSt0</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#MockChainSt"><span class="hs-identifier hs-type">MockChainSt</span></a></span><span>
</span><span id="line-161"></span><span id="mockChainSt0"><span class="annot"><span class="annottext">mockChainSt0 :: MockChainSt
</span><a href="Cooked.MockChain.MockChainSt.html#mockChainSt0"><span class="hs-identifier hs-var hs-var">mockChainSt0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Params
-&gt; UtxoIndex
-&gt; Map DatumHash (TxSkelOutDatum, Integer)
-&gt; Map ValidatorHash (Versioned Validator)
-&gt; Slot
-&gt; MockChainSt
</span><a href="Cooked.MockChain.MockChainSt.html#MockChainSt"><span class="hs-identifier hs-var">MockChainSt</span></a></span><span> </span><span class="annot"><span class="annottext">Params
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span> </span><span class="annot"><span class="annottext">UtxoIndex
</span><a href="Cooked.MockChain.MockChainSt.html#utxoIndex0"><span class="hs-identifier hs-var">utxoIndex0</span></a></span><span> </span><span class="annot"><span class="annottext">Map DatumHash (TxSkelOutDatum, Integer)
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span> </span><span class="annot"><span class="annottext">Map ValidatorHash (Versioned Validator)
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span> </span><span class="annot"><span class="annottext">Slot
</span><span class="hs-number">0</span></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="annot"><span class="hs-comment">-- * Initial `MockChainSt` from an initial distribution</span></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#mockChainSt0From"><span class="hs-identifier hs-type">mockChainSt0From</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cooked.InitialDistribution.html#InitialDistribution"><span class="hs-identifier hs-type">InitialDistribution</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#MockChainSt"><span class="hs-identifier hs-type">MockChainSt</span></a></span><span>
</span><span id="line-166"></span><span id="mockChainSt0From"><span class="annot"><span class="annottext">mockChainSt0From :: InitialDistribution -&gt; MockChainSt
</span><a href="Cooked.MockChain.MockChainSt.html#mockChainSt0From"><span class="hs-identifier hs-var hs-var">mockChainSt0From</span></a></span></span><span> </span><span id="local-6989586621679830272"><span class="annot"><span class="annottext">InitialDistribution
</span><a href="#local-6989586621679830272"><span class="hs-identifier hs-var">i0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Params
-&gt; UtxoIndex
-&gt; Map DatumHash (TxSkelOutDatum, Integer)
-&gt; Map ValidatorHash (Versioned Validator)
-&gt; Slot
-&gt; MockChainSt
</span><a href="Cooked.MockChain.MockChainSt.html#MockChainSt"><span class="hs-identifier hs-var">MockChainSt</span></a></span><span> </span><span class="annot"><span class="annottext">Params
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InitialDistribution -&gt; UtxoIndex
</span><a href="Cooked.MockChain.MockChainSt.html#utxoIndex0From"><span class="hs-identifier hs-var">utxoIndex0From</span></a></span><span> </span><span class="annot"><span class="annottext">InitialDistribution
</span><a href="#local-6989586621679830272"><span class="hs-identifier hs-var">i0</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InitialDistribution -&gt; Map DatumHash (TxSkelOutDatum, Integer)
</span><a href="Cooked.MockChain.MockChainSt.html#datumMap0From"><span class="hs-identifier hs-var">datumMap0From</span></a></span><span> </span><span class="annot"><span class="annottext">InitialDistribution
</span><a href="#local-6989586621679830272"><span class="hs-identifier hs-var">i0</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InitialDistribution -&gt; Map ValidatorHash (Versioned Validator)
</span><a href="Cooked.MockChain.MockChainSt.html#referenceScriptMap0From"><span class="hs-identifier hs-var">referenceScriptMap0From</span></a></span><span> </span><span class="annot"><span class="annottext">InitialDistribution
</span><a href="#local-6989586621679830272"><span class="hs-identifier hs-var">i0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Slot
</span><span class="hs-number">0</span></span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span class="hs-comment">-- | Reference scripts from initial distributions should be accounted for in the</span><span>
</span><span id="line-169"></span><span class="hs-comment">-- `MockChainSt` which is done using this function.</span><span>
</span><span id="line-170"></span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#referenceScriptMap0From"><span class="hs-identifier hs-type">referenceScriptMap0From</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cooked.InitialDistribution.html#InitialDistribution"><span class="hs-identifier hs-type">InitialDistribution</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script.ValidatorHash</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Script.Versioned</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script.Validator</span></span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span id="referenceScriptMap0From"><span class="annot"><span class="annottext">referenceScriptMap0From :: InitialDistribution -&gt; Map ValidatorHash (Versioned Validator)
</span><a href="Cooked.MockChain.MockChainSt.html#referenceScriptMap0From"><span class="hs-identifier hs-var hs-var">referenceScriptMap0From</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.InitialDistribution.html#InitialDistribution"><span class="hs-identifier hs-type">InitialDistribution</span></a></span><span> </span><span id="local-6989586621679830277"><span class="annot"><span class="annottext">[TxSkelOut]
</span><a href="#local-6989586621679830277"><span class="hs-identifier hs-var">initDist</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-172"></span><span>  </span><span class="hs-comment">-- This builds a map of entries from the reference scripts contained in the</span><span>
</span><span id="line-173"></span><span>  </span><span class="hs-comment">-- initial distribution</span><span>
</span><span id="line-174"></span><span>  </span><span class="annot"><span class="annottext">[(ValidatorHash, Versioned Validator)]
-&gt; Map ValidatorHash (Versioned Validator)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(ValidatorHash, Versioned Validator)]
 -&gt; Map ValidatorHash (Versioned Validator))
-&gt; [(ValidatorHash, Versioned Validator)]
-&gt; Map ValidatorHash (Versioned Validator)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TxSkelOut -&gt; Maybe (ValidatorHash, Versioned Validator))
-&gt; [TxSkelOut] -&gt; [(ValidatorHash, Versioned Validator)]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">TxSkelOut -&gt; Maybe (ValidatorHash, Versioned Validator)
</span><a href="#local-6989586621679830278"><span class="hs-identifier hs-var">unitMaybeFrom</span></a></span><span> </span><span class="annot"><span class="annottext">[TxSkelOut]
</span><a href="#local-6989586621679830277"><span class="hs-identifier hs-var">initDist</span></a></span><span>
</span><span id="line-175"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-comment">-- This takes a single output and returns a possible map entry when it</span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-comment">-- contains a reference script</span><span>
</span><span id="line-178"></span><span>    </span><span class="annot"><a href="#local-6989586621679830278"><span class="hs-identifier hs-type">unitMaybeFrom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cooked.Skeleton.html#TxSkelOut"><span class="hs-identifier hs-type">TxSkelOut</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Script.ValidatorHash</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script.Versioned</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script.Validator</span></span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>    </span><span id="local-6989586621679830278"><span class="annot"><span class="annottext">unitMaybeFrom :: TxSkelOut -&gt; Maybe (ValidatorHash, Versioned Validator)
</span><a href="#local-6989586621679830278"><span class="hs-identifier hs-var hs-var">unitMaybeFrom</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Skeleton.html#Pays"><span class="hs-identifier hs-type">Pays</span></a></span><span> </span><span id="local-6989586621679830300"><span class="annot"><span class="annottext">o
</span><a href="#local-6989586621679830300"><span class="hs-identifier hs-var">output</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-180"></span><span>      </span><span id="local-6989586621679830301"><span class="annot"><span class="annottext">ReferenceScriptType o
</span><a href="#local-6989586621679830301"><span class="hs-identifier hs-var">refScript</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx o (Maybe (ReferenceScriptType o))
-&gt; o -&gt; Maybe (ReferenceScriptType o)
forall k (is :: IxList) s a.
Is k A_Getter =&gt;
Optic' k is s a -&gt; s -&gt; a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx o (Maybe (ReferenceScriptType o))
forall o.
IsAbstractOutput o =&gt;
Lens' o (Maybe (ReferenceScriptType o))
</span><a href="Cooked.Output.html#outputReferenceScriptL"><span class="hs-identifier hs-var">outputReferenceScriptL</span></a></span><span> </span><span class="annot"><span class="annottext">o
</span><a href="#local-6989586621679830300"><span class="hs-identifier hs-var">output</span></a></span><span>
</span><span id="line-181"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679830303"><span class="annot"><span class="annottext">vScript :: Versioned Script
</span><a href="#local-6989586621679830303"><span class="hs-identifier hs-var">vScript</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Script.Versioned</span></span><span> </span><span id="local-6989586621679830305"><span class="annot"><span class="annottext">Script
</span><a href="#local-6989586621679830305"><span class="hs-identifier hs-var">script</span></a></span></span><span> </span><span id="local-6989586621679830306"><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621679830306"><span class="hs-identifier hs-var">version</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReferenceScriptType o -&gt; Versioned Script
forall a. ToVersionedScript a =&gt; a -&gt; Versioned Script
</span><a href="Cooked.Conversion.ToVersionedScript.html#toVersionedScript"><span class="hs-identifier hs-var">toVersionedScript</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceScriptType o
</span><a href="#local-6989586621679830301"><span class="hs-identifier hs-var">refScript</span></a></span><span>
</span><span id="line-182"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Api.ScriptHash</span></span><span> </span><span id="local-6989586621679830309"><span class="annot"><span class="annottext">BuiltinByteString
</span><a href="#local-6989586621679830309"><span class="hs-identifier hs-var">scriptHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Versioned Script -&gt; ScriptHash
forall a. ToScriptHash a =&gt; a -&gt; ScriptHash
</span><a href="Cooked.Conversion.ToScriptHash.html#toScriptHash"><span class="hs-identifier hs-var">toScriptHash</span></a></span><span> </span><span class="annot"><span class="annottext">Versioned Script
</span><a href="#local-6989586621679830303"><span class="hs-identifier hs-var">vScript</span></a></span><span>
</span><span id="line-183"></span><span>      </span><span class="annot"><span class="annottext">(ValidatorHash, Versioned Validator)
-&gt; Maybe (ValidatorHash, Versioned Validator)
forall a. a -&gt; Maybe a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuiltinByteString -&gt; ValidatorHash
</span><span class="hs-identifier hs-var">Script.ValidatorHash</span></span><span> </span><span class="annot"><span class="annottext">BuiltinByteString
</span><a href="#local-6989586621679830309"><span class="hs-identifier hs-var">scriptHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Validator -&gt; Language -&gt; Versioned Validator
forall script. script -&gt; Language -&gt; Versioned script
</span><span class="hs-identifier hs-var">Script.Versioned</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Script -&gt; Validator
</span><span class="hs-identifier hs-var">Script.Validator</span></span><span> </span><span class="annot"><span class="annottext">Script
</span><a href="#local-6989586621679830305"><span class="hs-identifier hs-var">script</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621679830306"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span class="hs-comment">-- | Datums from initial distributions should be accounted for in the</span><span>
</span><span id="line-186"></span><span class="hs-comment">-- `MockChainSt` which is done using this function.</span><span>
</span><span id="line-187"></span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#datumMap0From"><span class="hs-identifier hs-type">datumMap0From</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cooked.InitialDistribution.html#InitialDistribution"><span class="hs-identifier hs-type">InitialDistribution</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.DatumHash</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Skeleton.html#TxSkelOutDatum"><span class="hs-identifier hs-type">TxSkelOutDatum</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span id="datumMap0From"><span class="annot"><span class="annottext">datumMap0From :: InitialDistribution -&gt; Map DatumHash (TxSkelOutDatum, Integer)
</span><a href="Cooked.MockChain.MockChainSt.html#datumMap0From"><span class="hs-identifier hs-var hs-var">datumMap0From</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.InitialDistribution.html#InitialDistribution"><span class="hs-identifier hs-type">InitialDistribution</span></a></span><span> </span><span id="local-6989586621679830313"><span class="annot"><span class="annottext">[TxSkelOut]
</span><a href="#local-6989586621679830313"><span class="hs-identifier hs-var">initDist</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-189"></span><span>  </span><span class="hs-comment">-- This concatenates singleton maps from inputs and accounts for the number of</span><span>
</span><span id="line-190"></span><span>  </span><span class="hs-comment">-- occurrences of similar datums</span><span>
</span><span id="line-191"></span><span>  </span><span class="annot"><span class="annottext">(Map DatumHash (TxSkelOutDatum, Integer)
 -&gt; TxSkelOut -&gt; Map DatumHash (TxSkelOutDatum, Integer))
-&gt; Map DatumHash (TxSkelOutDatum, Integer)
-&gt; [TxSkelOut]
-&gt; Map DatumHash (TxSkelOutDatum, Integer)
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679830314"><span class="annot"><span class="annottext">Map DatumHash (TxSkelOutDatum, Integer)
</span><a href="#local-6989586621679830314"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((TxSkelOutDatum, Integer)
 -&gt; (TxSkelOutDatum, Integer) -&gt; (TxSkelOutDatum, Integer))
-&gt; Map DatumHash (TxSkelOutDatum, Integer)
-&gt; Map DatumHash (TxSkelOutDatum, Integer)
-&gt; Map DatumHash (TxSkelOutDatum, Integer)
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.unionWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679830316"><span class="annot"><span class="annottext">TxSkelOutDatum
</span><a href="#local-6989586621679830316"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679830317"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679830317"><span class="hs-identifier hs-var">n1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxSkelOutDatum
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679830318"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679830318"><span class="hs-identifier hs-var">n2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxSkelOutDatum
</span><a href="#local-6989586621679830316"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679830317"><span class="hs-identifier hs-var">n1</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679830318"><span class="hs-identifier hs-var">n2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map DatumHash (TxSkelOutDatum, Integer)
</span><a href="#local-6989586621679830314"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">(Map DatumHash (TxSkelOutDatum, Integer)
 -&gt; Map DatumHash (TxSkelOutDatum, Integer))
-&gt; (TxSkelOut -&gt; Map DatumHash (TxSkelOutDatum, Integer))
-&gt; TxSkelOut
-&gt; Map DatumHash (TxSkelOutDatum, Integer)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TxSkelOut -&gt; Map DatumHash (TxSkelOutDatum, Integer)
</span><a href="#local-6989586621679830319"><span class="hs-identifier hs-var">unitMapFrom</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map DatumHash (TxSkelOutDatum, Integer)
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span> </span><span class="annot"><span class="annottext">[TxSkelOut]
</span><a href="#local-6989586621679830313"><span class="hs-identifier hs-var">initDist</span></a></span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-comment">-- This takes a single output and creates an empty map if it contains no</span><span>
</span><span id="line-194"></span><span>    </span><span class="hs-comment">-- datum, or a singleton map if it contains one</span><span>
</span><span id="line-195"></span><span>    </span><span class="annot"><a href="#local-6989586621679830319"><span class="hs-identifier hs-type">unitMapFrom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cooked.Skeleton.html#TxSkelOut"><span class="hs-identifier hs-type">TxSkelOut</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.DatumHash</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.Skeleton.html#TxSkelOutDatum"><span class="hs-identifier hs-type">TxSkelOutDatum</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>    </span><span id="local-6989586621679830319"><span class="annot"><span class="annottext">unitMapFrom :: TxSkelOut -&gt; Map DatumHash (TxSkelOutDatum, Integer)
</span><a href="#local-6989586621679830319"><span class="hs-identifier hs-var hs-var">unitMapFrom</span></a></span></span><span> </span><span id="local-6989586621679830320"><span class="annot"><span class="annottext">TxSkelOut
</span><a href="#local-6989586621679830320"><span class="hs-identifier hs-var">txSkelOut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-197"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679830321"><span class="annot"><span class="annottext">datum :: TxSkelOutDatum
</span><a href="#local-6989586621679830321"><span class="hs-identifier hs-var hs-var">datum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx TxSkelOut TxSkelOutDatum
-&gt; TxSkelOut -&gt; TxSkelOutDatum
forall k (is :: IxList) s a.
Is k A_Getter =&gt;
Optic' k is s a -&gt; s -&gt; a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx TxSkelOut TxSkelOutDatum
</span><a href="Cooked.Skeleton.html#txSkelOutDatumL"><span class="hs-identifier hs-var">txSkelOutDatumL</span></a></span><span> </span><span class="annot"><span class="annottext">TxSkelOut
</span><a href="#local-6989586621679830320"><span class="hs-identifier hs-var">txSkelOut</span></a></span><span>
</span><span id="line-198"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Map DatumHash (TxSkelOutDatum, Integer)
-&gt; (Datum -&gt; Map DatumHash (TxSkelOutDatum, Integer))
-&gt; Maybe Datum
-&gt; Map DatumHash (TxSkelOutDatum, Integer)
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Map DatumHash (TxSkelOutDatum, Integer)
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DatumHash
 -&gt; (TxSkelOutDatum, Integer)
 -&gt; Map DatumHash (TxSkelOutDatum, Integer))
-&gt; (TxSkelOutDatum, Integer)
-&gt; DatumHash
-&gt; Map DatumHash (TxSkelOutDatum, Integer)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">DatumHash
-&gt; (TxSkelOutDatum, Integer)
-&gt; Map DatumHash (TxSkelOutDatum, Integer)
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxSkelOutDatum
</span><a href="#local-6989586621679830321"><span class="hs-identifier hs-var">datum</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DatumHash -&gt; Map DatumHash (TxSkelOutDatum, Integer))
-&gt; (Datum -&gt; DatumHash)
-&gt; Datum
-&gt; Map DatumHash (TxSkelOutDatum, Integer)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Datum -&gt; DatumHash
</span><span class="hs-identifier hs-var">Script.datumHash</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe Datum -&gt; Map DatumHash (TxSkelOutDatum, Integer))
-&gt; Maybe Datum -&gt; Map DatumHash (TxSkelOutDatum, Integer)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TxSkelOutDatum -&gt; Maybe Datum
</span><a href="Cooked.Skeleton.html#txSkelOutUntypedDatum"><span class="hs-identifier hs-var">txSkelOutUntypedDatum</span></a></span><span> </span><span class="annot"><span class="annottext">TxSkelOutDatum
</span><a href="#local-6989586621679830321"><span class="hs-identifier hs-var">datum</span></a></span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="hs-comment">-- | This creates the initial UtxoIndex from an initial distribution by</span><span>
</span><span id="line-201"></span><span class="hs-comment">-- submitting an initial transaction with the appropriate content:</span><span>
</span><span id="line-202"></span><span class="hs-comment">--</span><span>
</span><span id="line-203"></span><span class="hs-comment">-- - inputs consist of a single dummy pseudo input</span><span>
</span><span id="line-204"></span><span class="hs-comment">--</span><span>
</span><span id="line-205"></span><span class="hs-comment">-- - all non-ada assets in outputs are considered minted</span><span>
</span><span id="line-206"></span><span class="hs-comment">--</span><span>
</span><span id="line-207"></span><span class="hs-comment">-- - outputs are translated from the `TxSkelOut` list in the initial</span><span>
</span><span id="line-208"></span><span class="hs-comment">--   distribution</span><span>
</span><span id="line-209"></span><span class="hs-comment">--</span><span>
</span><span id="line-210"></span><span class="hs-comment">-- Two things to note:</span><span>
</span><span id="line-211"></span><span class="hs-comment">--</span><span>
</span><span id="line-212"></span><span class="hs-comment">-- - We don't know what &quot;Magic&quot; means for the network ID (TODO)</span><span>
</span><span id="line-213"></span><span class="hs-comment">--</span><span>
</span><span id="line-214"></span><span class="hs-comment">-- - The genesis key hash has been taken from</span><span>
</span><span id="line-215"></span><span class="hs-comment">--   https://github.com/input-output-hk/cardano-node/blob/543b267d75d3d448e1940f9ec04b42bd01bbb16b/cardano-api/test/Test/Cardano/Api/Genesis.hs#L60</span><span>
</span><span id="line-216"></span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#utxoIndex0From"><span class="hs-identifier hs-type">utxoIndex0From</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cooked.InitialDistribution.html#InitialDistribution"><span class="hs-identifier hs-type">InitialDistribution</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.UtxoIndex</span></span><span>
</span><span id="line-217"></span><span id="utxoIndex0From"><span class="annot"><span class="annottext">utxoIndex0From :: InitialDistribution -&gt; UtxoIndex
</span><a href="Cooked.MockChain.MockChainSt.html#utxoIndex0From"><span class="hs-identifier hs-var hs-var">utxoIndex0From</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.InitialDistribution.html#InitialDistribution"><span class="hs-identifier hs-type">InitialDistribution</span></a></span><span> </span><span id="local-6989586621679830326"><span class="annot"><span class="annottext">[TxSkelOut]
</span><a href="#local-6989586621679830326"><span class="hs-identifier hs-var">initDist</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either GenerateTxError (TxBody ConwayEra)
</span><a href="#local-6989586621679830327"><span class="hs-identifier hs-var">mkBody</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-218"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679830328"><span class="annot"><span class="annottext">GenerateTxError
</span><a href="#local-6989586621679830328"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; UtxoIndex
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; UtxoIndex) -&gt; String -&gt; UtxoIndex
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GenerateTxError -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">GenerateTxError
</span><a href="#local-6989586621679830328"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-219"></span><span>  </span><span class="hs-comment">-- TODO: There may be better ways to generate this initial state, see</span><span>
</span><span id="line-220"></span><span>  </span><span class="hs-comment">-- createGenesisTransaction for instance</span><span>
</span><span id="line-221"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679830331"><span class="annot"><span class="annottext">TxBody ConwayEra
</span><a href="#local-6989586621679830331"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Blockchain -&gt; UtxoIndex
</span><span class="hs-identifier hs-var">Ledger.initialise</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><span class="annottext">CardanoTx -&gt; OnChainTx
</span><span class="hs-identifier hs-var">Emulator.unsafeMakeValid</span></span><span> </span><span class="annot"><span class="annottext">(CardanoTx -&gt; OnChainTx) -&gt; CardanoTx -&gt; OnChainTx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tx ConwayEra -&gt; CardanoTx
</span><span class="hs-identifier hs-var">Ledger.CardanoEmulatorEraTx</span></span><span> </span><span class="annot"><span class="annottext">(Tx ConwayEra -&gt; CardanoTx) -&gt; Tx ConwayEra -&gt; CardanoTx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TxBody ConwayEra -&gt; [KeyWitness ConwayEra] -&gt; Tx ConwayEra
forall era. TxBody era -&gt; [KeyWitness era] -&gt; Tx era
</span><span class="hs-identifier hs-var">Cardano.Tx</span></span><span> </span><span class="annot"><span class="annottext">TxBody ConwayEra
</span><a href="#local-6989586621679830331"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-222"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-223"></span><span>    </span><span class="annot"><a href="#local-6989586621679830327"><span class="hs-identifier hs-type">mkBody</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.Common.html#GenerateTxError"><span class="hs-identifier hs-type">GenerateTxError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Cardano.TxBody</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.ConwayEra</span></span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>    </span><span id="local-6989586621679830327"><span class="annot"><span class="annottext">mkBody :: Either GenerateTxError (TxBody ConwayEra)
</span><a href="#local-6989586621679830327"><span class="hs-identifier hs-var hs-var">mkBody</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-225"></span><span>      </span><span id="local-6989586621679830336"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679830336"><span class="hs-identifier hs-var">value</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ToCardanoError -&gt; GenerateTxError)
-&gt; Either ToCardanoError Value -&gt; Either GenerateTxError Value
forall a c b. (a -&gt; c) -&gt; Either a b -&gt; Either c b
</span><span class="hs-identifier hs-var">mapLeft</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ToCardanoError -&gt; GenerateTxError
</span><a href="Cooked.MockChain.GenerateTx.Common.html#ToCardanoError"><span class="hs-identifier hs-var">ToCardanoError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Value error&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either ToCardanoError Value -&gt; Either GenerateTxError Value)
-&gt; Either ToCardanoError Value -&gt; Either GenerateTxError Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Either ToCardanoError Value
</span><span class="hs-identifier hs-var">Ledger.toCardanoValue</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Value -&gt; TxSkelOut -&gt; Value) -&gt; Value -&gt; [TxSkelOut] -&gt; Value
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679830339"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679830339"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679830339"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Value) -&gt; (TxSkelOut -&gt; Value) -&gt; TxSkelOut -&gt; Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx TxSkelOut Value -&gt; TxSkelOut -&gt; Value
forall k (is :: IxList) s a.
Is k A_Getter =&gt;
Optic' k is s a -&gt; s -&gt; a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx TxSkelOut Value
</span><a href="Cooked.Skeleton.html#txSkelOutValueL"><span class="hs-identifier hs-var">txSkelOutValueL</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Value
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">[TxSkelOut]
</span><a href="#local-6989586621679830326"><span class="hs-identifier hs-var">initDist</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679830341"><span class="annot"><span class="annottext">mintValue :: TxMintValue BuildTx ConwayEra
</span><a href="#local-6989586621679830341"><span class="hs-identifier hs-var hs-var">mintValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Value
 -&gt; BuildTxWith
      BuildTx (Map PolicyId (ScriptWitness WitCtxMint ConwayEra))
 -&gt; TxMintValue BuildTx ConwayEra)
-&gt; BuildTxWith
     BuildTx (Map PolicyId (ScriptWitness WitCtxMint ConwayEra))
-&gt; Value
-&gt; TxMintValue BuildTx ConwayEra
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MaryEraOnwards ConwayEra
-&gt; Value
-&gt; BuildTxWith
     BuildTx (Map PolicyId (ScriptWitness WitCtxMint ConwayEra))
-&gt; TxMintValue BuildTx ConwayEra
forall era build.
MaryEraOnwards era
-&gt; Value
-&gt; BuildTxWith build (Map PolicyId (ScriptWitness WitCtxMint era))
-&gt; TxMintValue build era
</span><span class="hs-identifier hs-var">Cardano.TxMintValue</span></span><span> </span><span class="annot"><span class="annottext">MaryEraOnwards ConwayEra
</span><span class="hs-identifier hs-var">Cardano.MaryEraOnwardsConway</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map PolicyId (ScriptWitness WitCtxMint ConwayEra)
-&gt; BuildTxWith
     BuildTx (Map PolicyId (ScriptWitness WitCtxMint ConwayEra))
forall a. a -&gt; BuildTxWith BuildTx a
</span><span class="hs-identifier hs-var">Cardano.BuildTxWith</span></span><span> </span><span class="annot"><span class="annottext">Map PolicyId (ScriptWitness WitCtxMint ConwayEra)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Value -&gt; TxMintValue BuildTx ConwayEra)
-&gt; (Value -&gt; Value) -&gt; Value -&gt; TxMintValue BuildTx ConwayEra
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(AssetId -&gt; Bool) -&gt; Value -&gt; Value
</span><span class="hs-identifier hs-var">Cardano.filterValue</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AssetId -&gt; AssetId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">AssetId
</span><span class="hs-identifier hs-var">Cardano.AdaAssetId</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Value -&gt; TxMintValue BuildTx ConwayEra)
-&gt; Value -&gt; TxMintValue BuildTx ConwayEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679830336"><span class="hs-identifier hs-var">value</span></a></span><span>
</span><span id="line-227"></span><span>          </span><span id="local-6989586621679830350"><span class="annot"><span class="annottext">theNetworkId :: NetworkId
</span><a href="#local-6989586621679830350"><span class="hs-identifier hs-var hs-var">theNetworkId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkMagic -&gt; NetworkId
</span><span class="hs-identifier hs-var">Cardano.Testnet</span></span><span> </span><span class="annot"><span class="annottext">(NetworkMagic -&gt; NetworkId) -&gt; NetworkMagic -&gt; NetworkId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; NetworkMagic
</span><span class="hs-identifier hs-var">Cardano.NetworkMagic</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">42</span></span><span>
</span><span id="line-228"></span><span>          </span><span id="local-6989586621679830357"><span class="annot"><span class="annottext">genesisKeyHash :: Hash GenesisUTxOKey
</span><a href="#local-6989586621679830357"><span class="hs-identifier hs-var hs-var">genesisKeyHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KeyHash 'Payment StandardCrypto -&gt; Hash GenesisUTxOKey
</span><span class="hs-identifier hs-var">Cardano.GenesisUTxOKeyHash</span></span><span> </span><span class="annot"><span class="annottext">(KeyHash 'Payment StandardCrypto -&gt; Hash GenesisUTxOKey)
-&gt; KeyHash 'Payment StandardCrypto -&gt; Hash GenesisUTxOKey
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Hash (ADDRHASH StandardCrypto) (VerKeyDSIGN (DSIGN StandardCrypto))
-&gt; KeyHash 'Payment StandardCrypto
forall (discriminator :: KeyRole) c.
Hash (ADDRHASH c) (VerKeyDSIGN (DSIGN c))
-&gt; KeyHash discriminator c
</span><span class="hs-identifier hs-var">Shelley.KeyHash</span></span><span> </span><span class="annot"><span class="annottext">Hash (ADDRHASH StandardCrypto) (VerKeyDSIGN (DSIGN StandardCrypto))
Hash Blake2b_224 (VerKeyDSIGN Ed25519DSIGN)
</span><span class="hs-string">&quot;23d51e91ae5adc7ae801e9de4cd54175fb7464ec2680b25686bbb194&quot;</span></span><span>
</span><span id="line-229"></span><span>          </span><span id="local-6989586621679830360"><span class="annot"><span class="annottext">inputs :: [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn era))]
</span><a href="#local-6989586621679830360"><span class="hs-identifier hs-var hs-var">inputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">NetworkId -&gt; Hash GenesisUTxOKey -&gt; TxIn
</span><span class="hs-identifier hs-var">Cardano.genesisUTxOPseudoTxIn</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621679830350"><span class="hs-identifier hs-var">theNetworkId</span></a></span><span> </span><span class="annot"><span class="annottext">Hash GenesisUTxOKey
</span><a href="#local-6989586621679830357"><span class="hs-identifier hs-var">genesisKeyHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Witness WitCtxTxIn era
-&gt; BuildTxWith BuildTx (Witness WitCtxTxIn era)
forall a. a -&gt; BuildTxWith BuildTx a
</span><span class="hs-identifier hs-var">Cardano.BuildTxWith</span></span><span> </span><span class="annot"><span class="annottext">(Witness WitCtxTxIn era
 -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn era))
-&gt; Witness WitCtxTxIn era
-&gt; BuildTxWith BuildTx (Witness WitCtxTxIn era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">KeyWitnessInCtx WitCtxTxIn -&gt; Witness WitCtxTxIn era
forall witctx era. KeyWitnessInCtx witctx -&gt; Witness witctx era
</span><span class="hs-identifier hs-var">Cardano.KeyWitness</span></span><span> </span><span class="annot"><span class="annottext">KeyWitnessInCtx WitCtxTxIn
</span><span class="hs-identifier hs-var">Cardano.KeyWitnessForSpending</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-230"></span><span>      </span><span id="local-6989586621679830364"><span class="annot"><span class="annottext">[TxOut CtxTx ConwayEra]
</span><a href="#local-6989586621679830364"><span class="hs-identifier hs-var">outputs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TxSkelOut -&gt; Either GenerateTxError (TxOut CtxTx ConwayEra))
-&gt; [TxSkelOut] -&gt; Either GenerateTxError [TxOut CtxTx ConwayEra]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NetworkId
-&gt; TxSkelOut -&gt; Either GenerateTxError (TxOut CtxTx ConwayEra)
</span><a href="Cooked.MockChain.GenerateTx.html#generateTxOut"><span class="hs-identifier hs-var">generateTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621679830350"><span class="hs-identifier hs-var">theNetworkId</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TxSkelOut]
</span><a href="#local-6989586621679830326"><span class="hs-identifier hs-var">initDist</span></a></span><span>
</span><span id="line-231"></span><span>      </span><span class="annot"><span class="annottext">(TxBodyError -&gt; GenerateTxError)
-&gt; Either TxBodyError (TxBody ConwayEra)
-&gt; Either GenerateTxError (TxBody ConwayEra)
forall a c b. (a -&gt; c) -&gt; Either a b -&gt; Either c b
forall (a :: * -&gt; * -&gt; *) b c d.
ArrowChoice a =&gt;
a b c -&gt; a (Either b d) (Either c d)
</span><span class="hs-identifier hs-var">left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; TxBodyError -&gt; GenerateTxError
</span><a href="Cooked.MockChain.GenerateTx.Common.html#TxBodyError"><span class="hs-identifier hs-var">TxBodyError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Body error&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either TxBodyError (TxBody ConwayEra)
 -&gt; Either GenerateTxError (TxBody ConwayEra))
-&gt; Either TxBodyError (TxBody ConwayEra)
-&gt; Either GenerateTxError (TxBody ConwayEra)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-232"></span><span>        </span><span class="annot"><span class="annottext">ShelleyBasedEra ConwayEra
-&gt; TxBodyContent BuildTx ConwayEra
-&gt; Either TxBodyError (TxBody ConwayEra)
forall era.
ShelleyBasedEra era
-&gt; TxBodyContent BuildTx era -&gt; Either TxBodyError (TxBody era)
</span><span class="hs-identifier hs-var">Cardano.createAndValidateTransactionBody</span></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra ConwayEra
</span><span class="hs-identifier hs-var">Cardano.ShelleyBasedEraConway</span></span><span> </span><span class="annot"><span class="annottext">(TxBodyContent BuildTx ConwayEra
 -&gt; Either TxBodyError (TxBody ConwayEra))
-&gt; TxBodyContent BuildTx ConwayEra
-&gt; Either TxBodyError (TxBody ConwayEra)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-233"></span><span>          </span><span class="annot"><span class="annottext">TxBodyContent BuildTx ConwayEra
</span><span class="hs-identifier hs-var">Ledger.emptyTxBodyContent</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="hs-identifier hs-var">Cardano.txMintValue</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679830341"><span class="hs-identifier hs-type">mintValue</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">Cardano.txOuts</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679830364"><span class="hs-identifier hs-type">outputs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">Cardano.txIns</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679830360"><span class="hs-identifier hs-type">inputs</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span class="annot"><a href="Cooked.MockChain.MockChainSt.html#utxoIndex0"><span class="hs-identifier hs-type">utxoIndex0</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ledger.UtxoIndex</span></span><span>
</span><span id="line-236"></span><span id="utxoIndex0"><span class="annot"><span class="annottext">utxoIndex0 :: UtxoIndex
</span><a href="Cooked.MockChain.MockChainSt.html#utxoIndex0"><span class="hs-identifier hs-var hs-var">utxoIndex0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InitialDistribution -&gt; UtxoIndex
</span><a href="Cooked.MockChain.MockChainSt.html#utxoIndex0From"><span class="hs-identifier hs-var">utxoIndex0From</span></a></span><span> </span><span class="annot"><span class="annottext">InitialDistribution
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span>
</span><span id="line-237"></span></pre></body></html>