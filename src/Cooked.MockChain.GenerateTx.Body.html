<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | This modules exposes entry points to convert a 'TxSkel' into a fully</span><span>
</span><span id="line-2"></span><span class="hs-comment">-- fledged transaction body</span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cooked.MockChain.GenerateTx.Body</span><span>
</span><span id="line-4"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.Body.html#txSkelToTxBody"><span class="hs-identifier">txSkelToTxBody</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-5"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.Body.html#txBodyContentToTxBody"><span class="hs-identifier">txBodyContentToTxBody</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-6"></span><span>    </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.Body.html#txSkelToTxBodyContent"><span class="hs-identifier">txSkelToTxBodyContent</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-7"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span class="hs-keyword">where</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Api</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Cardano</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Api.Shelley</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Cardano</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Alonzo.Tx</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Alonzo</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Alonzo.TxBody</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Alonzo</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Alonzo.TxWits</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Alonzo</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Conway.PParams</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Conway</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Plutus</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Cardano</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Node.Emulator.Internal.Node</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Emulator</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Lens</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.MockChain.BlockChain.html"><span class="hs-identifier">Cooked.MockChain.BlockChain</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.Collateral.html"><span class="hs-identifier">Cooked.MockChain.GenerateTx.Collateral</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Collateral</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.Common.html"><span class="hs-identifier">Cooked.MockChain.GenerateTx.Common</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.Input.html"><span class="hs-identifier">Cooked.MockChain.GenerateTx.Input</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Input</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.Mint.html"><span class="hs-identifier">Cooked.MockChain.GenerateTx.Mint</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Mint</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.Output.html"><span class="hs-identifier">Cooked.MockChain.GenerateTx.Output</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Output</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.Proposal.html"><span class="hs-identifier">Cooked.MockChain.GenerateTx.Proposal</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Proposal</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.MockChain.GenerateTx.Withdrawals.html"><span class="hs-identifier">Cooked.MockChain.GenerateTx.Withdrawals</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Withdrawals</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.Skeleton.html"><span class="hs-identifier">Cooked.Skeleton</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cooked.Wallet.html"><span class="hs-identifier">Cooked.Wallet</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Address</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ledger</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Tx.CardanoAPI</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ledger</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusLedgerApi.V3</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Api</span></span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="annot"><span class="hs-comment">-- | Generates a body content from a skeleton</span></span><span>
</span><span id="line-39"></span><span id="local-6989586621679833453"><span class="annot"><a href="Cooked.MockChain.GenerateTx.Body.html#txSkelToTxBodyContent"><span class="hs-identifier hs-type">txSkelToTxBodyContent</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-type">MonadBlockChainBalancing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679833453"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-41"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The skeleton from which the body is created</span></span><span>
</span><span id="line-42"></span><span>  </span><span class="annot"><a href="Cooked.Skeleton.html#TxSkel"><span class="hs-identifier hs-type">TxSkel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-43"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The fee to set in the body</span></span><span>
</span><span id="line-44"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-45"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The collaterals to set in the body</span></span><span>
</span><span id="line-46"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOutRef</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cooked.Wallet.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-47"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Returns a Cardano body content</span></span><span>
</span><span id="line-48"></span><span>  </span><span class="annot"><a href="#local-6989586621679833453"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Cardano.TxBodyContent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.BuildTx</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.ConwayEra</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-49"></span><span id="txSkelToTxBodyContent"><span class="annot"><span class="annottext">txSkelToTxBodyContent :: forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
TxSkel
-&gt; Integer
-&gt; Maybe (Set TxOutRef, Wallet)
-&gt; m (TxBodyContent BuildTx ConwayEra)
</span><a href="Cooked.MockChain.GenerateTx.Body.html#txSkelToTxBodyContent"><span class="hs-identifier hs-var hs-var">txSkelToTxBodyContent</span></a></span></span><span> </span><span id="local-6989586621679833803"><span class="annot"><span class="annottext">skel :: TxSkel
</span><a href="#local-6989586621679833803"><span class="hs-identifier hs-var">skel</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Cooked.Skeleton.html#TxSkel"><span class="hs-identifier hs-type">TxSkel</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679833804"><span id="local-6989586621679833805"><span id="local-6989586621679833806"><span id="local-6989586621679833807"><span id="local-6989586621679833808"><span id="local-6989586621679833809"><span id="local-6989586621679833810"><span id="local-6989586621679833811"><span id="local-6989586621679833812"><span id="local-6989586621679833813"><span class="annot"><span class="annottext">[Wallet]
[TxSkelProposal]
[TxSkelOut]
Set TxOutRef
Set TxLabel
TxSkelWithdrawals
Map TxOutRef TxSkelRedeemer
TxSkelMints
SlotRange
TxOpts
txSkelLabel :: Set TxLabel
txSkelOpts :: TxOpts
txSkelMints :: TxSkelMints
txSkelSigners :: [Wallet]
txSkelValidityRange :: SlotRange
txSkelIns :: Map TxOutRef TxSkelRedeemer
txSkelInsReference :: Set TxOutRef
txSkelOuts :: [TxSkelOut]
txSkelProposals :: [TxSkelProposal]
txSkelWithdrawals :: TxSkelWithdrawals
txSkelLabel :: TxSkel -&gt; Set TxLabel
txSkelOpts :: TxSkel -&gt; TxOpts
txSkelMints :: TxSkel -&gt; TxSkelMints
txSkelSigners :: TxSkel -&gt; [Wallet]
txSkelValidityRange :: TxSkel -&gt; SlotRange
txSkelIns :: TxSkel -&gt; Map TxOutRef TxSkelRedeemer
txSkelInsReference :: TxSkel -&gt; Set TxOutRef
txSkelOuts :: TxSkel -&gt; [TxSkelOut]
txSkelProposals :: TxSkel -&gt; [TxSkelProposal]
txSkelWithdrawals :: TxSkel -&gt; TxSkelWithdrawals
</span><a href="#local-6989586621679833804"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679833824"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679833824"><span class="hs-identifier hs-var">fee</span></a></span></span><span> </span><span id="local-6989586621679833825"><span class="annot"><span class="annottext">Maybe (Set TxOutRef, Wallet)
</span><a href="#local-6989586621679833825"><span class="hs-identifier hs-var">mCollaterals</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679833826"><span class="annot"><span class="annottext">[TxOutRef]
</span><a href="#local-6989586621679833826"><span class="hs-identifier hs-var">txSkelReferenceInputs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxSkel -&gt; [TxOutRef]
</span><a href="Cooked.Skeleton.html#txSkelReferenceTxOutRefs"><span class="hs-identifier hs-var">txSkelReferenceTxOutRefs</span></a></span><span> </span><span class="annot"><span class="annottext">TxSkel
</span><a href="#local-6989586621679833803"><span class="hs-identifier hs-var">skel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-50"></span><span>  </span><span id="local-6989586621679833828"><span class="annot"><span class="annottext">[(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn ConwayEra))]
</span><a href="#local-6989586621679833828"><span class="hs-identifier hs-var">txIns</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((TxOutRef, TxSkelRedeemer)
 -&gt; m (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn ConwayEra)))
-&gt; [(TxOutRef, TxSkelRedeemer)]
-&gt; m [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn ConwayEra))]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">(TxOutRef, TxSkelRedeemer)
-&gt; m (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn ConwayEra))
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
(TxOutRef, TxSkelRedeemer)
-&gt; m (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn ConwayEra))
</span><a href="Cooked.MockChain.GenerateTx.Input.html#toTxInAndWitness"><span class="hs-identifier hs-var">Input.toTxInAndWitness</span></a></span><span> </span><span class="annot"><span class="annottext">([(TxOutRef, TxSkelRedeemer)]
 -&gt; m [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn ConwayEra))])
-&gt; [(TxOutRef, TxSkelRedeemer)]
-&gt; m [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn ConwayEra))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map TxOutRef TxSkelRedeemer -&gt; [(TxOutRef, TxSkelRedeemer)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map TxOutRef TxSkelRedeemer
</span><a href="#local-6989586621679833809"><span class="hs-identifier hs-var">txSkelIns</span></a></span><span>
</span><span id="line-51"></span><span>  </span><span id="local-6989586621679833832"><span class="annot"><span class="annottext">TxInsReference ConwayEra
</span><a href="#local-6989586621679833832"><span class="hs-identifier hs-var">txInsReference</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[TxOutRef] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[TxOutRef]
</span><a href="#local-6989586621679833826"><span class="hs-identifier hs-var">txSkelReferenceInputs</span></a></span><span>
</span><span id="line-53"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TxInsReference ConwayEra -&gt; m (TxInsReference ConwayEra)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TxInsReference ConwayEra
forall era. TxInsReference era
</span><span class="hs-identifier hs-var">Cardano.TxInsReferenceNone</span></span><span>
</span><span id="line-54"></span><span>      </span><span class="hs-keyword">else</span><span>
</span><span id="line-55"></span><span>        </span><span class="annot"><span class="annottext">String
-&gt; ([TxIn] -&gt; TxInsReference ConwayEra)
-&gt; Either ToCardanoError [TxIn]
-&gt; m (TxInsReference ConwayEra)
forall (m :: * -&gt; *) a b.
MonadError MockChainError m =&gt;
String -&gt; (a -&gt; b) -&gt; Either ToCardanoError a -&gt; m b
</span><a href="Cooked.MockChain.GenerateTx.Common.html#throwOnToCardanoErrorOrApply"><span class="hs-identifier hs-var">throwOnToCardanoErrorOrApply</span></a></span><span>
</span><span id="line-56"></span><span>          </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;txSkelToBodyContent: Unable to translate reference inputs.&quot;</span></span><span>
</span><span id="line-57"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BabbageEraOnwards ConwayEra -&gt; [TxIn] -&gt; TxInsReference ConwayEra
forall era. BabbageEraOnwards era -&gt; [TxIn] -&gt; TxInsReference era
</span><span class="hs-identifier hs-var">Cardano.TxInsReference</span></span><span> </span><span class="annot"><span class="annottext">BabbageEraOnwards ConwayEra
</span><span class="hs-identifier hs-var">Cardano.BabbageEraOnwardsConway</span></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span>          </span><span class="annot"><span class="annottext">(Either ToCardanoError [TxIn] -&gt; m (TxInsReference ConwayEra))
-&gt; Either ToCardanoError [TxIn] -&gt; m (TxInsReference ConwayEra)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TxOutRef -&gt; Either ToCardanoError TxIn)
-&gt; [TxOutRef] -&gt; Either ToCardanoError [TxIn]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; Either ToCardanoError TxIn
</span><span class="hs-identifier hs-var">Ledger.toCardanoTxIn</span></span><span> </span><span class="annot"><span class="annottext">[TxOutRef]
</span><a href="#local-6989586621679833826"><span class="hs-identifier hs-var">txSkelReferenceInputs</span></a></span><span>
</span><span id="line-59"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679833839"><span class="annot"><span class="annottext">TxInsCollateral ConwayEra
</span><a href="#local-6989586621679833839"><span class="hs-identifier hs-var">txInsCollateral</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679833840"><span class="annot"><span class="annottext">TxTotalCollateral ConwayEra
</span><a href="#local-6989586621679833840"><span class="hs-identifier hs-var">txTotalCollateral</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679833841"><span class="annot"><span class="annottext">TxReturnCollateral CtxTx ConwayEra
</span><a href="#local-6989586621679833841"><span class="hs-identifier hs-var">txReturnCollateral</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Integer
-&gt; Maybe (Set TxOutRef, Wallet)
-&gt; m (TxInsCollateral ConwayEra, TxTotalCollateral ConwayEra,
      TxReturnCollateral CtxTx ConwayEra)
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
Integer
-&gt; Maybe (Set TxOutRef, Wallet)
-&gt; m (TxInsCollateral ConwayEra, TxTotalCollateral ConwayEra,
      TxReturnCollateral CtxTx ConwayEra)
</span><a href="Cooked.MockChain.GenerateTx.Collateral.html#toCollateralTriplet"><span class="hs-identifier hs-var">Collateral.toCollateralTriplet</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679833824"><span class="hs-identifier hs-var">fee</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Set TxOutRef, Wallet)
</span><a href="#local-6989586621679833825"><span class="hs-identifier hs-var">mCollaterals</span></a></span><span>
</span><span id="line-60"></span><span>  </span><span id="local-6989586621679833843"><span class="annot"><span class="annottext">[TxOut CtxTx ConwayEra]
</span><a href="#local-6989586621679833843"><span class="hs-identifier hs-var">txOuts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TxSkelOut -&gt; m (TxOut CtxTx ConwayEra))
-&gt; [TxSkelOut] -&gt; m [TxOut CtxTx ConwayEra]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">TxSkelOut -&gt; m (TxOut CtxTx ConwayEra)
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
TxSkelOut -&gt; m (TxOut CtxTx ConwayEra)
</span><a href="Cooked.MockChain.GenerateTx.Output.html#toCardanoTxOut"><span class="hs-identifier hs-var">Output.toCardanoTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">[TxSkelOut]
</span><a href="#local-6989586621679833811"><span class="hs-identifier hs-var">txSkelOuts</span></a></span><span>
</span><span id="line-61"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679833845"><span class="annot"><span class="annottext">TxValidityLowerBound ConwayEra
</span><a href="#local-6989586621679833845"><span class="hs-identifier hs-var">txValidityLowerBound</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679833846"><span class="annot"><span class="annottext">TxValidityUpperBound ConwayEra
</span><a href="#local-6989586621679833846"><span class="hs-identifier hs-var">txValidityUpperBound</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-62"></span><span>    </span><span class="annot"><span class="annottext">String
-&gt; Either
     ToCardanoError
     (TxValidityLowerBound ConwayEra, TxValidityUpperBound ConwayEra)
-&gt; m (TxValidityLowerBound ConwayEra,
      TxValidityUpperBound ConwayEra)
forall (m :: * -&gt; *) a.
MonadError MockChainError m =&gt;
String -&gt; Either ToCardanoError a -&gt; m a
</span><a href="Cooked.MockChain.GenerateTx.Common.html#throwOnToCardanoError"><span class="hs-identifier hs-var">throwOnToCardanoError</span></a></span><span>
</span><span id="line-63"></span><span>      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;txSkelToBodyContent: Unable to translate transaction validity range.&quot;</span></span><span>
</span><span id="line-64"></span><span>      </span><span class="annot"><span class="annottext">(Either
   ToCardanoError
   (TxValidityLowerBound ConwayEra, TxValidityUpperBound ConwayEra)
 -&gt; m (TxValidityLowerBound ConwayEra,
       TxValidityUpperBound ConwayEra))
-&gt; Either
     ToCardanoError
     (TxValidityLowerBound ConwayEra, TxValidityUpperBound ConwayEra)
-&gt; m (TxValidityLowerBound ConwayEra,
      TxValidityUpperBound ConwayEra)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SlotRange
-&gt; Either
     ToCardanoError
     (TxValidityLowerBound ConwayEra, TxValidityUpperBound ConwayEra)
</span><span class="hs-identifier hs-var">Ledger.toCardanoValidityRange</span></span><span> </span><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679833808"><span class="hs-identifier hs-var">txSkelValidityRange</span></a></span><span>
</span><span id="line-65"></span><span>  </span><span id="local-6989586621679833849"><span class="annot"><span class="annottext">TxMintValue BuildTx ConwayEra
</span><a href="#local-6989586621679833849"><span class="hs-identifier hs-var">txMintValue</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxSkelMints -&gt; m (TxMintValue BuildTx ConwayEra)
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
TxSkelMints -&gt; m (TxMintValue BuildTx ConwayEra)
</span><a href="Cooked.MockChain.GenerateTx.Mint.html#toMintValue"><span class="hs-identifier hs-var">Mint.toMintValue</span></a></span><span> </span><span class="annot"><span class="annottext">TxSkelMints
</span><a href="#local-6989586621679833806"><span class="hs-identifier hs-var">txSkelMints</span></a></span><span>
</span><span id="line-66"></span><span>  </span><span id="local-6989586621679833851"><span class="annot"><span class="annottext">TxExtraKeyWitnesses ConwayEra
</span><a href="#local-6989586621679833851"><span class="hs-identifier hs-var">txExtraKeyWits</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[Wallet] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Wallet]
</span><a href="#local-6989586621679833807"><span class="hs-identifier hs-var">txSkelSigners</span></a></span><span>
</span><span id="line-68"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TxExtraKeyWitnesses ConwayEra -&gt; m (TxExtraKeyWitnesses ConwayEra)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TxExtraKeyWitnesses ConwayEra
forall era. TxExtraKeyWitnesses era
</span><span class="hs-identifier hs-var">Cardano.TxExtraKeyWitnessesNone</span></span><span>
</span><span id="line-69"></span><span>      </span><span class="hs-keyword">else</span><span>
</span><span id="line-70"></span><span>        </span><span class="annot"><span class="annottext">String
-&gt; ([Hash PaymentKey] -&gt; TxExtraKeyWitnesses ConwayEra)
-&gt; Either ToCardanoError [Hash PaymentKey]
-&gt; m (TxExtraKeyWitnesses ConwayEra)
forall (m :: * -&gt; *) a b.
MonadError MockChainError m =&gt;
String -&gt; (a -&gt; b) -&gt; Either ToCardanoError a -&gt; m b
</span><a href="Cooked.MockChain.GenerateTx.Common.html#throwOnToCardanoErrorOrApply"><span class="hs-identifier hs-var">throwOnToCardanoErrorOrApply</span></a></span><span>
</span><span id="line-71"></span><span>          </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;txSkelToBodyContent: Unable to translate the required signers&quot;</span></span><span>
</span><span id="line-72"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AlonzoEraOnwards ConwayEra
-&gt; [Hash PaymentKey] -&gt; TxExtraKeyWitnesses ConwayEra
forall era.
AlonzoEraOnwards era
-&gt; [Hash PaymentKey] -&gt; TxExtraKeyWitnesses era
</span><span class="hs-identifier hs-var">Cardano.TxExtraKeyWitnesses</span></span><span> </span><span class="annot"><span class="annottext">AlonzoEraOnwards ConwayEra
</span><span class="hs-identifier hs-var">Cardano.AlonzoEraOnwardsConway</span></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>          </span><span class="annot"><span class="annottext">(Either ToCardanoError [Hash PaymentKey]
 -&gt; m (TxExtraKeyWitnesses ConwayEra))
-&gt; Either ToCardanoError [Hash PaymentKey]
-&gt; m (TxExtraKeyWitnesses ConwayEra)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Wallet -&gt; Either ToCardanoError (Hash PaymentKey))
-&gt; [Wallet] -&gt; Either ToCardanoError [Hash PaymentKey]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PaymentPubKeyHash -&gt; Either ToCardanoError (Hash PaymentKey)
</span><span class="hs-identifier hs-var">Ledger.toCardanoPaymentKeyHash</span></span><span> </span><span class="annot"><span class="annottext">(PaymentPubKeyHash -&gt; Either ToCardanoError (Hash PaymentKey))
-&gt; (Wallet -&gt; PaymentPubKeyHash)
-&gt; Wallet
-&gt; Either ToCardanoError (Hash PaymentKey)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PubKeyHash -&gt; PaymentPubKeyHash
</span><span class="hs-identifier hs-var">Ledger.PaymentPubKeyHash</span></span><span> </span><span class="annot"><span class="annottext">(PubKeyHash -&gt; PaymentPubKeyHash)
-&gt; (Wallet -&gt; PubKeyHash) -&gt; Wallet -&gt; PaymentPubKeyHash
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Wallet -&gt; PubKeyHash
</span><a href="Cooked.Wallet.html#walletPKHash"><span class="hs-identifier hs-var">walletPKHash</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Wallet]
</span><a href="#local-6989586621679833807"><span class="hs-identifier hs-var">txSkelSigners</span></a></span><span>
</span><span id="line-74"></span><span>  </span><span id="local-6989586621679833859"><span class="annot"><span class="annottext">BuildTxWith BuildTx (Maybe (LedgerProtocolParameters ConwayEra))
</span><a href="#local-6989586621679833859"><span class="hs-identifier hs-var">txProtocolParams</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (LedgerProtocolParameters ConwayEra)
-&gt; BuildTxWith BuildTx (Maybe (LedgerProtocolParameters ConwayEra))
forall a. a -&gt; BuildTxWith BuildTx a
</span><span class="hs-identifier hs-var">Cardano.BuildTxWith</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (LedgerProtocolParameters ConwayEra)
 -&gt; BuildTxWith
      BuildTx (Maybe (LedgerProtocolParameters ConwayEra)))
-&gt; (Params -&gt; Maybe (LedgerProtocolParameters ConwayEra))
-&gt; Params
-&gt; BuildTxWith BuildTx (Maybe (LedgerProtocolParameters ConwayEra))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LedgerProtocolParameters ConwayEra
-&gt; Maybe (LedgerProtocolParameters ConwayEra)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(LedgerProtocolParameters ConwayEra
 -&gt; Maybe (LedgerProtocolParameters ConwayEra))
-&gt; (Params -&gt; LedgerProtocolParameters ConwayEra)
-&gt; Params
-&gt; Maybe (LedgerProtocolParameters ConwayEra)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Params -&gt; LedgerProtocolParameters ConwayEra
</span><span class="hs-identifier hs-var">Emulator.ledgerProtocolParameters</span></span><span> </span><span class="annot"><span class="annottext">(Params
 -&gt; BuildTxWith
      BuildTx (Maybe (LedgerProtocolParameters ConwayEra)))
-&gt; m Params
-&gt; m (BuildTxWith
        BuildTx (Maybe (LedgerProtocolParameters ConwayEra)))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m Params
forall (m :: * -&gt; *). MonadBlockChainBalancing m =&gt; m Params
</span><a href="Cooked.MockChain.BlockChain.html#getParams"><span class="hs-identifier hs-var">getParams</span></a></span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679833864"><span class="annot"><span class="annottext">txFee :: TxFee ConwayEra
</span><a href="#local-6989586621679833864"><span class="hs-identifier hs-var hs-var">txFee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra ConwayEra -&gt; Coin -&gt; TxFee ConwayEra
forall era. ShelleyBasedEra era -&gt; Coin -&gt; TxFee era
</span><span class="hs-identifier hs-var">Cardano.TxFeeExplicit</span></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra ConwayEra
</span><span class="hs-identifier hs-var">Cardano.ShelleyBasedEraConway</span></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; TxFee ConwayEra) -&gt; Coin -&gt; TxFee ConwayEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><span class="hs-identifier hs-var">Emulator.Coin</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679833824"><span class="hs-identifier hs-var">fee</span></a></span><span>
</span><span id="line-76"></span><span>  </span><span id="local-6989586621679833868"><span class="annot"><span class="annottext">Maybe
  (Featured
     ConwayEraOnwards
     ConwayEra
     (TxProposalProcedures BuildTx ConwayEra))
</span><a href="#local-6989586621679833868"><span class="hs-identifier hs-var">txProposalProcedures</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><span class="annottext">Featured
  ConwayEraOnwards ConwayEra (TxProposalProcedures BuildTx ConwayEra)
-&gt; Maybe
     (Featured
        ConwayEraOnwards
        ConwayEra
        (TxProposalProcedures BuildTx ConwayEra))
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Featured
   ConwayEraOnwards ConwayEra (TxProposalProcedures BuildTx ConwayEra)
 -&gt; Maybe
      (Featured
         ConwayEraOnwards
         ConwayEra
         (TxProposalProcedures BuildTx ConwayEra)))
-&gt; (TxProposalProcedures BuildTx ConwayEra
    -&gt; Featured
         ConwayEraOnwards
         ConwayEra
         (TxProposalProcedures BuildTx ConwayEra))
-&gt; TxProposalProcedures BuildTx ConwayEra
-&gt; Maybe
     (Featured
        ConwayEraOnwards
        ConwayEra
        (TxProposalProcedures BuildTx ConwayEra))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ConwayEraOnwards ConwayEra
-&gt; TxProposalProcedures BuildTx ConwayEra
-&gt; Featured
     ConwayEraOnwards ConwayEra (TxProposalProcedures BuildTx ConwayEra)
forall (eon :: * -&gt; *) era a. eon era -&gt; a -&gt; Featured eon era a
</span><span class="hs-identifier hs-var">Cardano.Featured</span></span><span> </span><span class="annot"><span class="annottext">ConwayEraOnwards ConwayEra
</span><span class="hs-identifier hs-var">Cardano.ConwayEraOnwardsConway</span></span><span>
</span><span id="line-78"></span><span>      </span><span class="annot"><span class="annottext">(TxProposalProcedures BuildTx ConwayEra
 -&gt; Maybe
      (Featured
         ConwayEraOnwards
         ConwayEra
         (TxProposalProcedures BuildTx ConwayEra)))
-&gt; m (TxProposalProcedures BuildTx ConwayEra)
-&gt; m (Maybe
        (Featured
           ConwayEraOnwards
           ConwayEra
           (TxProposalProcedures BuildTx ConwayEra)))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[TxSkelProposal]
-&gt; AnchorResolution -&gt; m (TxProposalProcedures BuildTx ConwayEra)
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
[TxSkelProposal]
-&gt; AnchorResolution -&gt; m (TxProposalProcedures BuildTx ConwayEra)
</span><a href="Cooked.MockChain.GenerateTx.Proposal.html#toProposalProcedures"><span class="hs-identifier hs-var">Proposal.toProposalProcedures</span></a></span><span> </span><span class="annot"><span class="annottext">[TxSkelProposal]
</span><a href="#local-6989586621679833812"><span class="hs-identifier hs-var">txSkelProposals</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOpts -&gt; AnchorResolution
</span><a href="Cooked.Skeleton.Option.html#txOptAnchorResolution"><span class="hs-identifier hs-var">txOptAnchorResolution</span></a></span><span> </span><span class="annot"><span class="annottext">TxOpts
</span><a href="#local-6989586621679833805"><span class="hs-identifier hs-var">txSkelOpts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>  </span><span id="local-6989586621679833873"><span class="annot"><span class="annottext">TxWithdrawals BuildTx ConwayEra
</span><a href="#local-6989586621679833873"><span class="hs-identifier hs-var">txWithdrawals</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxSkelWithdrawals -&gt; m (TxWithdrawals BuildTx ConwayEra)
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
TxSkelWithdrawals -&gt; m (TxWithdrawals BuildTx ConwayEra)
</span><a href="Cooked.MockChain.GenerateTx.Withdrawals.html#toWithdrawals"><span class="hs-identifier hs-var">Withdrawals.toWithdrawals</span></a></span><span> </span><span class="annot"><span class="annottext">TxSkelWithdrawals
</span><a href="#local-6989586621679833813"><span class="hs-identifier hs-var">txSkelWithdrawals</span></a></span><span>
</span><span id="line-80"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679833875"><span class="annot"><span class="annottext">txMetadata :: TxMetadataInEra era
</span><a href="#local-6989586621679833875"><span class="hs-identifier hs-var hs-var">txMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxMetadataInEra era
forall era. TxMetadataInEra era
</span><span class="hs-identifier hs-var">Cardano.TxMetadataNone</span></span><span> </span><span class="hs-comment">-- That's what plutus-apps does as well</span><span>
</span><span id="line-81"></span><span>      </span><span id="local-6989586621679833877"><span class="annot"><span class="annottext">txAuxScripts :: TxAuxScripts era
</span><a href="#local-6989586621679833877"><span class="hs-identifier hs-var hs-var">txAuxScripts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxAuxScripts era
forall era. TxAuxScripts era
</span><span class="hs-identifier hs-var">Cardano.TxAuxScriptsNone</span></span><span> </span><span class="hs-comment">-- That's what plutus-apps does as well</span><span>
</span><span id="line-82"></span><span>      </span><span id="local-6989586621679833879"><span class="annot"><span class="annottext">txUpdateProposal :: TxUpdateProposal era
</span><a href="#local-6989586621679833879"><span class="hs-identifier hs-var hs-var">txUpdateProposal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxUpdateProposal era
forall era. TxUpdateProposal era
</span><span class="hs-identifier hs-var">Cardano.TxUpdateProposalNone</span></span><span> </span><span class="hs-comment">-- That's what plutus-apps does as well</span><span>
</span><span id="line-83"></span><span>      </span><span id="local-6989586621679833881"><span class="annot"><span class="annottext">txCertificates :: TxCertificates build era
</span><a href="#local-6989586621679833881"><span class="hs-identifier hs-var hs-var">txCertificates</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxCertificates build era
forall build era. TxCertificates build era
</span><span class="hs-identifier hs-var">Cardano.TxCertificatesNone</span></span><span> </span><span class="hs-comment">-- That's what plutus-apps does as well</span><span>
</span><span id="line-84"></span><span>      </span><span id="local-6989586621679833883"><span class="annot"><span class="annottext">txScriptValidity :: TxScriptValidity era
</span><a href="#local-6989586621679833883"><span class="hs-identifier hs-var hs-var">txScriptValidity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxScriptValidity era
forall era. TxScriptValidity era
</span><span class="hs-identifier hs-var">Cardano.TxScriptValidityNone</span></span><span> </span><span class="hs-comment">-- That's what plutus-apps does as well</span><span>
</span><span id="line-85"></span><span>      </span><span id="local-6989586621679833885"><span class="annot"><span class="annottext">txVotingProcedures :: Maybe a
</span><a href="#local-6989586621679833885"><span class="hs-identifier hs-var hs-var">txVotingProcedures</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-86"></span><span>      </span><span id="local-6989586621679833886"><span class="annot"><span class="annottext">txCurrentTreasuryValue :: Maybe a
</span><a href="#local-6989586621679833886"><span class="hs-identifier hs-var hs-var">txCurrentTreasuryValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-87"></span><span>      </span><span id="local-6989586621679833887"><span class="annot"><span class="annottext">txTreasuryDonation :: Maybe a
</span><a href="#local-6989586621679833887"><span class="hs-identifier hs-var hs-var">txTreasuryDonation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-88"></span><span>  </span><span class="annot"><span class="annottext">TxBodyContent BuildTx ConwayEra
-&gt; m (TxBodyContent BuildTx ConwayEra)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.TxBodyContent</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">[(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn ConwayEra))]
[TxOut CtxTx ConwayEra]
Maybe (Featured ConwayEraOnwards ConwayEra (Maybe Coin))
Maybe (Featured ConwayEraOnwards ConwayEra Coin)
Maybe
  (Featured
     ConwayEraOnwards
     ConwayEra
     (TxProposalProcedures BuildTx ConwayEra))
Maybe
  (Featured
     ConwayEraOnwards ConwayEra (TxVotingProcedures BuildTx ConwayEra))
BuildTxWith BuildTx (Maybe (LedgerProtocolParameters ConwayEra))
TxScriptValidity ConwayEra
TxAuxScripts ConwayEra
TxCertificates BuildTx ConwayEra
TxExtraKeyWitnesses ConwayEra
TxFee ConwayEra
TxInsCollateral ConwayEra
TxInsReference ConwayEra
TxMetadataInEra ConwayEra
TxMintValue BuildTx ConwayEra
TxReturnCollateral CtxTx ConwayEra
TxTotalCollateral ConwayEra
TxUpdateProposal ConwayEra
TxValidityLowerBound ConwayEra
TxValidityUpperBound ConwayEra
TxWithdrawals BuildTx ConwayEra
forall a. Maybe a
forall era. TxScriptValidity era
forall era. TxAuxScripts era
forall era. TxMetadataInEra era
forall era. TxUpdateProposal era
forall build era. TxCertificates build era
txIns :: [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn ConwayEra))]
txInsReference :: TxInsReference ConwayEra
txInsCollateral :: TxInsCollateral ConwayEra
txTotalCollateral :: TxTotalCollateral ConwayEra
txReturnCollateral :: TxReturnCollateral CtxTx ConwayEra
txOuts :: [TxOut CtxTx ConwayEra]
txValidityLowerBound :: TxValidityLowerBound ConwayEra
txValidityUpperBound :: TxValidityUpperBound ConwayEra
txMintValue :: TxMintValue BuildTx ConwayEra
txExtraKeyWits :: TxExtraKeyWitnesses ConwayEra
txProtocolParams :: BuildTxWith BuildTx (Maybe (LedgerProtocolParameters ConwayEra))
txFee :: TxFee ConwayEra
txProposalProcedures :: Maybe
  (Featured
     ConwayEraOnwards
     ConwayEra
     (TxProposalProcedures BuildTx ConwayEra))
txWithdrawals :: TxWithdrawals BuildTx ConwayEra
txMetadata :: forall era. TxMetadataInEra era
txAuxScripts :: forall era. TxAuxScripts era
txUpdateProposal :: forall era. TxUpdateProposal era
txCertificates :: forall build era. TxCertificates build era
txScriptValidity :: forall era. TxScriptValidity era
txVotingProcedures :: forall a. Maybe a
txCurrentTreasuryValue :: forall a. Maybe a
txTreasuryDonation :: forall a. Maybe a
txAuxScripts :: TxAuxScripts ConwayEra
txCertificates :: TxCertificates BuildTx ConwayEra
txCurrentTreasuryValue :: Maybe (Featured ConwayEraOnwards ConwayEra (Maybe Coin))
txExtraKeyWits :: TxExtraKeyWitnesses ConwayEra
txFee :: TxFee ConwayEra
txIns :: [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn ConwayEra))]
txInsCollateral :: TxInsCollateral ConwayEra
txInsReference :: TxInsReference ConwayEra
txMetadata :: TxMetadataInEra ConwayEra
txMintValue :: TxMintValue BuildTx ConwayEra
txOuts :: [TxOut CtxTx ConwayEra]
txProposalProcedures :: Maybe
  (Featured
     ConwayEraOnwards
     ConwayEra
     (TxProposalProcedures BuildTx ConwayEra))
txProtocolParams :: BuildTxWith BuildTx (Maybe (LedgerProtocolParameters ConwayEra))
txReturnCollateral :: TxReturnCollateral CtxTx ConwayEra
txScriptValidity :: TxScriptValidity ConwayEra
txTotalCollateral :: TxTotalCollateral ConwayEra
txTreasuryDonation :: Maybe (Featured ConwayEraOnwards ConwayEra Coin)
txUpdateProposal :: TxUpdateProposal ConwayEra
txValidityLowerBound :: TxValidityLowerBound ConwayEra
txValidityUpperBound :: TxValidityUpperBound ConwayEra
txVotingProcedures :: Maybe
  (Featured
     ConwayEraOnwards ConwayEra (TxVotingProcedures BuildTx ConwayEra))
txWithdrawals :: TxWithdrawals BuildTx ConwayEra
</span><a href="#local-6989586621679833828"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="annot"><span class="hs-comment">-- | Generates a transaction body from a body content</span></span><span>
</span><span id="line-91"></span><span id="local-6989586621679833568"><span class="annot"><a href="Cooked.MockChain.GenerateTx.Body.html#txBodyContentToTxBody"><span class="hs-identifier hs-type">txBodyContentToTxBody</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-type">MonadBlockChainBalancing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679833568"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.TxBodyContent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.BuildTx</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.ConwayEra</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cooked.Skeleton.html#TxSkel"><span class="hs-identifier hs-type">TxSkel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679833568"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Cardano.TxBody</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.ConwayEra</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-92"></span><span id="txBodyContentToTxBody"><span class="annot"><span class="annottext">txBodyContentToTxBody :: forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
TxBodyContent BuildTx ConwayEra -&gt; TxSkel -&gt; m (TxBody ConwayEra)
</span><a href="Cooked.MockChain.GenerateTx.Body.html#txBodyContentToTxBody"><span class="hs-identifier hs-var hs-var">txBodyContentToTxBody</span></a></span></span><span> </span><span id="local-6989586621679834020"><span class="annot"><span class="annottext">TxBodyContent BuildTx ConwayEra
</span><a href="#local-6989586621679834020"><span class="hs-identifier hs-var">txBodyContent</span></a></span></span><span> </span><span id="local-6989586621679834021"><span class="annot"><span class="annottext">TxSkel
</span><a href="#local-6989586621679834021"><span class="hs-identifier hs-var">skel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-comment">-- We create the associated Shelley TxBody</span><span>
</span><span id="line-94"></span><span>  </span><span id="local-6989586621679834022"><span class="annot"><span class="annottext">txBody :: TxBody ConwayEra
</span><a href="#local-6989586621679834022"><span class="hs-identifier hs-var">txBody</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Cardano.ShelleyTxBody</span></span><span> </span><span id="local-6989586621679834024"><span class="annot"><span class="annottext">ShelleyBasedEra ConwayEra
</span><a href="#local-6989586621679834024"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679834025"><span class="annot"><span class="annottext">TxBody (ShelleyLedgerEra ConwayEra)
</span><a href="#local-6989586621679834025"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621679834026"><span class="annot"><span class="annottext">[Script (ShelleyLedgerEra ConwayEra)]
</span><a href="#local-6989586621679834026"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679834027"><span class="annot"><span class="annottext">TxBodyScriptData ConwayEra
</span><a href="#local-6989586621679834027"><span class="hs-identifier hs-var">dats</span></a></span></span><span> </span><span id="local-6989586621679834028"><span class="annot"><span class="annottext">Maybe (TxAuxData (ShelleyLedgerEra ConwayEra))
</span><a href="#local-6989586621679834028"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621679834029"><span class="annot"><span class="annottext">TxScriptValidity ConwayEra
</span><a href="#local-6989586621679834029"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-95"></span><span>    </span><span class="annot"><span class="annottext">(TxBodyError -&gt; m (TxBody ConwayEra))
-&gt; (TxBody ConwayEra -&gt; m (TxBody ConwayEra))
-&gt; Either TxBodyError (TxBody ConwayEra)
-&gt; m (TxBody ConwayEra)
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span>
</span><span id="line-96"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MockChainError -&gt; m (TxBody ConwayEra)
forall a. MockChainError -&gt; m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(MockChainError -&gt; m (TxBody ConwayEra))
-&gt; (TxBodyError -&gt; MockChainError)
-&gt; TxBodyError
-&gt; m (TxBody ConwayEra)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenerateTxError -&gt; MockChainError
</span><a href="Cooked.MockChain.BlockChain.html#MCEGenerationError"><span class="hs-identifier hs-var">MCEGenerationError</span></a></span><span> </span><span class="annot"><span class="annottext">(GenerateTxError -&gt; MockChainError)
-&gt; (TxBodyError -&gt; GenerateTxError)
-&gt; TxBodyError
-&gt; MockChainError
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; TxBodyError -&gt; GenerateTxError
</span><a href="Cooked.MockChain.BlockChain.html#TxBodyError"><span class="hs-identifier hs-var">TxBodyError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;generateTx :&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>      </span><span class="annot"><span class="annottext">TxBody ConwayEra -&gt; m (TxBody ConwayEra)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-98"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyBasedEra ConwayEra
-&gt; TxBodyContent BuildTx ConwayEra
-&gt; Either TxBodyError (TxBody ConwayEra)
forall era.
HasCallStack =&gt;
ShelleyBasedEra era
-&gt; TxBodyContent BuildTx era -&gt; Either TxBodyError (TxBody era)
</span><span class="hs-identifier hs-var">Cardano.createTransactionBody</span></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra ConwayEra
</span><span class="hs-identifier hs-var">Cardano.ShelleyBasedEraConway</span></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx ConwayEra
</span><a href="#local-6989586621679834020"><span class="hs-identifier hs-var">txBodyContent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-comment">-- There is a chance that the body is in need of additional data. This happens</span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-comment">-- when the set of reference inputs contains hashed datums that will need to</span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-comment">-- be resolved during phase 2 validation. All that follows until the</span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-comment">-- definition of &quot;txBody'&quot; aims at doing just that. In the process, we have to</span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-comment">-- reconstruct the body with the new data and the associated hash. Hopefully,</span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-comment">-- in the future, cardano-api provides a way to add those data in the body</span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-comment">-- directly without requiring this method, which somewhat feels like a hack.</span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-comment">-- We attempt to resolve the reference inputs used by the skeleton</span><span>
</span><span id="line-109"></span><span>  </span><span id="local-6989586621679834035"><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621679834035"><span class="hs-identifier hs-var">refIns</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TxOutRef] -&gt; (TxOutRef -&gt; m TxOut) -&gt; m [TxOut]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxSkel -&gt; [TxOutRef]
</span><a href="Cooked.Skeleton.html#txSkelReferenceTxOutRefs"><span class="hs-identifier hs-var">txSkelReferenceTxOutRefs</span></a></span><span> </span><span class="annot"><span class="annottext">TxSkel
</span><a href="#local-6989586621679834021"><span class="hs-identifier hs-var">skel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((TxOutRef -&gt; m TxOut) -&gt; m [TxOut])
-&gt; (TxOutRef -&gt; m TxOut) -&gt; m [TxOut]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679834037"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679834037"><span class="hs-identifier hs-var">oRef</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-110"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Maybe TxOut -&gt; m TxOut
forall (m :: * -&gt; *) a.
MonadError MockChainError m =&gt;
String -&gt; Maybe a -&gt; m a
</span><a href="Cooked.MockChain.GenerateTx.Common.html#throwOnMaybe"><span class="hs-identifier hs-var">throwOnMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;txSkelToCardanoTx: Unable to resolve TxOutRef &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679834037"><span class="hs-identifier hs-var">oRef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe TxOut -&gt; m TxOut) -&gt; m (Maybe TxOut) -&gt; m TxOut
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; m (Maybe TxOut)
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
TxOutRef -&gt; m (Maybe TxOut)
</span><a href="Cooked.MockChain.BlockChain.html#txOutByRef"><span class="hs-identifier hs-var">txOutByRef</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679834037"><span class="hs-identifier hs-var">oRef</span></a></span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-comment">-- We collect the datum hashes present at these outputs</span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679834042"><span class="annot"><span class="annottext">datumHashes :: [DatumHash]
</span><a href="#local-6989586621679834042"><span class="hs-identifier hs-var hs-var">datumHashes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679834043"><span class="hs-identifier hs-var">hash</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Api.TxOut</span></span><span> </span><span class="annot"><span class="annottext">Address
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Api.OutputDatumHash</span></span><span> </span><span id="local-6989586621679834043"><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679834043"><span class="hs-identifier hs-var">hash</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe ScriptHash
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621679834035"><span class="hs-identifier hs-var">refIns</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-comment">-- We resolve those datum hashes from the context</span><span>
</span><span id="line-114"></span><span>  </span><span id="local-6989586621679834046"><span class="annot"><span class="annottext">[Datum]
</span><a href="#local-6989586621679834046"><span class="hs-identifier hs-var">additionalData</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[DatumHash] -&gt; (DatumHash -&gt; m Datum) -&gt; m [Datum]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[DatumHash]
</span><a href="#local-6989586621679834042"><span class="hs-identifier hs-var">datumHashes</span></a></span><span> </span><span class="annot"><span class="annottext">((DatumHash -&gt; m Datum) -&gt; m [Datum])
-&gt; (DatumHash -&gt; m Datum) -&gt; m [Datum]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679834047"><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679834047"><span class="hs-identifier hs-var">dHash</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-115"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Maybe Datum -&gt; m Datum
forall (m :: * -&gt; *) a.
MonadError MockChainError m =&gt;
String -&gt; Maybe a -&gt; m a
</span><a href="Cooked.MockChain.GenerateTx.Common.html#throwOnMaybe"><span class="hs-identifier hs-var">throwOnMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;txSkelToCardanoTx: Unable to resolve datum hash &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">DatumHash -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679834047"><span class="hs-identifier hs-var">dHash</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe Datum -&gt; m Datum) -&gt; m (Maybe Datum) -&gt; m Datum
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">DatumHash -&gt; m (Maybe Datum)
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
DatumHash -&gt; m (Maybe Datum)
</span><a href="Cooked.MockChain.BlockChain.html#datumFromHash"><span class="hs-identifier hs-var">datumFromHash</span></a></span><span> </span><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679834047"><span class="hs-identifier hs-var">dHash</span></a></span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-comment">-- We compute the map from datum hash to datum of these additional required data</span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679834049"><span class="annot"><span class="annottext">additionalDataMap :: Map DataHash (Data ConwayEra)
</span><a href="#local-6989586621679834049"><span class="hs-identifier hs-var hs-var">additionalDataMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(DataHash, Data ConwayEra)] -&gt; Map DataHash (Data ConwayEra)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Data ConwayEra -&gt; DataHash
forall era. Data era -&gt; DataHash
</span><span class="hs-identifier hs-var">Cardano.hashData</span></span><span> </span><span class="annot"><span class="annottext">Data ConwayEra
</span><a href="#local-6989586621679834052"><span class="hs-identifier hs-var">dat</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Data ConwayEra
</span><a href="#local-6989586621679834052"><span class="hs-identifier hs-var">dat</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.Datum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Data -&gt; Data ConwayEra
forall era. Era era =&gt; Data -&gt; Data era
</span><span class="hs-identifier hs-var">Cardano.Data</span></span><span> </span><span class="annot"><span class="annottext">(Data -&gt; Data ConwayEra)
-&gt; (BuiltinData -&gt; Data) -&gt; BuiltinData -&gt; Data ConwayEra
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BuiltinData -&gt; Data
forall a. ToData a =&gt; a -&gt; Data
</span><span class="hs-identifier hs-var">Api.toData</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679834052"><span class="annot"><span class="annottext">Data ConwayEra
</span><a href="#local-6989586621679834052"><span class="hs-identifier hs-var">dat</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Datum]
</span><a href="#local-6989586621679834046"><span class="hs-identifier hs-var">additionalData</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-comment">-- We retrieve a needed parameter to process difference plutus languages</span><span>
</span><span id="line-119"></span><span>  </span><span id="local-6989586621679834056"><span class="annot"><span class="annottext">Language -&gt; LangDepView
</span><a href="#local-6989586621679834056"><span class="hs-identifier hs-var">toLangDepViewParam</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PParams ConwayEra -&gt; Language -&gt; LangDepView
forall era.
AlonzoEraPParams era =&gt;
PParams era -&gt; Language -&gt; LangDepView
</span><span class="hs-identifier hs-var">Conway.getLanguageView</span></span><span> </span><span class="annot"><span class="annottext">(PParams ConwayEra -&gt; Language -&gt; LangDepView)
-&gt; (Params -&gt; PParams ConwayEra)
-&gt; Params
-&gt; Language
-&gt; LangDepView
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LedgerProtocolParameters ConwayEra
-&gt; PParams (ShelleyLedgerEra ConwayEra)
LedgerProtocolParameters ConwayEra -&gt; PParams ConwayEra
forall era.
LedgerProtocolParameters era -&gt; PParams (ShelleyLedgerEra era)
</span><span class="hs-identifier hs-var">Cardano.unLedgerProtocolParameters</span></span><span> </span><span class="annot"><span class="annottext">(LedgerProtocolParameters ConwayEra -&gt; PParams ConwayEra)
-&gt; (Params -&gt; LedgerProtocolParameters ConwayEra)
-&gt; Params
-&gt; PParams ConwayEra
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Params -&gt; LedgerProtocolParameters ConwayEra
</span><span class="hs-identifier hs-var">Emulator.ledgerProtocolParameters</span></span><span> </span><span class="annot"><span class="annottext">(Params -&gt; Language -&gt; LangDepView)
-&gt; m Params -&gt; m (Language -&gt; LangDepView)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m Params
forall (m :: * -&gt; *). MonadBlockChainBalancing m =&gt; m Params
</span><a href="Cooked.MockChain.BlockChain.html#getParams"><span class="hs-identifier hs-var">getParams</span></a></span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-comment">-- We convert our data map into a 'TxDats'</span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679834059"><span class="annot"><span class="annottext">txDats' :: TxDats ConwayEra
</span><a href="#local-6989586621679834059"><span class="hs-identifier hs-var hs-var">txDats'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map DataHash (Data ConwayEra) -&gt; TxDats ConwayEra
forall era. Era era =&gt; Map DataHash (Data era) -&gt; TxDats era
</span><span class="hs-identifier hs-var">Alonzo.TxDats</span></span><span> </span><span class="annot"><span class="annottext">Map DataHash (Data ConwayEra)
</span><a href="#local-6989586621679834049"><span class="hs-identifier hs-var">additionalDataMap</span></a></span><span>
</span><span id="line-122"></span><span>      </span><span class="hs-comment">-- We compute the new era, datums and redeemers based on the current dats</span><span>
</span><span id="line-123"></span><span>      </span><span class="hs-comment">-- in the body and the additional data to include in the body.</span><span>
</span><span id="line-124"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679834061"><span class="annot"><span class="annottext">AlonzoEraOnwards ConwayEra
</span><a href="#local-6989586621679834061"><span class="hs-identifier hs-var">era</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679834062"><span class="annot"><span class="annottext">TxDats ConwayEra
</span><a href="#local-6989586621679834062"><span class="hs-identifier hs-var">datums</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679834063"><span class="annot"><span class="annottext">Redeemers ConwayEra
</span><a href="#local-6989586621679834063"><span class="hs-identifier hs-var">redeemers</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TxBodyScriptData ConwayEra
</span><a href="#local-6989586621679834027"><span class="hs-identifier hs-var">dats</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-125"></span><span>        </span><span class="annot"><span class="annottext">TxBodyScriptData ConwayEra
</span><span class="hs-identifier hs-var">Cardano.TxBodyNoScriptData</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AlonzoEraOnwards ConwayEra
</span><span class="hs-identifier hs-var">Cardano.AlonzoEraOnwardsConway</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxDats ConwayEra
</span><a href="#local-6989586621679834059"><span class="hs-identifier hs-var">txDats'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map (PlutusPurpose AsIx ConwayEra) (Data ConwayEra, ExUnits)
-&gt; Redeemers ConwayEra
forall era.
AlonzoEraScript era =&gt;
Map (PlutusPurpose AsIx era) (Data era, ExUnits) -&gt; Redeemers era
</span><span class="hs-identifier hs-var">Alonzo.Redeemers</span></span><span> </span><span class="annot"><span class="annottext">Map (PlutusPurpose AsIx ConwayEra) (Data ConwayEra, ExUnits)
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Cardano.TxBodyScriptData</span></span><span> </span><span id="local-6989586621679834071"><span class="annot"><span class="annottext">AlonzoEraOnwards ConwayEra
</span><a href="#local-6989586621679834071"><span class="hs-identifier hs-var">era'</span></a></span></span><span> </span><span id="local-6989586621679834072"><span class="annot"><span class="annottext">TxDats (ShelleyLedgerEra ConwayEra)
</span><a href="#local-6989586621679834072"><span class="hs-identifier hs-var">txDats</span></a></span></span><span> </span><span id="local-6989586621679834073"><span class="annot"><span class="annottext">Redeemers (ShelleyLedgerEra ConwayEra)
</span><a href="#local-6989586621679834073"><span class="hs-identifier hs-var">reds</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AlonzoEraOnwards ConwayEra
</span><a href="#local-6989586621679834071"><span class="hs-identifier hs-var">era'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxDats (ShelleyLedgerEra ConwayEra)
TxDats ConwayEra
</span><a href="#local-6989586621679834072"><span class="hs-identifier hs-var">txDats</span></a></span><span> </span><span class="annot"><span class="annottext">TxDats ConwayEra -&gt; TxDats ConwayEra -&gt; TxDats ConwayEra
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TxDats ConwayEra
</span><a href="#local-6989586621679834059"><span class="hs-identifier hs-var">txDats'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Redeemers (ShelleyLedgerEra ConwayEra)
Redeemers ConwayEra
</span><a href="#local-6989586621679834073"><span class="hs-identifier hs-var">reds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>      </span><span class="hs-comment">-- We collect the various witnesses in the body</span><span>
</span><span id="line-128"></span><span>      </span><span id="local-6989586621679834074"><span class="annot"><span class="annottext">witnesses :: [(ScriptWitnessIndex, AnyScriptWitness ConwayEra)]
</span><a href="#local-6989586621679834074"><span class="hs-identifier hs-var hs-var">witnesses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra ConwayEra
-&gt; TxBodyContent BuildTx ConwayEra
-&gt; [(ScriptWitnessIndex, AnyScriptWitness ConwayEra)]
forall era.
ShelleyBasedEra era
-&gt; TxBodyContent BuildTx era
-&gt; [(ScriptWitnessIndex, AnyScriptWitness era)]
</span><span class="hs-identifier hs-var">Cardano.collectTxBodyScriptWitnesses</span></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra ConwayEra
</span><span class="hs-identifier hs-var">Cardano.ShelleyBasedEraConway</span></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx ConwayEra
</span><a href="#local-6989586621679834020"><span class="hs-identifier hs-var">txBodyContent</span></a></span><span>
</span><span id="line-129"></span><span>      </span><span class="hs-comment">-- We collect their associated languages</span><span>
</span><span id="line-130"></span><span>      </span><span id="local-6989586621679834076"><span class="annot"><span class="annottext">languages :: [Language]
</span><a href="#local-6989586621679834076"><span class="hs-identifier hs-var hs-var">languages</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PlutusScriptVersion lang -&gt; Language
forall lang. PlutusScriptVersion lang -&gt; Language
</span><a href="#local-6989586621679834077"><span class="hs-identifier hs-var">toCardanoLanguage</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScriptVersion lang
</span><a href="#local-6989586621679834078"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptWitnessIndex
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.AnyScriptWitness</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Cardano.PlutusScriptWitness</span></span><span> </span><span class="annot"><span class="annottext">ScriptLanguageInEra lang ConwayEra
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679834078"><span class="annot"><span class="annottext">PlutusScriptVersion lang
</span><a href="#local-6989586621679834078"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">PlutusScriptOrReferenceInput lang
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ScriptDatum witctx
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ExecutionUnits
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(ScriptWitnessIndex, AnyScriptWitness ConwayEra)]
</span><a href="#local-6989586621679834074"><span class="hs-identifier hs-var">witnesses</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-131"></span><span>      </span><span class="hs-comment">-- We compute the new script integrity hash with the added data</span><span>
</span><span id="line-132"></span><span>      </span><span id="local-6989586621679834083"><span class="annot"><span class="annottext">scriptIntegrityHash :: StrictMaybe ScriptIntegrityHash
</span><a href="#local-6989586621679834083"><span class="hs-identifier hs-var hs-var">scriptIntegrityHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-133"></span><span>        </span><span class="annot"><span class="annottext">AlonzoEraOnwards ConwayEra
-&gt; (AlonzoEraOnwardsConstraints ConwayEra =&gt;
    StrictMaybe ScriptIntegrityHash)
-&gt; StrictMaybe ScriptIntegrityHash
forall era a.
AlonzoEraOnwards era -&gt; (AlonzoEraOnwardsConstraints era =&gt; a) -&gt; a
</span><span class="hs-identifier hs-var">Cardano.alonzoEraOnwardsConstraints</span></span><span> </span><span class="annot"><span class="annottext">AlonzoEraOnwards ConwayEra
</span><a href="#local-6989586621679834061"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">((AlonzoEraOnwardsConstraints ConwayEra =&gt;
  StrictMaybe ScriptIntegrityHash)
 -&gt; StrictMaybe ScriptIntegrityHash)
-&gt; (AlonzoEraOnwardsConstraints ConwayEra =&gt;
    StrictMaybe ScriptIntegrityHash)
-&gt; StrictMaybe ScriptIntegrityHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-134"></span><span>          </span><span class="annot"><span class="annottext">Set LangDepView
-&gt; Redeemers ConwayEra
-&gt; TxDats ConwayEra
-&gt; StrictMaybe ScriptIntegrityHash
forall era.
AlonzoEraScript era =&gt;
Set LangDepView
-&gt; Redeemers era -&gt; TxDats era -&gt; StrictMaybe ScriptIntegrityHash
</span><span class="hs-identifier hs-var">Alonzo.hashScriptIntegrity</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LangDepView] -&gt; Set LangDepView
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([LangDepView] -&gt; Set LangDepView)
-&gt; [LangDepView] -&gt; Set LangDepView
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Language -&gt; LangDepView
</span><a href="#local-6989586621679834056"><span class="hs-identifier hs-var">toLangDepViewParam</span></a></span><span> </span><span class="annot"><span class="annottext">(Language -&gt; LangDepView) -&gt; [Language] -&gt; [LangDepView]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Language]
</span><a href="#local-6989586621679834076"><span class="hs-identifier hs-var">languages</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Redeemers ConwayEra
</span><a href="#local-6989586621679834063"><span class="hs-identifier hs-var">redeemers</span></a></span><span> </span><span class="annot"><span class="annottext">TxDats ConwayEra
</span><a href="#local-6989586621679834062"><span class="hs-identifier hs-var">datums</span></a></span><span>
</span><span id="line-135"></span><span>      </span><span class="hs-comment">-- We wrap all of this in the new body</span><span>
</span><span id="line-136"></span><span>      </span><span id="local-6989586621679834097"><span class="annot"><span class="annottext">body' :: ConwayTxBody ConwayEra
</span><a href="#local-6989586621679834097"><span class="hs-identifier hs-var hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxBody (ShelleyLedgerEra ConwayEra)
ConwayTxBody ConwayEra
</span><a href="#local-6989586621679834025"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ConwayTxBody ConwayEra
-&gt; (ConwayTxBody ConwayEra -&gt; ConwayTxBody ConwayEra)
-&gt; ConwayTxBody ConwayEra
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">Lens.&amp;</span></span><span> </span><span class="annot"><span class="annottext">(StrictMaybe ScriptIntegrityHash
 -&gt; Identity (StrictMaybe ScriptIntegrityHash))
-&gt; TxBody ConwayEra -&gt; Identity (TxBody ConwayEra)
(StrictMaybe ScriptIntegrityHash
 -&gt; Identity (StrictMaybe ScriptIntegrityHash))
-&gt; ConwayTxBody ConwayEra -&gt; Identity (ConwayTxBody ConwayEra)
forall era.
AlonzoEraTxBody era =&gt;
Lens' (TxBody era) (StrictMaybe ScriptIntegrityHash)
Lens' (TxBody ConwayEra) (StrictMaybe ScriptIntegrityHash)
</span><span class="hs-identifier hs-var">Alonzo.scriptIntegrityHashTxBodyL</span></span><span> </span><span class="annot"><span class="annottext">((StrictMaybe ScriptIntegrityHash
  -&gt; Identity (StrictMaybe ScriptIntegrityHash))
 -&gt; ConwayTxBody ConwayEra -&gt; Identity (ConwayTxBody ConwayEra))
-&gt; StrictMaybe ScriptIntegrityHash
-&gt; ConwayTxBody ConwayEra
-&gt; ConwayTxBody ConwayEra
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">Lens..~</span></span><span> </span><span class="annot"><span class="annottext">StrictMaybe ScriptIntegrityHash
</span><a href="#local-6989586621679834083"><span class="hs-identifier hs-var">scriptIntegrityHash</span></a></span><span>
</span><span id="line-137"></span><span>      </span><span id="local-6989586621679834101"><span class="annot"><span class="annottext">txBody' :: TxBody ConwayEra
</span><a href="#local-6989586621679834101"><span class="hs-identifier hs-var hs-var">txBody'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra ConwayEra
-&gt; TxBody (ShelleyLedgerEra ConwayEra)
-&gt; [Script (ShelleyLedgerEra ConwayEra)]
-&gt; TxBodyScriptData ConwayEra
-&gt; Maybe (TxAuxData (ShelleyLedgerEra ConwayEra))
-&gt; TxScriptValidity ConwayEra
-&gt; TxBody ConwayEra
forall era.
ShelleyBasedEra era
-&gt; TxBody (ShelleyLedgerEra era)
-&gt; [Script (ShelleyLedgerEra era)]
-&gt; TxBodyScriptData era
-&gt; Maybe (TxAuxData (ShelleyLedgerEra era))
-&gt; TxScriptValidity era
-&gt; TxBody era
</span><span class="hs-identifier hs-var">Cardano.ShelleyTxBody</span></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra ConwayEra
</span><a href="#local-6989586621679834024"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody (ShelleyLedgerEra ConwayEra)
ConwayTxBody ConwayEra
</span><a href="#local-6989586621679834097"><span class="hs-identifier hs-var">body'</span></a></span><span> </span><span class="annot"><span class="annottext">[Script (ShelleyLedgerEra ConwayEra)]
</span><a href="#local-6989586621679834026"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AlonzoEraOnwards ConwayEra
-&gt; TxDats (ShelleyLedgerEra ConwayEra)
-&gt; Redeemers (ShelleyLedgerEra ConwayEra)
-&gt; TxBodyScriptData ConwayEra
forall era.
AlonzoEraOnwardsConstraints era =&gt;
AlonzoEraOnwards era
-&gt; TxDats (ShelleyLedgerEra era)
-&gt; Redeemers (ShelleyLedgerEra era)
-&gt; TxBodyScriptData era
</span><span class="hs-identifier hs-var">Cardano.TxBodyScriptData</span></span><span> </span><span class="annot"><span class="annottext">AlonzoEraOnwards ConwayEra
</span><a href="#local-6989586621679834061"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">TxDats (ShelleyLedgerEra ConwayEra)
TxDats ConwayEra
</span><a href="#local-6989586621679834062"><span class="hs-identifier hs-var">datums</span></a></span><span> </span><span class="annot"><span class="annottext">Redeemers (ShelleyLedgerEra ConwayEra)
Redeemers ConwayEra
</span><a href="#local-6989586621679834063"><span class="hs-identifier hs-var">redeemers</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (TxAuxData (ShelleyLedgerEra ConwayEra))
</span><a href="#local-6989586621679834028"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">TxScriptValidity ConwayEra
</span><a href="#local-6989586621679834029"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span>  </span><span class="annot"><span class="annottext">TxBody ConwayEra -&gt; m (TxBody ConwayEra)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(TxBody ConwayEra -&gt; m (TxBody ConwayEra))
-&gt; TxBody ConwayEra -&gt; m (TxBody ConwayEra)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Map DataHash (Data ConwayEra) -&gt; Bool
forall a. Map DataHash a -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">Map DataHash (Data ConwayEra)
</span><a href="#local-6989586621679834049"><span class="hs-identifier hs-var">additionalDataMap</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TxBody ConwayEra
</span><a href="#local-6989586621679834022"><span class="hs-identifier hs-var">txBody</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">TxBody ConwayEra
</span><a href="#local-6989586621679834101"><span class="hs-identifier hs-var">txBody'</span></a></span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-141"></span><span>    </span><span id="local-6989586621679833717"><span class="annot"><a href="#local-6989586621679834077"><span class="hs-identifier hs-type">toCardanoLanguage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.PlutusScriptVersion</span></span><span> </span><span class="annot"><a href="#local-6989586621679833717"><span class="hs-identifier hs-type">lang</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.Language</span></span></span><span>
</span><span id="line-142"></span><span>    </span><span id="local-6989586621679834077"><span class="annot"><span class="annottext">toCardanoLanguage :: forall lang. PlutusScriptVersion lang -&gt; Language
</span><a href="#local-6989586621679834077"><span class="hs-identifier hs-var hs-var">toCardanoLanguage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-143"></span><span>      </span><span class="annot"><span class="annottext">PlutusScriptVersion lang
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptV1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Language
</span><span class="hs-identifier hs-var">Cardano.PlutusV1</span></span><span>
</span><span id="line-144"></span><span>      </span><span class="annot"><span class="annottext">PlutusScriptVersion lang
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptV2</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Language
</span><span class="hs-identifier hs-var">Cardano.PlutusV2</span></span><span>
</span><span id="line-145"></span><span>      </span><span class="annot"><span class="annottext">PlutusScriptVersion lang
</span><span class="hs-identifier hs-var">Cardano.PlutusScriptV3</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Language
</span><span class="hs-identifier hs-var">Cardano.PlutusV3</span></span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span class="hs-comment">-- | Generates a transaction body from a 'TxSkel' and associated fee and</span><span>
</span><span id="line-148"></span><span class="hs-comment">-- collateral information</span><span>
</span><span id="line-149"></span><span id="local-6989586621679833748"><span class="annot"><a href="Cooked.MockChain.GenerateTx.Body.html#txSkelToTxBody"><span class="hs-identifier hs-type">txSkelToTxBody</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cooked.MockChain.BlockChain.html#MonadBlockChainBalancing"><span class="hs-identifier hs-type">MonadBlockChainBalancing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679833748"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cooked.Skeleton.html#TxSkel"><span class="hs-identifier hs-type">TxSkel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Api.TxOutRef</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cooked.Wallet.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679833748"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Cardano.TxBody</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cardano.ConwayEra</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-150"></span><span id="txSkelToTxBody"><span class="annot"><span class="annottext">txSkelToTxBody :: forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
TxSkel
-&gt; Integer -&gt; Maybe (Set TxOutRef, Wallet) -&gt; m (TxBody ConwayEra)
</span><a href="Cooked.MockChain.GenerateTx.Body.html#txSkelToTxBody"><span class="hs-identifier hs-var hs-var">txSkelToTxBody</span></a></span></span><span> </span><span id="local-6989586621679834117"><span class="annot"><span class="annottext">TxSkel
</span><a href="#local-6989586621679834117"><span class="hs-identifier hs-var">skel</span></a></span></span><span> </span><span id="local-6989586621679834118"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679834118"><span class="hs-identifier hs-var">fee</span></a></span></span><span> </span><span id="local-6989586621679834119"><span class="annot"><span class="annottext">Maybe (Set TxOutRef, Wallet)
</span><a href="#local-6989586621679834119"><span class="hs-identifier hs-var">mCollaterals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-151"></span><span>  </span><span id="local-6989586621679834120"><span class="annot"><span class="annottext">TxBodyContent BuildTx ConwayEra
</span><a href="#local-6989586621679834120"><span class="hs-identifier hs-var">txBodyContent</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxSkel
-&gt; Integer
-&gt; Maybe (Set TxOutRef, Wallet)
-&gt; m (TxBodyContent BuildTx ConwayEra)
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
TxSkel
-&gt; Integer
-&gt; Maybe (Set TxOutRef, Wallet)
-&gt; m (TxBodyContent BuildTx ConwayEra)
</span><a href="Cooked.MockChain.GenerateTx.Body.html#txSkelToTxBodyContent"><span class="hs-identifier hs-var">txSkelToTxBodyContent</span></a></span><span> </span><span class="annot"><span class="annottext">TxSkel
</span><a href="#local-6989586621679834117"><span class="hs-identifier hs-var">skel</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679834118"><span class="hs-identifier hs-var">fee</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Set TxOutRef, Wallet)
</span><a href="#local-6989586621679834119"><span class="hs-identifier hs-var">mCollaterals</span></a></span><span>
</span><span id="line-152"></span><span>  </span><span class="annot"><span class="annottext">TxBodyContent BuildTx ConwayEra -&gt; TxSkel -&gt; m (TxBody ConwayEra)
forall (m :: * -&gt; *).
MonadBlockChainBalancing m =&gt;
TxBodyContent BuildTx ConwayEra -&gt; TxSkel -&gt; m (TxBody ConwayEra)
</span><a href="Cooked.MockChain.GenerateTx.Body.html#txBodyContentToTxBody"><span class="hs-identifier hs-var">txBodyContentToTxBody</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx ConwayEra
</span><a href="#local-6989586621679834120"><span class="hs-identifier hs-var">txBodyContent</span></a></span><span> </span><span class="annot"><span class="annottext">TxSkel
</span><a href="#local-6989586621679834117"><span class="hs-identifier hs-var">skel</span></a></span><span>
</span><span id="line-153"></span></pre></body></html>